var ho=Object.defineProperty,mo=Object.defineProperties;var go=Object.getOwnPropertyDescriptors;var un=Object.getOwnPropertySymbols;var ko=Object.prototype.hasOwnProperty,bo=Object.prototype.propertyIsEnumerable;var fn=(t,e,n)=>e in t?ho(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Yt=(t,e)=>{for(var n in e||(e={}))ko.call(e,n)&&fn(t,n,e[n]);if(un)for(var n of un(e))bo.call(e,n)&&fn(t,n,e[n]);return t},Kt=(t,e)=>mo(t,go(e));import{S as Je,i as Qe,n as Ze,P as po,k as at,Q as vo,f as R,F as lt,d as B,T as Ot,u as Co,e as Q,j as $,c as Z,a as x,l as ee,b as X,U as O,s as E,m as Re,o as W,p as Le,q as G,w as ge,x as ke,y as be,L as Pe,B as pe,V as Rt,W as K,X as on,Y as Ln,Z as ie,J,_ as rn,t as ue,g as fe,h as Fe,$ as cn,a0 as he,a1 as de,v as jn,a2 as _o,a3 as wo,a4 as yo,a5 as Nn,a6 as hn,I as So,a7 as Mo}from"../../chunks/index-91a5e740.js";import{F as je,f as dt,a as Po,b as an,M as Fo,m as Et,n as Do,t as Eo,c as Bo,d as Io,e as To,g as Ao,h as qo,i as Vo,j as Gn,q as Zt,k as xt}from"../../chunks/merged-header-icon-fca71072.js";import{p as zo}from"../../chunks/stores-c16cb913.js";import{d as Oo,i as Ro,m as Pt,a as tt,b as Lo,E as mt,c as jo,f as No,p as Go,e as Ho,g as Xe,o as st,s as gt,h as we,j as Lt,F as Ie,k as $t,l as Hn,t as pt,n as en,q as tn,R as Xo,r as nn,V as Ft,B as He,u as dn,v as wt,w as Wo,x as Yo,y as Ko,z as Uo,A as Jo,C as Ut,D as Qo,G as Zo,H as xo,I as $o,J as er,K as tr,L as nr,M as or,N as rr,O as ir,P as ar,Q as lr,S as sr}from"../../chunks/format-page-title-d2ff14dd.js";import{S as Xn,_ as Bt,a as kt,b as vt,c as ur,i as et,O as Ye,n as ln,d as fr,B as It,e as Me,w as cr}from"../../chunks/store-afb7c6c1.js";import{m as hr,g as Wn,a as Yn,c as bt,p as mn,o as Kn,f as gn,b as dr,i as Un,d as mr}from"../../chunks/index.es-98a5a7c8.js";import{r as nt,a as gr}from"../../chunks/theme-option-c3fe1088.js";import{t as Ue}from"../../chunks/tap-495987ce.js";import{d as kn}from"../../chunks/dialog-manager-2d1393e2.js";import"../../chunks/index-dccf800c.js";import"../../chunks/singletons-d1fb5791.js";const Jn=!0;var ct={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,r=ct.delegate;r&&(e=r.requestAnimationFrame,n=r.cancelAnimationFrame);var o=e(function(i){n=void 0,t(i)});return new Xn(function(){return n==null?void 0:n(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ct.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Bt([],kt(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ct.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,Bt([],kt(t)))},delegate:void 0},kr=function(t){vt(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Xn),Tt={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Tt.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,Bt([t,e],kt(n))):setInterval.apply(void 0,Bt([t,e],kt(n)))},clearInterval:function(t){var e=Tt.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Qn=function(t){vt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(i,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),Tt.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;Tt.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ur(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(kr),bn=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=Oo.now,t}(),Zn=function(t){vt(e,t);function e(n,r){r===void 0&&(r=bn.now);var o=t.call(this,n,r)||this;return o.actions=[],o._active=!1,o._scheduled=void 0,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(bn),jt=new Zn(Qn),br=jt,pr=function(t){vt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o}return e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),o!==null&&o>0?t.prototype.requestAsyncId.call(this,n,r,o):(n.actions.push(this),n._scheduled||(n._scheduled=ct.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&o>0||o==null&&this.delay>0)return t.prototype.recycleAsyncId.call(this,n,r,o);n.actions.some(function(i){return i.id===r})||(ct.cancelAnimationFrame(r),n._scheduled=void 0)},e}(Qn),vr=function(t){vt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var o=this.actions,i;n=n||o.shift();do if(i=n.execute(n.state,n.delay))break;while((n=o[0])&&n.id===r&&o.shift());if(this._active=!1,i){for(;(n=o[0])&&n.id===r&&o.shift();)n.unsubscribe();throw i}},e}(Zn),Nt=new vr(pr);function Cr(t){return t instanceof Date&&!isNaN(t)}var _r=["addListener","removeListener"],wr=["addEventListener","removeEventListener"],yr=["on","off"];function We(t,e,n,r){if(et(n)&&(r=n,n=void 0),r)return We(t,e,n).pipe(hr(r));var o=kt(Pr(t)?wr.map(function(l){return function(s){return t[l](e,s,n)}}):Sr(t)?_r.map(pn(t,e)):Mr(t)?yr.map(pn(t,e)):[],2),i=o[0],a=o[1];if(!i&&Ro(t))return Pt(function(l){return We(l,e,n)})(tt(t));if(!i)throw new TypeError("Invalid event target");return new Ye(function(l){var s=function(){for(var u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];return l.next(1<u.length?u:u[0])};return i(s),function(){return a(s)}})}function pn(t,e){return function(n){return function(r){return t[n](e,r)}}}function Sr(t){return et(t.addListener)&&et(t.removeListener)}function Mr(t){return et(t.on)&&et(t.off)}function Pr(t){return et(t.addEventListener)&&et(t.removeEventListener)}function Gt(t,e,n){t===void 0&&(t=0),n===void 0&&(n=br);var r=-1;return e!=null&&(Lo(e)?n=e:r=e),new Ye(function(o){var i=Cr(t)?+t-n.now():t;i<0&&(i=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function Fr(t,e){return t===void 0&&(t=0),e===void 0&&(e=jt),t<0&&(t=0),Gt(t,t,e)}function Ht(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Go(t),r=Ho(t,1/0),o=t;return o.length?o.length===1?tt(o[0]):jo(r)(No(o,n)):mt}var xn=new Ye(ln),Dr=Array.isArray;function Er(t){return t.length===1&&Dr(t[0])?t[0]:t}function Br(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=Er(t),t.length===1?tt(t[0]):new Ye(Ir(t))}function Ir(t){return function(e){for(var n=[],r=function(i){n.push(tt(t[i]).subscribe(Xe(e,function(a){if(n){for(var l=0;l<n.length;l++)l!==i&&n[l].unsubscribe();n=null}e.next(a)})))},o=0;n&&!e.closed&&o<t.length;o++)r(o)}}function Tr(t){return st(function(e,n){var r=!1,o=null,i=null,a=function(){if(i==null||i.unsubscribe(),i=null,r){r=!1;var l=o;o=null,n.next(l)}};e.subscribe(Xe(n,function(l){i==null||i.unsubscribe(),r=!0,o=l,i=Xe(n,a,ln),tt(t(l)).subscribe(i)},function(){a(),n.complete()},void 0,function(){o=i=null}))})}function At(t,e){return e===void 0&&(e=jt),st(function(n,r){var o=null,i=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var u=i;i=null,r.next(u)}};function s(){var u=a+t,d=e.now();if(d<u){o=this.schedule(void 0,u-d),r.add(o);return}l()}n.subscribe(Xe(r,function(u){i=u,a=e.now(),o||(o=e.schedule(s,t),r.add(o))},function(){l(),r.complete()},void 0,function(){i=o=null}))})}function $n(t,e){return e===void 0&&(e=fr),t=t!=null?t:Ar,st(function(n,r){var o,i=!0;n.subscribe(Xe(r,function(a){var l=e(a);(i||!t(o,l))&&(i=!1,o=l,r.next(a))}))})}function Ar(t,e){return t===e}function qr(){return st(function(t,e){var n,r=!1;t.subscribe(Xe(e,function(o){var i=n;n=o,r&&e.next([i,o]),r=!0}))})}function qe(t){return st(function(e,n){tt(t).subscribe(Xe(n,function(){return n.complete()},ln)),!n.closed&&e.subscribe(n)})}var eo={leading:!0,trailing:!1};function Vr(t,e){return e===void 0&&(e=eo),st(function(n,r){var o=e.leading,i=e.trailing,a=!1,l=null,s=null,u=!1,d=function(){s==null||s.unsubscribe(),s=null,i&&(f(),u&&r.complete())},b=function(){s=null,u&&r.complete()},c=function(g){return s=tt(t(g)).subscribe(Xe(r,d,b))},f=function(){if(a){a=!1;var g=l;l=null,r.next(g),!u&&c(g)}};n.subscribe(Xe(r,function(g){a=!0,l=g,!(s&&!s.closed)&&(o?f():c(g))},function(){u=!0,!(i&&a&&s&&!s.closed)&&r.complete()}))})}function zr(t,e,n){e===void 0&&(e=jt),n===void 0&&(n=eo);var r=Gt(t,e);return Vr(function(){return r},n)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const sn=new It([]),qt=new Me,Ct=new Me,it=new Me;function to(t){const e=t.filter(i=>!i.parentChapter);let n=t.find(i=>i.progress<100);n||(n=t[t.length-1]);const r=n.parentChapter||n.reference,o=e.findIndex(i=>i.reference===r);return[e,o,r]}function Or(t){let e,n;return{c(){e=new po(!1),n=at(),this.h()},l(r){e=vo(r,!1),n=at(),this.h()},h(){e.a=n},m(r,o){e.m(t[0],r,o),R(r,n,o)},p(r,[o]){o&1&&e.p(r[0])},i:lt,o:lt,d(r){r&&B(n),r&&e.d()}}}function Rr(t,e,n){let{html:r}=e;const o=Ot();return Co(()=>{o("load")}),t.$$set=i=>{"html"in i&&n(0,r=i.html)},[r]}class no extends Je{constructor(e){super(),Qe(this,e,Rr,Or,Ze,{html:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ot(t,e){return e==="rtl"?-t:t}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Lr{constructor(e,n,r){this.calculator=e,this.window=n,this.firstDimensionMargin=r}scrollToBookmark(e){const n=this.getBookmarkPosition(e);if(!n)return;const{scrollToData:r}=vn(n,this.firstDimensionMargin);this.window.scrollTo(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount,{verticalMode:o}=this.calculator,i=o?"scrollX":"scrollY";return{dataId:e,exploredCharCount:n,progress:n/r,[i]:this.window[i]}}getBookmarkBarPosition(e){const n=this.getBookmarkPosition(e);if(!!n)return vn(n,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:n}=this.calculator,r=this.getBookmarkTargetPosByScrollValue(e);if(r)return r;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return n?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:n}=e,r=o=>{const i=e[o];if(!i)return;const a=ot(i,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===n)return{[o]:i}};return this.calculator.verticalMode?r("scrollX"):r("scrollY")}}function vn(t,e){return"scrollX"in t?{scrollToData:{left:t.scrollX},bookmarkPosData:{right:`${-t.scrollX+e}px`}}:{scrollToData:{top:t.scrollY},bookmarkPosData:{top:`${t.scrollY+e}px`}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function jr(t){const e=(n,r,o,i)=>{if(o<r)return t!=null?t:o;const a=Math.floor((r+o)/2);return n[a]===i?a:n[a]>i?e(n,r,a-1,i):e(n,a+1,o,i)};return(n,r)=>e(n,0,n.length-1,r)}const Vt=jr(void 0);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class oo{constructor(e,n,r,o,i){this.containerEl=e,this.axis=n,this.direction=r,this.scrollEl=o,this.document=i,this.paragraphPosToAccCharCount=new Map,this.paragraphs=Wn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=Yn(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const n=this.scrollEl.getBoundingClientRect(),r=ot(this.verticalMode?n.right:n.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),i=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=this.getNodeBoundingRect(l),d=ot(this.verticalMode?s.left:s.bottom,this.direction)-r-o+e;this.paragraphPos[a]=d;const b=i.get(d)||[];i.set(d,b),b.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(i.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(){return this.getCharCountByScrollPos(this.scrollPos)}getCharCountByScrollPos(e){const n=Vt(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[n])||0}getScrollPosByCharCount(e){const n=Vt(this.accumulatedCharCount,e);return ot(this.paragraphPos[n],this.direction)}getNodeBoundingRect(e){const n=this.document.createRange();return n.selectNode(e),n.getBoundingClientRect()}get scrollPos(){return ot(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Nr(t,e,n){const r=Xr(e,n)(t,"scrollLeft");return(o,i,a)=>{if(!Gr(o))return;const l=Hr(o,i,a);r(-l),o.preventDefault()}}function Gr(t){return!(!t.deltaY||t.deltaX||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)}function Hr(t,e,n){switch(t.deltaMode){case 0:return t.deltaY;case 1:return t.deltaY*e*1.75;default:return t.deltaY*n}}function Xr(t,e){return(n,r)=>{let o=!1,i=t[r],a=t[r];const l=()=>{o=!0;const s=Math.trunc((i-t[r])/n);if(t[r]!==a){o=!1;return}if(a+=s,t.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(i=t[r],a=t[r]),i+=s,o||e(l)}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Wr{constructor(e,n,r){this.verticalMode=e,this.firstDimensionMargin=n,this.window=r}nextPage(){this.scrollByPercent(.9)}prevPage(){this.scrollByPercent(-.9)}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let n=this.window.innerHeight,r="top",o=1;this.verticalMode&&(n=this.window.innerWidth,r="left",o=-1);const i=n-this.firstDimensionMargin*2;this.window.scrollBy({[r]:i*e*o,behavior:"smooth"})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Yr{constructor(e,n,r,o,i=Nt){this.multiplier=e,this.verticalMode=n,this.enabled$=new It(!1),this.enabled$.pipe(gt(a=>{if(!a)return mt;let l=0;return Fr(0,i).pipe(we(()=>Date.now()),qr(),we(s=>this.calcNewPos(s)),we(s=>{l+=s;const u=Math.trunc(l);return l-=u,u}),Lt(s=>s!==0))}),qe(r)).subscribe(a=>{let l="top";n&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,n]){let r=.00365956;return this.verticalMode&&(r=-91489e-8),r*this.multiplier*(n-e)}}const{document:Kr,window:Ur}=Ln;function Cn(t){let e,n,r,o,i;return{c(){e=Q("div"),r=$(),o=Q("div"),this.h()},l(a){e=Z(a,"DIV",{class:!0,style:!0}),x(e).forEach(B),r=ee(a),o=Z(a,"DIV",{class:!0,style:!0}),x(o).forEach(B),this.h()},h(){X(e,"class","fixed z-[5]"),X(e,"style",n=t[21]+": 100%; "+t[20]+": "+t[14]+"px; "+t[19][0]+": 0"),O(e,"inset-y-0",t[2]),O(e,"inset-x-0",!t[2]),E(e,"background-color",t[4],!1),X(o,"class","fixed z-[5]"),X(o,"style",i=t[21]+": 100%; "+t[20]+": "+t[14]+"px; "+t[19][1]+": 0"),O(o,"inset-y-0",t[2]),O(o,"inset-x-0",!t[2]),E(o,"background-color",t[4],!1)},m(a,l){R(a,e,l),R(a,r,l),R(a,o,l)},p(a,l){l[0]&3686400&&n!==(n=a[21]+": 100%; "+a[20]+": "+a[14]+"px; "+a[19][0]+": 0")&&X(e,"style",n),l[0]&4&&O(e,"inset-y-0",a[2]),l[0]&4&&O(e,"inset-x-0",!a[2]),l[0]&16&&E(e,"background-color",a[4],!1),l[0]&3686400&&i!==(i=a[21]+": 100%; "+a[20]+": "+a[14]+"px; "+a[19][1]+": 0")&&X(o,"style",i),l[0]&4&&O(o,"inset-y-0",a[2]),l[0]&4&&O(o,"inset-x-0",!a[2]),l[0]&16&&E(o,"background-color",a[4],!1)},d(a){a&&B(e),a&&B(r),a&&B(o)}}}function _n(t){let e,n,r,o;const i=[Qr,Jr],a=[];function l(s,u){return s[2]?0:1}return e=l(t),n=a[e]=i[e](t),{c(){n.c(),r=at()},l(s){n.l(s),r=at()},m(s,u){a[e].m(s,u),R(s,r,u),o=!0},p(s,u){let d=e;e=l(s),e===d?a[e].p(s,u):(Re(),W(a[d],1,1,()=>{a[d]=null}),Le(),n=a[e],n?n.p(s,u):(n=a[e]=i[e](s),n.c()),G(n,1),n.m(r.parentNode,r))},i(s){o||(G(n),o=!0)},o(s){W(n),o=!1},d(s){a[e].d(s),s&&B(r)}}}function Jr(t){let e,n,r;return n=new je({props:{icon:dt}}),{c(){e=Q("div"),ge(n.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var i=x(e);ke(n.$$.fragment,i),i.forEach(B),this.h()},h(){X(e,"class","pointer-events-none absolute text-sm opacity-25 sm:text-xl"),E(e,"color",t[3],!1),E(e,"left",t[16],!1),E(e,"top",`calc(${t[17].top} + 1.5rem)`,!1)},m(o,i){R(o,e,i),be(n,e,null),r=!0},p(o,i){i[0]&8&&E(e,"color",o[3],!1),i[0]&65536&&E(e,"left",o[16],!1),i[0]&131072&&E(e,"top",`calc(${o[17].top} + 1.5rem)`,!1)},i(o){r||(G(n.$$.fragment,o),r=!0)},o(o){W(n.$$.fragment,o),r=!1},d(o){o&&B(e),pe(n)}}}function Qr(t){let e,n,r;return n=new je({props:{icon:dt}}),{c(){e=Q("div"),ge(n.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var i=x(e);ke(n.$$.fragment,i),i.forEach(B),this.h()},h(){X(e,"class","pointer-events-none absolute text-xl opacity-25"),E(e,"color",t[3],!1),E(e,"right",`calc(${t[17].right} + 1rem)`,!1),E(e,"top",t[16],!1)},m(o,i){R(o,e,i),be(n,e,null),r=!0},p(o,i){i[0]&8&&E(e,"color",o[3],!1),i[0]&131072&&E(e,"right",`calc(${o[17].right} + 1rem)`,!1),i[0]&65536&&E(e,"top",o[16],!1)},i(o){r||(G(n.$$.fragment,o),r=!0)},o(o){W(n.$$.fragment,o),r=!1},d(o){o&&B(e),pe(n)}}}function Zr(t){let e,n,r=`${t[7]}px`,o=`${t[18]||t[1]}px`,i,a,l,s,u,d;n=new no({props:{html:t[0]}}),n.$on("load",t[24]);let b=t[14]&&Cn(t),c=t[17]&&_n(t);return{c(){e=Q("div"),ge(n.$$.fragment),i=$(),b&&b.c(),a=$(),c&&c.c(),l=$(),this.h()},l(f){e=Z(f,"DIV",{class:!0});var g=x(e);ke(n.$$.fragment,g),g.forEach(B),i=ee(f),b&&b.l(f),a=ee(f),c&&c.l(f),l=ee(f),this.h()},h(){X(e,"class","book-content m-auto svelte-1tqbqao"),O(e,"book-content--writing-vertical-rl",t[2]),O(e,"book-content--writing-horizontal-rl",!t[2]),O(e,"book-content--hide-furigana",t[11]),O(e,"book-content--hide-spoiler-image",t[10]),O(e,"book-content--furigana-style-partial",t[12]===Ie.Partial),O(e,"book-content--furigana-style-full",t[12]===Ie.Full),O(e,"book-content--furigana-style-toggle",t[12]===Ie.Toggle),E(e,"color",t[3],!1),E(e,"font-size",r,!1),E(e,"max-width",!t[2]&&t[13]?`${t[13]}px`:void 0,!1),E(e,"max-height",t[18]?`${t[18]}px`:void 0,!1),E(e,"padding-left",t[2]&&t[14]?`${t[14]}px`:void 0,!1),E(e,"padding-right",t[2]&&t[14]?`${t[14]}px`:void 0,!1),E(e,"padding-top",!t[2]&&t[14]?`${t[14]}px`:void 0,!1),E(e,"padding-bottom",!t[2]&&t[14]?`${t[14]}px`:void 0,!1),E(e,"--font-family-serif",t[8],!1),E(e,"--font-family-sans-serif",t[9],!1),E(e,"--book-content-hint-furigana-font-color",t[5],!1),E(e,"--book-content-hint-furigana-shadow-color",t[6],!1),E(e,"--book-content-child-height",o,!1)},m(f,g){R(f,e,g),be(n,e,null),t[41](e),R(f,i,g),b&&b.m(f,g),R(f,a,g),c&&c.m(f,g),R(f,l,g),s=!0,u||(d=[Pe(Ur,"scroll",t[23]),Pe(Kr.body,"wheel",t[22],{passive:!1})],u=!0)},p(f,g){const y={};g[0]&1&&(y.html=f[0]),n.$set(y),g[0]&4&&O(e,"book-content--writing-vertical-rl",f[2]),g[0]&4&&O(e,"book-content--writing-horizontal-rl",!f[2]),g[0]&2048&&O(e,"book-content--hide-furigana",f[11]),g[0]&1024&&O(e,"book-content--hide-spoiler-image",f[10]),g[0]&4096&&O(e,"book-content--furigana-style-partial",f[12]===Ie.Partial),g[0]&4096&&O(e,"book-content--furigana-style-full",f[12]===Ie.Full),g[0]&4096&&O(e,"book-content--furigana-style-toggle",f[12]===Ie.Toggle),g[0]&8&&E(e,"color",f[3],!1),g[0]&128&&r!==(r=`${f[7]}px`)&&E(e,"font-size",r,!1),g[0]&8196&&E(e,"max-width",!f[2]&&f[13]?`${f[13]}px`:void 0,!1),g[0]&262144&&E(e,"max-height",f[18]?`${f[18]}px`:void 0,!1),g[0]&16388&&E(e,"padding-left",f[2]&&f[14]?`${f[14]}px`:void 0,!1),g[0]&16388&&E(e,"padding-right",f[2]&&f[14]?`${f[14]}px`:void 0,!1),g[0]&16388&&E(e,"padding-top",!f[2]&&f[14]?`${f[14]}px`:void 0,!1),g[0]&16388&&E(e,"padding-bottom",!f[2]&&f[14]?`${f[14]}px`:void 0,!1),g[0]&256&&E(e,"--font-family-serif",f[8],!1),g[0]&512&&E(e,"--font-family-sans-serif",f[9],!1),g[0]&32&&E(e,"--book-content-hint-furigana-font-color",f[5],!1),g[0]&64&&E(e,"--book-content-hint-furigana-shadow-color",f[6],!1),g[0]&262146&&o!==(o=`${f[18]||f[1]}px`)&&E(e,"--book-content-child-height",o,!1),f[14]?b?b.p(f,g):(b=Cn(f),b.c(),b.m(a.parentNode,a)):b&&(b.d(1),b=null),f[17]?c?(c.p(f,g),g[0]&131072&&G(c,1)):(c=_n(f),c.c(),G(c,1),c.m(l.parentNode,l)):c&&(Re(),W(c,1,1,()=>{c=null}),Le())},i(f){s||(G(n.$$.fragment,f),G(c),s=!0)},o(f){W(n.$$.fragment,f),W(c),s=!1},d(f){f&&B(e),pe(n),t[41](null),f&&B(i),b&&b.d(f),f&&B(a),c&&c.d(f),f&&B(l),u=!1,Rt(d)}}}function xr(t,e,n){let r,o,i,a,l;K(t,it,D=>n(47,l=D));let{htmlContent:s}=e,{width:u}=e,{height:d}=e,{verticalMode:b}=e,{fontColor:c}=e,{backgroundColor:f}=e,{hintFuriganaFontColor:g}=e,{hintFuriganaShadowColor:y}=e,{fontSize:m}=e,{fontFamilyGroupOne:v}=e,{fontFamilyGroupTwo:S}=e,{hideSpoilerImage:h}=e,{hideFurigana:C}=e,{furiganaStyle:F}=e,{secondDimensionMaxValue:A}=e,{firstDimensionMargin:V}=e,{autoPositionOnResize:Y}=e,{autoBookmark:oe}=e,{loadingState:ae}=e,{multiplier:p}=e,{bookmarkData:I}=e,{exploredCharCount:_}=e,{bookCharCount:T}=e,{autoScroller:z}=e,{bookmarkManager:H}=e,{pageManager:L}=e;const te=Ot();let j,U,M={},q,le,N,Ce,se,ye=0,ce=!1,ve=window.matchMedia("(min-width: 640px)").matches?"0.5rem":"0.25rem";const De=Nr(4,document.documentElement,requestAnimationFrame),Ee=new Me,Se=new Me,_e=new Me,me=new Map,Ve=new Map;let ze=0,Te=!1;on(()=>{_e.next(),_e.complete()}),q=new Yr(p,b,_e,document),z=q,bt([Ee,Se]).pipe(Lt(()=>Y),$t(1),we(([D,re])=>b?re:D),$n(),At(10),Hn(Nt),qe(_e)).subscribe(()=>{if(!U||!N)return;const D=U.getScrollPosByCharCount(ye);ce=!0,N.scrollTo(D)});function xe(D){D.updateParagraphPos(),n(25,_=D.calcExploredCharCount()),se&&(se=!1,I.then(re=>{!re||!H||H.scrollToBookmark(re)}).finally(()=>{oe&&We(window,"scroll").pipe($t(1),At(3e3),qe(_e)).subscribe(()=>{te("bookmark")}),sn.pipe(pt(1),gt(re=>re.length?(re.forEach(Ge=>{const Be=Ge.reference,Oe=document.getElementById(Be);Oe&&(ze||(ze=Number(getComputedStyle(Oe)[b?"marginLeft":"marginBottom"].replace(/px$/,""))/2),Ve.set(Be,Kt(Yt({},Ge),{progress:0})),me.set(Be,Oe))}),me.size?(Ke(),We(window,"scroll")):mt):mt),Tr(()=>Gt(Te?100:500)),qe(_e)).subscribe(Ke)})),n(37,M={})}function Ke(){const D=[...Ve.entries()];for(let re=0,{length:Ge}=D;re<Ge;re+=1){const[Be,Oe]=D[re],k=me.get(Be).getBoundingClientRect();Oe.progress=b?Math.min(Math.max(k.right+(V||0)-window.innerWidth,0),k.width)/(k.width||1)*100:Math.abs(Math.min(Math.max(k.top-(V||0),-k.height),0))/(k.height||1)*100,Ve.set(Be,Oe)}Te=!1,qt.next(Ve)}function Ne(D){b&&!l&&De(D,m,window.innerWidth)}function $e(){requestAnimationFrame(()=>{!U||(n(25,_=U.calcExploredCharCount()),ce||(ye=_),ce=!1)})}function P(){!j||(n(36,U=new oo(j,b?"vertical":"horizontal",b?"rtl":"ltr",document.documentElement,document)),n(25,_=0),ye=_,n(26,T=U.charCount),te("contentChange",j))}Ct.pipe(qe(_e)).subscribe(D=>{let re=document.getElementById(D);if(!re)return;re=!D.startsWith(mn)&&re.closest(`div[id^="${mn}"]`)||re,Te=!0;const Be=re.getBoundingClientRect();b?window.scrollBy(-(window.innerWidth-Be.right-(V||0)-ze),0):window.scrollBy(0,Be.top-(V||0)-ze)});function ne(D){ie[D?"unshift":"push"](()=>{j=D,n(15,j)})}return t.$$set=D=>{"htmlContent"in D&&n(0,s=D.htmlContent),"width"in D&&n(30,u=D.width),"height"in D&&n(1,d=D.height),"verticalMode"in D&&n(2,b=D.verticalMode),"fontColor"in D&&n(3,c=D.fontColor),"backgroundColor"in D&&n(4,f=D.backgroundColor),"hintFuriganaFontColor"in D&&n(5,g=D.hintFuriganaFontColor),"hintFuriganaShadowColor"in D&&n(6,y=D.hintFuriganaShadowColor),"fontSize"in D&&n(7,m=D.fontSize),"fontFamilyGroupOne"in D&&n(8,v=D.fontFamilyGroupOne),"fontFamilyGroupTwo"in D&&n(9,S=D.fontFamilyGroupTwo),"hideSpoilerImage"in D&&n(10,h=D.hideSpoilerImage),"hideFurigana"in D&&n(11,C=D.hideFurigana),"furiganaStyle"in D&&n(12,F=D.furiganaStyle),"secondDimensionMaxValue"in D&&n(13,A=D.secondDimensionMaxValue),"firstDimensionMargin"in D&&n(14,V=D.firstDimensionMargin),"autoPositionOnResize"in D&&n(31,Y=D.autoPositionOnResize),"autoBookmark"in D&&n(32,oe=D.autoBookmark),"loadingState"in D&&n(33,ae=D.loadingState),"multiplier"in D&&n(34,p=D.multiplier),"bookmarkData"in D&&n(35,I=D.bookmarkData),"exploredCharCount"in D&&n(25,_=D.exploredCharCount),"bookCharCount"in D&&n(26,T=D.bookCharCount),"autoScroller"in D&&n(27,z=D.autoScroller),"bookmarkManager"in D&&n(28,H=D.bookmarkManager),"pageManager"in D&&n(29,L=D.pageManager)},t.$$.update=()=>{if(t.$$.dirty[0]&4&&n(21,r=b?"height":"width"),t.$$.dirty[0]&4&&n(20,o=b?"width":"height"),t.$$.dirty[0]&4&&n(19,i=b?["left","right"]:["top","bottom"]),t.$$.dirty[0]&1073741824&&Ee.next(u),t.$$.dirty[0]&2&&Se.next(d),t.$$.dirty[0]&8196&&n(18,a=b&&A?A:void 0),t.$$.dirty[0]&106500&&A&&j){const D=Number(getComputedStyle(j)[b?"marginTop":"marginRight"].replace(/px$/,""));n(16,ve=`min(max(calc(${`${D}px - ${ve}`}), ${ve}), ${D?`${D}px`:ve})`)}if(t.$$.dirty[0]&1&&s&&(se=!0),t.$$.dirty[0]&1073741826|t.$$.dirty[1]&36&&U&&u&&d&&!ae){const D=U;requestAnimationFrame(()=>{xe(D)})}t.$$.dirty[0]&4|t.$$.dirty[1]&136&&q&&(n(38,q.multiplier=p,q),n(38,q.verticalMode=b,q)),t.$$.dirty[0]&16384|t.$$.dirty[1]&288&&U&&(n(39,le=U&&new Lr(U,window,V||0)),n(28,H=le)),t.$$.dirty[1]&336&&M&&(n(17,Ce=void 0),I.then(D=>{!D||n(17,Ce=le==null?void 0:le.getBookmarkBarPosition(D))})),t.$$.dirty[0]&16388|t.$$.dirty[1]&512&&(n(40,N=new Wr(b,V,window)),n(29,L=N))},[s,d,b,c,f,g,y,m,v,S,h,C,F,A,V,j,ve,Ce,a,i,o,r,Ne,$e,P,_,T,z,H,L,u,Y,oe,ae,p,I,U,M,q,le,N,ne]}class $r extends Je{constructor(e){super(),Qe(this,e,xr,Zr,Ze,{htmlContent:0,width:30,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontSize:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,hideSpoilerImage:10,hideFurigana:11,furiganaStyle:12,secondDimensionMaxValue:13,firstDimensionMargin:14,autoPositionOnResize:31,autoBookmark:32,loadingState:33,multiplier:34,bookmarkData:35,exploredCharCount:25,bookCharCount:26,autoScroller:27,bookmarkManager:28,pageManager:29},null,[-1,-1])}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const ei="px-4 md:px-8";/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ht(t,e=Jn){return e?t():xn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ti(t){const e=Array.from(t.getElementsByTagName("img"));return new Ye(n=>{const r=e.filter(i=>i.src).map(ni);if(r.length<=0){n.next(!1),n.complete();return}const o=bt(r).subscribe(()=>{n.next(!1),n.complete()});return n.next(!0),o})}function ni(t){return t.complete?Kn(1):Br(We(t,"load"),We(t,"error"))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function oi(t,e){const n=ri(t),r=ai(t);return o=>Ht(n(o),ii(o,e),r(o))}function ri(t){return e=>{const n=Array.from(e.getElementsByTagName("a"));n.forEach(o=>{o.href=t.location.pathname+o.hash});const r=n.map(o=>zt(o).pipe(Ue(()=>Ct.next(o.hash.substring(1)))));return Ht(...r)}}function ii(t,e){const n=e===Ie.Toggle,o=Array.from(t.getElementsByTagName("ruby")).map(i=>n?zt(i).pipe(Ue(()=>{i.classList.toggle("reveal-rt")})):zt(i).pipe(pt(1),Ue(()=>{i.classList.add("reveal-rt")})));return Ht(...o)}function ai(t){return e=>{const r=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const i=t.createElement("span");return i.classList.add("spoiler-label"),i.setAttribute("aria-hidden","true"),i.innerText="\u30CD\u30BF\u30D0\u30EC",o.appendChild(i),zt(o).pipe(pt(1),Ue(()=>{o.removeChild(i),o.removeAttribute("data-ttu-spoiler-img")}))});return Ht(...r)}}function zt(t){return We(t,"click").pipe(Ue(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const li=300,si=60,ro="none";function ft(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function ui(t,e){return e.filter(n=>t.pointerId!==n.pointerId)}function yt(t,e,n,r,o){t.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:n,pointersCount:r.length}}))}function fi(t,e,n,r,o,i=ro){e.style.touchAction=i;let a=[];function l(u){a.push(u),yt(e,t,u,a,"down"),r==null||r(a,u);const d=u.pointerId;function b(v){d===v.pointerId&&(a=ui(v,a),a.length||c(),yt(e,t,v,a,"up"),o==null||o(a,v))}function c(){f(),g(),y(),m()}const f=ft(e,"pointermove",v=>{a=a.map(S=>v.pointerId===S.pointerId?v:S),yt(e,t,v,a,"move"),n==null||n(a,v)}),g=ft(e,"lostpointercapture",v=>{b(v)}),y=ft(e,"pointerup",v=>{b(v)}),m=ft(e,"pointerleave",v=>{a=[],c(),yt(e,t,v,a,"up"),o==null||o(a,v)})}const s=ft(e,"pointerdown",l);return{destroy:()=>{s()}}}function ci(t,e={timeframe:li,minSwipeDistance:si,touchAction:ro}){const n="swipe";let r,o,i,a;function l(u,d){o=d.clientX,i=d.clientY,r=Date.now(),u.length===1&&(a=d.target)}function s(u,d){if(d.type==="pointerup"&&u.length===0&&Date.now()-r<e.timeframe){const b=d.clientX-o,c=d.clientY-i,f=Math.abs(b),g=Math.abs(c);let y=null;f>=2*g&&f>e.minSwipeDistance?y=b>0?"right":"left":g>=2*f&&g>e.minSwipeDistance&&(y=c>0?"bottom":"top"),y&&t.dispatchEvent(new CustomEvent(n,{detail:{direction:y,target:a}}))}}return fi(n,t,null,l,s,e.touchAction)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class hi{constructor(e,n,r,o,i,a,l,s,u,d,b){this.contentEl=e,this.scrollEl=n,this.sections=r,this.sectionIndex$=o,this.virtualScrollPos$=i,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=u,this.pageChange$=d,this.sectionRenderComplete$=b,this.translateX=0,this.sectionData=new Map,sn.pipe(pt(1)).subscribe(c=>{!c.length||(c.forEach(f=>{this.sectionData.set(f.reference,Kt(Yt({},f),{progress:0}))}),qt.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}flipPage(e){const n=this.verticalMode?"scrollHeight":"scrollWidth",r=this.verticalMode?this.height:this.width,o=r+this.pageGap,i=!0;if(this.translateX){const b=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const c=this.translateX;b(),this.scrollToPos(-c-o,i);return}if(this.nextSection(i)){b();return}return}const a=0,l=this.scrollEl[n],s=this.virtualScrollPos$.getValue(),u=s+o*e,d=Math.ceil(u);if(d<a){if(s!==a){this.scrollToPos(a,i);return}this.prevSection(o,n,r,i);return}if(d>=l){this.nextSection(i);return}this.scrollOrTranslateToPos(u,l,r,i)}scrollTo(e,n){const r=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[r],o,n)}prevSection(e,n,r,o){const i=this.sectionIndex$.getValue()-1;return i<0?!1:(this.updateSectionIndex(i).subscribe(()=>{const a=this.scrollEl[n];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,r,o)}),!0)}nextSection(e){const n=this.sectionIndex$.getValue()+1;return n>=this.sections.length?!1:(this.updateSectionIndex(n).subscribe(()=>{var r,o;this.scrollToPos(0,e),this.updateSectionData((r=this.sections[n-1])==null?void 0:r.id,100,!1),this.updateSectionData((o=this.sections[n])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,n,r,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/n*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+r<=n){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,n){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(n)}translateXToPos(e,n){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(n)}updateSectionIndex(e){return new Ye(n=>{if(this.sectionIndex$.getValue()===e){n.next(),n.complete();return}const r=this.sectionRenderComplete$.subscribe(o=>{o===e&&n.next(),n.complete(),r.unsubscribe()});return this.sectionIndex$.next(e),r})}updateSectionData(e,n,r=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let i=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=n:i?l.progress=0:l.progress=100,!i&&s&&(i=!0),this.sectionData.set(a.reference,l)}),r&&qt.next(this.sectionData)}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class di{constructor(e,n,r,o,i,a,l,s,u){this.containerEl=e,this.sections=n,this.virtualScrollPos$=r,this.getWidth=o,this.getHeight=i,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=u,this.sectionIndex=-1;const d=c=>Wn(c).reduce((g,y)=>g+Yn(y),0);let b=0;this.sectionAccCharCounts=n.map(c=>(b+=d(c),b)),this.charCount=b}updateCurrentSection(e){this.calculator=new oo(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(){const e=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+e)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const n=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+n}getSectionIndexByCharCount(e){return Vt(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const n=this.getSectionStartCount(),r=this.sectionAccCharCounts[this.sectionIndex],o=e-n,i=e===r&&r-n>0;if(o<0||e>r||i)return-1;if(o===0)return 0;const a=Vt(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,u=l[a];if(Number.isNaN(Number(s[a])))return-1;const d=(y,m)=>y>=m?m:l[y]>u?y:d(y+1,m),b=s[d(a+1,l.length-1)],{screenSize:c}=this,f=this.verticalMode?-1:0,g=c*(Math.ceil(b/c)+f);return ot(g,this.calculator.direction)}isCharOnScreen(e){const n=this.getScrollPosByCharCount(e),r=this.virtualScrollPos$.getValue();return n===r}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class mi{constructor(e,n,r,o,i){this.calculator=e,this.pageManager=n,this.sectionReady$=r,this.sectionIndex$=o,this.setIntendedCharCount=i}scrollToBookmark(e){const n=e.exploredCharCount;if(!n)return;const r=this.calculator.getSectionIndexByCharCount(n),o=l=>{const s=l.getScrollPosByCharCount(n);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(n)};if(this.sectionIndex$.getValue()===r){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount;return{dataId:e,exploredCharCount:n,progress:n/r}}}function wn(t){let e,n,r;return n=new je({props:{icon:Po,spin:!0}}),{c(){e=Q("div"),ge(n.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var i=x(e);ke(n.$$.fragment,i),i.forEach(B),this.h()},h(){X(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),E(e,"color",t[4],!1),E(e,"background-color",t[5],!1)},m(o,i){R(o,e,i),be(n,e,null),r=!0},p(o,i){i[0]&16&&E(e,"color",o[4],!1),i[0]&32&&E(e,"background-color",o[5],!1)},i(o){r||(G(n.$$.fragment,o),r=!0)},o(o){W(n.$$.fragment,o),r=!1},d(o){o&&B(e),pe(n)}}}function yn(t){let e,n,r;return n=new je({props:{icon:dt}}),{c(){e=Q("div"),ge(n.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var i=x(e);ke(n.$$.fragment,i),i.forEach(B),this.h()},h(){X(e,"class","fixed top-3 right-3 text-xl opacity-25"),E(e,"color",t[4],!1)},m(o,i){R(o,e,i),be(n,e,null),r=!0},p(o,i){i[0]&16&&E(e,"color",o[4],!1)},i(o){r||(G(n.$$.fragment,o),r=!0)},o(o){W(n.$$.fragment,o),r=!1},d(o){o&&B(e),pe(n)}}}function gi(t){let e,n,r,o=`${t[8]}px`,i=`${t[1]}px`,a=`${t[2]}px`,l=`${t[3]?t[1]:(t[1]+rt)/t[20]-rt}px`,s,u,d,b,c,f;r=new no({props:{html:t[19]}}),r.$on("load",t[21]);let g=!t[18]&&wn(t),y=t[0]&&yn(t);return{c(){e=Q("div"),n=Q("div"),ge(r.$$.fragment),s=$(),g&&g.c(),u=$(),y&&y.c(),d=at(),this.h()},l(m){e=Z(m,"DIV",{class:!0});var v=x(e);n=Z(v,"DIV",{class:!0});var S=x(n);ke(r.$$.fragment,S),S.forEach(B),v.forEach(B),s=ee(m),g&&g.l(m),u=ee(m),y&&y.l(m),d=at(),this.h()},h(){X(n,"class","book-content-container svelte-np4m3j"),X(e,"class","book-content m-auto svelte-np4m3j"),O(e,"book-content--avoid-page-break",t[14]),O(e,"book-content--writing-vertical-rl",t[3]),O(e,"book-content--writing-horizontal-rl",!t[3]),O(e,"book-content--hide-furigana",t[12]),O(e,"book-content--hide-spoiler-image",t[11]),O(e,"book-content--furigana-style-partial",t[13]===Ie.Partial),O(e,"book-content--furigana-style-full",t[13]===Ie.Full),O(e,"book-content--furigana-style-toggle",t[13]===Ie.Toggle),E(e,"color",t[4],!1),E(e,"font-size",o,!1),E(e,"padding-top",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),E(e,"padding-bottom",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),E(e,"padding-left",t[3]&&t[15]?`${t[15]}px`:void 0,!1),E(e,"padding-right",t[3]&&t[15]?`${t[15]}px`:void 0,!1),E(e,"max-width",t[1]?`${t[1]}px`:void 0,!1),E(e,"max-height",t[3]&&t[2]?`${t[2]}px`:void 0,!1),E(e,"--font-family-serif",t[9],!1),E(e,"--font-family-sans-serif",t[10],!1),E(e,"--book-content-hint-furigana-font-color",t[6],!1),E(e,"--book-content-hint-furigana-shadow-color",t[7],!1),E(e,"--book-content-child-width",i,!1),E(e,"--book-content-child-height",a,!1),E(e,"--book-content-column-count",t[20],!1),E(e,"--book-content-image-max-width",l,!1)},m(m,v){R(m,e,v),J(e,n),be(r,n,null),t[37](n),t[38](e),R(m,s,v),g&&g.m(m,v),R(m,u,v),y&&y.m(m,v),R(m,d,v),b=!0,c||(f=[Pe(window,"keydown",t[23]),rn(ci.call(null,e,{timeframe:500,minSwipeDistance:10,touchAction:"pan-y"})),Pe(e,"swipe",t[22])],c=!0)},p(m,v){const S={};v[0]&524288&&(S.html=m[19]),r.$set(S),v[0]&16384&&O(e,"book-content--avoid-page-break",m[14]),v[0]&8&&O(e,"book-content--writing-vertical-rl",m[3]),v[0]&8&&O(e,"book-content--writing-horizontal-rl",!m[3]),v[0]&4096&&O(e,"book-content--hide-furigana",m[12]),v[0]&2048&&O(e,"book-content--hide-spoiler-image",m[11]),v[0]&8192&&O(e,"book-content--furigana-style-partial",m[13]===Ie.Partial),v[0]&8192&&O(e,"book-content--furigana-style-full",m[13]===Ie.Full),v[0]&8192&&O(e,"book-content--furigana-style-toggle",m[13]===Ie.Toggle),v[0]&16&&E(e,"color",m[4],!1),v[0]&256&&o!==(o=`${m[8]}px`)&&E(e,"font-size",o,!1),v[0]&32776&&E(e,"padding-top",!m[3]&&m[15]?`${m[15]}px`:void 0,!1),v[0]&32776&&E(e,"padding-bottom",!m[3]&&m[15]?`${m[15]}px`:void 0,!1),v[0]&32776&&E(e,"padding-left",m[3]&&m[15]?`${m[15]}px`:void 0,!1),v[0]&32776&&E(e,"padding-right",m[3]&&m[15]?`${m[15]}px`:void 0,!1),v[0]&2&&E(e,"max-width",m[1]?`${m[1]}px`:void 0,!1),v[0]&12&&E(e,"max-height",m[3]&&m[2]?`${m[2]}px`:void 0,!1),v[0]&512&&E(e,"--font-family-serif",m[9],!1),v[0]&1024&&E(e,"--font-family-sans-serif",m[10],!1),v[0]&64&&E(e,"--book-content-hint-furigana-font-color",m[6],!1),v[0]&128&&E(e,"--book-content-hint-furigana-shadow-color",m[7],!1),v[0]&2&&i!==(i=`${m[1]}px`)&&E(e,"--book-content-child-width",i,!1),v[0]&4&&a!==(a=`${m[2]}px`)&&E(e,"--book-content-child-height",a,!1),v[0]&1048576&&E(e,"--book-content-column-count",m[20],!1),v[0]&1048586&&l!==(l=`${m[3]?m[1]:(m[1]+rt)/m[20]-rt}px`)&&E(e,"--book-content-image-max-width",l,!1),m[18]?g&&(Re(),W(g,1,1,()=>{g=null}),Le()):g?(g.p(m,v),v[0]&262144&&G(g,1)):(g=wn(m),g.c(),G(g,1),g.m(u.parentNode,u)),m[0]?y?(y.p(m,v),v[0]&1&&G(y,1)):(y=yn(m),y.c(),G(y,1),y.m(d.parentNode,d)):y&&(Re(),W(y,1,1,()=>{y=null}),Le())},i(m){b||(G(r.$$.fragment,m),G(g),G(y),b=!0)},o(m){W(r.$$.fragment,m),W(g),W(y),b=!1},d(m){m&&B(e),pe(r),t[37](null),t[38](null),m&&B(s),g&&g.d(m),m&&B(u),y&&y.d(m),m&&B(d),c=!1,Rt(f)}}}const Sn="overflow-hidden",rt=20;function ki(t,e,n){let r,o;K(t,it,P=>n(42,o=P));let{htmlContent:i}=e,{width:a}=e,{height:l}=e,{verticalMode:s}=e,{fontColor:u}=e,{backgroundColor:d}=e,{hintFuriganaFontColor:b}=e,{hintFuriganaShadowColor:c}=e,{fontSize:f}=e,{fontFamilyGroupOne:g}=e,{fontFamilyGroupTwo:y}=e,{hideSpoilerImage:m}=e,{hideFurigana:v}=e,{furiganaStyle:S}=e,{loadingState:h}=e,{bookmarkData:C}=e,{pageManager:F}=e,{bookmarkManager:A}=e,{exploredCharCount:V}=e,{bookCharCount:Y}=e,{isBookmarkScreen:oe=!1}=e,{avoidPageBreak:ae=!0}=e,{pageColumns:p}=e,{firstDimensionMargin:I}=e,{autoBookmark:_=!1}=e;const T=Ot();let z,H,L,te=[],j,U,M,q=!1,le="",N=!0,Ce=0;const se=new Me,ye=new Me,ce=new It(-1),ve=new Me,De=new It(0),Ee=new Me,Se=new Me,_e=ce.pipe(we(P=>{var ne;return((ne=te[P])==null?void 0:ne.innerHTML)||""})),me=new Me;on(()=>{document.body.classList.remove(Sn),me.next(),me.complete()}),bt([se,ye]).pipe($t(1),gt(()=>Se.pipe(pt(1))),qe(me)).subscribe(()=>{if(!L||!j)return;const P=L.getScrollPosByCharCount(Ce);P<0||j.scrollTo(P,!1)}),ve.pipe(qe(me)).subscribe(P=>{!L||(n(26,V=L.calcExploredCharCount()),P&&(Ce=V),C.then(Te))}),_&&ve.pipe(At(3e3),qe(me)).subscribe(P=>{P&&T("bookmark")}),_e.pipe($n(),qe(me)).subscribe(()=>{n(18,q=!1)}),_e.pipe(qe(me)).subscribe(P=>{const ne=(D,re)=>{if(re===0){D();return}requestAnimationFrame(()=>ne(D,re-1))};ne(()=>{n(19,le=P)},2)}),ht(()=>We(document.body,"wheel",{passive:!0})).pipe(zr(50),qe(me)).subscribe(P=>{if(!o){let ne=(P.deltaX<0?-1:1)*(s?-1:1);P.deltaX||(ne=P.deltaY<0?-1:1),j==null||j.flipPage(ne)}});function Ve(){if(N){N=!1;return}!z||(n(33,L=new di(z,te,De,()=>a,()=>l,()=>rt,s,z,document)),n(26,V=0),Ce=0,n(27,Y=L.charCount),L.updateCurrentSection(ce.getValue()),T("contentChange",z))}function ze(P){P.updateParagraphPos(),n(26,V=P.calcExploredCharCount()),Se.next(P),C.then(Te),M&&(M=!1,C.then(ne=>{!ne||!A||A.scrollToBookmark(ne)})),n(18,q=!0)}function Te(P){const ne=P==null?void 0:P.exploredCharCount;!L||!ne||n(0,oe=L.isCharOnScreen(ne))}function xe(P){if(!j||o||P.detail.direction!=="left"&&P.detail.direction!=="right")return;const ne=P.detail.direction==="left",D=s?!ne:ne;j.flipPage(D?1:-1)}function Ke(P){if(!(!j||o))switch(P.code){case"ArrowLeft":j[s?"nextPage":"prevPage"]();break;case"ArrowRight":j[s?"prevPage":"nextPage"]();break;case"ArrowUp":j.prevPage();break;case"ArrowDown":j.nextPage();break}}Ct.pipe(qe(me)).subscribe(P=>{const ne=te.findIndex(D=>D.id===P||D.querySelector(`[id="${P}"]`));ne>-1&&(ce.next(ne),j==null||j.scrollTo(0,!0))});function Ne(P){ie[P?"unshift":"push"](()=>{H=P,n(17,H)})}function $e(P){ie[P?"unshift":"push"](()=>{z=P,n(16,z)})}return t.$$set=P=>{"htmlContent"in P&&n(28,i=P.htmlContent),"width"in P&&n(1,a=P.width),"height"in P&&n(2,l=P.height),"verticalMode"in P&&n(3,s=P.verticalMode),"fontColor"in P&&n(4,u=P.fontColor),"backgroundColor"in P&&n(5,d=P.backgroundColor),"hintFuriganaFontColor"in P&&n(6,b=P.hintFuriganaFontColor),"hintFuriganaShadowColor"in P&&n(7,c=P.hintFuriganaShadowColor),"fontSize"in P&&n(8,f=P.fontSize),"fontFamilyGroupOne"in P&&n(9,g=P.fontFamilyGroupOne),"fontFamilyGroupTwo"in P&&n(10,y=P.fontFamilyGroupTwo),"hideSpoilerImage"in P&&n(11,m=P.hideSpoilerImage),"hideFurigana"in P&&n(12,v=P.hideFurigana),"furiganaStyle"in P&&n(13,S=P.furiganaStyle),"loadingState"in P&&n(29,h=P.loadingState),"bookmarkData"in P&&n(30,C=P.bookmarkData),"pageManager"in P&&n(24,F=P.pageManager),"bookmarkManager"in P&&n(25,A=P.bookmarkManager),"exploredCharCount"in P&&n(26,V=P.exploredCharCount),"bookCharCount"in P&&n(27,Y=P.bookCharCount),"isBookmarkScreen"in P&&n(0,oe=P.isBookmarkScreen),"avoidPageBreak"in P&&n(14,ae=P.avoidPageBreak),"pageColumns"in P&&n(31,p=P.pageColumns),"firstDimensionMargin"in P&&n(15,I=P.firstDimensionMargin),"autoBookmark"in P&&n(32,_=P.autoBookmark)},t.$$.update=()=>{if(t.$$.dirty[0]&1073741824&&C.then(Te),t.$$.dirty[0]&2&&a&&se.next(a),t.$$.dirty[0]&4&&l&&ye.next(l),t.$$.dirty[0]&10|t.$$.dirty[1]&1&&n(20,r=s?1:p||Math.ceil(a/1e3)),t.$$.dirty[0]&268435456&&i&&(M=!0),t.$$.dirty[0]&268435456){const P=document.createElement("div");P.innerHTML=i,n(34,te=Array.from(P.children)),ce.next(0)}if(t.$$.dirty[0]&196622|t.$$.dirty[1]&24&&H&&z&&te&&(n(35,j=new hi(H,z,te,ce,De,a,l,rt,s,ve,Ee)),n(24,F=j)),t.$$.dirty[0]&536870918|t.$$.dirty[1]&4&&L&&a&&l&&!h){const P=L;requestAnimationFrame(()=>{ze(P)})}t.$$.dirty[0]&536870912|t.$$.dirty[1]&4&&L&&!h&&Ee.next(ce.getValue()),t.$$.dirty[1]&52&&L&&j&&(n(36,U=new mi(L,j,Se,ce,P=>Ce=P)),n(25,A=U))},document.body.classList.add(Sn),[oe,a,l,s,u,d,b,c,f,g,y,m,v,S,ae,I,z,H,q,le,r,Ve,xe,Ke,F,A,V,Y,i,h,C,p,_,L,te,j,U,Ne,$e]}class bi extends Je{constructor(e){super(),Qe(this,e,ki,gi,Ze,{htmlContent:28,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,loadingState:29,bookmarkData:30,pageManager:24,bookmarkManager:25,exploredCharCount:26,bookCharCount:27,isBookmarkScreen:0,avoidPageBreak:14,pageColumns:31,firstDimensionMargin:15,autoBookmark:32},null,[-1,-1])}}function pi(t){var m,v,S;let e,n,r,o,i,a,l,s;function u(h){t[48](h)}function d(h){t[49](h)}function b(h){t[50](h)}function c(h){t[51](h)}function f(h){t[52](h)}function g(h){t[53](h)}let y={htmlContent:t[7],width:(m=t[28])!=null?m:0,height:(v=t[29])!=null?v:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],loadingState:(S=t[30])!=null?S:!0,avoidPageBreak:t[22],pageColumns:t[23],autoBookmark:t[24],firstDimensionMargin:t[20]};return t[0]!==void 0&&(y.exploredCharCount=t[0]),t[1]!==void 0&&(y.bookCharCount=t[1]),t[6]!==void 0&&(y.isBookmarkScreen=t[6]),t[2]!==void 0&&(y.bookmarkData=t[2]),t[4]!==void 0&&(y.bookmarkManager=t[4]),t[5]!==void 0&&(y.pageManager=t[5]),e=new bi({props:y}),ie.push(()=>he(e,"exploredCharCount",u)),ie.push(()=>he(e,"bookCharCount",d)),ie.push(()=>he(e,"isBookmarkScreen",b)),ie.push(()=>he(e,"bookmarkData",c)),ie.push(()=>he(e,"bookmarkManager",f)),ie.push(()=>he(e,"pageManager",g)),e.$on("contentChange",t[54]),e.$on("bookmark",t[55]),{c(){ge(e.$$.fragment)},l(h){ke(e.$$.fragment,h)},m(h,C){be(e,h,C),s=!0},p(h,C){var A,V,Y;const F={};C[0]&128&&(F.htmlContent=h[7]),C[0]&268435456&&(F.width=(A=h[28])!=null?A:0),C[0]&536870912&&(F.height=(V=h[29])!=null?V:0),C[0]&256&&(F.verticalMode=h[8]),C[0]&512&&(F.fontColor=h[9]),C[0]&1024&&(F.backgroundColor=h[10]),C[0]&2048&&(F.hintFuriganaFontColor=h[11]),C[0]&4096&&(F.hintFuriganaShadowColor=h[12]),C[0]&8192&&(F.fontSize=h[13]),C[0]&16384&&(F.fontFamilyGroupOne=h[14]),C[0]&32768&&(F.fontFamilyGroupTwo=h[15]),C[0]&65536&&(F.hideSpoilerImage=h[16]),C[0]&131072&&(F.hideFurigana=h[17]),C[0]&262144&&(F.furiganaStyle=h[18]),C[0]&1073741824&&(F.loadingState=(Y=h[30])!=null?Y:!0),C[0]&4194304&&(F.avoidPageBreak=h[22]),C[0]&8388608&&(F.pageColumns=h[23]),C[0]&16777216&&(F.autoBookmark=h[24]),C[0]&1048576&&(F.firstDimensionMargin=h[20]),!n&&C[0]&1&&(n=!0,F.exploredCharCount=h[0],de(()=>n=!1)),!r&&C[0]&2&&(r=!0,F.bookCharCount=h[1],de(()=>r=!1)),!o&&C[0]&64&&(o=!0,F.isBookmarkScreen=h[6],de(()=>o=!1)),!i&&C[0]&4&&(i=!0,F.bookmarkData=h[2],de(()=>i=!1)),!a&&C[0]&16&&(a=!0,F.bookmarkManager=h[4],de(()=>a=!1)),!l&&C[0]&32&&(l=!0,F.pageManager=h[5],de(()=>l=!1)),e.$set(F)},i(h){s||(G(e.$$.fragment,h),s=!0)},o(h){W(e.$$.fragment,h),s=!1},d(h){pe(e,h)}}}function vi(t){var m,v,S;let e,n,r,o,i,a,l,s;function u(h){t[40](h)}function d(h){t[41](h)}function b(h){t[42](h)}function c(h){t[43](h)}function f(h){t[44](h)}function g(h){t[45](h)}let y={htmlContent:t[7],width:(m=t[28])!=null?m:0,height:(v=t[29])!=null?v:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],secondDimensionMaxValue:t[19],firstDimensionMargin:t[20],autoPositionOnResize:t[21],autoBookmark:t[24],multiplier:t[26],loadingState:(S=t[30])!=null?S:!0};return t[0]!==void 0&&(y.exploredCharCount=t[0]),t[1]!==void 0&&(y.bookCharCount=t[1]),t[2]!==void 0&&(y.bookmarkData=t[2]),t[3]!==void 0&&(y.autoScroller=t[3]),t[4]!==void 0&&(y.bookmarkManager=t[4]),t[5]!==void 0&&(y.pageManager=t[5]),e=new $r({props:y}),ie.push(()=>he(e,"exploredCharCount",u)),ie.push(()=>he(e,"bookCharCount",d)),ie.push(()=>he(e,"bookmarkData",b)),ie.push(()=>he(e,"autoScroller",c)),ie.push(()=>he(e,"bookmarkManager",f)),ie.push(()=>he(e,"pageManager",g)),e.$on("contentChange",t[46]),e.$on("bookmark",t[47]),{c(){ge(e.$$.fragment)},l(h){ke(e.$$.fragment,h)},m(h,C){be(e,h,C),s=!0},p(h,C){var A,V,Y;const F={};C[0]&128&&(F.htmlContent=h[7]),C[0]&268435456&&(F.width=(A=h[28])!=null?A:0),C[0]&536870912&&(F.height=(V=h[29])!=null?V:0),C[0]&256&&(F.verticalMode=h[8]),C[0]&512&&(F.fontColor=h[9]),C[0]&1024&&(F.backgroundColor=h[10]),C[0]&2048&&(F.hintFuriganaFontColor=h[11]),C[0]&4096&&(F.hintFuriganaShadowColor=h[12]),C[0]&8192&&(F.fontSize=h[13]),C[0]&16384&&(F.fontFamilyGroupOne=h[14]),C[0]&32768&&(F.fontFamilyGroupTwo=h[15]),C[0]&65536&&(F.hideSpoilerImage=h[16]),C[0]&131072&&(F.hideFurigana=h[17]),C[0]&262144&&(F.furiganaStyle=h[18]),C[0]&524288&&(F.secondDimensionMaxValue=h[19]),C[0]&1048576&&(F.firstDimensionMargin=h[20]),C[0]&2097152&&(F.autoPositionOnResize=h[21]),C[0]&16777216&&(F.autoBookmark=h[24]),C[0]&67108864&&(F.multiplier=h[26]),C[0]&1073741824&&(F.loadingState=(Y=h[30])!=null?Y:!0),!n&&C[0]&1&&(n=!0,F.exploredCharCount=h[0],de(()=>n=!1)),!r&&C[0]&2&&(r=!0,F.bookCharCount=h[1],de(()=>r=!1)),!o&&C[0]&4&&(o=!0,F.bookmarkData=h[2],de(()=>o=!1)),!i&&C[0]&8&&(i=!0,F.autoScroller=h[3],de(()=>i=!1)),!a&&C[0]&16&&(a=!0,F.bookmarkManager=h[4],de(()=>a=!1)),!l&&C[0]&32&&(l=!0,F.pageManager=h[5],de(()=>l=!1)),e.$set(F)},i(h){s||(G(e.$$.fragment,h),s=!0)},o(h){W(e.$$.fragment,h),s=!1},d(h){pe(e,h)}}}function Ci(t){var b;let e,n,r,o,i=((b=t[31])!=null?b:"")+"",a,l;const s=[vi,pi],u=[];function d(c,f){return c[25]===Ft.Continuous?0:1}return n=d(t),r=u[n]=s[n](t),{c(){e=Q("div"),r.c(),o=$(),a=ue(i),this.h()},l(c){e=Z(c,"DIV",{class:!0});var f=x(e);r.l(f),f.forEach(B),o=ee(c),a=fe(c,i),this.h()},h(){X(e,"class",ei+" py-8")},m(c,f){R(c,e,f),u[n].m(e,null),t[56](e),R(c,o,f),R(c,a,f),l=!0},p(c,f){var y;let g=n;n=d(c),n===g?u[n].p(c,f):(Re(),W(u[g],1,1,()=>{u[g]=null}),Le(),r=u[n],r?r.p(c,f):(r=u[n]=s[n](c),r.c()),G(r,1),r.m(e,null)),(!l||f[1]&1)&&i!==(i=((y=c[31])!=null?y:"")+"")&&Fe(a,i)},i(c){l||(G(r),l=!0)},o(c){W(r),l=!1},d(c){c&&B(e),u[n].d(),t[56](null),c&&B(o),c&&B(a)}}}function St(t){return Number(t.replace(/px$/,""))}function _i(t,e,n){let r,o,i,a,l,s,{htmlContent:u}=e,{width:d}=e,{height:b}=e,{verticalMode:c}=e,{fontColor:f}=e,{backgroundColor:g}=e,{hintFuriganaFontColor:y}=e,{hintFuriganaShadowColor:m}=e,{fontSize:v}=e,{fontFamilyGroupOne:S}=e,{fontFamilyGroupTwo:h}=e,{hideSpoilerImage:C}=e,{hideFurigana:F}=e,{furiganaStyle:A}=e,{secondDimensionMaxValue:V}=e,{firstDimensionMargin:Y}=e,{autoPositionOnResize:oe}=e,{avoidPageBreak:ae}=e,{pageColumns:p}=e,{autoBookmark:I}=e,{viewMode:_}=e,{exploredCharCount:T}=e,{bookCharCount:z}=e,{multiplier:H}=e,{bookmarkData:L}=e,{autoScroller:te}=e,{bookmarkManager:j}=e,{pageManager:U}=e,{isBookmarkScreen:M}=e;const q=new Me,le=new Me,N=cr(null);K(t,N,k=>n(27,o=k));const Ce=bt([N.pipe(Lt(k=>!!k)),bt([q,le]).pipe(en(0))]).pipe(At(0,Nt),we(([k])=>getComputedStyle(k)),tn({refCount:!0,bufferSize:1})),se=new Xo(1),ye=Ce.pipe(we(k=>Ee(d-St(k.paddingLeft)-St(k.paddingRight))));K(t,ye,k=>n(28,i=k));const ce=Ce.pipe(we(k=>Se(b-St(k.paddingTop)-St(k.paddingBottom)-r)));K(t,ce,k=>n(29,a=k));const ve=ht(()=>Kn(document)).pipe(Pt(k=>{const Xt=oi(k,A);return se.pipe(Pt(Wt=>Xt(Wt)))}),nt());K(t,ve,k=>n(31,s=k));const De=se.pipe(Pt(k=>ti(k)),nn());K(t,De,k=>n(30,l=k));function Ee(k){return Ft.Paginated===_&&!c&&V?Math.min(V,k):k}function Se(k){return Ft.Paginated===_&&c&&V?Math.min(V,k):k}function _e(k){T=k,n(0,T)}function me(k){z=k,n(1,z)}function Ve(k){L=k,n(2,L)}function ze(k){te=k,n(3,te)}function Te(k){j=k,n(4,j)}function xe(k){U=k,n(5,U)}const Ke=k=>se.next(k.detail);function Ne(k){cn.call(this,t,k)}function $e(k){T=k,n(0,T)}function P(k){z=k,n(1,z)}function ne(k){M=k,n(6,M)}function D(k){L=k,n(2,L)}function re(k){j=k,n(4,j)}function Ge(k){U=k,n(5,U)}const Be=k=>se.next(k.detail);function Oe(k){cn.call(this,t,k)}function _t(k){ie[k?"unshift":"push"](()=>{o=k,N.set(o)})}return t.$$set=k=>{"htmlContent"in k&&n(7,u=k.htmlContent),"width"in k&&n(38,d=k.width),"height"in k&&n(39,b=k.height),"verticalMode"in k&&n(8,c=k.verticalMode),"fontColor"in k&&n(9,f=k.fontColor),"backgroundColor"in k&&n(10,g=k.backgroundColor),"hintFuriganaFontColor"in k&&n(11,y=k.hintFuriganaFontColor),"hintFuriganaShadowColor"in k&&n(12,m=k.hintFuriganaShadowColor),"fontSize"in k&&n(13,v=k.fontSize),"fontFamilyGroupOne"in k&&n(14,S=k.fontFamilyGroupOne),"fontFamilyGroupTwo"in k&&n(15,h=k.fontFamilyGroupTwo),"hideSpoilerImage"in k&&n(16,C=k.hideSpoilerImage),"hideFurigana"in k&&n(17,F=k.hideFurigana),"furiganaStyle"in k&&n(18,A=k.furiganaStyle),"secondDimensionMaxValue"in k&&n(19,V=k.secondDimensionMaxValue),"firstDimensionMargin"in k&&n(20,Y=k.firstDimensionMargin),"autoPositionOnResize"in k&&n(21,oe=k.autoPositionOnResize),"avoidPageBreak"in k&&n(22,ae=k.avoidPageBreak),"pageColumns"in k&&n(23,p=k.pageColumns),"autoBookmark"in k&&n(24,I=k.autoBookmark),"viewMode"in k&&n(25,_=k.viewMode),"exploredCharCount"in k&&n(0,T=k.exploredCharCount),"bookCharCount"in k&&n(1,z=k.bookCharCount),"multiplier"in k&&n(26,H=k.multiplier),"bookmarkData"in k&&n(2,L=k.bookmarkData),"autoScroller"in k&&n(3,te=k.autoScroller),"bookmarkManager"in k&&n(4,j=k.bookmarkManager),"pageManager"in k&&n(5,U=k.pageManager),"isBookmarkScreen"in k&&n(6,M=k.isBookmarkScreen)},t.$$.update=()=>{t.$$.dirty[0]&34603264&&(r=Y&&Ft.Paginated===_&&!c?Y*2:0),t.$$.dirty[1]&128&&q.next(d),t.$$.dirty[1]&256&&le.next(b)},[T,z,L,te,j,U,M,u,c,f,g,y,m,v,S,h,C,F,A,V,Y,oe,ae,p,I,_,H,o,i,a,l,s,N,se,ye,ce,ve,De,d,b,_e,me,Ve,ze,Te,xe,Ke,Ne,$e,P,ne,D,re,Ge,Be,Oe,_t]}class wi extends Je{constructor(e){super(),Qe(this,e,_i,Ci,Ze,{htmlContent:7,width:38,height:39,verticalMode:8,fontColor:9,backgroundColor:10,hintFuriganaFontColor:11,hintFuriganaShadowColor:12,fontSize:13,fontFamilyGroupOne:14,fontFamilyGroupTwo:15,hideSpoilerImage:16,hideFurigana:17,furiganaStyle:18,secondDimensionMaxValue:19,firstDimensionMargin:20,autoPositionOnResize:21,avoidPageBreak:22,pageColumns:23,autoBookmark:24,viewMode:25,exploredCharCount:0,bookCharCount:1,multiplier:26,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6},null,[-1,-1,-1])}}function yi(t,e){const n=document.createTextNode(e);if(t.firstChild){t.replaceChild(n,t.firstChild);return}t.appendChild(n)}function Si(t,e,n){let{styleSheet:r}=e,o;return jn(()=>{n(1,o=document.createElement("style")),document.head.appendChild(o)}),on(()=>{o&&document.head.removeChild(o)}),t.$$set=i=>{"styleSheet"in i&&n(0,r=i.styleSheet)},t.$$.update=()=>{t.$$.dirty&3&&o&&yi(o,r)},[r,o]}class Mi extends Je{constructor(e){super(),Qe(this,e,Si,null,Ze,{styleSheet:0})}}function Mn(t){let e,n,r,o,i;return n=new je({props:{icon:Io}}),{c(){e=Q("div"),ge(n.$$.fragment),this.h()},l(a){e=Z(a,"DIV",{class:!0,role:!0});var l=x(e);ke(n.$$.fragment,l),l.forEach(B),this.h()},h(){X(e,"class",an),X(e,"role","button")},m(a,l){R(a,e,l),be(n,e,null),r=!0,o||(i=Pe(e,"click",t[5]),o=!0)},p:lt,i(a){r||(G(n.$$.fragment,a),r=!0)},o(a){W(n.$$.fragment,a),r=!1},d(a){a&&B(e),pe(n),o=!1,i()}}}function Pn(t){let e,n,r,o,i;return n=new je({props:{icon:To}}),{c(){e=Q("div"),ge(n.$$.fragment),this.h()},l(a){e=Z(a,"DIV",{role:!0,class:!0});var l=x(e);ke(n.$$.fragment,l),l.forEach(B),this.h()},h(){X(e,"role","button"),X(e,"class",an)},m(a,l){R(a,e,l),be(n,e,null),r=!0,o||(i=Pe(e,"click",t[7]),o=!0)},p:lt,i(a){r||(G(n.$$.fragment,a),r=!0)},o(a){W(n.$$.fragment,a),r=!1},d(a){a&&B(e),pe(n),o=!1,i()}}}function Pi(t){let e,n,r,o,i,a,l,s,u,d,b,c,f,g,y,m,v=t[0]&&Mn(t);i=new je({props:{icon:t[3]?dt:gn}});let S=t[2]&&Pn(t);return f=new Fo({props:{items:[Et.SETTINGS,Et.MANAGE]}}),f.$on("action",t[8]),{c(){e=Q("div"),n=Q("div"),v&&v.c(),r=$(),o=Q("div"),ge(i.$$.fragment),a=$(),l=Q("div"),s=ue(t[1]),u=ue("x"),d=$(),b=Q("div"),S&&S.c(),c=$(),ge(f.$$.fragment),this.h()},l(h){e=Z(h,"DIV",{class:!0});var C=x(e);n=Z(C,"DIV",{class:!0});var F=x(n);v&&v.l(F),r=ee(F),o=Z(F,"DIV",{class:!0,role:!0});var A=x(o);ke(i.$$.fragment,A),A.forEach(B),a=ee(F),l=Z(F,"DIV",{class:!0});var V=x(l);s=fe(V,t[1]),u=fe(V,"x"),V.forEach(B),F.forEach(B),d=ee(C),b=Z(C,"DIV",{class:!0});var Y=x(b);S&&S.l(Y),c=ee(Y),ke(f.$$.fragment,Y),Y.forEach(B),C.forEach(B),this.h()},h(){X(o,"class",an),X(o,"role","button"),X(l,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg"),X(n,"class","flex transform-gpu "+Do),X(b,"class","flex transform-gpu "+Eo),X(e,"class","flex justify-between bg-gray-700 px-4 md:px-8 "+Bo)},m(h,C){R(h,e,C),J(e,n),v&&v.m(n,null),J(n,r),J(n,o),be(i,o,null),J(n,a),J(n,l),J(l,s),J(l,u),J(e,d),J(e,b),S&&S.m(b,null),J(b,c),be(f,b,null),g=!0,y||(m=Pe(o,"click",t[6]),y=!0)},p(h,[C]){h[0]?v?(v.p(h,C),C&1&&G(v,1)):(v=Mn(h),v.c(),G(v,1),v.m(n,r)):v&&(Re(),W(v,1,1,()=>{v=null}),Le());const F={};C&8&&(F.icon=h[3]?dt:gn),i.$set(F),(!g||C&2)&&Fe(s,h[1]),h[2]?S?(S.p(h,C),C&4&&G(S,1)):(S=Pn(h),S.c(),G(S,1),S.m(b,c)):S&&(Re(),W(S,1,1,()=>{S=null}),Le())},i(h){g||(G(v),G(i.$$.fragment,h),G(S),G(f.$$.fragment,h),g=!0)},o(h){W(v),W(i.$$.fragment,h),W(S),W(f.$$.fragment,h),g=!1},d(h){h&&B(e),v&&v.d(),pe(i),S&&S.d(),pe(f),y=!1,m()}}}function Fi(t,e,n){let{hasChapterData:r}=e,{autoScrollMultiplier:o}=e,{showFullscreenButton:i}=e,{isBookmarkScreen:a}=e;const l=Ot(),s=()=>l("tocClick"),u=()=>l("bookmarkClick"),d=()=>l("fullscreenClick"),b=({detail:c})=>{c===Et.SETTINGS.label?l("settingsClick"):c===Et.MANAGE.label&&l("bookManagerClick")};return t.$$set=c=>{"hasChapterData"in c&&n(0,r=c.hasChapterData),"autoScrollMultiplier"in c&&n(1,o=c.autoScrollMultiplier),"showFullscreenButton"in c&&n(2,i=c.showFullscreenButton),"isBookmarkScreen"in c&&n(3,a=c.isBookmarkScreen)},[r,o,i,a,l,s,u,d,b]}class Di extends Je{constructor(e){super(),Qe(this,e,Fi,Pi,Ze,{hasChapterData:0,autoScrollMultiplier:1,showFullscreenButton:2,isBookmarkScreen:3})}}function Fn(t,e,n){const r=t.slice();return r[15]=e[n],r}function Dn(t,e){let n,r,o=e[15].label+"",i,a,l,s,u=e[15].startCharacter+"",d,b,c,f;function g(){return e[12](e[15])}return{key:t,first:null,c(){n=Q("div"),r=Q("div"),i=ue(o),l=$(),s=Q("div"),d=ue(u),b=$(),this.h()},l(y){n=Z(y,"DIV",{class:!0});var m=x(n);r=Z(m,"DIV",{id:!0,class:!0});var v=x(r);i=fe(v,o),v.forEach(B),l=ee(m),s=Z(m,"DIV",{});var S=x(s);d=fe(S,u),S.forEach(B),b=ee(m),m.forEach(B),this.h()},h(){X(r,"id",a=`for${e[15].reference}`),X(r,"class","mr-4 cursor-pointer"),O(r,"opacity-30",e[15].progress===100&&e[15]!==e[1]),O(r,"hover:opacity-100",e[15].progress===100&&e[15]!==e[1]),O(r,"hover:opacity-60",e[15].progress<100||e[15]===e[1]),O(s,"opacity-30",e[15].progress===100&&e[15]!==e[1]),X(n,"class","my-6 flex justify-between"),this.first=n},m(y,m){R(y,n,m),J(n,r),J(r,i),J(n,l),J(n,s),J(s,d),J(n,b),c||(f=Pe(r,"click",g),c=!0)},p(y,m){e=y,m&1&&o!==(o=e[15].label+"")&&Fe(i,o),m&1&&a!==(a=`for${e[15].reference}`)&&X(r,"id",a),m&3&&O(r,"opacity-30",e[15].progress===100&&e[15]!==e[1]),m&3&&O(r,"hover:opacity-100",e[15].progress===100&&e[15]!==e[1]),m&3&&O(r,"hover:opacity-60",e[15].progress<100||e[15]===e[1]),m&1&&u!==(u=e[15].startCharacter+"")&&Fe(d,u),m&3&&O(s,"opacity-30",e[15].progress===100&&e[15]!==e[1])},d(y){y&&B(n),c=!1,f()}}}function Ei(t){let e,n,r,o,i,a,l,s,u,d,b,c,f=[],g=new Map,y,m,v,S,h,C,F,A,V,Y;d=new je({props:{icon:Ao}});let oe=t[0];const ae=p=>p[15].reference;for(let p=0;p<oe.length;p+=1){let I=Fn(t,oe,p),_=ae(I);g.set(_,f[p]=Dn(_,I))}return S=new je({props:{icon:qo}}),F=new je({props:{icon:Vo}}),{c(){e=Q("div"),n=Q("div"),r=ue("Chapter Progress: "),o=ue(t[2]),i=ue(" ("),a=ue(t[3]),l=ue("%)"),s=$(),u=Q("div"),ge(d.$$.fragment),b=$(),c=Q("div");for(let p=0;p<f.length;p+=1)f[p].c();y=$(),m=Q("div"),v=Q("div"),ge(S.$$.fragment),h=$(),C=Q("div"),ge(F.$$.fragment),this.h()},l(p){e=Z(p,"DIV",{class:!0});var I=x(e);n=Z(I,"DIV",{});var _=x(n);r=fe(_,"Chapter Progress: "),o=fe(_,t[2]),i=fe(_," ("),a=fe(_,t[3]),l=fe(_,"%)"),_.forEach(B),s=ee(I),u=Z(I,"DIV",{class:!0});var T=x(u);ke(d.$$.fragment,T),T.forEach(B),I.forEach(B),b=ee(p),c=Z(p,"DIV",{class:!0});var z=x(c);for(let j=0;j<f.length;j+=1)f[j].l(z);z.forEach(B),y=ee(p),m=Z(p,"DIV",{class:!0});var H=x(m);v=Z(H,"DIV",{class:!0});var L=x(v);ke(S.$$.fragment,L),L.forEach(B),h=ee(H),C=Z(H,"DIV",{class:!0});var te=x(C);ke(F.$$.fragment,te),te.forEach(B),H.forEach(B),this.h()},h(){X(u,"class","flex cursor-pointer items-end md:items-center"),X(e,"class","flex justify-between p-4"),X(c,"class","flex-1 overflow-auto p-4"),X(v,"class","cursor-pointer"),O(v,"opacity-30",!t[5]),X(C,"class","cursor-pointer"),O(C,"opacity-30",!t[4]),X(m,"class","flex justify-between px-4 py-6")},m(p,I){R(p,e,I),J(e,n),J(n,r),J(n,o),J(n,i),J(n,a),J(n,l),J(e,s),J(e,u),be(d,u,null),R(p,b,I),R(p,c,I);for(let _=0;_<f.length;_+=1)f[_].m(c,null);R(p,y,I),R(p,m,I),J(m,v),be(S,v,null),J(m,h),J(m,C),be(F,C,null),A=!0,V||(Y=[Pe(u,"click",t[8]),Pe(v,"click",t[13]),Pe(C,"click",t[14])],V=!0)},p(p,[I]){(!A||I&4)&&Fe(o,p[2]),(!A||I&8)&&Fe(a,p[3]),I&131&&(oe=p[0],f=_o(f,I,ae,1,p,oe,g,c,wo,Dn,null,Fn)),I&32&&O(v,"opacity-30",!p[5]),I&16&&O(C,"opacity-30",!p[4])},i(p){A||(G(d.$$.fragment,p),G(S.$$.fragment,p),G(F.$$.fragment,p),A=!0)},o(p){W(d.$$.fragment,p),W(S.$$.fragment,p),W(F.$$.fragment,p),A=!1},d(p){p&&B(e),pe(d),p&&B(b),p&&B(c);for(let I=0;I<f.length;I+=1)f[I].d();p&&B(y),p&&B(m),pe(S),pe(F),V=!1,Rt(Y)}}}function Bi(t,e){const[n,r]=e.reduce((o,i,a)=>(o[0]+=t[a]*i,o[1]+=i,o),[0,0]);return n/r}function En(t){!t||(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView())}function Ii(t,e,n){let r,o,{sectionData:i=[]}=e,{exploredCharCount:a=0}=e,l=[],s,u=-1,d="0/0",b="0.00";jn(()=>{kn.dialogs$.next([{component:"<div/>"}]),s&&En(document.getElementById(`for${s.reference}`))});function c(S,h){if(S){const C=l[u+h];f(C.reference,!1)}}function f(S,h=!1){Ct.next(S),h&&g()}function g(){it.next(!1),kn.dialogs$.next([])}const y=S=>f(S.reference,!0),m=()=>c(r,-1),v=()=>c(o,1);return t.$$set=S=>{"sectionData"in S&&n(9,i=S.sectionData),"exploredCharCount"in S&&n(10,a=S.exploredCharCount)},t.$$.update=()=>{if(t.$$.dirty&2560&&i){const[S,h,C]=to(i),F=i.filter(A=>A.reference===C||A.parentChapter===C);n(3,b=Bi(F.map(A=>A.progress),F.map(A=>A.charactersWeight)).toFixed(2)),n(0,l=S),n(11,u=h),n(1,s=S[u])}if(t.$$.dirty&2048&&n(5,r=!!u),t.$$.dirty&2049&&n(4,o=u<l.length-1),t.$$.dirty&1026&&s){En(document.getElementById(`for${s.reference}`));const S=s.characters;n(2,d=`${Math.min(Math.max(a-s.startCharacter,0),S)} / ${S}`)}},[l,s,d,b,o,r,c,f,g,i,a,u,y,m,v]}class Ti extends Je{constructor(e){super(),Qe(this,e,Ii,Ei,Ze,{sectionData:9,exploredCharCount:10})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Ai{constructor(e){this.document=e,this.fallbackSpec=Bn(this.document)}get fullscreenEnabled(){var e;return(e=this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled"))!=null?e:!1}get fullscreenElement(){var e;return(e=this.fallbackSpec("fullscreenElement","webkitFullscreenElement"))!=null?e:null}async requestFullscreen(e,n){const r=Bn(e)("requestFullscreen","webkitRequestFullscreen");!r||await r(n)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function Bn(t){return(e,n)=>{var r;return(r=In(t,e))!=null?r:In(t,n)}}function In(t,e){const n=t[e];return typeof n=="function"?n.bind(t):n}const Dt=new Ai(document);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function qi(t,e){return Vi(t).pipe(we(n=>{const r=e.createElement("div");return r.innerHTML=n,zi(r),Oi(r),Ri(r,e),Li(r),r.innerHTML}))}function Vi(t){return new Ye(e=>{const{blobs:n}=t;let{elementHtml:r}=t;const o=[];return Object.entries(n).forEach(([i,a])=>{const l=URL.createObjectURL(a);o.push(l),r=r.replaceAll(dr(i),l).replaceAll(`ttu:${i}`,l)}),e.next(r),()=>{o.forEach(i=>URL.revokeObjectURL(i))}})}function zi(t){Array.from(t.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:Un(e)})).forEach(({parentEl:e,isGaiji:n})=>{e==null||e.classList.add("ttu-img-container"),n||e==null||e.classList.add("ttu-illustration-container")})}function Oi(t){Array.from(t.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function Ri(t,e){const n=()=>{let o=[...t.children];const i=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return i>0&&i<o.length&&(o=o.slice(i)),o},r=(o,i)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||i).insertBefore(a,o),a.appendChild(o)};n().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(i=>!Un(i)).forEach(i=>r(i,o)),Array.from(o.getElementsByTagName("svg")).filter(i=>i.getElementsByTagName("image").length).forEach(i=>r(i,o))})}function Li(t){t.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var ji=io;function io(t,e,n){t instanceof RegExp&&(t=Tn(t,n)),e instanceof RegExp&&(e=Tn(e,n));const r=ao(t,e,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+t.length,r[1]),post:n.slice(r[1]+e.length)}}function Tn(t,e){const n=e.match(t);return n?n[0]:null}io.range=ao;function ao(t,e,n){let r,o,i,a,l,s=n.indexOf(t),u=n.indexOf(e,s+1),d=s;if(s>=0&&u>0){if(t===e)return[s,u];for(r=[],i=n.length;d>=0&&!l;)d===s?(r.push(d),s=n.indexOf(t,d+1)):r.length===1?l=[r.pop(),u]:(o=r.pop(),o<i&&(i=o,a=u),u=n.indexOf(e,d+1)),d=s<u&&s>=0?s:u;r.length&&(l=[i,a])}return l}function Ni(t,e={}){const r=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function i(_){throw new Error(`CSS parse error: ${_}`)}function a(_){const T=_.exec(t);if(T)return t=t.slice(T[0].length),T}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function u(){a(/^\s*/)}function d(){if(u(),t[0]!=="/"||t[1]!=="*")return;let _=2;for(;t[_]&&(t[_]!=="*"||t[_+1]!=="/");)_++;if(!t[_])return i("end of comment is missing");const T=t.slice(2,_);return t=t.slice(_+2),{type:"comment",comment:T}}function b(){const _=[];let T;for(;T=d();)_.push(T);return r.removeComments?[]:_}function c(){for(u();t[0]==="}";)i("extra closing bracket");const _=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(_)return _[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(T){return T.replace(/,/g,"\u200C")}).split(/\s*(?![^(]*\)),\s*/).map(function(T){return T.replace(/\u200C/g,",")})}function f(){if(t[0]==="@")return ae();a(/^([;\s]*)+/);const _=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let T=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!T)return;if(T=T[0].trim(),!a(/^:\s*/))return i("property missing ':'");const z=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),H={type:"declaration",property:T.replace(_,""),value:z?z[0].replace(_,"").trim():""};return a(/^[;\s]*/),H}function g(){if(!l())return i("missing '{'");let _,T=b();for(;_=f();)T.push(_),T=T.concat(b());return s()?T:i("missing '}'")}function y(){u();const _=[];let T;for(;T=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)_.push(T[1]),a(/^,\s*/);if(_.length)return{type:"keyframe",values:_,declarations:g()}}function m(){let _=a(/^@([-\w]+)?keyframes\s*/);if(!_)return;const T=_[1];if(_=a(/^([-\w]+)\s*/),!_)return i("@keyframes missing name");const z=_[1];if(!l())return i("@keyframes missing '{'");let H,L=b();for(;H=y();)L.push(H),L=L.concat(b());return s()?{type:"keyframes",name:z,vendor:T,keyframes:L}:i("@keyframes missing '}'")}function v(){if(a(/^@page */)){const T=c()||[];return{type:"page",selectors:T,declarations:g()}}}function S(){const _=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(_){const T=`${_[1]}-${_[2]}`+(_[3]?`-${_[3]}`:"");return{type:"page-margin-box",name:T,declarations:g()}}}function h(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:g()}}function C(){const _=a(/^@supports *([^{]+)/);if(_)return{type:"supports",supports:_[1].trim(),rules:I()}}function F(){if(a(/^@host\s*/))return{type:"host",rules:I()}}function A(){const _=a(/^@media([^{]+)*/);if(_)return{type:"media",media:(_[1]||"").trim(),rules:I()}}function V(){const _=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(_)return{type:"custom-media",name:_[1].trim(),media:_[2].trim()}}function Y(){const _=a(/^@([-\w]+)?document *([^{]+)/);if(_)return{type:"document",document:_[2].trim(),vendor:_[1]?_[1].trim():null,rules:I()}}function oe(){const _=a(/^@(import|charset|namespace)\s*([^;]+);/);if(_)return{type:_[1],name:_[2].trim()}}function ae(){if(u(),t[0]==="@"){const _=oe()||h()||A()||m()||C()||Y()||V()||F()||v()||S();if(_&&!r.preserveStatic){let T=!1;return _.declarations?T=_.declarations.some(z=>/var\(/.test(z.value)):T=(_.keyframes||_.rules||[]).some(H=>(H.declarations||[]).some(L=>/var\(/.test(L.value))),T?_:{}}return _}}function p(){if(!r.preserveStatic){const z=ji("{","}",t);if(z){const H=/:(?:root|host)(?![.:#(])/.test(z.pre)&&/--\S*\s*:/.test(z.body),L=/var\(/.test(z.body);if(!H&&!L)return t=t.slice(z.end+1),{}}}const _=c()||[],T=r.preserveStatic?g():g().filter(z=>{const H=_.some(te=>/:(?:root|host)(?![.:#(])/.test(te))&&/^--\S/.test(z.property),L=/var\(/.test(z.value);return H||L});return _.length||i("selector missing"),{type:"rule",selectors:_,declarations:T}}function I(_){if(!_&&!l())return i("missing '{'");let T,z=b();for(;t.length&&(_||t[0]!=="}")&&(T=ae()||p());)T.type&&z.push(T),z=z.concat(b());return!_&&!s()?i("missing '}'"):z}return{type:"stylesheet",stylesheet:{rules:I(!0),errors:o}}}function Gi(t,e="",n){const r={charset(i){return"@charset "+i.name+";"},comment(i){return i.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+i.comment+"*/":""},"custom-media"(i){return"@custom-media "+i.name+" "+i.media+";"},declaration(i){return i.property+":"+i.value+";"},document(i){return"@"+(i.vendor||"")+"document "+i.document+"{"+o(i.rules)+"}"},"font-face"(i){return"@font-face{"+o(i.declarations)+"}"},host(i){return"@host{"+o(i.rules)+"}"},import(i){return"@import "+i.name+";"},keyframe(i){return i.values.join(",")+"{"+o(i.declarations)+"}"},keyframes(i){return"@"+(i.vendor||"")+"keyframes "+i.name+"{"+o(i.keyframes)+"}"},media(i){return"@media "+i.media+"{"+o(i.rules)+"}"},namespace(i){return"@namespace "+i.name+";"},page(i){return"@page "+(i.selectors.length?i.selectors.join(", "):"")+"{"+o(i.declarations)+"}"},"page-margin-box"(i){return"@"+i.name+"{"+o(i.declarations)+"}"},rule(i){const a=i.declarations;if(a.length)return i.selectors.join(",")+"{"+o(a)+"}"},supports(i){return"@supports "+i.supports+"{"+o(i.rules)+"}"}};function o(i){let a="";for(let l=0;l<i.length;l++){const s=i[l];n&&n(s);const u=r[s.type](s);u&&(a+=u,u.length&&s.selectors&&(a+=e))}return a}return o(t.stylesheet.rules)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const Hi=/\s?html\s?/gi,Xi=/\s?body\s?/gi;function Wi(t,e){const r=Ni(t.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(i=>Hi.test(i)||Xi.test(i)));return r.forEach(o=>{const i={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new Ji(o.declarations,i);o.declarations.forEach(l=>{Jt(i,Ki(l)),Jt(i,Ui(l)),Jt(i,a.convert(l))}),Object.entries(i).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),r.push(Qi()),r.forEach(o=>{o.selectors=Yi(o.selectors,e)}),Gi({stylesheet:{rules:r},type:"stylesheet"})}function Yi(t,e){return t.map(n=>`${e} ${n}`)}function Jt(t,e){return e&&(t[e.key]=e.value),t}function Ki(t){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(t.property);if(e)return{key:e[1],value:t.value}}function Ui(t){if(t.property==="font-family"){let e=t.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:t.property,value:e}}}class Ji{constructor(e,n){this.ruleDeclarations=e,this.newDeclarations=n}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(n=>n.type==="declaration"&&n.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function Qi(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Zi(t,e,n){return qi(t,n).pipe(we(r=>({htmlContent:r,styleSheet:Wi(t,e)})))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function xi(t){return new Ye(e=>t.subscribe(n=>{e.next(n)}))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Mt(t=Jn){return e=>t?e:xn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function An(t,e,n){return r=>new Ye(o=>{const i=t();return r.pipe(Hn(Nt),mr(()=>n(i))).subscribe({next:a=>{e(a,i),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function $i(t,e,n,r,o,i,a,l,s){switch(e[t.code]){case He.BOOKMARK:return n(),!0;case He.JUMP_TO_BOOKMARK:return r(),!0;case He.AUTO_SCROLL_TOGGLE:return i==null||i.toggle(),!0;case He.AUTO_SCROLL_INCREASE:return o(1),!0;case He.AUTO_SCROLL_DECREASE:return o(-1),!0;case He.NEXT_PAGE:return a==null||a.nextPage(),!0;case He.PREV_PAGE:return a==null||a.prevPage(),!0;case He.PREV_CHAPTER:return s(l?1:-1),!0;case He.NEXT_CHAPTER:return s(l?-1:1),!0;default:return!1}}const{document:Qt}=Ln;function qn(t){var b;let e,n,r,o,i,a,l,s;function u(c){t[54](c)}let d={hasChapterData:!!((b=t[10])!=null&&b.length),showFullscreenButton:Dt.fullscreenEnabled,autoScrollMultiplier:t[14]};return t[3]!==void 0&&(d.isBookmarkScreen=t[3]),n=new Di({props:d}),ie.push(()=>he(n,"isBookmarkScreen",u)),n.$on("tocClick",t[55]),n.$on("fullscreenClick",t[52]),n.$on("bookmarkClick",t[50]),n.$on("bookManagerClick",t[51]),n.$on("settingsClick",t[50]),{c(){e=Q("div"),ge(n.$$.fragment),this.h()},l(c){e=Z(c,"DIV",{class:!0});var f=x(e);ke(n.$$.fragment,f),f.forEach(B),this.h()},h(){X(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(c,f){R(c,e,f),be(n,e,null),a=!0,l||(s=rn(o=Gn.call(null,e,t[56])),l=!0)},p(c,f){var y;t=c;const g={};f[0]&1024&&(g.hasChapterData=!!((y=t[10])!=null&&y.length)),f[0]&16384&&(g.autoScrollMultiplier=t[14]),!r&&f[0]&8&&(r=!0,g.isBookmarkScreen=t[3],de(()=>r=!1)),n.$set(g),o&&yo(o.update)&&f[0]&4&&o.update.call(null,t[56])},i(c){a||(G(n.$$.fragment,c),c&&Nn(()=>{i||(i=hn(e,xt,{y:-300,easing:Zt},!0)),i.run(1)}),a=!0)},o(c){W(n.$$.fragment,c),c&&(i||(i=hn(e,xt,{y:-300,easing:Zt},!1)),i.run(0)),a=!1},d(c){c&&B(e),pe(n),c&&i&&i.end(),l=!1,s()}}}function ea(t){var r;let e=((r=t[36])!=null?r:"")+"",n;return{c(){n=ue(e)},l(o){n=fe(o,e)},m(o,i){R(o,n,i)},p(o,i){var a;i[1]&32&&e!==(e=((a=o[36])!=null?a:"")+"")&&Fe(n,e)},i:lt,o:lt,d(o){o&&B(n)}}}function ta(t){var _,T,z,H,L,te,j,U;let e,n,r,o,i,a,l,s,u,d,b,c=((_=t[33])!=null?_:"")+"",f,g,y=((T=t[34])!=null?T:"")+"",m,v,S=((z=t[35])!=null?z:"")+"",h,C;e=new Mi({props:{styleSheet:t[15].styleSheet}});function F(M){t[57](M)}function A(M){t[58](M)}function V(M){t[59](M)}function Y(M){t[60](M)}function oe(M){t[61](M)}function ae(M){t[62](M)}function p(M){t[63](M)}let I={htmlContent:t[15].htmlContent,width:(H=t[16])!=null?H:0,height:(L=t[17])!=null?L:0,verticalMode:t[11],fontColor:(te=t[18])==null?void 0:te.fontColor,backgroundColor:t[19],hintFuriganaFontColor:(j=t[18])==null?void 0:j.hintFuriganaFontColor,hintFuriganaShadowColor:(U=t[18])==null?void 0:U.hintFuriganaShadowColor,fontSize:t[20],fontFamilyGroupOne:t[21],fontFamilyGroupTwo:t[22],hideSpoilerImage:t[23],hideFurigana:t[24],furiganaStyle:t[25],viewMode:t[26],secondDimensionMaxValue:t[27],firstDimensionMargin:t[28],autoPositionOnResize:t[29],avoidPageBreak:t[30],pageColumns:t[31],autoBookmark:t[32],multiplier:t[14]};return t[5]!==void 0&&(I.exploredCharCount=t[5]),t[6]!==void 0&&(I.bookCharCount=t[6]),t[3]!==void 0&&(I.isBookmarkScreen=t[3]),t[9]!==void 0&&(I.bookmarkData=t[9]),t[0]!==void 0&&(I.autoScroller=t[0]),t[7]!==void 0&&(I.bookmarkManager=t[7]),t[8]!==void 0&&(I.pageManager=t[8]),r=new wi({props:I}),ie.push(()=>he(r,"exploredCharCount",F)),ie.push(()=>he(r,"bookCharCount",A)),ie.push(()=>he(r,"isBookmarkScreen",V)),ie.push(()=>he(r,"bookmarkData",Y)),ie.push(()=>he(r,"autoScroller",oe)),ie.push(()=>he(r,"bookmarkManager",ae)),ie.push(()=>he(r,"pageManager",p)),r.$on("bookmark",t[50]),{c(){ge(e.$$.fragment),n=$(),ge(r.$$.fragment),b=$(),f=ue(c),g=$(),m=ue(y),v=$(),h=ue(S)},l(M){ke(e.$$.fragment,M),n=ee(M),ke(r.$$.fragment,M),b=ee(M),f=fe(M,c),g=ee(M),m=fe(M,y),v=ee(M),h=fe(M,S)},m(M,q){be(e,M,q),R(M,n,q),be(r,M,q),R(M,b,q),R(M,f,q),R(M,g,q),R(M,m,q),R(M,v,q),R(M,h,q),C=!0},p(M,q){var Ce,se,ye,ce,ve,De,Ee,Se;const le={};q[0]&32768&&(le.styleSheet=M[15].styleSheet),e.$set(le);const N={};q[0]&32768&&(N.htmlContent=M[15].htmlContent),q[0]&65536&&(N.width=(Ce=M[16])!=null?Ce:0),q[0]&131072&&(N.height=(se=M[17])!=null?se:0),q[0]&2048&&(N.verticalMode=M[11]),q[0]&262144&&(N.fontColor=(ye=M[18])==null?void 0:ye.fontColor),q[0]&524288&&(N.backgroundColor=M[19]),q[0]&262144&&(N.hintFuriganaFontColor=(ce=M[18])==null?void 0:ce.hintFuriganaFontColor),q[0]&262144&&(N.hintFuriganaShadowColor=(ve=M[18])==null?void 0:ve.hintFuriganaShadowColor),q[0]&1048576&&(N.fontSize=M[20]),q[0]&2097152&&(N.fontFamilyGroupOne=M[21]),q[0]&4194304&&(N.fontFamilyGroupTwo=M[22]),q[0]&8388608&&(N.hideSpoilerImage=M[23]),q[0]&16777216&&(N.hideFurigana=M[24]),q[0]&33554432&&(N.furiganaStyle=M[25]),q[0]&67108864&&(N.viewMode=M[26]),q[0]&134217728&&(N.secondDimensionMaxValue=M[27]),q[0]&268435456&&(N.firstDimensionMargin=M[28]),q[0]&536870912&&(N.autoPositionOnResize=M[29]),q[0]&1073741824&&(N.avoidPageBreak=M[30]),q[1]&1&&(N.pageColumns=M[31]),q[1]&2&&(N.autoBookmark=M[32]),q[0]&16384&&(N.multiplier=M[14]),!o&&q[0]&32&&(o=!0,N.exploredCharCount=M[5],de(()=>o=!1)),!i&&q[0]&64&&(i=!0,N.bookCharCount=M[6],de(()=>i=!1)),!a&&q[0]&8&&(a=!0,N.isBookmarkScreen=M[3],de(()=>a=!1)),!l&&q[0]&512&&(l=!0,N.bookmarkData=M[9],de(()=>l=!1)),!s&&q[0]&1&&(s=!0,N.autoScroller=M[0],de(()=>s=!1)),!u&&q[0]&128&&(u=!0,N.bookmarkManager=M[7],de(()=>u=!1)),!d&&q[0]&256&&(d=!0,N.pageManager=M[8],de(()=>d=!1)),r.$set(N),(!C||q[1]&4)&&c!==(c=((De=M[33])!=null?De:"")+"")&&Fe(f,c),(!C||q[1]&8)&&y!==(y=((Ee=M[34])!=null?Ee:"")+"")&&Fe(m,y),(!C||q[1]&16)&&S!==(S=((Se=M[35])!=null?Se:"")+"")&&Fe(h,S)},i(M){C||(G(e.$$.fragment,M),G(r.$$.fragment,M),C=!0)},o(M){W(e.$$.fragment,M),W(r.$$.fragment,M),C=!1},d(M){pe(e,M),M&&B(n),pe(r,M),M&&B(b),M&&B(f),M&&B(g),M&&B(m),M&&B(v),M&&B(h)}}}function Vn(t){let e,n,r,o,i,a,l;return n=new Ti({props:{sectionData:t[10],exploredCharCount:t[5]}}),{c(){e=Q("div"),ge(n.$$.fragment),this.h()},l(s){e=Z(s,"DIV",{class:!0});var u=x(e);ke(n.$$.fragment,u),u.forEach(B),this.h()},h(){var s;X(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),E(e,"color",(s=t[18])==null?void 0:s.fontColor,!1),E(e,"background-color",t[19],!1)},m(s,u){R(s,e,u),be(n,e,null),i=!0,a||(l=rn(r=Gn.call(null,e,t[64])),a=!0)},p(s,u){var b;t=s;const d={};u[0]&1024&&(d.sectionData=t[10]),u[0]&32&&(d.exploredCharCount=t[5]),n.$set(d),u[0]&262144&&E(e,"color",(b=t[18])==null?void 0:b.fontColor,!1),u[0]&524288&&E(e,"background-color",t[19],!1)},i(s){i||(G(n.$$.fragment,s),s&&(o||Nn(()=>{o=Mo(e,xt,{x:-100,duration:100,easing:Zt}),o.start()})),i=!0)},o(s){W(n.$$.fragment,s),i=!1},d(s){s&&B(e),pe(n),a=!1,l()}}}function zn(t){let e,n,r,o,i,a=(t[5]/t[6]*100).toFixed(2)+"",l,s;return{c(){e=Q("div"),n=ue(t[5]),r=ue(" / "),o=ue(t[6]),i=ue(" ("),l=ue(a),s=ue("%)"),this.h()},l(u){e=Z(u,"DIV",{class:!0});var d=x(e);n=fe(d,t[5]),r=fe(d," / "),o=fe(d,t[6]),i=fe(d," ("),l=fe(d,a),s=fe(d,"%)"),d.forEach(B),this.h()},h(){var u;X(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),E(e,"color",(u=t[18])==null?void 0:u.tooltipTextFontColor,!1)},m(u,d){R(u,e,d),J(e,n),J(e,r),J(e,o),J(e,i),J(e,l),J(e,s)},p(u,d){var b;d[0]&32&&Fe(n,u[5]),d[0]&64&&Fe(o,u[6]),d[0]&96&&a!==(a=(u[5]/u[6]*100).toFixed(2)+"")&&Fe(l,a),d[0]&262144&&E(e,"color",(b=u[18])==null?void 0:b.tooltipTextFontColor,!1)},d(u){u&&B(e)}}}function na(t){var Y,oe,ae;let e,n,r=((Y=t[13])!=null?Y:"")+"",o,i,a,l,s,u,d,b,c,f,g,y,m,v;Qt.title=e=dn((ae=(oe=t[12])==null?void 0:oe.title)!=null?ae:"");let S=t[2]&&qn(t);const h=[ta,ea],C=[];function F(p,I){return p[15]?0:1}u=F(t),d=C[u]=h[u](t);let A=t[1]&&Vn(t),V=t[4]&&t[6]&&zn(t);return{c(){n=$(),o=ue(r),i=$(),a=Q("button"),l=$(),S&&S.c(),s=$(),d.c(),b=$(),A&&A.c(),c=$(),V&&V.c(),f=$(),g=Q("button"),this.h()},l(p){So('[data-svelte="svelte-rnuhm6"]',Qt.head).forEach(B),n=ee(p),o=fe(p,r),i=ee(p),a=Z(p,"BUTTON",{class:!0}),x(a).forEach(B),l=ee(p),S&&S.l(p),s=ee(p),d.l(p),b=ee(p),A&&A.l(p),c=ee(p),V&&V.l(p),f=ee(p),g=Z(p,"BUTTON",{class:!0}),x(g).forEach(B),this.h()},h(){X(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),X(g,"class","fixed inset-x-0 bottom-0 z-10 h-8 w-full cursor-pointer")},m(p,I){R(p,n,I),R(p,o,I),R(p,i,I),R(p,a,I),R(p,l,I),S&&S.m(p,I),R(p,s,I),C[u].m(p,I),R(p,b,I),A&&A.m(p,I),R(p,c,I),V&&V.m(p,I),R(p,f,I),R(p,g,I),y=!0,m||(v=[Pe(window,"keydown",t[49]),Pe(a,"click",t[53]),Pe(g,"click",t[65])],m=!0)},p(p,I){var T,z,H;(!y||I[0]&4096)&&e!==(e=dn((z=(T=p[12])==null?void 0:T.title)!=null?z:""))&&(Qt.title=e),(!y||I[0]&8192)&&r!==(r=((H=p[13])!=null?H:"")+"")&&Fe(o,r),p[2]?S?(S.p(p,I),I[0]&4&&G(S,1)):(S=qn(p),S.c(),G(S,1),S.m(s.parentNode,s)):S&&(Re(),W(S,1,1,()=>{S=null}),Le());let _=u;u=F(p),u===_?C[u].p(p,I):(Re(),W(C[_],1,1,()=>{C[_]=null}),Le(),d=C[u],d?d.p(p,I):(d=C[u]=h[u](p),d.c()),G(d,1),d.m(b.parentNode,b)),p[1]?A?(A.p(p,I),I[0]&2&&G(A,1)):(A=Vn(p),A.c(),G(A,1),A.m(c.parentNode,c)):A&&(Re(),W(A,1,1,()=>{A=null}),Le()),p[4]&&p[6]?V?V.p(p,I):(V=zn(p),V.c(),V.m(f.parentNode,f)):V&&(V.d(1),V=null)},i(p){y||(G(S),G(d),G(A),y=!0)},o(p){W(S),W(d),W(A),y=!1},d(p){p&&B(n),p&&B(o),p&&B(i),p&&B(a),p&&B(l),S&&S.d(p),p&&B(s),C[u].d(p),p&&B(b),A&&A.d(p),p&&B(c),V&&V.d(p),p&&B(f),p&&B(g),m=!1,Rt(v)}}}const On="background-color",Rn="writing-mode";function oa(t,e,n){let r,o,i,a,l,s,u,d,b,c,f,g,y,m,v,S,h,C,F,A,V,Y,oe,ae,p,I,_,T;K(t,Jo,w=>n(11,o=w)),K(t,it,w=>n(1,i=w)),K(t,Ut,w=>n(14,s=w)),K(t,Qo,w=>n(20,g=w)),K(t,Zo,w=>n(21,y=w)),K(t,xo,w=>n(22,m=w)),K(t,$o,w=>n(23,v=w)),K(t,er,w=>n(24,S=w)),K(t,tr,w=>n(25,h=w)),K(t,nr,w=>n(26,C=w)),K(t,or,w=>n(27,F=w)),K(t,rr,w=>n(28,A=w)),K(t,ir,w=>n(29,V=w)),K(t,ar,w=>n(30,Y=w)),K(t,lr,w=>n(31,oe=w)),K(t,sr,w=>n(32,ae=w));let z=!0,H=!1,L=!0,te=0,j=0,U,M,q,le=Promise.resolve(void 0);const N=Gt(2500).pipe(Ue(()=>n(2,z=!1)),nt());K(t,N,w=>n(13,l=w));const Ce=ht(()=>xi(zo)).pipe(we(w=>Number(w.url.searchParams.get("id"))),tn({refCount:!0,bufferSize:1})),se=Ce.pipe(gt(w=>wt.getData(w)),nn());K(t,se,w=>n(12,a=w));const ye=se.pipe(Ue(w=>{w||Ko("/manage")}),nt());K(t,ye,w=>n(36,T=w));const ce=se.pipe(Ue(w=>{!w||n(9,le=wt.getBookmark(w.id))}),nt());K(t,ce,w=>n(33,p=w));const ve=se.pipe(gt(w=>w?(sn.next(w.sections||[]),Zi(w,".book-content",document)):mt),tn({refCount:!0,bufferSize:1}));K(t,ve,w=>n(15,u=w));const De=ht(()=>We(visualViewport,"resize")).pipe(nn()),Ee=De.pipe(en(0),we(()=>visualViewport.width),Mt());K(t,Ee,w=>n(16,d=w));const Se=De.pipe(en(0),we(()=>visualViewport.height),Mt());K(t,Se,w=>n(17,b=w));const _e=Wo.pipe(we(w=>gr.get(w)),Lt(w=>!!w));K(t,_e,w=>n(18,c=w));const me=_e.pipe(we(w=>w.backgroundColor));K(t,me,w=>n(19,f=w));const Ve=me.pipe(An(()=>document.body,(w,Ae)=>Ae.style.setProperty(On,w),w=>w.style.removeProperty(On)),nt(),Mt());K(t,Ve,w=>n(34,I=w));const ze=Yo.pipe(An(()=>document.documentElement,(w,Ae)=>Ae.style.setProperty(Rn,w),w=>w.style.removeProperty(Rn)),nt(),Mt());K(t,ze,w=>n(35,_=w));const Te=ht(()=>qt).pipe(we(w=>[...w.values()]));K(t,Te,w=>n(10,r=w));function xe(w){!$i(w,Uo.getValue(),Ne,$e,ut=>Ut.next(Ut.getValue()+ut),U,q,o,D)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),w.preventDefault())}function Ke(){let w;return Ce.subscribe(Ae=>w=Ae).unsubscribe(),w}async function Ne(){const w=Ke();if(!w||!M)return;const Ae=M.formatBookmarkData(w);await wt.putBookmark(Ae),n(9,le=Promise.resolve(Ae))}async function $e(){const w=await le;!w||!M||M.scrollToBookmark(w)}function P(){wt.deleteLastItem(),Ne()}function ne(){if(!Dt.fullscreenElement){Dt.requestFullscreen(document.documentElement);return}Dt.exitFullscreen()}function D(w){if(!(r!=null&&r.length))return;const[Ae,ut]=to(r);!ut&&w===-1||w===1&&ut===Ae.length-1||Ct.next(Ae[ut+w].reference)}const re=()=>n(2,z=!0);function Ge(w){H=w,n(3,H)}const Be=()=>{n(2,z=!1),it.next(!0)},Oe=()=>n(2,z=!1);function _t(w){te=w,n(5,te)}function k(w){j=w,n(6,j)}function Xt(w){H=w,n(3,H)}function Wt(w){le=w,n(9,le)}function lo(w){U=w,n(0,U)}function so(w){M=w,n(7,M)}function uo(w){q=w,n(8,q)}const fo=()=>it.next(!1),co=()=>n(4,L=!L);return t.$$.update=()=>{t.$$.dirty[0]&3&&i&&(U==null||U.off())},[U,i,z,H,L,te,j,M,q,le,r,o,a,l,s,u,d,b,c,f,g,y,m,v,S,h,C,F,A,V,Y,oe,ae,p,I,_,T,N,se,ye,ce,ve,Ee,Se,_e,me,Ve,ze,Te,xe,Ne,P,ne,re,Ge,Be,Oe,_t,k,Xt,Wt,lo,so,uo,fo,co]}class ka extends Je{constructor(e){super(),Qe(this,e,oa,na,Ze,{},null,[-1,-1,-1])}}export{ka as default};
