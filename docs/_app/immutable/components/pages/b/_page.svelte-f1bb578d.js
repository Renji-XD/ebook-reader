var rr=Object.defineProperty;var ar=(n,e,t)=>e in n?rr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var et=(n,e,t)=>(ar(n,typeof e!="symbol"?e+"":e,t),t);import{S as Dt,i as Ft,n as Tt,V as lr,e as Ht,W as sr,a as H,B as Et,f as R,a2 as wn,h as ur,j as Q,w as Se,s as ie,k as Z,l as x,x as Pe,c as re,m as U,a8 as K,p as M,y as ve,N as de,d as j,g as ot,t as Y,b as it,z as ye,R as _t,D as W,_ as Gn,T as Wn,a1 as oe,G as ee,a5 as jn,a9 as Jo,q as _e,r as we,u as Ye,aa as ao,ab as ce,ac as he,o as Qo,Y as Zo,Z as xo,F as fr,L as $o,a0 as lo,$ as cr,ad as hr,A as dr}from"../../../chunks/index-876111f7.js";import{k as gr,l as ei,n as ti,o as mr,q as hn,r as At,s as pr,v as kr,w as br,x as ht,y as Pt,B as gn,z as Sn,A as zt,m as Ke,C as $t,D as ni,F as lt,u as oi,E as Yt,G as ii,H as Xn,I as mn,J as ri,K as so,t as St,L as ai,c as qn,N as li,O as Cr,P as Ot,Q as _r,R as Ln,S as Vn,T as wr,U as zn,V as Bt,W as Pn,X as Sr,Y as Pr,Z as vr,f as Ct,_ as si,i as yr,a as tt,$ as Rr,a0 as ui,a1 as Mr,a2 as Er,a3 as bt,a4 as ln,a5 as sn,a6 as Xt,M as wt,a7 as Dr,a8 as Fr,a9 as uo,j as Dn,aa as Tr,ab as Br,p as fo,ac as Ir,ad as Fn,ae as Nn,af as Hn,ag as Ar,ah as Or,ai as Lr,aj as Vr,ak as zr,al as Nr,g as Hr,am as Gr,an as Tn,ao as Bn,h as Wr,ap as jr,aq as Xr,ar as qr,as as Kr,at as Yr,au as Ur,av as Jr,aw as Qr,ax as Zr,ay as xr,az as $r,aA as co}from"../../../chunks/store-34c5451e.js";import{p as ea}from"../../../chunks/stores-708a1552.js";import{f as ho,g as go}from"../../../chunks/format-page-title-256dab77.js";import{F as rt,f as Kn,a as Jt,b as ta,c as na,d as oa,e as ia,g as ra,h as aa,i as la}from"../../../chunks/fa-884f19f7.js";import{t as fi,k as pn,l as Qt,_ as en,u as sa,O as vt,i as It,n as ua,h as fa,a as nt,m as mt,v as In}from"../../../chunks/error-handler-df8dffd6.js";import{i as ci}from"../../../chunks/fonts-e5a631ed.js";import{m as ca,t as ct,c as Zt,f as mo}from"../../../chunks/index-b146a6c7.js";import{r as Mt,M as ha,m as qe,P as da,c as hi}from"../../../chunks/merged-header-icon-4609f9c6.js";import{a as ga}from"../../../chunks/theme-option-f9f8f697.js";var Ut={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,i=Ut.delegate;i&&(e=i.requestAnimationFrame,t=i.cancelAnimationFrame);var o=e(function(r){t=void 0,n(r)});return new fi(function(){return t==null?void 0:t(o)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ut.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,pn([],Qt(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ut.delegate;return((t==null?void 0:t.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,pn([],Qt(n)))},delegate:void 0},ma=function(n){en(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e}(fi),kn={setInterval:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var o=kn.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,pn([n,e],Qt(t))):setInterval.apply(void 0,pn([n,e],Qt(t)))},clearInterval:function(n){var e=kn.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0},di=function(n){en(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.scheduler=t,o.work=i,o.pending=!1,o}return e.prototype.schedule=function(t,i){var o;if(i===void 0&&(i=0),this.closed)return this;this.state=t;var r=this.id,a=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(a,r,i)),this.pending=!0,this.delay=i,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,i),this},e.prototype.requestAsyncId=function(t,i,o){return o===void 0&&(o=0),kn.setInterval(t.flush.bind(t,this),o)},e.prototype.recycleAsyncId=function(t,i,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return i;i!=null&&kn.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(t,i);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var o=!1,r;try{this.work(t)}catch(a){o=!0,r=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,o=t.scheduler,r=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,sa(r,this),i!=null&&(this.id=this.recycleAsyncId(o,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(ma),po=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=gr.now,n}(),gi=function(n){en(e,n);function e(t,i){i===void 0&&(i=po.now);var o=n.call(this,t,i)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var o;this._active=!0;do if(o=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,o){for(;t=i.shift();)t.unsubscribe();throw o}},e}(po),tn=new gi(di),pa=tn,ka=function(n){en(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.scheduler=t,o.work=i,o}return e.prototype.requestAsyncId=function(t,i,o){return o===void 0&&(o=0),o!==null&&o>0?n.prototype.requestAsyncId.call(this,t,i,o):(t.actions.push(this),t._scheduled||(t._scheduled=Ut.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,i,o){var r;if(o===void 0&&(o=0),o!=null?o>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,i,o);var a=t.actions;i!=null&&((r=a[a.length-1])===null||r===void 0?void 0:r.id)!==i&&(Ut.cancelAnimationFrame(i),t._scheduled=void 0)},e}(di),ba=function(n){en(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var i=this._scheduled;this._scheduled=void 0;var o=this.actions,r;t=t||o.shift();do if(r=t.execute(t.state,t.delay))break;while((t=o[0])&&t.id===i&&o.shift());if(this._active=!1,r){for(;(t=o[0])&&t.id===i&&o.shift();)t.unsubscribe();throw r}},e}(gi),vn=new ba(ka),Gt=new vt(function(n){return n.complete()});function Yn(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ei(n);return ti(n,t)}function Ca(n){return n instanceof Date&&!isNaN(n)}var _a=["addListener","removeListener"],wa=["addEventListener","removeEventListener"],Sa=["on","off"];function st(n,e,t,i){if(It(t)&&(i=t,t=void 0),i)return st(n,e,t).pipe(ca(i));var o=Qt(ya(n)?wa.map(function(l){return function(s){return n[l](e,s,t)}}):Pa(n)?_a.map(ko(n,e)):va(n)?Sa.map(ko(n,e)):[],2),r=o[0],a=o[1];if(!r&&mr(n))return hn(function(l){return st(l,e,t)})(At(n));if(!r)throw new TypeError("Invalid event target");return new vt(function(l){var s=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];return l.next(1<f.length?f:f[0])};return r(s),function(){return a(s)}})}function ko(n,e){return function(t){return function(i){return n[t](e,i)}}}function Pa(n){return It(n.addListener)&&It(n.removeListener)}function va(n){return It(n.on)&&It(n.off)}function ya(n){return It(n.addEventListener)&&It(n.removeEventListener)}function nn(n,e,t){n===void 0&&(n=0),t===void 0&&(t=pa);var i=-1;return e!=null&&(pr(e)?t=e:i=e),new vt(function(o){var r=Ca(n)?+n-t.now():n;r<0&&(r=0);var a=0;return t.schedule(function(){o.closed||(o.next(a++),0<=i?this.schedule(void 0,i):o.complete())},r)})}function Ra(n,e){return n===void 0&&(n=0),e===void 0&&(e=tn),n<0&&(n=0),nn(n,n,e)}function on(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ei(n),i=kr(n,1/0),o=n;return o.length?o.length===1?At(o[0]):br(i)(ti(o,t)):Gt}var Ma=Array.isArray;function Ea(n){return n.length===1&&Ma(n[0])?n[0]:n}function Da(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=Ea(n),n.length===1?At(n[0]):new vt(Fa(n))}function Fa(n){return function(e){for(var t=[],i=function(r){t.push(At(n[r]).subscribe(ht(e,function(a){if(t){for(var l=0;l<t.length;l++)l!==r&&t[l].unsubscribe();t=null}e.next(a)})))},o=0;t&&!e.closed&&o<n.length;o++)i(o)}}function Ta(n){return Pt(function(e,t){var i=!1,o=null,r=null,a=!1,l=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var f=o;o=null,t.next(f)}a&&t.complete()},s=function(){r=null,a&&t.complete()};e.subscribe(ht(t,function(f){i=!0,o=f,r||At(n(f)).subscribe(r=ht(t,l,s))},function(){a=!0,(!i||!r||r.closed)&&t.complete()}))})}function Ba(n,e){return e===void 0&&(e=tn),Ta(function(){return nn(n,e)})}function Ia(n){return Pt(function(e,t){var i=!1,o=null,r=null,a=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var l=o;o=null,t.next(l)}};e.subscribe(ht(t,function(l){r==null||r.unsubscribe(),i=!0,o=l,r=ht(t,a,ua),At(n(l)).subscribe(r)},function(){a(),t.complete()},void 0,function(){o=r=null}))})}function xt(n,e){return e===void 0&&(e=tn),Pt(function(t,i){var o=null,r=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var f=r;r=null,i.next(f)}};function s(){var f=a+n,d=e.now();if(d<f){o=this.schedule(void 0,f-d),i.add(o);return}l()}t.subscribe(ht(i,function(f){r=f,a=e.now(),o||(o=e.schedule(s,n),i.add(o))},function(){l(),i.complete()},void 0,function(){r=o=null}))})}function Wt(n){return n<=0?function(){return Gt}:Pt(function(e,t){var i=0;e.subscribe(ht(t,function(o){++i<=n&&(t.next(o),n<=i&&t.complete())}))})}function mi(n,e){return e===void 0&&(e=fa),n=n??Aa,Pt(function(t,i){var o,r=!0;t.subscribe(ht(i,function(a){var l=e(a);(r||!n(o,l))&&(r=!1,o=l,i.next(a))}))})}function Aa(n,e){return n===e}function Oa(n){return Pt(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function La(){return Pt(function(n,e){var t,i=!1;n.subscribe(ht(e,function(o){var r=t;t=o,i&&e.next([r,o]),i=!0}))})}function Va(n,e){return e===void 0&&(e=!1),Pt(function(t,i){var o=0;t.subscribe(ht(i,function(r){var a=n(r,o++);(a||e)&&i.next(r),!a&&i.complete()}))})}var pi={leading:!0,trailing:!1};function za(n,e){return e===void 0&&(e=pi),Pt(function(t,i){var o=e.leading,r=e.trailing,a=!1,l=null,s=null,f=!1,d=function(){s==null||s.unsubscribe(),s=null,r&&(v(),f&&i.complete())},w=function(){s=null,f&&i.complete()},p=function(E){return s=At(n(E)).subscribe(ht(i,d,w))},v=function(){if(a){a=!1;var E=l;l=null,i.next(E),!f&&p(E)}};t.subscribe(ht(i,function(E){a=!0,l=E,!(s&&!s.closed)&&(o?v():p(E))},function(){f=!0,!(r&&a&&s&&!s.closed)&&i.complete()}))})}function Na(n,e,t){e===void 0&&(e=tn),t===void 0&&(t=pi);var i=nn(n,e);return za(function(){return i},t)}const Un=new gn([]),bn=new nt,rn=new nt,Nt=new nt;function ki(n){const e=n.filter(r=>!r.parentChapter);let t=n.find(r=>r.progress<100);t||(t=n[n.length-1]);const i=t.parentChapter||t.reference,o=e.findIndex(r=>r.reference===i);return[e,o,i]}function Ha(n){let e,t;return{c(){e=new lr(!1),t=Ht(),this.h()},l(i){e=sr(i,!1),t=Ht(),this.h()},h(){e.a=t},m(i,o){e.m(n[0],i,o),H(i,t,o)},p(i,[o]){o&1&&e.p(i[0])},i:Et,o:Et,d(i){i&&R(t),i&&e.d()}}}function Ga(n,e,t){let{html:i}=e;const o=wn();return ur(()=>{o("load")}),n.$$set=r=>{"html"in r&&t(0,i=r.html)},[i]}class bi extends Dt{constructor(e){super(),Ft(this,e,Ga,Ha,Tt,{html:0})}}function Wa(n,e){var o;const t=(o=document.elementFromPoint(n,e))==null?void 0:o.closest("p");if(!t)return;const i=Sn(t);if(!!i.length)return{range:Jn(i[0]),parent:t}}function Jn(n,e=0,t=0){const i=new Range;return i.setStart(n,e),i.setEnd(n,t),i}function ja(n,e){var a,l,s;const t=(a=n.getSelection())!=null&&a.toString().trim()?(l=n.getSelection())==null?void 0:l.getRangeAt(0):void 0;let i;if(t?i=t:i=e,!i)return;const o=(s=i.endContainer.parentElement)==null?void 0:s.closest("p");if(!o)return;const r=Sn(o);if(!!r.length)return Jn(r[0])}function bo(n,e){const t=n.createRange();return t.selectNode(e),t.getBoundingClientRect()}function Ci(n,e=250){var t;(t=n.getSelection())==null||t.removeAllRanges(),setTimeout(()=>{var i;(i=n.getSelection())==null||i.addRange(new Range)},e)}function _i(n,e,t,i){const o=Math.min(Math.max(i,0),t?n.innerWidth/4:n.innerHeight/4),r=e.getBoundingClientRect(),a=t?o:r.left,l=t?n.innerWidth-o:r.right,s=t?r.top:o,f=t?r.bottom:n.innerHeight-o,d=Number(getComputedStyle(e).lineHeight.replace(/px$/,""));return{elLeftReferencePoint:a,elRightReferencePoint:l,elTopReferencePoint:s,elBottomReferencePoint:f,firstDimensionMargin:o,pointGap:d}}function Kt(n,e,t,i=0){if(!n)return;const o=`animate-[pulse_${t}s_cubic-bezier(0.4,0,0.6,1)_${i?"1":"infinite"}]`;n.classList[e](o),i&&setTimeout(()=>n.classList.remove(o),i)}class Xa{constructor(e,t,i,o,r=vn){et(this,"enabled$",new gn(!1));this.multiplier=e,this.verticalMode=t,this.enabled$.pipe(zt(a=>{if(!a)return Gt;let l=0;return Ra(0,r).pipe(Ke(()=>Date.now()),La(),Ke(s=>this.calcNewPos(s)),Ke(s=>{l+=s;const f=Math.trunc(l);return l-=f,f}),$t(s=>s!==0))}),ct(i)).subscribe(a=>{let l="top";t&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,t]){let i=.00365956;return this.verticalMode&&(i=-91489e-8),i*this.multiplier*(t-e)}}function Lt(n,e){return e==="rtl"?-n:n}class qa{constructor(e,t,i){this.calculator=e,this.window=t,this.firstDimensionMargin=i}scrollToBookmark(e,t=0){const i=this.getBookmarkPosition(e);if(!i)return;const{scrollToData:o}=Co(i,this.firstDimensionMargin),r=this.calculator.verticalMode?"left":"top";o.left!==void 0&&r==="left"?o.left+=t:o.top!==void 0&&r==="top"&&(o.top-=t),this.window.scrollTo(o)}formatBookmarkData(e,t=0){const i=this.calculator.calcExploredCharCount(t),o=this.calculator.charCount,{verticalMode:r}=this.calculator,a=r?"scrollX":"scrollY";return{dataId:e,exploredCharCount:i,progress:i/o,[a]:this.window[a],lastBookmarkModified:new Date().getTime()}}formatBookmarkDataByRange(e){return this.formatBookmarkData(e)}getBookmarkBarPosition(e){const t=this.getBookmarkPosition(e);if(!!t)return Co(t,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:t}=this.calculator,i=this.getBookmarkTargetPosByScrollValue(e);if(i)return i;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return t?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:t}=e,i=o=>{const r=e[o];if(!r)return;const a=Lt(r,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===t)return{[o]:r}};return this.calculator.verticalMode?i("scrollX"):i("scrollY")}}function Co(n,e){return"scrollX"in n?{scrollToData:{left:n.scrollX},bookmarkPosData:{right:`${-n.scrollX+e}px`}}:{scrollToData:{top:n.scrollY},bookmarkPosData:{top:`${n.scrollY+e}px`}}}function wi(n){const e=(t,i,o,r)=>{if(o<i)return n??o;const a=Math.floor((i+o)/2);return t[a]===r?a:t[a]>r?e(t,i,a-1,r):e(t,a+1,o,r)};return(t,i)=>e(t,0,t.length-1,i)}function Ka(){const n=(e,t,i,o)=>{if(i<t)return-1;const r=Math.floor((t+i)/2);return o.intersectsNode(e[r])?r:o.comparePoint(e[r],0)>0?n(e,t,r-1,o):n(e,r+1,i,o)};return(e,t)=>n(e,0,e.length-1,t)}const Ya=Ka(),Ua=wi(-1),Cn=wi(void 0);class Si{constructor(e,t,i,o,r){et(this,"charCount");et(this,"accumulatedCharCount");et(this,"paragraphPos");et(this,"paragraphs");et(this,"paragraphPosToAccCharCount",new Map);this.containerEl=e,this.axis=t,this.direction=i,this.scrollEl=o,this.document=r,this.paragraphs=Sn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=ni(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const t=this.scrollEl.getBoundingClientRect(),i=Lt(this.verticalMode?t.right:t.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),r=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=bo(this.document,l),d=(()=>(this.verticalMode?s.width:s.height)<=0?this.paragraphPos[a-1]||0:Lt(this.verticalMode?s.left:s.bottom,this.direction)-i-o+e)();this.paragraphPos[a]=d;const w=r.get(d)||[];r.set(d,w),w.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(r.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(e=0){return this.getCharCountByScrollPos(this.scrollPos+e)}getCharCountByScrollPos(e){const t=Cn(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[t])||0}getBookMarkPosForSection(e,t){const i=Math.max(0,Ua(this.accumulatedCharCount,t-e));let o=i,r=this.processSectionBookmarkIteration(i,e,t);if(!r){for(let a=i+1,{length:l}=this.accumulatedCharCount;a<l;a+=1)if(r=this.processSectionBookmarkIteration(a,e,t),r){o=a;break}}return{bookmarkPos:r,node:r?this.paragraphs[o]:void 0,isFirstNode:o===0}}getScrollPosByCharCount(e){const t=Cn(this.accumulatedCharCount,e);return Lt(this.paragraphPos[t],this.direction)||0}getCharCountToPoint(e){const t=Math.max(0,Ya(this.paragraphs,e));return this.accumulatedCharCount[t-1]||0}processSectionBookmarkIteration(e,t,i){const o=this.accumulatedCharCount[e]+t;let r;if(o>i){let a=this.paragraphs[e];a.parentElement&&(a=a.parentElement.closest("p")||a.parentElement);const{top:l,right:s,left:f}=bo(this.document,a);r=this.axis==="horizontal"?{left:s}:{top:l,left:f}}return r}get scrollPos(){return Lt(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}function Ja(n,e,t){const i=xa(e,t)(n,"scrollLeft");return(o,r,a)=>{if(!Qa(o))return;const l=Za(o,r,a);i(-l),o.preventDefault()}}function Qa(n){return!(!n.deltaY||n.deltaX||n.altKey||n.shiftKey||n.ctrlKey||n.metaKey)}function Za(n,e,t){switch(n.deltaMode){case 0:return n.deltaY;case 1:return n.deltaY*e*1.75;default:return n.deltaY*t}}function xa(n,e){return(t,i)=>{let o=!1,r=n[i],a=n[i];const l=()=>{o=!0;const s=Math.trunc((r-n[i])/t);if(n[i]!==a){o=!1;return}if(a+=s,n.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(r=n[i],a=n[i]),r+=s,o||e(l)}}}class $a{constructor(e,t,i){this.verticalMode=e,this.firstDimensionMargin=t,this.window=i}nextPage(){this.scrollByPercent(.95)}prevPage(){this.scrollByPercent(-.95)}updateSectionDataByOffset(){}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let t=this.window.innerHeight,i="top",o=1;this.verticalMode&&(t=this.window.innerWidth,i="left",o=-1);const r=t-this.firstDimensionMargin*2;this.window.scrollBy({[i]:r*e*o,behavior:"smooth"})}}const{document:_o,window:el}=Wn;function wo(n){let e,t,i,o,r;return{c(){e=Q("div"),i=ie(),o=Q("div"),this.h()},l(a){e=Z(a,"DIV",{class:!0,style:!0}),x(e).forEach(R),i=re(a),o=Z(a,"DIV",{class:!0,style:!0}),x(o).forEach(R),this.h()},h(){U(e,"class","fixed z-[5]"),U(e,"style",t=n[23]+": 100%; "+n[22]+": "+n[15]+"px; "+n[21][0]+": 0"),K(e,"inset-y-0",n[2]),K(e,"inset-x-0",!n[2]),M(e,"background-color",n[4]),U(o,"class","fixed z-[5]"),U(o,"style",r=n[23]+": 100%; "+n[22]+": "+n[15]+"px; "+n[21][1]+": 0"),K(o,"inset-y-0",n[2]),K(o,"inset-x-0",!n[2]),M(o,"background-color",n[4])},m(a,l){H(a,e,l),H(a,i,l),H(a,o,l)},p(a,l){l[0]&14712832&&t!==(t=a[23]+": 100%; "+a[22]+": "+a[15]+"px; "+a[21][0]+": 0")&&U(e,"style",t),l[0]&4&&K(e,"inset-y-0",a[2]),l[0]&4&&K(e,"inset-x-0",!a[2]),l[0]&16&&M(e,"background-color",a[4]),l[0]&14712832&&r!==(r=a[23]+": 100%; "+a[22]+": "+a[15]+"px; "+a[21][1]+": 0")&&U(o,"style",r),l[0]&4&&K(o,"inset-y-0",a[2]),l[0]&4&&K(o,"inset-x-0",!a[2]),l[0]&16&&M(o,"background-color",a[4])},d(a){a&&R(e),a&&R(i),a&&R(o)}}}function So(n){let e,t,i,o;const r=[nl,tl],a=[];function l(s,f){return s[2]?0:1}return e=l(n),t=a[e]=r[e](n),{c(){t.c(),i=Ht()},l(s){t.l(s),i=Ht()},m(s,f){a[e].m(s,f),H(s,i,f),o=!0},p(s,f){let d=e;e=l(s),e===d?a[e].p(s,f):(ot(),Y(a[d],1,1,()=>{a[d]=null}),it(),t=a[e],t?t.p(s,f):(t=a[e]=r[e](s),t.c()),j(t,1),t.m(i.parentNode,i))},i(s){o||(j(t),o=!0)},o(s){Y(t),o=!1},d(s){a[e].d(s),s&&R(i)}}}function tl(n){let e,t,i;return t=new rt({props:{icon:Jt}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);Pe(t.$$.fragment,r),r.forEach(R),this.h()},h(){U(e,"class","pointer-events-none absolute text-sm opacity-25 sm:text-xl"),M(e,"color",n[3]),M(e,"left",n[17]),M(e,"top",`calc(${n[19].top} + 1.5rem)`)},m(o,r){H(o,e,r),ve(t,e,null),i=!0},p(o,r){r[0]&8&&M(e,"color",o[3]),r[0]&131072&&M(e,"left",o[17]),r[0]&524288&&M(e,"top",`calc(${o[19].top} + 1.5rem)`)},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&R(e),ye(t)}}}function nl(n){let e,t,i;return t=new rt({props:{icon:Jt}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);Pe(t.$$.fragment,r),r.forEach(R),this.h()},h(){U(e,"class","pointer-events-none absolute text-xl opacity-25"),M(e,"color",n[3]),M(e,"right",`calc(${n[19].right} + 1rem)`),M(e,"top",n[17])},m(o,r){H(o,e,r),ve(t,e,null),i=!0},p(o,r){r[0]&8&&M(e,"color",o[3]),r[0]&524288&&M(e,"right",`calc(${o[19].right} + 1rem)`),r[0]&131072&&M(e,"top",o[17])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&R(e),ye(t)}}}function Po(n){let e,t,i;return t=new rt({props:{icon:Kn,spin:!0}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);Pe(t.$$.fragment,r),r.forEach(R),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),M(e,"color",n[3]),M(e,"background-color",n[4])},m(o,r){H(o,e,r),ve(t,e,null),i=!0},p(o,r){r[0]&8&&M(e,"color",o[3]),r[0]&16&&M(e,"background-color",o[4])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&R(e),ye(t)}}}function ol(n){let e,t,i=`${n[9]}px`,o=`${n[20]||n[1]}px`,r,a,l,s,f,d,w;t=new bi({props:{html:n[0]}}),t.$on("load",n[27]);let p=n[15]&&wo(n),v=n[19]&&So(n),E=!n[18]&&Po(n);return{c(){e=Q("div"),Se(t.$$.fragment),r=ie(),p&&p.c(),a=ie(),v&&v.c(),l=ie(),E&&E.c(),s=ie(),this.h()},l(u){e=Z(u,"DIV",{class:!0});var k=x(e);Pe(t.$$.fragment,k),k.forEach(R),r=re(u),p&&p.l(u),a=re(u),v&&v.l(u),l=re(u),E&&E.l(u),s=re(u),this.h()},h(){U(e,"class","book-content m-auto svelte-1ouz3ba"),K(e,"book-content--writing-vertical-rl",n[2]),K(e,"book-content--writing-horizontal-rl",!n[2]),K(e,"book-content--hide-furigana",n[12]),K(e,"book-content--hide-spoiler-image",n[11]),K(e,"book-content--furigana-style-partial",n[13]===lt.Partial),K(e,"book-content--furigana-style-full",n[13]===lt.Full),K(e,"book-content--furigana-style-toggle",n[13]===lt.Toggle),M(e,"color",n[3]),M(e,"font-size",i),M(e,"line-height",n[10]),M(e,"max-width",!n[2]&&n[14]?`${n[14]}px`:void 0),M(e,"max-height",n[20]?`${n[20]}px`:void 0),M(e,"padding-left",n[2]&&n[15]?`${n[15]}px`:void 0),M(e,"padding-right",n[2]&&n[15]?`${n[15]}px`:void 0),M(e,"padding-top",!n[2]&&n[15]?`${n[15]}px`:void 0),M(e,"padding-bottom",!n[2]&&n[15]?`${n[15]}px`:void 0),M(e,"--font-family-serif",n[7]),M(e,"--font-family-sans-serif",n[8]),M(e,"--book-content-hint-furigana-font-color",n[5]),M(e,"--book-content-hint-furigana-shadow-color",n[6]),M(e,"--book-content-child-height",o)},m(u,k){H(u,e,k),ve(t,e,null),n[49](e),H(u,r,k),p&&p.m(u,k),H(u,a,k),v&&v.m(u,k),H(u,l,k),E&&E.m(u,k),H(u,s,k),f=!0,d||(w=[de(el,"scroll",n[26]),de(_o.body,"wheel",n[25],{passive:!1}),de(_o.body,"mousedown",n[50])],d=!0)},p(u,k){const g={};k[0]&1&&(g.html=u[0]),t.$set(g),(!f||k[0]&4)&&K(e,"book-content--writing-vertical-rl",u[2]),(!f||k[0]&4)&&K(e,"book-content--writing-horizontal-rl",!u[2]),(!f||k[0]&4096)&&K(e,"book-content--hide-furigana",u[12]),(!f||k[0]&2048)&&K(e,"book-content--hide-spoiler-image",u[11]),(!f||k[0]&8192)&&K(e,"book-content--furigana-style-partial",u[13]===lt.Partial),(!f||k[0]&8192)&&K(e,"book-content--furigana-style-full",u[13]===lt.Full),(!f||k[0]&8192)&&K(e,"book-content--furigana-style-toggle",u[13]===lt.Toggle),k[0]&8&&M(e,"color",u[3]),k[0]&512&&i!==(i=`${u[9]}px`)&&M(e,"font-size",i),k[0]&1024&&M(e,"line-height",u[10]),k[0]&16388&&M(e,"max-width",!u[2]&&u[14]?`${u[14]}px`:void 0),k[0]&1048576&&M(e,"max-height",u[20]?`${u[20]}px`:void 0),k[0]&32772&&M(e,"padding-left",u[2]&&u[15]?`${u[15]}px`:void 0),k[0]&32772&&M(e,"padding-right",u[2]&&u[15]?`${u[15]}px`:void 0),k[0]&32772&&M(e,"padding-top",!u[2]&&u[15]?`${u[15]}px`:void 0),k[0]&32772&&M(e,"padding-bottom",!u[2]&&u[15]?`${u[15]}px`:void 0),k[0]&128&&M(e,"--font-family-serif",u[7]),k[0]&256&&M(e,"--font-family-sans-serif",u[8]),k[0]&32&&M(e,"--book-content-hint-furigana-font-color",u[5]),k[0]&64&&M(e,"--book-content-hint-furigana-shadow-color",u[6]),k[0]&1048578&&o!==(o=`${u[20]||u[1]}px`)&&M(e,"--book-content-child-height",o),u[15]?p?p.p(u,k):(p=wo(u),p.c(),p.m(a.parentNode,a)):p&&(p.d(1),p=null),u[19]?v?(v.p(u,k),k[0]&524288&&j(v,1)):(v=So(u),v.c(),j(v,1),v.m(l.parentNode,l)):v&&(ot(),Y(v,1,1,()=>{v=null}),it()),u[18]?E&&(ot(),Y(E,1,1,()=>{E=null}),it()):E?(E.p(u,k),k[0]&262144&&j(E,1)):(E=Po(u),E.c(),j(E,1),E.m(s.parentNode,s))},i(u){f||(j(t.$$.fragment,u),j(v),j(E),f=!0)},o(u){Y(t.$$.fragment,u),Y(v),Y(E),f=!1},d(u){u&&R(e),ye(t),n[49](null),u&&R(r),p&&p.d(u),u&&R(a),v&&v.d(u),u&&R(l),E&&E.d(u),u&&R(s),d=!1,_t(w)}}}function il(n,e,t){let i,o,r,a,l,s,f,d,w;W(n,oi,S=>t(57,l=S)),W(n,Yt,S=>t(58,s=S)),W(n,ii,S=>t(24,f=S)),W(n,Nt,S=>t(59,d=S)),W(n,Xn,S=>t(48,w=S));let{htmlContent:p}=e,{width:v}=e,{height:E}=e,{verticalMode:u}=e,{fontColor:k}=e,{backgroundColor:g}=e,{hintFuriganaFontColor:y}=e,{hintFuriganaShadowColor:T}=e,{fontFamilyGroupOne:P}=e,{fontFamilyGroupTwo:F}=e,{fontSize:D}=e,{lineHeight:X}=e,{hideSpoilerImage:B}=e,{hideFurigana:A}=e,{furiganaStyle:z}=e,{secondDimensionMaxValue:I}=e,{firstDimensionMargin:O}=e,{autoPositionOnResize:_}=e,{autoBookmark:N}=e,{loadingState:b}=e,{multiplier:L}=e,{bookmarkData:$}=e,{exploredCharCount:se}=e,{bookCharCount:ke}=e,{autoScroller:Ve}=e,{bookmarkManager:Me}=e,{pageManager:Re}=e,{customReadingPoint:Ie}=e,{customReadingPointLeft:ze}=e,{customReadingPointTop:ge}=e,{customReadingPointScrollOffset:ae}=e;const le=wn();let Te=!1,J,te,Ne={},Ee,De,C,V,He,q=0,Be=!1,be=window.matchMedia("(min-width: 640px)").matches?"0.5rem":"0.25rem",Ae=!1;const dt=Ja(4,document.documentElement,requestAnimationFrame),Ue=new nt,Ce=new nt,pe=new nt,Je=new Map,Qe=new Map;let me=0,ut=!1;Gn(()=>{pe.next(),pe.complete()}),Ee=new Xa(L,u,pe,document),Ve=Ee,Zt([Ue,Ce]).pipe($t(()=>_),mn(1),Ke(([S,ue])=>u?ue:S),mi(),xt(10),ri(vn),ct(pe)).subscribe(()=>{if(!te||!C)return;const S=te.getScrollPosByCharCount(q)+(u?ae:-ae);Be=!0,C.scrollTo(S)});function Ge(){if(!w||!J)return;const{elLeftReferencePoint:S,elTopReferencePoint:ue,elRightReferencePoint:We,elBottomReferencePoint:Oe,firstDimensionMargin:m,pointGap:ne}=_i(window,J,u,O);if(u){t(34,ge=ue),t(33,ze=Math.min(Math.max(m+(We-S)*(Ie/100)-2,S+ne),We-2)),t(35,ae=window.innerWidth-m-ze);return}t(34,ge=Math.min(Math.max(m+(Oe-ue)*(Ie/100),m),Oe-ne*1.5)),t(33,ze=S),t(35,ae=ge-m)}function pt(S){S.updateParagraphPos(),Ge(),t(28,se=S.calcExploredCharCount(ae)),He&&(He=!1,$.then(ue=>{!ue||!Me||(q=ue.exploredCharCount||0,Me.scrollToBookmark(ue,ae))}).finally(()=>{N&&st(window,"scroll").pipe(mn(1),xt(3e3),ct(pe)).subscribe(()=>{le("bookmark")}),Un.pipe(Wt(1),zt(ue=>ue.length?(ue.forEach(We=>{const Oe=We.reference,m=document.getElementById(Oe);m&&(me||(me=Number(getComputedStyle(m)[u?"marginLeft":"marginBottom"].replace(/px$/,""))/2),Qe.set(Oe,{...We,progress:0}),Je.set(Oe,m))}),Je.size?(je(),st(window,"scroll")):Gt):Gt),Ia(()=>nn(ut?100:500)),ct(pe)).subscribe(je)})),t(44,Ne={}),t(18,Te=!0)}function je(){const S=[...Qe.entries()];for(let ue=0,{length:We}=S;ue<We;ue+=1){const[Oe,m]=S[ue],h=Je.get(Oe).getBoundingClientRect();m.progress=u?Math.min(Math.max(h.right+(O||0)-window.innerWidth+ae,0),h.width)/(h.width||1)*100:Math.abs(Math.min(Math.max(h.top-(O||0)-ae,-h.height),0))/(h.height||1)*100,Qe.set(Oe,m)}ut=!1,bn.next(Qe)}function Ze(S){u&&!d&&!f&&!s&&dt(S,D,window.innerWidth)}function Xe(){requestAnimationFrame(()=>{!te||(t(28,se=te.calcExploredCharCount(ae)),!Be&&se&&(q=se),Be=!1)})}function gt(){if(!J)return;t(43,te=new Si(J,u?"vertical":"horizontal",u?"rtl":"ltr",document.documentElement,document)),t(28,se=0),q=se,t(29,ke=te.charCount);let S=!1;try{S=document.fonts.check(`${D}px ${P||"Noto Serif JP"}`)}catch(ue){mt.error(`Error checking Font Load: ${ue.message}`),S=!0}if(S)le("contentChange",J);else if(!Ae){Ae=!0;const ue=ci(P,l)?3e4:1e4,We=setTimeout(()=>{mt.error(`Error loading primary Font: ${P}`),le("contentChange",J)},ue);document.fonts.addEventListener("loadingdone",()=>{clearTimeout(We),le("contentChange",J)})}}rn.pipe(ct(pe)).subscribe(S=>{let ue=document.getElementById(S);if(!ue)return;ue=!S.startsWith(so)&&ue.closest(`div[id^="${so}"]`)||ue,ut=!0;const Oe=ue.getBoundingClientRect();u?window.scrollBy(-(window.innerWidth-Oe.right-(O||0)-ae-(!ae||ae&&me>ae?me:0)),0):window.scrollBy(0,Oe.top-(O||0)-ae-(!ae||ae&&me>ae?me:0))});function Fe(S){oe[S?"unshift":"push"](()=>{J=S,t(16,J)})}const kt=S=>{f&&S.button===1&&S.preventDefault()};return n.$$set=S=>{"htmlContent"in S&&t(0,p=S.htmlContent),"width"in S&&t(36,v=S.width),"height"in S&&t(1,E=S.height),"verticalMode"in S&&t(2,u=S.verticalMode),"fontColor"in S&&t(3,k=S.fontColor),"backgroundColor"in S&&t(4,g=S.backgroundColor),"hintFuriganaFontColor"in S&&t(5,y=S.hintFuriganaFontColor),"hintFuriganaShadowColor"in S&&t(6,T=S.hintFuriganaShadowColor),"fontFamilyGroupOne"in S&&t(7,P=S.fontFamilyGroupOne),"fontFamilyGroupTwo"in S&&t(8,F=S.fontFamilyGroupTwo),"fontSize"in S&&t(9,D=S.fontSize),"lineHeight"in S&&t(10,X=S.lineHeight),"hideSpoilerImage"in S&&t(11,B=S.hideSpoilerImage),"hideFurigana"in S&&t(12,A=S.hideFurigana),"furiganaStyle"in S&&t(13,z=S.furiganaStyle),"secondDimensionMaxValue"in S&&t(14,I=S.secondDimensionMaxValue),"firstDimensionMargin"in S&&t(15,O=S.firstDimensionMargin),"autoPositionOnResize"in S&&t(37,_=S.autoPositionOnResize),"autoBookmark"in S&&t(38,N=S.autoBookmark),"loadingState"in S&&t(39,b=S.loadingState),"multiplier"in S&&t(40,L=S.multiplier),"bookmarkData"in S&&t(41,$=S.bookmarkData),"exploredCharCount"in S&&t(28,se=S.exploredCharCount),"bookCharCount"in S&&t(29,ke=S.bookCharCount),"autoScroller"in S&&t(30,Ve=S.autoScroller),"bookmarkManager"in S&&t(31,Me=S.bookmarkManager),"pageManager"in S&&t(32,Re=S.pageManager),"customReadingPoint"in S&&t(42,Ie=S.customReadingPoint),"customReadingPointLeft"in S&&t(33,ze=S.customReadingPointLeft),"customReadingPointTop"in S&&t(34,ge=S.customReadingPointTop),"customReadingPointScrollOffset"in S&&t(35,ae=S.customReadingPointScrollOffset)},n.$$.update=()=>{if(n.$$.dirty[0]&4&&t(23,i=u?"height":"width"),n.$$.dirty[0]&4&&t(22,o=u?"width":"height"),n.$$.dirty[0]&4&&t(21,r=u?["left","right"]:["top","bottom"]),n.$$.dirty[1]&32&&Ue.next(v),n.$$.dirty[0]&2&&Ce.next(E),n.$$.dirty[0]&16388&&t(20,a=u&&I?I:void 0),n.$$.dirty[0]&212996&&I&&J){const S=Number(getComputedStyle(J)[u?"marginTop":"marginRight"].replace(/px$/,""));t(17,be=`min(max(calc(${`${S}px - ${be}`}), ${be}), ${S?`${S}px`:be})`)}if(n.$$.dirty[0]&1&&p&&(He=!0),n.$$.dirty[0]&2|n.$$.dirty[1]&4384&&te&&v&&E&&!b){const S=te;requestAnimationFrame(()=>{pt(S)})}n.$$.dirty[0]&4|n.$$.dirty[1]&16896&&Ee&&(t(45,Ee.multiplier=L,Ee),t(45,Ee.verticalMode=u,Ee)),n.$$.dirty[0]&32768|n.$$.dirty[1]&36864&&te&&(t(46,De=te&&new qa(te,window,O||0)),t(31,Me=De)),n.$$.dirty[1]&41984&&Ne&&(t(19,V=void 0),$.then(S=>{!S||t(19,V=De==null?void 0:De.getBookmarkBarPosition(S))})),n.$$.dirty[0]&32772|n.$$.dirty[1]&65536&&(t(47,C=new $a(u,O,window)),t(32,Re=C)),n.$$.dirty[0]&65536|n.$$.dirty[1]&133120&&w&&J&&Number.isFinite(Ie)&&(Ge(),Xe(),je())},[p,E,u,k,g,y,T,P,F,D,X,B,A,z,I,O,J,be,Te,V,a,r,o,i,f,Ze,Xe,gt,se,ke,Ve,Me,Re,ze,ge,ae,v,_,N,b,L,$,Ie,te,Ne,Ee,De,C,w,Fe,kt]}class rl extends Dt{constructor(e){super(),Ft(this,e,il,ol,Tt,{htmlContent:0,width:36,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontFamilyGroupOne:7,fontFamilyGroupTwo:8,fontSize:9,lineHeight:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,secondDimensionMaxValue:14,firstDimensionMargin:15,autoPositionOnResize:37,autoBookmark:38,loadingState:39,multiplier:40,bookmarkData:41,exploredCharCount:28,bookCharCount:29,autoScroller:30,bookmarkManager:31,pageManager:32,customReadingPoint:42,customReadingPointLeft:33,customReadingPointTop:34,customReadingPointScrollOffset:35},null,[-1,-1,-1])}}const al="px-4 md:px-8";function ll(n){const e=Array.from(n.getElementsByTagName("img"));return new vt(t=>{const i=e.filter(r=>r.src).map(sl);if(i.length<=0){t.next(!1),t.complete();return}const o=Zt(i).subscribe(()=>{t.next(!1),t.complete()});return t.next(!0),o})}function sl(n){return n.complete?Yn(1):Da(st(n,"load"),st(n,"error"))}function ul(n,e){const t=fl(n),i=hl(n);return o=>on(t(o),cl(o,e),i(o))}function fl(n){return e=>{const t=Array.from(e.getElementsByTagName("a"));t.forEach(o=>{o.href=n.location.pathname+o.hash});const i=t.map(o=>_n(o).pipe(St(()=>rn.next(o.hash.substring(1)))));return on(...i)}}function cl(n,e){const t=e===lt.Toggle,o=Array.from(n.getElementsByTagName("ruby")).map(r=>t?_n(r).pipe(St(()=>{r.classList.toggle("reveal-rt")})):_n(r).pipe(Wt(1),St(()=>{r.classList.add("reveal-rt")})));return on(...o)}function hl(n){return e=>{const i=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const r=n.createElement("span");return r.classList.add("spoiler-label"),r.setAttribute("aria-hidden","true"),r.innerText="ネタバレ",o.appendChild(r),_n(o).pipe(Wt(1),St(()=>{o.removeChild(r),o.removeAttribute("data-ttu-spoiler-img")}))});return on(...i)}}function _n(n){return st(n,"click").pipe(St(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const dl=300,gl=60,Pi="none";function qt(n,e,t){return n.addEventListener(e,t),()=>n.removeEventListener(e,t)}function ml(n,e){return e.filter(t=>n.pointerId!==t.pointerId)}function un(n,e,t,i,o){n.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:t,pointersCount:i.length}}))}function pl(n,e,t,i,o,r=Pi){e.style.touchAction=r;let a=[];function l(f){a.push(f),un(e,n,f,a,"down"),i==null||i(a,f);const d=f.pointerId;function w(g){d===g.pointerId&&(a=ml(g,a),a.length||p(),un(e,n,g,a,"up"),o==null||o(a,g))}function p(){v(),E(),u(),k()}const v=qt(e,"pointermove",g=>{a=a.map(y=>g.pointerId===y.pointerId?g:y),un(e,n,g,a,"move"),t==null||t(a,g)}),E=qt(e,"lostpointercapture",g=>{w(g)}),u=qt(e,"pointerup",g=>{w(g)}),k=qt(e,"pointerleave",g=>{a=[],p(),un(e,n,g,a,"up"),o==null||o(a,g)})}const s=qt(e,"pointerdown",l);return{destroy:()=>{s()}}}function kl(n,e={timeframe:dl,minSwipeDistance:gl,touchAction:Pi}){const t="swipe";let i,o,r,a;function l(f,d){o=d.clientX,r=d.clientY,i=Date.now(),f.length===1&&(a=d.target)}function s(f,d){if(d.type==="pointerup"&&f.length===0&&Date.now()-i<e.timeframe){const w=d.clientX-o,p=d.clientY-r,v=Math.abs(w),E=Math.abs(p);let u=null;v>=2*E&&v>e.minSwipeDistance?u=w>0?"right":"left":E>=2*v&&E>e.minSwipeDistance&&(u=p>0?"bottom":"top"),u&&n.dispatchEvent(new CustomEvent(t,{detail:{direction:u,target:a}}))}}return pl(t,n,null,l,s,e.touchAction)}class bl{constructor(e,t,i,o,r){this.calculator=e,this.pageManager=t,this.sectionReady$=i,this.sectionIndex$=o,this.setIntendedCharCount=r}scrollToBookmark(e){const t=e.exploredCharCount;if(!t)return;const i=this.calculator.getSectionIndexByCharCount(t),o=l=>{const s=l.getScrollPosByCharCount(t);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(t)};if(this.sectionIndex$.getValue()===i){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(i)}formatBookmarkData(e){return this.formatBookmarkDataByRange(e,void 0)}formatBookmarkDataByRange(e,t){const i=this.calculator.calcExploredCharCount(t),o=this.calculator.charCount;return{dataId:e,exploredCharCount:i,progress:i/o,lastBookmarkModified:new Date().getTime()}}}class Cl{constructor(e,t,i,o,r,a,l,s,f,d,w){et(this,"translateX",0);et(this,"sectionData",new Map);this.contentEl=e,this.scrollEl=t,this.sections=i,this.sectionIndex$=o,this.virtualScrollPos$=r,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=f,this.pageChange$=d,this.sectionRenderComplete$=w,Un.pipe(Wt(1)).subscribe(p=>{!p.length||(p.forEach(v=>{this.sectionData.set(v.reference,{...v,progress:0})}),bn.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}updateSectionDataByOffset(e=0){var o,r;const t=this.verticalMode?this.height:this.width,i=this.virtualScrollPos$.getValue()/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100;if(e){const l=(this.virtualScrollPos$.getValue()+t+this.pageGap)/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100-i;this.updateSectionData((o=this.sections[this.sectionIndex$.getValue()])==null?void 0:o.id,i+l*e)}else this.updateSectionData((r=this.sections[this.sectionIndex$.getValue()])==null?void 0:r.id,i)}flipPage(e){const t=this.verticalMode?"scrollHeight":"scrollWidth",i=this.verticalMode?this.height:this.width,o=i+this.pageGap,r=!0;if(this.translateX){const w=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const p=this.translateX;w(),this.scrollToPos(-p-o,r);return}if(this.nextSection(r)){w();return}return}const a=0,l=this.scrollEl[t],s=this.virtualScrollPos$.getValue(),f=s+o*e,d=Math.ceil(f);if(d<a){if(s!==a){this.scrollToPos(a,r);return}this.prevSection(o,t,i,r);return}if(d>=l){this.nextSection(r);return}this.scrollOrTranslateToPos(f,l,i,r)}scrollTo(e,t){const i=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[i],o,t)}prevSection(e,t,i,o){const r=this.sectionIndex$.getValue()-1;return r<0?!1:(this.updateSectionIndex(r).subscribe(()=>{const a=this.scrollEl[t];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,i,o)}),!0)}nextSection(e){const t=this.sectionIndex$.getValue()+1;return t>=this.sections.length?!1:(this.updateSectionIndex(t).subscribe(()=>{var i,o;this.scrollToPos(0,e),this.updateSectionData((i=this.sections[t-1])==null?void 0:i.id,100,!1),this.updateSectionData((o=this.sections[t])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,t,i,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/t*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+i<=t){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,t){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(t)}translateXToPos(e,t){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(t)}updateSectionIndex(e){return new vt(t=>{if(this.sectionIndex$.getValue()===e){t.next(),t.complete();return}const i=this.sectionRenderComplete$.subscribe(o=>{o===e&&t.next(),t.complete(),i.unsubscribe()});return this.sectionIndex$.next(e),i})}updateSectionData(e,t,i=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let r=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=t:r?l.progress=0:l.progress=100,!r&&s&&(r=!0),this.sectionData.set(a.reference,l)}),i&&bn.next(this.sectionData)}}class _l{constructor(e,t,i,o,r,a,l,s,f){et(this,"charCount");et(this,"sectionAccCharCounts");et(this,"sectionIndex",-1);et(this,"calculator");this.containerEl=e,this.sections=t,this.virtualScrollPos$=i,this.getWidth=o,this.getHeight=r,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=f;const d=p=>Sn(p).reduce((E,u)=>E+ni(u),0);let w=0;this.sectionAccCharCounts=t.map(p=>(w+=d(p),w)),this.charCount=w}updateCurrentSection(e){this.calculator=new Si(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(e){if(e&&this.calculator)return this.getSectionStartCount()+this.calculator.getCharCountToPoint(e);const t=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+t)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const t=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+t}getSectionIndexByCharCount(e){return Cn(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const t=this.getSectionStartCount(),i=this.sectionAccCharCounts[this.sectionIndex],o=e-t,r=e===i&&i-t>0;if(o<0||e>i||r)return-1;if(o===0)return 0;const a=Cn(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,f=l[a];if(Number.isNaN(Number(s[a])))return-1;const d=(u,k)=>u>=k?k:l[u]>f?u:d(u+1,k),w=s[d(a+1,l.length-1)],{screenSize:p}=this,v=this.verticalMode?-1:0,E=p*(Math.ceil(w/p)+v);return Lt(E,this.calculator.direction)}checkBookmarkOnScreen(e){const t=this.getScrollPosByCharCount(e),i=this.virtualScrollPos$.getValue();return t===i&&this.calculator?{isBookmarkScreen:!0,...this.calculator.getBookMarkPosForSection(this.getSectionStartCount(),e)}:{isBookmarkScreen:t===i,bookmarkPos:void 0,node:void 0,isFirstNode:!0}}getOffsetToRange(e,t){if(!e)return 0;const i=e.getBoundingClientRect();if(this.verticalMode)return 1-i.left/this.screenSizeMirrored;const o=Math.floor(100/t),r=Math.floor(this.screenSize/t),a=o*i.bottom/this.screenSizeMirrored;let l=a,s=0;for(let f=0;f<this.screenSize&&i.right>=f;f+=r)l=s*o+a,s+=1;return l/100}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}get screenSizeMirrored(){return(this.verticalMode?this.getWidth():this.getHeight())+this.getPageGap()}}const{window:wl}=Wn;function vo(n){let e,t,i;return t=new rt({props:{icon:Kn,spin:!0}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);Pe(t.$$.fragment,r),r.forEach(R),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),M(e,"color",n[4]),M(e,"background-color",n[5])},m(o,r){H(o,e,r),ve(t,e,null),i=!0},p(o,r){r[0]&16&&M(e,"color",o[4]),r[0]&32&&M(e,"background-color",o[5])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&R(e),ye(t)}}}function yo(n){let e,t,i;return t=new rt({props:{icon:Jt}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);Pe(t.$$.fragment,r),r.forEach(R),this.h()},h(){U(e,"class","fixed h-3 w-3 text-base opacity-25 sm:text-xl"),M(e,"color",n[4]),M(e,"top",n[21]),M(e,"left",n[22]),M(e,"right",n[23])},m(o,r){H(o,e,r),ve(t,e,null),i=!0},p(o,r){r[0]&16&&M(e,"color",o[4]),r[0]&2097152&&M(e,"top",o[21]),r[0]&4194304&&M(e,"left",o[22]),r[0]&8388608&&M(e,"right",o[23])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&R(e),ye(t)}}}function Sl(n){let e,t,i,o,r=`${n[10]}px`,a=`${n[1]}px`,l=`${n[2]}px`,s=`${n[3]?n[1]:(n[1]+Vt)/n[24]-Vt}px`,f,d,w,p,v,E;i=new bi({props:{html:n[20]}}),i.$on("load",n[26]);let u=!n[19]&&vo(n),k=n[0]&&yo(n);return{c(){e=Q("div"),t=Q("div"),Se(i.$$.fragment),f=ie(),u&&u.c(),d=ie(),k&&k.c(),w=Ht(),this.h()},l(g){e=Z(g,"DIV",{class:!0});var y=x(e);t=Z(y,"DIV",{class:!0});var T=x(t);Pe(i.$$.fragment,T),T.forEach(R),y.forEach(R),f=re(g),u&&u.l(g),d=re(g),k&&k.l(g),w=Ht(),this.h()},h(){U(t,"class","book-content-container svelte-u9j5ct"),U(e,"class","book-content m-auto svelte-u9j5ct"),K(e,"book-content--avoid-page-break",n[15]),K(e,"book-content--writing-vertical-rl",n[3]),K(e,"book-content--writing-horizontal-rl",!n[3]),K(e,"book-content--hide-furigana",n[13]),K(e,"book-content--hide-spoiler-image",n[12]),K(e,"book-content--furigana-style-partial",n[14]===lt.Partial),K(e,"book-content--furigana-style-full",n[14]===lt.Full),K(e,"book-content--furigana-style-toggle",n[14]===lt.Toggle),M(e,"color",n[4]),M(e,"font-size",r),M(e,"line-height",n[11]),M(e,"padding-top",!n[3]&&n[16]?`${n[16]}px`:void 0),M(e,"padding-bottom",!n[3]&&n[16]?`${n[16]}px`:void 0),M(e,"padding-left",n[3]&&n[16]?`${n[16]}px`:void 0),M(e,"padding-right",n[3]&&n[16]?`${n[16]}px`:void 0),M(e,"max-width",n[1]?`${n[1]}px`:void 0),M(e,"max-height",n[3]&&n[2]?`${n[2]}px`:void 0),M(e,"--font-family-serif",n[8]),M(e,"--font-family-sans-serif",n[9]),M(e,"--book-content-hint-furigana-font-color",n[6]),M(e,"--book-content-hint-furigana-shadow-color",n[7]),M(e,"--book-content-child-width",a),M(e,"--book-content-child-height",l),M(e,"--book-content-child-column-width",!n[3]&&n[24]===1?`${n[1]}px`:""),M(e,"--book-content-column-count",n[24]),M(e,"--book-content-image-max-width",s)},m(g,y){H(g,e,y),ee(e,t),ve(i,t,null),n[44](t),n[45](e),H(g,f,y),u&&u.m(g,y),H(g,d,y),k&&k.m(g,y),H(g,w,y),p=!0,v||(E=[de(wl,"keydown",n[28]),jn(o=kl.call(null,e,{timeframe:500,minSwipeDistance:n[25],touchAction:"pan-y"})),de(e,"swipe",n[27])],v=!0)},p(g,y){const T={};y[0]&1048576&&(T.html=g[20]),i.$set(T),o&&Jo(o.update)&&y[0]&33554432&&o.update.call(null,{timeframe:500,minSwipeDistance:g[25],touchAction:"pan-y"}),(!p||y[0]&32768)&&K(e,"book-content--avoid-page-break",g[15]),(!p||y[0]&8)&&K(e,"book-content--writing-vertical-rl",g[3]),(!p||y[0]&8)&&K(e,"book-content--writing-horizontal-rl",!g[3]),(!p||y[0]&8192)&&K(e,"book-content--hide-furigana",g[13]),(!p||y[0]&4096)&&K(e,"book-content--hide-spoiler-image",g[12]),(!p||y[0]&16384)&&K(e,"book-content--furigana-style-partial",g[14]===lt.Partial),(!p||y[0]&16384)&&K(e,"book-content--furigana-style-full",g[14]===lt.Full),(!p||y[0]&16384)&&K(e,"book-content--furigana-style-toggle",g[14]===lt.Toggle),y[0]&16&&M(e,"color",g[4]),y[0]&1024&&r!==(r=`${g[10]}px`)&&M(e,"font-size",r),y[0]&2048&&M(e,"line-height",g[11]),y[0]&65544&&M(e,"padding-top",!g[3]&&g[16]?`${g[16]}px`:void 0),y[0]&65544&&M(e,"padding-bottom",!g[3]&&g[16]?`${g[16]}px`:void 0),y[0]&65544&&M(e,"padding-left",g[3]&&g[16]?`${g[16]}px`:void 0),y[0]&65544&&M(e,"padding-right",g[3]&&g[16]?`${g[16]}px`:void 0),y[0]&2&&M(e,"max-width",g[1]?`${g[1]}px`:void 0),y[0]&12&&M(e,"max-height",g[3]&&g[2]?`${g[2]}px`:void 0),y[0]&256&&M(e,"--font-family-serif",g[8]),y[0]&512&&M(e,"--font-family-sans-serif",g[9]),y[0]&64&&M(e,"--book-content-hint-furigana-font-color",g[6]),y[0]&128&&M(e,"--book-content-hint-furigana-shadow-color",g[7]),y[0]&2&&a!==(a=`${g[1]}px`)&&M(e,"--book-content-child-width",a),y[0]&4&&l!==(l=`${g[2]}px`)&&M(e,"--book-content-child-height",l),y[0]&16777226&&M(e,"--book-content-child-column-width",!g[3]&&g[24]===1?`${g[1]}px`:""),y[0]&16777216&&M(e,"--book-content-column-count",g[24]),y[0]&16777226&&s!==(s=`${g[3]?g[1]:(g[1]+Vt)/g[24]-Vt}px`)&&M(e,"--book-content-image-max-width",s),g[19]?u&&(ot(),Y(u,1,1,()=>{u=null}),it()):u?(u.p(g,y),y[0]&524288&&j(u,1)):(u=vo(g),u.c(),j(u,1),u.m(d.parentNode,d)),g[0]?k?(k.p(g,y),y[0]&1&&j(k,1)):(k=yo(g),k.c(),j(k,1),k.m(w.parentNode,w)):k&&(ot(),Y(k,1,1,()=>{k=null}),it())},i(g){p||(j(i.$$.fragment,g),j(u),j(k),p=!0)},o(g){Y(i.$$.fragment,g),Y(u),Y(k),p=!1},d(g){g&&R(e),ye(i),n[44](null),n[45](null),g&&R(f),u&&u.d(g),g&&R(d),k&&k.d(g),g&&R(w),v=!1,_t(E)}}}const Ro="overflow-hidden",Vt=40;function Pl(n,e,t){let i,o,r,a,l,s,f,d,w;W(n,Yt,m=>t(51,o=m)),W(n,Nt,m=>t(52,r=m)),W(n,ai,m=>t(53,a=m)),W(n,qn,m=>t(54,l=m)),W(n,oi,m=>t(55,s=m)),W(n,ii,m=>t(56,f=m)),W(n,li,m=>t(57,d=m)),W(n,Cr,m=>t(25,w=m));let{htmlContent:p}=e,{width:v}=e,{height:E}=e,{verticalMode:u}=e,{fontColor:k}=e,{backgroundColor:g}=e,{hintFuriganaFontColor:y}=e,{hintFuriganaShadowColor:T}=e,{fontFamilyGroupOne:P}=e,{fontFamilyGroupTwo:F}=e,{fontSize:D}=e,{lineHeight:X}=e,{hideSpoilerImage:B}=e,{hideFurigana:A}=e,{furiganaStyle:z}=e,{loadingState:I}=e,{bookmarkData:O}=e,{pageManager:_}=e,{bookmarkManager:N}=e,{exploredCharCount:b}=e,{bookCharCount:L}=e,{isBookmarkScreen:$=!1}=e,{avoidPageBreak:se=!0}=e,{pageColumns:ke}=e,{firstDimensionMargin:Ve}=e,{autoBookmark:Me=!1}=e,{customReadingPointRange:Re}=e,{showCustomReadingPoint:Ie}=e;const ze=wn();let ge,ae,le,Te=[],J,te,Ne,Ee=!1,De="",C=!0,V=0,He=!1,q,Be,be,Ae=!1;const dt=new nt,Ue=new nt,Ce=new gn(-1),pe=new nt,Je=new gn(0),Qe=new nt,me=new nt,ut=Ce.pipe(Ke(m=>{var ne;return((ne=Te[m])==null?void 0:ne.innerHTML)||""})),Ge=new nt;Gn(()=>{document.body.classList.remove(Ro),Ge.next(),Ge.complete()}),Zt([dt,Ue]).pipe(mn(1),zt(()=>me.pipe(Wt(1))),ct(Ge)).subscribe(()=>{if(!le||!J)return;const m=le.getScrollPosByCharCount(V);m<0||J.scrollTo(m,!1)}),pe.pipe(ct(Ge)).subscribe(m=>{var ne;!le||(t(34,Ie=!1),Kt((ne=Re==null?void 0:Re.endContainer)==null?void 0:ne.parentElement,"remove",1),t(29,Re=void 0),t(32,b=le.calcExploredCharCount(Re)),m&&(V=b,d&&Ci(window)),O.then(Fe))}),Me&&pe.pipe(xt(3e3),ct(Ge)).subscribe(m=>{m&&ze("bookmark")}),ut.pipe(mi(),ct(Ge)).subscribe(()=>{t(19,Ee=!1)}),ut.pipe(ct(Ge)).subscribe(m=>{const ne=(h,ft)=>{if(ft===0){h();return}requestAnimationFrame(()=>ne(h,ft-1))};ne(()=>{t(20,De=m)},2)}),Ot(()=>st(document.body,"wheel",{passive:!0})).pipe($t(()=>!f&&!o),Na(50),ct(Ge)).subscribe(m=>{if(!r){let ne=(m.deltaX<0?-1:1)*(u?-1:1);m.deltaX||(ne=m.deltaY<0?-1:1),J==null||J.flipPage(ne)}});function pt(m){!le||(t(32,b=le.calcExploredCharCount(m)),V=b,je(m))}function je(m){!J||!le||J.updateSectionDataByOffset(le.getOffsetToRange(m,i))}function Ze(){if(C){C=!1;return}if(!ge)return;t(40,le=new _l(ge,Te,Je,()=>v,()=>E,()=>Vt,u,ge,document)),t(32,b=0),V=0,t(33,L=le.charCount);let m=!1;try{m=document.fonts.check(`${D}px ${P||"Noto Serif JP"}`)}catch(ne){mt.error(`Error checking Font Load: ${ne.message}`),m=!0}if(m)Xe();else if(!Ae){Ae=!0;const ne=ci(P,s)?3e4:1e4,h=setTimeout(()=>{mt.error(`Error loading primary Font: ${P}`),Xe()},ne);document.fonts.addEventListener("loadingdone",()=>{clearTimeout(h),Xe()})}}function Xe(){!le||(le.updateCurrentSection(Ce.getValue()),ze("contentChange",ge))}function gt(m){m.updateParagraphPos(),t(32,b=m.calcExploredCharCount(Re)),me.next(m),O.then(Fe),Ne&&(Ne=!1,O.then(ne=>{!ne||!N||(t(32,b=ne.exploredCharCount||0),N.scrollToBookmark(ne))})),t(19,Ee=!0)}function Fe(m){const ne=m==null?void 0:m.exploredCharCount;if(!le||!ne)return;const h=le.checkBookmarkOnScreen(ne);if(ge&&h.isBookmarkScreen){const ft=Number(getComputedStyle(ge)[u?"marginTop":"marginRight"].replace(/px$/,""));h.bookmarkPos?u?(t(21,q=ft?`${ft}px`:"0.5rem"),t(22,Be=`${h.bookmarkPos.left}px`),t(23,be=void 0)):(t(21,q=`${h.bookmarkPos.top}px`),t(23,be=void 0),t(22,Be=h.bookmarkPos.left>0?`calc(${h.bookmarkPos.left}px - ${l?"15":"20"}px)`:`calc(${Math.max(l?15:20,ft)}px)`)):kt(ft)}else kt(0);h.isBookmarkScreen&&m.exploredCharCount&&(h.node&&!He&&!h.isFirstNode?je(Jn(h.node)):h.isFirstNode&&je(void 0),t(32,b=He?b:m.exploredCharCount),V=b,He=!0),t(0,$=h.isBookmarkScreen)}function kt(m){u?(t(21,q=m?`${m}px`:"0.5rem"),t(22,Be=a?`${v-a}px`:void 0),t(23,be=a?void 0:"0.75rem")):(t(21,q=a?`${a}px`:"0.5rem"),t(22,Be=m?`calc(${m}px + 0.75rem)`:"0.75rem"),t(23,be=void 0))}function S(m){if(!J||r||o||m.detail.direction!=="left"&&m.detail.direction!=="right")return;const ne=m.detail.direction==="left",h=u?!ne:ne;J.flipPage(h?1:-1)}function ue(m){if(!(!J||r||o))switch(m.code){case"ArrowLeft":J[u?"nextPage":"prevPage"]();break;case"ArrowRight":J[u?"prevPage":"nextPage"]();break;case"ArrowUp":J.prevPage();break;case"ArrowDown":J.nextPage();break}}rn.pipe(ct(Ge)).subscribe(m=>{const ne=Te.findIndex(h=>h.id===m||h.querySelector(`[id="${m}"]`));ne>-1&&(Ce.next(ne),J==null||J.scrollTo(0,!0))});function We(m){oe[m?"unshift":"push"](()=>{ae=m,t(18,ae)})}function Oe(m){oe[m?"unshift":"push"](()=>{ge=m,t(17,ge)})}return n.$$set=m=>{"htmlContent"in m&&t(35,p=m.htmlContent),"width"in m&&t(1,v=m.width),"height"in m&&t(2,E=m.height),"verticalMode"in m&&t(3,u=m.verticalMode),"fontColor"in m&&t(4,k=m.fontColor),"backgroundColor"in m&&t(5,g=m.backgroundColor),"hintFuriganaFontColor"in m&&t(6,y=m.hintFuriganaFontColor),"hintFuriganaShadowColor"in m&&t(7,T=m.hintFuriganaShadowColor),"fontFamilyGroupOne"in m&&t(8,P=m.fontFamilyGroupOne),"fontFamilyGroupTwo"in m&&t(9,F=m.fontFamilyGroupTwo),"fontSize"in m&&t(10,D=m.fontSize),"lineHeight"in m&&t(11,X=m.lineHeight),"hideSpoilerImage"in m&&t(12,B=m.hideSpoilerImage),"hideFurigana"in m&&t(13,A=m.hideFurigana),"furiganaStyle"in m&&t(14,z=m.furiganaStyle),"loadingState"in m&&t(36,I=m.loadingState),"bookmarkData"in m&&t(37,O=m.bookmarkData),"pageManager"in m&&t(30,_=m.pageManager),"bookmarkManager"in m&&t(31,N=m.bookmarkManager),"exploredCharCount"in m&&t(32,b=m.exploredCharCount),"bookCharCount"in m&&t(33,L=m.bookCharCount),"isBookmarkScreen"in m&&t(0,$=m.isBookmarkScreen),"avoidPageBreak"in m&&t(15,se=m.avoidPageBreak),"pageColumns"in m&&t(38,ke=m.pageColumns),"firstDimensionMargin"in m&&t(16,Ve=m.firstDimensionMargin),"autoBookmark"in m&&t(39,Me=m.autoBookmark),"customReadingPointRange"in m&&t(29,Re=m.customReadingPointRange),"showCustomReadingPoint"in m&&t(34,Ie=m.showCustomReadingPoint)},n.$$.update=()=>{if(n.$$.dirty[1]&64&&O.then(m=>{He=!1,Fe(m)}),n.$$.dirty[0]&2&&v&&dt.next(v),n.$$.dirty[0]&4&&E&&Ue.next(E),n.$$.dirty[0]&10|n.$$.dirty[1]&128&&t(24,i=u?1:ke||Math.ceil(v/1e3)),n.$$.dirty[1]&16&&p&&(Ne=!0),n.$$.dirty[1]&16){const m=document.createElement("div");m.innerHTML=p,t(41,Te=Array.from(m.children)),Ce.next(0)}if(n.$$.dirty[0]&393230|n.$$.dirty[1]&3072&&ae&&ge&&Te&&(t(42,J=new Cl(ae,ge,Te,Ce,Je,v,E,Vt,u,pe,Qe)),t(30,_=J)),n.$$.dirty[0]&6|n.$$.dirty[1]&544&&le&&v&&E&&!I){const m=le;requestAnimationFrame(()=>{gt(m)})}n.$$.dirty[1]&544&&le&&!I&&Qe.next(Ce.getValue()),n.$$.dirty[1]&6656&&le&&J&&(t(43,te=new bl(le,J,me,Ce,m=>V=m)),t(31,N=te)),n.$$.dirty[0]&536870912&&pt(Re)},document.body.classList.add(Ro),[$,v,E,u,k,g,y,T,P,F,D,X,B,A,z,se,Ve,ge,ae,Ee,De,q,Be,be,i,w,Ze,S,ue,Re,_,N,b,L,Ie,p,I,O,ke,Me,le,Te,J,te,We,Oe]}class vl extends Dt{constructor(e){super(),Ft(this,e,Pl,Sl,Tt,{htmlContent:35,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,fontSize:10,lineHeight:11,hideSpoilerImage:12,hideFurigana:13,furiganaStyle:14,loadingState:36,bookmarkData:37,pageManager:30,bookmarkManager:31,exploredCharCount:32,bookCharCount:33,isBookmarkScreen:0,avoidPageBreak:15,pageColumns:38,firstDimensionMargin:16,autoBookmark:39,customReadingPointRange:29,showCustomReadingPoint:34},null,[-1,-1,-1])}}function yl(n){let e,t,i,o,r,a,l,s,f,d;function w(P){n[59](P)}function p(P){n[60](P)}function v(P){n[61](P)}function E(P){n[62](P)}function u(P){n[63](P)}function k(P){n[64](P)}function g(P){n[65](P)}function y(P){n[66](P)}let T={htmlContent:n[13],width:n[35]??0,height:n[36]??0,verticalMode:n[14],fontColor:n[15],backgroundColor:n[16],hintFuriganaFontColor:n[17],hintFuriganaShadowColor:n[18],fontFamilyGroupOne:n[19],fontFamilyGroupTwo:n[20],fontSize:n[21],lineHeight:n[22],hideSpoilerImage:n[23],hideFurigana:n[24],furiganaStyle:n[25],loadingState:n[37]??!0,avoidPageBreak:n[29],pageColumns:n[30],autoBookmark:n[31],firstDimensionMargin:n[27]};return n[0]!==void 0&&(T.exploredCharCount=n[0]),n[1]!==void 0&&(T.bookCharCount=n[1]),n[6]!==void 0&&(T.isBookmarkScreen=n[6]),n[2]!==void 0&&(T.bookmarkData=n[2]),n[4]!==void 0&&(T.bookmarkManager=n[4]),n[5]!==void 0&&(T.pageManager=n[5]),n[11]!==void 0&&(T.customReadingPointRange=n[11]),n[12]!==void 0&&(T.showCustomReadingPoint=n[12]),e=new vl({props:T}),oe.push(()=>ce(e,"exploredCharCount",w)),oe.push(()=>ce(e,"bookCharCount",p)),oe.push(()=>ce(e,"isBookmarkScreen",v)),oe.push(()=>ce(e,"bookmarkData",E)),oe.push(()=>ce(e,"bookmarkManager",u)),oe.push(()=>ce(e,"pageManager",k)),oe.push(()=>ce(e,"customReadingPointRange",g)),oe.push(()=>ce(e,"showCustomReadingPoint",y)),e.$on("contentChange",n[67]),e.$on("bookmark",n[68]),{c(){Se(e.$$.fragment)},l(P){Pe(e.$$.fragment,P)},m(P,F){ve(e,P,F),d=!0},p(P,F){const D={};F[0]&8192&&(D.htmlContent=P[13]),F[1]&16&&(D.width=P[35]??0),F[1]&32&&(D.height=P[36]??0),F[0]&16384&&(D.verticalMode=P[14]),F[0]&32768&&(D.fontColor=P[15]),F[0]&65536&&(D.backgroundColor=P[16]),F[0]&131072&&(D.hintFuriganaFontColor=P[17]),F[0]&262144&&(D.hintFuriganaShadowColor=P[18]),F[0]&524288&&(D.fontFamilyGroupOne=P[19]),F[0]&1048576&&(D.fontFamilyGroupTwo=P[20]),F[0]&2097152&&(D.fontSize=P[21]),F[0]&4194304&&(D.lineHeight=P[22]),F[0]&8388608&&(D.hideSpoilerImage=P[23]),F[0]&16777216&&(D.hideFurigana=P[24]),F[0]&33554432&&(D.furiganaStyle=P[25]),F[1]&64&&(D.loadingState=P[37]??!0),F[0]&536870912&&(D.avoidPageBreak=P[29]),F[0]&1073741824&&(D.pageColumns=P[30]),F[1]&1&&(D.autoBookmark=P[31]),F[0]&134217728&&(D.firstDimensionMargin=P[27]),!t&&F[0]&1&&(t=!0,D.exploredCharCount=P[0],he(()=>t=!1)),!i&&F[0]&2&&(i=!0,D.bookCharCount=P[1],he(()=>i=!1)),!o&&F[0]&64&&(o=!0,D.isBookmarkScreen=P[6],he(()=>o=!1)),!r&&F[0]&4&&(r=!0,D.bookmarkData=P[2],he(()=>r=!1)),!a&&F[0]&16&&(a=!0,D.bookmarkManager=P[4],he(()=>a=!1)),!l&&F[0]&32&&(l=!0,D.pageManager=P[5],he(()=>l=!1)),!s&&F[0]&2048&&(s=!0,D.customReadingPointRange=P[11],he(()=>s=!1)),!f&&F[0]&4096&&(f=!0,D.showCustomReadingPoint=P[12],he(()=>f=!1)),e.$set(D)},i(P){d||(j(e.$$.fragment,P),d=!0)},o(P){Y(e.$$.fragment,P),d=!1},d(P){ye(e,P)}}}function Rl(n){let e,t,i,o,r,a,l,s,f,d,w,p;function v(B){n[47](B)}function E(B){n[48](B)}function u(B){n[49](B)}function k(B){n[50](B)}function g(B){n[51](B)}function y(B){n[52](B)}function T(B){n[53](B)}function P(B){n[54](B)}function F(B){n[55](B)}function D(B){n[56](B)}let X={htmlContent:n[13],width:n[35]??0,height:n[36]??0,verticalMode:n[14],fontColor:n[15],backgroundColor:n[16],hintFuriganaFontColor:n[17],hintFuriganaShadowColor:n[18],fontFamilyGroupOne:n[19],fontFamilyGroupTwo:n[20],fontSize:n[21],lineHeight:n[22],hideSpoilerImage:n[23],hideFurigana:n[24],furiganaStyle:n[25],secondDimensionMaxValue:n[26],firstDimensionMargin:n[27],autoPositionOnResize:n[28],autoBookmark:n[31],multiplier:n[33],loadingState:n[37]??!0};return n[0]!==void 0&&(X.exploredCharCount=n[0]),n[1]!==void 0&&(X.bookCharCount=n[1]),n[2]!==void 0&&(X.bookmarkData=n[2]),n[3]!==void 0&&(X.autoScroller=n[3]),n[4]!==void 0&&(X.bookmarkManager=n[4]),n[5]!==void 0&&(X.pageManager=n[5]),n[7]!==void 0&&(X.customReadingPoint=n[7]),n[8]!==void 0&&(X.customReadingPointTop=n[8]),n[9]!==void 0&&(X.customReadingPointLeft=n[9]),n[10]!==void 0&&(X.customReadingPointScrollOffset=n[10]),e=new rl({props:X}),oe.push(()=>ce(e,"exploredCharCount",v)),oe.push(()=>ce(e,"bookCharCount",E)),oe.push(()=>ce(e,"bookmarkData",u)),oe.push(()=>ce(e,"autoScroller",k)),oe.push(()=>ce(e,"bookmarkManager",g)),oe.push(()=>ce(e,"pageManager",y)),oe.push(()=>ce(e,"customReadingPoint",T)),oe.push(()=>ce(e,"customReadingPointTop",P)),oe.push(()=>ce(e,"customReadingPointLeft",F)),oe.push(()=>ce(e,"customReadingPointScrollOffset",D)),e.$on("contentChange",n[57]),e.$on("bookmark",n[58]),{c(){Se(e.$$.fragment)},l(B){Pe(e.$$.fragment,B)},m(B,A){ve(e,B,A),p=!0},p(B,A){const z={};A[0]&8192&&(z.htmlContent=B[13]),A[1]&16&&(z.width=B[35]??0),A[1]&32&&(z.height=B[36]??0),A[0]&16384&&(z.verticalMode=B[14]),A[0]&32768&&(z.fontColor=B[15]),A[0]&65536&&(z.backgroundColor=B[16]),A[0]&131072&&(z.hintFuriganaFontColor=B[17]),A[0]&262144&&(z.hintFuriganaShadowColor=B[18]),A[0]&524288&&(z.fontFamilyGroupOne=B[19]),A[0]&1048576&&(z.fontFamilyGroupTwo=B[20]),A[0]&2097152&&(z.fontSize=B[21]),A[0]&4194304&&(z.lineHeight=B[22]),A[0]&8388608&&(z.hideSpoilerImage=B[23]),A[0]&16777216&&(z.hideFurigana=B[24]),A[0]&33554432&&(z.furiganaStyle=B[25]),A[0]&67108864&&(z.secondDimensionMaxValue=B[26]),A[0]&134217728&&(z.firstDimensionMargin=B[27]),A[0]&268435456&&(z.autoPositionOnResize=B[28]),A[1]&1&&(z.autoBookmark=B[31]),A[1]&4&&(z.multiplier=B[33]),A[1]&64&&(z.loadingState=B[37]??!0),!t&&A[0]&1&&(t=!0,z.exploredCharCount=B[0],he(()=>t=!1)),!i&&A[0]&2&&(i=!0,z.bookCharCount=B[1],he(()=>i=!1)),!o&&A[0]&4&&(o=!0,z.bookmarkData=B[2],he(()=>o=!1)),!r&&A[0]&8&&(r=!0,z.autoScroller=B[3],he(()=>r=!1)),!a&&A[0]&16&&(a=!0,z.bookmarkManager=B[4],he(()=>a=!1)),!l&&A[0]&32&&(l=!0,z.pageManager=B[5],he(()=>l=!1)),!s&&A[0]&128&&(s=!0,z.customReadingPoint=B[7],he(()=>s=!1)),!f&&A[0]&256&&(f=!0,z.customReadingPointTop=B[8],he(()=>f=!1)),!d&&A[0]&512&&(d=!0,z.customReadingPointLeft=B[9],he(()=>d=!1)),!w&&A[0]&1024&&(w=!0,z.customReadingPointScrollOffset=B[10],he(()=>w=!1)),e.$set(z)},i(B){p||(j(e.$$.fragment,B),p=!0)},o(B){Y(e.$$.fragment,B),p=!1},d(B){ye(e,B)}}}function Ml(n){let e,t,i,o,r=(n[38]??"")+"",a,l;const s=[Rl,yl],f=[];function d(w,p){return w[32]===Bt.Continuous?0:1}return t=d(n),i=f[t]=s[t](n),{c(){e=Q("div"),i.c(),o=ie(),a=_e(r),this.h()},l(w){e=Z(w,"DIV",{class:!0});var p=x(e);i.l(p),p.forEach(R),o=re(w),a=we(w,r),this.h()},h(){U(e,"class",al+" py-8")},m(w,p){H(w,e,p),f[t].m(e,null),n[69](e),H(w,o,p),H(w,a,p),l=!0},p(w,p){let v=t;t=d(w),t===v?f[t].p(w,p):(ot(),Y(f[v],1,1,()=>{f[v]=null}),it(),i=f[t],i?i.p(w,p):(i=f[t]=s[t](w),i.c()),j(i,1),i.m(e,null)),(!l||p[1]&128)&&r!==(r=(w[38]??"")+"")&&Ye(a,r)},i(w){l||(j(i),l=!0)},o(w){Y(i),l=!1},d(w){w&&R(e),f[t].d(),n[69](null),w&&R(o),w&&R(a)}}}function fn(n){return Number(n.replace(/px$/,""))}function El(n,e,t){let i,o,r,a,l,s,{htmlContent:f}=e,{width:d}=e,{height:w}=e,{verticalMode:p}=e,{fontColor:v}=e,{backgroundColor:E}=e,{hintFuriganaFontColor:u}=e,{hintFuriganaShadowColor:k}=e,{fontFamilyGroupOne:g}=e,{fontFamilyGroupTwo:y}=e,{fontSize:T}=e,{lineHeight:P}=e,{hideSpoilerImage:F}=e,{hideFurigana:D}=e,{furiganaStyle:X}=e,{secondDimensionMaxValue:B}=e,{firstDimensionMargin:A}=e,{autoPositionOnResize:z}=e,{avoidPageBreak:I}=e,{pageColumns:O}=e,{autoBookmark:_}=e,{viewMode:N}=e,{exploredCharCount:b}=e,{bookCharCount:L}=e,{multiplier:$}=e,{bookmarkData:se}=e,{autoScroller:ke}=e,{bookmarkManager:Ve}=e,{pageManager:Me}=e,{isBookmarkScreen:Re}=e,{customReadingPoint:Ie}=e,{customReadingPointTop:ze}=e,{customReadingPointLeft:ge}=e,{customReadingPointScrollOffset:ae}=e,{customReadingPointRange:le}=e,{showCustomReadingPoint:Te}=e;const J=new nt,te=new nt,Ne=_r(null);W(n,Ne,h=>t(34,o=h));const Ee=Zt([Ne.pipe($t(h=>!!h)),Zt([J,te]).pipe(Ln(0))]).pipe(xt(0,vn),Ke(([h])=>getComputedStyle(h)),Vn({refCount:!0,bufferSize:1})),De=new wr(1),C=Ee.pipe(Ke(h=>Be(d-fn(h.paddingLeft)-fn(h.paddingRight))));W(n,C,h=>t(35,r=h));const V=Ee.pipe(Ke(h=>be(w-fn(h.paddingTop)-fn(h.paddingBottom)-i)));W(n,V,h=>t(36,a=h));const He=Ot(()=>Yn(document)).pipe(hn(h=>{const ft=ul(h,X);return De.pipe(hn(an=>ft(an)))}),Mt());W(n,He,h=>t(38,s=h));const q=De.pipe(hn(h=>ll(h)),zn());W(n,q,h=>t(37,l=h));function Be(h){return Bt.Paginated===N&&!p&&B?Math.min(B,h):h}function be(h){return Bt.Paginated===N&&p&&B?Math.min(B,h):h}function Ae(h){b=h,t(0,b)}function dt(h){L=h,t(1,L)}function Ue(h){se=h,t(2,se)}function Ce(h){ke=h,t(3,ke)}function pe(h){Ve=h,t(4,Ve)}function Je(h){Me=h,t(5,Me)}function Qe(h){Ie=h,t(7,Ie)}function me(h){ze=h,t(8,ze)}function ut(h){ge=h,t(9,ge)}function Ge(h){ae=h,t(10,ae)}const pt=h=>De.next(h.detail);function je(h){ao.call(this,n,h)}function Ze(h){b=h,t(0,b)}function Xe(h){L=h,t(1,L)}function gt(h){Re=h,t(6,Re)}function Fe(h){se=h,t(2,se)}function kt(h){Ve=h,t(4,Ve)}function S(h){Me=h,t(5,Me)}function ue(h){le=h,t(11,le)}function We(h){Te=h,t(12,Te)}const Oe=h=>De.next(h.detail);function m(h){ao.call(this,n,h)}function ne(h){oe[h?"unshift":"push"](()=>{o=h,Ne.set(o)})}return n.$$set=h=>{"htmlContent"in h&&t(13,f=h.htmlContent),"width"in h&&t(45,d=h.width),"height"in h&&t(46,w=h.height),"verticalMode"in h&&t(14,p=h.verticalMode),"fontColor"in h&&t(15,v=h.fontColor),"backgroundColor"in h&&t(16,E=h.backgroundColor),"hintFuriganaFontColor"in h&&t(17,u=h.hintFuriganaFontColor),"hintFuriganaShadowColor"in h&&t(18,k=h.hintFuriganaShadowColor),"fontFamilyGroupOne"in h&&t(19,g=h.fontFamilyGroupOne),"fontFamilyGroupTwo"in h&&t(20,y=h.fontFamilyGroupTwo),"fontSize"in h&&t(21,T=h.fontSize),"lineHeight"in h&&t(22,P=h.lineHeight),"hideSpoilerImage"in h&&t(23,F=h.hideSpoilerImage),"hideFurigana"in h&&t(24,D=h.hideFurigana),"furiganaStyle"in h&&t(25,X=h.furiganaStyle),"secondDimensionMaxValue"in h&&t(26,B=h.secondDimensionMaxValue),"firstDimensionMargin"in h&&t(27,A=h.firstDimensionMargin),"autoPositionOnResize"in h&&t(28,z=h.autoPositionOnResize),"avoidPageBreak"in h&&t(29,I=h.avoidPageBreak),"pageColumns"in h&&t(30,O=h.pageColumns),"autoBookmark"in h&&t(31,_=h.autoBookmark),"viewMode"in h&&t(32,N=h.viewMode),"exploredCharCount"in h&&t(0,b=h.exploredCharCount),"bookCharCount"in h&&t(1,L=h.bookCharCount),"multiplier"in h&&t(33,$=h.multiplier),"bookmarkData"in h&&t(2,se=h.bookmarkData),"autoScroller"in h&&t(3,ke=h.autoScroller),"bookmarkManager"in h&&t(4,Ve=h.bookmarkManager),"pageManager"in h&&t(5,Me=h.pageManager),"isBookmarkScreen"in h&&t(6,Re=h.isBookmarkScreen),"customReadingPoint"in h&&t(7,Ie=h.customReadingPoint),"customReadingPointTop"in h&&t(8,ze=h.customReadingPointTop),"customReadingPointLeft"in h&&t(9,ge=h.customReadingPointLeft),"customReadingPointScrollOffset"in h&&t(10,ae=h.customReadingPointScrollOffset),"customReadingPointRange"in h&&t(11,le=h.customReadingPointRange),"showCustomReadingPoint"in h&&t(12,Te=h.showCustomReadingPoint)},n.$$.update=()=>{n.$$.dirty[0]&134234112|n.$$.dirty[1]&2&&(i=A&&Bt.Paginated===N&&!p?A*2:0),n.$$.dirty[1]&16384&&J.next(d),n.$$.dirty[1]&32768&&te.next(w)},[b,L,se,ke,Ve,Me,Re,Ie,ze,ge,ae,le,Te,f,p,v,E,u,k,g,y,T,P,F,D,X,B,A,z,I,O,_,N,$,o,r,a,l,s,Ne,De,C,V,He,q,d,w,Ae,dt,Ue,Ce,pe,Je,Qe,me,ut,Ge,pt,je,Ze,Xe,gt,Fe,kt,S,ue,We,Oe,m,ne]}class Dl extends Dt{constructor(e){super(),Ft(this,e,El,Ml,Tt,{htmlContent:13,width:45,height:46,verticalMode:14,fontColor:15,backgroundColor:16,hintFuriganaFontColor:17,hintFuriganaShadowColor:18,fontFamilyGroupOne:19,fontFamilyGroupTwo:20,fontSize:21,lineHeight:22,hideSpoilerImage:23,hideFurigana:24,furiganaStyle:25,secondDimensionMaxValue:26,firstDimensionMargin:27,autoPositionOnResize:28,avoidPageBreak:29,pageColumns:30,autoBookmark:31,viewMode:32,exploredCharCount:0,bookCharCount:1,multiplier:33,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6,customReadingPoint:7,customReadingPointTop:8,customReadingPointLeft:9,customReadingPointScrollOffset:10,customReadingPointRange:11,showCustomReadingPoint:12},null,[-1,-1,-1])}}function Fl(n,e){const t=document.createTextNode(e);if(n.firstChild){n.replaceChild(t,n.firstChild);return}n.appendChild(t)}function Tl(n,e,t){let{styleSheet:i}=e,o;return Qo(()=>{t(1,o=document.createElement("style")),document.head.appendChild(o)}),Gn(()=>{o&&document.head.removeChild(o)}),n.$$set=r=>{"styleSheet"in r&&t(0,i=r.styleSheet)},n.$$.update=()=>{n.$$.dirty&3&&o&&Fl(o,i)},[i,o]}class Bl extends Dt{constructor(e){super(),Ft(this,e,Tl,null,Tt,{styleSheet:0})}}function Mo(n,e,t){const i=n.slice();return i[19]=e[t],i}function Eo(n){let e,t,i,o,r;return t=new rt({props:{icon:ta}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(a){e=Z(a,"DIV",{role:!0,class:!0});var l=x(e);Pe(t.$$.fragment,l),l.forEach(R),this.h()},h(){U(e,"role","button"),U(e,"class",Pn)},m(a,l){H(a,e,l),ve(t,e,null),i=!0,o||(r=[de(e,"click",n[13]),de(e,"keyup",Ct)],o=!0)},p:Et,i(a){i||(j(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&R(e),ye(t),o=!1,_t(r)}}}function Do(n){let e,t,i;return{c(){e=Q("div"),t=_e(n[1]),i=_e("x"),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);t=we(r,n[1]),i=we(r,"x"),r.forEach(R),this.h()},h(){U(e,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg")},m(o,r){H(o,e,r),ee(e,t),ee(e,i)},p(o,r){r&2&&Ye(t,o[1])},d(o){o&&R(e)}}}function Fo(n){let e,t,i,o={placement:"bottom",fallbackPlacements:["bottom-end","bottom-start"],yOffset:0,$$slots:{content:[Al],icon:[Il]},$$scope:{ctx:n}};return t=new da({props:o}),n[16](t),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(r){e=Z(r,"DIV",{class:!0});var a=x(e);Pe(t.$$.fragment,a),a.forEach(R),this.h()},h(){U(e,"class","flex")},m(r,a){H(r,e,a),ve(t,e,null),i=!0},p(r,a){const l={};a&4194304&&(l.$$scope={dirty:a,ctx:r}),t.$set(l)},i(r){i||(j(t.$$.fragment,r),i=!0)},o(r){Y(t.$$.fragment,r),i=!1},d(r){r&&R(e),n[16](null),ye(t)}}}function Il(n){let e,t,i;return t=new rt({props:{icon:oa}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{slot:!0,class:!0});var r=x(e);Pe(t.$$.fragment,r),r.forEach(R),this.h()},h(){U(e,"slot","icon"),U(e,"class",Pn)},m(o,r){H(o,e,r),ve(t,e,null),i=!0},p:Et,i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&R(e),ye(t)}}}function To(n,e){let t,i=e[19].label+"",o,r,a,l;function s(){return e[15](e[19])}return{key:n,first:null,c(){t=Q("div"),o=_e(i),r=ie(),this.h()},l(f){t=Z(f,"DIV",{role:!0,class:!0});var d=x(t);o=we(d,i),r=re(d),d.forEach(R),this.h()},h(){U(t,"role","button"),U(t,"class","px-4 py-2 text-sm hover:bg-white hover:text-gray-700"),this.first=t},m(f,d){H(f,t,d),ee(t,o),ee(t,r),a||(l=[de(t,"click",s),de(t,"keyup",Ct)],a=!0)},p(f,d){e=f},d(f){f&&R(t),a=!1,_t(l)}}}function Al(n){let e,t=[],i=new Map,o=n[10];const r=a=>a[19].label;for(let a=0;a<o.length;a+=1){let l=Mo(n,o,a),s=r(l);i.set(s,t[a]=To(s,l))}return{c(){e=Q("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=Z(a,"DIV",{class:!0,slot:!0});var l=x(e);for(let s=0;s<t.length;s+=1)t[s].l(l);l.forEach(R),this.h()},h(){U(e,"class","w-40 bg-gray-700 md:w-32"),U(e,"slot","content")},m(a,l){H(a,e,l);for(let s=0;s<t.length;s+=1)t[s].m(e,null)},p(a,l){l&3072&&(o=a[10],t=Zo(t,l,r,1,a,o,i,e,xo,To,null,Mo))},d(a){a&&R(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function Bo(n){let e,t,i,o,r;return t=new rt({props:{icon:na}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(a){e=Z(a,"DIV",{role:!0,class:!0});var l=x(e);Pe(t.$$.fragment,l),l.forEach(R),this.h()},h(){U(e,"role","button"),U(e,"class",Pn)},m(a,l){H(a,e,l),ve(t,e,null),i=!0,o||(r=[de(e,"click",n[17]),de(e,"keyup",Ct)],o=!0)},p:Et,i(a){i||(j(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&R(e),ye(t),o=!1,_t(r)}}}function Ol(n){let e,t,i,o,r,a,l,s,f,d,w,p,v,E,u=n[0]&&Eo(n);r=new rt({props:{icon:n[3]?Jt:mo}});let k=!n[6]&&Do(n),g=(n[7]||n[8]===Bt.Paginated)&&Fo(n),y=n[2]&&Bo(n);return w=new ha({props:{disableRouteNavigation:!0,items:n[5]?[qe.SETTINGS,qe.DOMAIN_HINT,qe.MANAGE]:[qe.SETTINGS,qe.MANAGE]}}),w.$on("action",n[18]),{c(){e=Q("div"),t=Q("div"),u&&u.c(),i=ie(),o=Q("div"),Se(r.$$.fragment),a=ie(),k&&k.c(),l=ie(),s=Q("div"),g&&g.c(),f=ie(),y&&y.c(),d=ie(),Se(w.$$.fragment),this.h()},l(T){e=Z(T,"DIV",{class:!0});var P=x(e);t=Z(P,"DIV",{class:!0});var F=x(t);u&&u.l(F),i=re(F),o=Z(F,"DIV",{role:!0,class:!0});var D=x(o);Pe(r.$$.fragment,D),D.forEach(R),a=re(F),k&&k.l(F),F.forEach(R),l=re(P),s=Z(P,"DIV",{class:!0});var X=x(s);g&&g.l(X),f=re(X),y&&y.l(X),d=re(X),Pe(w.$$.fragment,X),X.forEach(R),P.forEach(R),this.h()},h(){U(o,"role","button"),U(o,"class",Pn),U(t,"class","flex transform-gpu "+Sr),U(s,"class","flex transform-gpu "+Pr),U(e,"class","flex justify-between bg-gray-700 px-4 md:px-8 "+vr)},m(T,P){H(T,e,P),ee(e,t),u&&u.m(t,null),ee(t,i),ee(t,o),ve(r,o,null),ee(t,a),k&&k.m(t,null),ee(e,l),ee(e,s),g&&g.m(s,null),ee(s,f),y&&y.m(s,null),ee(s,d),ve(w,s,null),p=!0,v||(E=[de(o,"click",n[14]),de(o,"keyup",Ct)],v=!0)},p(T,[P]){T[0]?u?(u.p(T,P),P&1&&j(u,1)):(u=Eo(T),u.c(),j(u,1),u.m(t,i)):u&&(ot(),Y(u,1,1,()=>{u=null}),it());const F={};P&8&&(F.icon=T[3]?Jt:mo),r.$set(F),T[6]?k&&(k.d(1),k=null):k?k.p(T,P):(k=Do(T),k.c(),k.m(t,null)),T[7]||T[8]===Bt.Paginated?g?(g.p(T,P),P&384&&j(g,1)):(g=Fo(T),g.c(),j(g,1),g.m(s,f)):g&&(ot(),Y(g,1,1,()=>{g=null}),it()),T[2]?y?(y.p(T,P),P&4&&j(y,1)):(y=Bo(T),y.c(),j(y,1),y.m(s,d)):y&&(ot(),Y(y,1,1,()=>{y=null}),it());const D={};P&32&&(D.items=T[5]?[qe.SETTINGS,qe.DOMAIN_HINT,qe.MANAGE]:[qe.SETTINGS,qe.MANAGE]),w.$set(D)},i(T){p||(j(u),j(r.$$.fragment,T),j(g),j(y),j(w.$$.fragment,T),p=!0)},o(T){Y(u),Y(r.$$.fragment,T),Y(g),Y(y),Y(w.$$.fragment,T),p=!1},d(T){T&&R(e),u&&u.d(),ye(r),k&&k.d(),g&&g.d(),y&&y.d(),ye(w),v=!1,_t(E)}}}function Ll(n,e,t){let i,o,r,a;W(n,qn,D=>t(6,o=D)),W(n,Xn,D=>t(7,r=D)),W(n,si,D=>t(8,a=D));let{hasChapterData:l}=e,{autoScrollMultiplier:s}=e,{hasCustomReadingPoint:f}=e,{showFullscreenButton:d}=e,{isBookmarkScreen:w}=e;const p=wn(),v=[...f?[{label:"Show Point",action:"showCustomReadingPoint"}]:[],{label:"Set Point",action:"setCustomReadingPoint"},...f?[{label:"Reset Point",action:"resetCustomReadingPoint"}]:[]];let E;function u(D){p(D),E.toggleOpen()}const k=()=>p("tocClick"),g=()=>p("bookmarkClick"),y=D=>u(D.action);function T(D){oe[D?"unshift":"push"](()=>{E=D,t(4,E)})}const P=()=>p("fullscreenClick"),F=({detail:D})=>{D===qe.SETTINGS.label?p("settingsClick"):D===qe.DOMAIN_HINT.label?p("domainHintClick"):D===qe.MANAGE.label&&p("bookManagerClick")};return n.$$set=D=>{"hasChapterData"in D&&t(0,l=D.hasChapterData),"autoScrollMultiplier"in D&&t(1,s=D.autoScrollMultiplier),"hasCustomReadingPoint"in D&&t(12,f=D.hasCustomReadingPoint),"showFullscreenButton"in D&&t(2,d=D.showFullscreenButton),"isBookmarkScreen"in D&&t(3,w=D.isBookmarkScreen)},t(5,i=yr(window)),[l,s,d,w,E,i,o,r,a,p,v,u,f,k,g,y,T,P,F]}class Vl extends Dt{constructor(e){super(),Ft(this,e,Ll,Ol,Tt,{hasChapterData:0,autoScrollMultiplier:1,hasCustomReadingPoint:12,showFullscreenButton:2,isBookmarkScreen:3})}}function Io(n,e,t){const i=n.slice();return i[16]=e[t],i}function Ao(n,e){let t,i,o=e[16].label+"",r,a,l,s,f=e[16].startCharacter+"",d,w,p,v;function E(){return e[13](e[16])}return{key:n,first:null,c(){t=Q("div"),i=Q("div"),r=_e(o),l=ie(),s=Q("div"),d=_e(f),w=ie(),this.h()},l(u){t=Z(u,"DIV",{class:!0});var k=x(t);i=Z(k,"DIV",{id:!0,class:!0});var g=x(i);r=we(g,o),g.forEach(R),l=re(k),s=Z(k,"DIV",{});var y=x(s);d=we(y,f),y.forEach(R),w=re(k),k.forEach(R),this.h()},h(){U(i,"id",a=`for${e[16].reference}`),U(i,"class","mr-4 cursor-pointer"),K(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),K(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),K(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),K(s,"opacity-30",e[16].progress===100&&e[16]!==e[2]),U(t,"class","my-6 flex justify-between"),this.first=t},m(u,k){H(u,t,k),ee(t,i),ee(i,r),ee(t,l),ee(t,s),ee(s,d),ee(t,w),p||(v=[de(i,"click",E),de(i,"keydown",Ct)],p=!0)},p(u,k){e=u,k&2&&o!==(o=e[16].label+"")&&Ye(r,o),k&2&&a!==(a=`for${e[16].reference}`)&&U(i,"id",a),k&6&&K(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),k&6&&K(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),k&6&&K(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),k&2&&f!==(f=e[16].startCharacter+"")&&Ye(d,f),k&6&&K(s,"opacity-30",e[16].progress===100&&e[16]!==e[2])},d(u){u&&R(t),p=!1,_t(v)}}}function zl(n){let e,t,i,o,r,a,l,s,f,d,w,p,v=[],E=new Map,u,k,g,y,T,P,F,D,X,B;d=new rt({props:{icon:ia}});let A=n[1];const z=I=>I[16].reference;for(let I=0;I<A.length;I+=1){let O=Io(n,A,I),_=z(O);E.set(_,v[I]=Ao(_,O))}return y=new rt({props:{icon:ra}}),F=new rt({props:{icon:aa}}),{c(){e=Q("div"),t=Q("div"),i=_e("Chapter Progress: "),o=_e(n[3]),r=_e(" ("),a=_e(n[4]),l=_e("%)"),s=ie(),f=Q("div"),Se(d.$$.fragment),w=ie(),p=Q("div");for(let I=0;I<v.length;I+=1)v[I].c();u=ie(),k=Q("div"),g=Q("div"),Se(y.$$.fragment),T=ie(),P=Q("div"),Se(F.$$.fragment),this.h()},l(I){e=Z(I,"DIV",{class:!0});var O=x(e);t=Z(O,"DIV",{});var _=x(t);i=we(_,"Chapter Progress: "),o=we(_,n[3]),r=we(_," ("),a=we(_,n[4]),l=we(_,"%)"),_.forEach(R),s=re(O),f=Z(O,"DIV",{class:!0});var N=x(f);Pe(d.$$.fragment,N),N.forEach(R),O.forEach(R),w=re(I),p=Z(I,"DIV",{class:!0});var b=x(p);for(let ke=0;ke<v.length;ke+=1)v[ke].l(b);b.forEach(R),u=re(I),k=Z(I,"DIV",{class:!0});var L=x(k);g=Z(L,"DIV",{class:!0});var $=x(g);Pe(y.$$.fragment,$),$.forEach(R),T=re(L),P=Z(L,"DIV",{class:!0});var se=x(P);Pe(F.$$.fragment,se),se.forEach(R),L.forEach(R),this.h()},h(){U(f,"class","flex cursor-pointer items-end md:items-center"),U(e,"class","flex justify-between p-4"),U(p,"class","flex-1 overflow-auto p-4"),U(g,"class","cursor-pointer"),K(g,"opacity-30",!n[6]),U(P,"class","cursor-pointer"),K(P,"opacity-30",!n[5]),U(k,"class","flex justify-between px-4 py-6")},m(I,O){H(I,e,O),ee(e,t),ee(t,i),ee(t,o),ee(t,r),ee(t,a),ee(t,l),ee(e,s),ee(e,f),ve(d,f,null),H(I,w,O),H(I,p,O);for(let _=0;_<v.length;_+=1)v[_].m(p,null);H(I,u,O),H(I,k,O),ee(k,g),ve(y,g,null),ee(k,T),ee(k,P),ve(F,P,null),D=!0,X||(B=[de(f,"click",n[9]),de(f,"keydown",Ct),de(g,"click",n[14]),de(g,"keydown",Ct),de(P,"click",n[15]),de(P,"keydown",Ct)],X=!0)},p(I,[O]){(!D||O&8)&&Ye(o,I[3]),(!D||O&16)&&Ye(a,I[4]),O&262&&(A=I[1],v=Zo(v,O,z,1,I,A,E,p,xo,Ao,null,Io)),(!D||O&64)&&K(g,"opacity-30",!I[6]),(!D||O&32)&&K(P,"opacity-30",!I[5])},i(I){D||(j(d.$$.fragment,I),j(y.$$.fragment,I),j(F.$$.fragment,I),D=!0)},o(I){Y(d.$$.fragment,I),Y(y.$$.fragment,I),Y(F.$$.fragment,I),D=!1},d(I){I&&R(e),ye(d),I&&R(w),I&&R(p);for(let O=0;O<v.length;O+=1)v[O].d();I&&R(u),I&&R(k),ye(y),ye(F),X=!1,_t(B)}}}function Nl(n,e){const[t,i]=e.reduce((o,r,a)=>(o[0]+=n[a]*r,o[1]+=r,o),[0,0]);return t/i}function Oo(n){!n||(n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView())}function Hl(n,e,t){let i,o,{sectionData:r=[]}=e,{exploredCharCount:a=0}=e,{verticalMode:l}=e,s=[],f,d=-1,w="0/0",p="0.00";Qo(()=>{tt.dialogs$.next([{component:"<div/>"}]),f&&Oo(document.getElementById(`for${f.reference}`))});function v(T,P){if(T){const F=s[d+P];E(F.reference,!1)}}function E(T,P=!1){rn.next(T),P&&u()}function u(){Nt.next(!1),tt.dialogs$.next([])}const k=T=>E(T.reference,!0),g=()=>v(i,l?1:-1),y=()=>v(o,l?-1:1);return n.$$set=T=>{"sectionData"in T&&t(10,r=T.sectionData),"exploredCharCount"in T&&t(11,a=T.exploredCharCount),"verticalMode"in T&&t(0,l=T.verticalMode)},n.$$.update=()=>{if(n.$$.dirty&5120&&r){const[T,P,F]=ki(r),D=r.filter(X=>X.reference===F||X.parentChapter===F);t(4,p=Nl(D.map(X=>X.progress),D.map(X=>X.charactersWeight)).toFixed(2)),t(1,s=T),t(12,d=P),t(2,f=T[d])}if(n.$$.dirty&4099&&t(6,i=l?d<s.length-1:!!d),n.$$.dirty&4099&&t(5,o=l?!!d:d<s.length-1),n.$$.dirty&2052&&f){Oo(document.getElementById(`for${f.reference}`));const T=f.characters;t(3,w=`${Math.min(Math.max(a-f.startCharacter,0),T)} / ${T}`)}},[l,s,f,w,p,o,i,v,E,u,r,a,d,k,g,y]}class Gl extends Dt{constructor(e){super(),Ft(this,e,Hl,zl,Tt,{sectionData:10,exploredCharCount:11,verticalMode:0})}}class Wl{constructor(e){et(this,"fallbackSpec");this.fallbackSpec=Lo(e)}get fullscreenEnabled(){return this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled")??!1}get fullscreenElement(){return this.fallbackSpec("fullscreenElement","webkitFullscreenElement")??null}async requestFullscreen(e,t){const i=Lo(e)("requestFullscreen","webkitRequestFullscreen");!i||await i(t)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function Lo(n){return(e,t)=>Vo(n,e)??Vo(n,t)}function Vo(n,e){const t=n[e];return typeof t=="function"?t.bind(n):t}const dn=new Wl(document);function jl(n,e){return Xl(n).pipe(Ke(t=>{const i=e.createElement("div");return i.innerHTML=t,ql(i),Kl(i),Yl(i,e),Ul(i),i.innerHTML}))}function Xl(n){return new vt(e=>{const{blobs:t}=n;let{elementHtml:i}=n;const o=[];return Object.entries(t).forEach(([r,a])=>{const l=URL.createObjectURL(a);o.push(l),i=i.replaceAll(Rr(r),l).replaceAll(`ttu:${r}`,l)}),e.next(i),()=>{o.forEach(r=>URL.revokeObjectURL(r))}})}function ql(n){Array.from(n.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:ui(e)})).forEach(({parentEl:e,isGaiji:t})=>{e==null||e.classList.add("ttu-img-container"),t||e==null||e.classList.add("ttu-illustration-container")})}function Kl(n){Array.from(n.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function Yl(n,e){const t=()=>{let o=[...n.children];const r=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return r>0&&r<o.length&&(o=o.slice(r)),o},i=(o,r)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||r).insertBefore(a,o),a.appendChild(o)};t().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(r=>!ui(r)).forEach(r=>i(r,o)),Array.from(o.getElementsByTagName("svg")).filter(r=>r.getElementsByTagName("image").length).forEach(r=>i(r,o))})}function Ul(n){n.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Jl=vi;function vi(n,e,t){n instanceof RegExp&&(n=zo(n,t)),e instanceof RegExp&&(e=zo(e,t));const i=yi(n,e,t);return i&&{start:i[0],end:i[1],pre:t.slice(0,i[0]),body:t.slice(i[0]+n.length,i[1]),post:t.slice(i[1]+e.length)}}function zo(n,e){const t=e.match(n);return t?t[0]:null}vi.range=yi;function yi(n,e,t){let i,o,r,a,l,s=t.indexOf(n),f=t.indexOf(e,s+1),d=s;if(s>=0&&f>0){if(n===e)return[s,f];for(i=[],r=t.length;d>=0&&!l;)d===s?(i.push(d),s=t.indexOf(n,d+1)):i.length===1?l=[i.pop(),f]:(o=i.pop(),o<r&&(r=o,a=f),f=t.indexOf(e,d+1)),d=s<f&&s>=0?s:f;i.length&&(l=[r,a])}return l}function Ql(n,e={}){const i=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function r(_){throw new Error(`CSS parse error: ${_}`)}function a(_){const N=_.exec(n);if(N)return n=n.slice(N[0].length),N}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function f(){a(/^\s*/)}function d(){if(f(),n[0]!=="/"||n[1]!=="*")return;let _=2;for(;n[_]&&(n[_]!=="*"||n[_+1]!=="/");)_++;if(!n[_])return r("end of comment is missing");const N=n.slice(2,_);return n=n.slice(_+2),{type:"comment",comment:N}}function w(){const _=[];let N;for(;N=d();)_.push(N);return i.removeComments?[]:_}function p(){for(f();n[0]==="}";)r("extra closing bracket");const _=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(_)return _[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(N){return N.replace(/,/g,"‌")}).split(/\s*(?![^(]*\)),\s*/).map(function(N){return N.replace(/\u200C/g,",")})}function v(){if(n[0]==="@")return z();a(/^([;\s]*)+/);const _=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let N=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!N)return;if(N=N[0].trim(),!a(/^:\s*/))return r("property missing ':'");const b=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),L={type:"declaration",property:N.replace(_,""),value:b?b[0].replace(_,"").trim():""};return a(/^[;\s]*/),L}function E(){if(!l())return r("missing '{'");let _,N=w();for(;_=v();)N.push(_),N=N.concat(w());return s()?N:r("missing '}'")}function u(){f();const _=[];let N;for(;N=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)_.push(N[1]),a(/^,\s*/);if(_.length)return{type:"keyframe",values:_,declarations:E()}}function k(){let _=a(/^@([-\w]+)?keyframes\s*/);if(!_)return;const N=_[1];if(_=a(/^([-\w]+)\s*/),!_)return r("@keyframes missing name");const b=_[1];if(!l())return r("@keyframes missing '{'");let L,$=w();for(;L=u();)$.push(L),$=$.concat(w());return s()?{type:"keyframes",name:b,vendor:N,keyframes:$}:r("@keyframes missing '}'")}function g(){if(a(/^@page */))return{type:"page",selectors:p()||[],declarations:E()}}function y(){const _=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(_)return{type:"page-margin-box",name:`${_[1]}-${_[2]}`+(_[3]?`-${_[3]}`:""),declarations:E()}}function T(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:E()}}function P(){const _=a(/^@supports *([^{]+)/);if(_)return{type:"supports",supports:_[1].trim(),rules:O()}}function F(){if(a(/^@host\s*/))return{type:"host",rules:O()}}function D(){const _=a(/^@media([^{]+)*/);if(_)return{type:"media",media:(_[1]||"").trim(),rules:O()}}function X(){const _=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(_)return{type:"custom-media",name:_[1].trim(),media:_[2].trim()}}function B(){const _=a(/^@([-\w]+)?document *([^{]+)/);if(_)return{type:"document",document:_[2].trim(),vendor:_[1]?_[1].trim():null,rules:O()}}function A(){const _=a(/^@(import|charset|namespace)\s*([^;]+);/);if(_)return{type:_[1],name:_[2].trim()}}function z(){if(f(),n[0]==="@"){const _=A()||T()||D()||k()||P()||B()||X()||F()||g()||y();if(_&&!i.preserveStatic){let N=!1;return _.declarations?N=_.declarations.some(b=>/var\(/.test(b.value)):N=(_.keyframes||_.rules||[]).some(L=>(L.declarations||[]).some($=>/var\(/.test($.value))),N?_:{}}return _}}function I(){if(!i.preserveStatic){const b=Jl("{","}",n);if(b){const L=/:(?:root|host)(?![.:#(])/.test(b.pre)&&/--\S*\s*:/.test(b.body),$=/var\(/.test(b.body);if(!L&&!$)return n=n.slice(b.end+1),{}}}const _=p()||[],N=i.preserveStatic?E():E().filter(b=>{const L=_.some(se=>/:(?:root|host)(?![.:#(])/.test(se))&&/^--\S/.test(b.property),$=/var\(/.test(b.value);return L||$});return _.length||r("selector missing"),{type:"rule",selectors:_,declarations:N}}function O(_){if(!_&&!l())return r("missing '{'");let N,b=w();for(;n.length&&(_||n[0]!=="}")&&(N=z()||I());)N.type&&b.push(N),b=b.concat(w());return!_&&!s()?r("missing '}'"):b}return{type:"stylesheet",stylesheet:{rules:O(!0),errors:o}}}function Zl(n,e="",t){const i={charset(r){return"@charset "+r.name+";"},comment(r){return r.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+r.comment+"*/":""},"custom-media"(r){return"@custom-media "+r.name+" "+r.media+";"},declaration(r){return r.property+":"+r.value+";"},document(r){return"@"+(r.vendor||"")+"document "+r.document+"{"+o(r.rules)+"}"},"font-face"(r){return"@font-face{"+o(r.declarations)+"}"},host(r){return"@host{"+o(r.rules)+"}"},import(r){return"@import "+r.name+";"},keyframe(r){return r.values.join(",")+"{"+o(r.declarations)+"}"},keyframes(r){return"@"+(r.vendor||"")+"keyframes "+r.name+"{"+o(r.keyframes)+"}"},media(r){return"@media "+r.media+"{"+o(r.rules)+"}"},namespace(r){return"@namespace "+r.name+";"},page(r){return"@page "+(r.selectors.length?r.selectors.join(", "):"")+"{"+o(r.declarations)+"}"},"page-margin-box"(r){return"@"+r.name+"{"+o(r.declarations)+"}"},rule(r){const a=r.declarations;if(a.length)return r.selectors.join(",")+"{"+o(a)+"}"},supports(r){return"@supports "+r.supports+"{"+o(r.rules)+"}"}};function o(r){let a="";for(let l=0;l<r.length;l++){const s=r[l];t&&t(s);const f=i[s.type](s);f&&(a+=f,f.length&&s.selectors&&(a+=e))}return a}return o(n.stylesheet.rules)}const xl=/\s?html\s?/gi,$l=/\s?body\s?/gi;function es(n,e){const i=Ql(n.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(r=>xl.test(r)||$l.test(r)));return i.forEach(o=>{const r={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new is(o.declarations,r);o.declarations.forEach(l=>{An(r,ns(l)),An(r,os(l)),An(r,a.convert(l))}),Object.entries(r).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),i.push(rs()),i.forEach(o=>{o.selectors=ts(o.selectors,e)}),Zl({stylesheet:{rules:i},type:"stylesheet"})}function ts(n,e){return n.map(t=>`${e} ${t}`)}function An(n,e){return e&&(n[e.key]=e.value),n}function ns(n){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(n.property);if(e)return{key:e[1],value:n.value}}function os(n){if(n.property==="font-family"){let e=n.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:n.property,value:e}}}class is{constructor(e,t){et(this,"hasLineBreakDefined");this.ruleDeclarations=e,this.newDeclarations=t}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(t=>t.type==="declaration"&&t.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function rs(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}function as(n,e,t){return jl(n,t).pipe(Ke(i=>({htmlContent:i,styleSheet:es(n,e)})))}function ls(n){return new vt(e=>n.subscribe(t=>{e.next(t)}))}function cn(n=Er){return e=>n?e:Mr}function No(n,e,t){return i=>new vt(o=>{const r=n();return i.pipe(ri(vn),Oa(()=>t(r))).subscribe({next:a=>{e(a,r),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}function ss(n,e,t,i,o,r,a,l,s,f){switch(e[n.code]){case bt.BOOKMARK:return t(!0),!0;case bt.JUMP_TO_BOOKMARK:return i(),!0;case bt.AUTO_SCROLL_TOGGLE:return r==null||r.toggle(),!0;case bt.AUTO_SCROLL_INCREASE:return o(1),!0;case bt.AUTO_SCROLL_DECREASE:return o(-1),!0;case bt.NEXT_PAGE:return a==null||a.nextPage(),!0;case bt.PREV_PAGE:return a==null||a.prevPage(),!0;case bt.PREV_CHAPTER:return s(l?1:-1),!0;case bt.NEXT_CHAPTER:return s(l?-1:1),!0;case bt.SET_READING_POINT:return f(),!0;default:return!1}}const{document:On,window:Ho}=Wn;function Go(n){var w;let e,t,i,o,r,a,l,s;function f(p){n[79](p)}let d={hasChapterData:!!((w=n[26])!=null&&w.length),hasCustomReadingPoint:!!(n[28]&&(n[22]&&n[4]||!n[22]&&n[15]>-1&&n[14]>-1)),showFullscreenButton:dn.fullscreenEnabled,autoScrollMultiplier:n[29]};return n[10]!==void 0&&(d.isBookmarkScreen=n[10]),t=new Vl({props:d}),oe.push(()=>ce(t,"isBookmarkScreen",f)),t.$on("tocClick",n[80]),t.$on("setCustomReadingPoint",n[75]),t.$on("showCustomReadingPoint",n[81]),t.$on("resetCustomReadingPoint",n[82]),t.$on("fullscreenClick",n[71]),t.$on("bookmarkClick",n[70]),t.$on("settingsClick",n[83]),t.$on("domainHintClick",n[72]),t.$on("bookManagerClick",n[84]),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(p){e=Z(p,"DIV",{class:!0});var v=x(e);Pe(t.$$.fragment,v),v.forEach(R),this.h()},h(){U(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(p,v){H(p,e,v),ve(t,e,null),a=!0,l||(s=jn(o=hi.call(null,e,n[85])),l=!0)},p(p,v){var u;n=p;const E={};v[0]&67108864&&(E.hasChapterData=!!((u=n[26])!=null&&u.length)),v[0]&272678928&&(E.hasCustomReadingPoint=!!(n[28]&&(n[22]&&n[4]||!n[22]&&n[15]>-1&&n[14]>-1))),v[0]&536870912&&(E.autoScrollMultiplier=n[29]),!i&&v[0]&1024&&(i=!0,E.isBookmarkScreen=n[10],he(()=>i=!1)),t.$set(E),o&&Jo(o.update)&&v[0]&512&&o.update.call(null,n[85])},i(p){a||(j(t.$$.fragment,p),p&&$o(()=>{r||(r=lo(e,Hn,{y:-300,easing:Nn},!0)),r.run(1)}),a=!0)},o(p){Y(t.$$.fragment,p),p&&(r||(r=lo(e,Hn,{y:-300,easing:Nn},!1)),r.run(0)),a=!1},d(p){p&&R(e),ye(t),p&&r&&r.end(),l=!1,s()}}}function us(n){let e=(n[52]??"")+"",t;return{c(){t=_e(e)},l(i){t=we(i,e)},m(i,o){H(i,t,o)},p(i,o){o[1]&2097152&&e!==(e=(i[52]??"")+"")&&Ye(t,e)},i:Et,o:Et,d(i){i&&R(t)}}}function fs(n){var Ne,Ee,De;let e,t,i,o,r,a,l,s,f,d,w,p,v,E,u,k,g,y=(n[47]??"")+"",T,P,F=(n[48]??"")+"",D,X,B=(n[49]??"")+"",A,z,I=(n[50]??"")+"",O,_,N=(n[51]??"")+"",b,L;e=new Bl({props:{styleSheet:n[30].styleSheet}});function $(C){n[86](C)}function se(C){n[87](C)}function ke(C){n[88](C)}function Ve(C){n[89](C)}function Me(C){n[90](C)}function Re(C){n[91](C)}function Ie(C){n[92](C)}function ze(C){n[93](C)}function ge(C){n[94](C)}function ae(C){n[95](C)}function le(C){n[96](C)}function Te(C){n[97](C)}function J(C){n[98](C)}let te={htmlContent:n[30].htmlContent,width:n[31]??0,height:n[32]??0,verticalMode:n[23],fontColor:(Ne=n[33])==null?void 0:Ne.fontColor,backgroundColor:n[34],hintFuriganaFontColor:(Ee=n[33])==null?void 0:Ee.hintFuriganaFontColor,hintFuriganaShadowColor:(De=n[33])==null?void 0:De.hintFuriganaShadowColor,fontFamilyGroupOne:n[35],fontFamilyGroupTwo:n[36],fontSize:n[37],lineHeight:n[38],hideSpoilerImage:n[39],hideFurigana:n[40],furiganaStyle:n[41],viewMode:n[6],secondDimensionMaxValue:n[42],firstDimensionMargin:n[24],autoPositionOnResize:n[43],avoidPageBreak:n[44],pageColumns:n[45],autoBookmark:n[46],multiplier:n[29]};return n[0]!==void 0&&(te.exploredCharCount=n[0]),n[1]!==void 0&&(te.bookCharCount=n[1]),n[10]!==void 0&&(te.isBookmarkScreen=n[10]),n[3]!==void 0&&(te.bookmarkData=n[3]),n[2]!==void 0&&(te.autoScroller=n[2]),n[12]!==void 0&&(te.bookmarkManager=n[12]),n[13]!==void 0&&(te.pageManager=n[13]),n[16]!==void 0&&(te.customReadingPoint=n[16]),n[14]!==void 0&&(te.customReadingPointTop=n[14]),n[15]!==void 0&&(te.customReadingPointLeft=n[15]),n[17]!==void 0&&(te.customReadingPointScrollOffset=n[17]),n[4]!==void 0&&(te.customReadingPointRange=n[4]),n[5]!==void 0&&(te.showCustomReadingPoint=n[5]),i=new Dl({props:te}),oe.push(()=>ce(i,"exploredCharCount",$)),oe.push(()=>ce(i,"bookCharCount",se)),oe.push(()=>ce(i,"isBookmarkScreen",ke)),oe.push(()=>ce(i,"bookmarkData",Ve)),oe.push(()=>ce(i,"autoScroller",Me)),oe.push(()=>ce(i,"bookmarkManager",Re)),oe.push(()=>ce(i,"pageManager",Ie)),oe.push(()=>ce(i,"customReadingPoint",ze)),oe.push(()=>ce(i,"customReadingPointTop",ge)),oe.push(()=>ce(i,"customReadingPointLeft",ae)),oe.push(()=>ce(i,"customReadingPointScrollOffset",le)),oe.push(()=>ce(i,"customReadingPointRange",Te)),oe.push(()=>ce(i,"showCustomReadingPoint",J)),i.$on("bookmark",n[70]),{c(){Se(e.$$.fragment),t=ie(),Se(i.$$.fragment),g=ie(),T=_e(y),P=ie(),D=_e(F),X=ie(),A=_e(B),z=ie(),O=_e(I),_=ie(),b=_e(N)},l(C){Pe(e.$$.fragment,C),t=re(C),Pe(i.$$.fragment,C),g=re(C),T=we(C,y),P=re(C),D=we(C,F),X=re(C),A=we(C,B),z=re(C),O=we(C,I),_=re(C),b=we(C,N)},m(C,V){ve(e,C,V),H(C,t,V),ve(i,C,V),H(C,g,V),H(C,T,V),H(C,P,V),H(C,D,V),H(C,X,V),H(C,A,V),H(C,z,V),H(C,O,V),H(C,_,V),H(C,b,V),L=!0},p(C,V){var Be,be,Ae;const He={};V[0]&1073741824&&(He.styleSheet=C[30].styleSheet),e.$set(He);const q={};V[0]&1073741824&&(q.htmlContent=C[30].htmlContent),V[1]&1&&(q.width=C[31]??0),V[1]&2&&(q.height=C[32]??0),V[0]&8388608&&(q.verticalMode=C[23]),V[1]&4&&(q.fontColor=(Be=C[33])==null?void 0:Be.fontColor),V[1]&8&&(q.backgroundColor=C[34]),V[1]&4&&(q.hintFuriganaFontColor=(be=C[33])==null?void 0:be.hintFuriganaFontColor),V[1]&4&&(q.hintFuriganaShadowColor=(Ae=C[33])==null?void 0:Ae.hintFuriganaShadowColor),V[1]&16&&(q.fontFamilyGroupOne=C[35]),V[1]&32&&(q.fontFamilyGroupTwo=C[36]),V[1]&64&&(q.fontSize=C[37]),V[1]&128&&(q.lineHeight=C[38]),V[1]&256&&(q.hideSpoilerImage=C[39]),V[1]&512&&(q.hideFurigana=C[40]),V[1]&1024&&(q.furiganaStyle=C[41]),V[0]&64&&(q.viewMode=C[6]),V[1]&2048&&(q.secondDimensionMaxValue=C[42]),V[0]&16777216&&(q.firstDimensionMargin=C[24]),V[1]&4096&&(q.autoPositionOnResize=C[43]),V[1]&8192&&(q.avoidPageBreak=C[44]),V[1]&16384&&(q.pageColumns=C[45]),V[1]&32768&&(q.autoBookmark=C[46]),V[0]&536870912&&(q.multiplier=C[29]),!o&&V[0]&1&&(o=!0,q.exploredCharCount=C[0],he(()=>o=!1)),!r&&V[0]&2&&(r=!0,q.bookCharCount=C[1],he(()=>r=!1)),!a&&V[0]&1024&&(a=!0,q.isBookmarkScreen=C[10],he(()=>a=!1)),!l&&V[0]&8&&(l=!0,q.bookmarkData=C[3],he(()=>l=!1)),!s&&V[0]&4&&(s=!0,q.autoScroller=C[2],he(()=>s=!1)),!f&&V[0]&4096&&(f=!0,q.bookmarkManager=C[12],he(()=>f=!1)),!d&&V[0]&8192&&(d=!0,q.pageManager=C[13],he(()=>d=!1)),!w&&V[0]&65536&&(w=!0,q.customReadingPoint=C[16],he(()=>w=!1)),!p&&V[0]&16384&&(p=!0,q.customReadingPointTop=C[14],he(()=>p=!1)),!v&&V[0]&32768&&(v=!0,q.customReadingPointLeft=C[15],he(()=>v=!1)),!E&&V[0]&131072&&(E=!0,q.customReadingPointScrollOffset=C[17],he(()=>E=!1)),!u&&V[0]&16&&(u=!0,q.customReadingPointRange=C[4],he(()=>u=!1)),!k&&V[0]&32&&(k=!0,q.showCustomReadingPoint=C[5],he(()=>k=!1)),i.$set(q),(!L||V[1]&65536)&&y!==(y=(C[47]??"")+"")&&Ye(T,y),(!L||V[1]&131072)&&F!==(F=(C[48]??"")+"")&&Ye(D,F),(!L||V[1]&262144)&&B!==(B=(C[49]??"")+"")&&Ye(A,B),(!L||V[1]&524288)&&I!==(I=(C[50]??"")+"")&&Ye(O,I),(!L||V[1]&1048576)&&N!==(N=(C[51]??"")+"")&&Ye(b,N)},i(C){L||(j(e.$$.fragment,C),j(i.$$.fragment,C),L=!0)},o(C){Y(e.$$.fragment,C),Y(i.$$.fragment,C),L=!1},d(C){ye(e,C),C&&R(t),ye(i,C),C&&R(g),C&&R(T),C&&R(P),C&&R(D),C&&R(X),C&&R(A),C&&R(z),C&&R(O),C&&R(_),C&&R(b)}}}function Wo(n){let e,t,i,o,r,a;return t=new Gl({props:{sectionData:n[26],verticalMode:n[23],exploredCharCount:n[0]}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(l){e=Z(l,"DIV",{class:!0});var s=x(e);Pe(t.$$.fragment,s),s.forEach(R),this.h()},h(){var l;U(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),M(e,"color",(l=n[33])==null?void 0:l.fontColor),M(e,"background-color",n[34])},m(l,s){H(l,e,s),ve(t,e,null),o=!0,r||(a=jn(hi.call(null,e,n[99])),r=!0)},p(l,s){var d;n=l;const f={};s[0]&67108864&&(f.sectionData=n[26]),s[0]&8388608&&(f.verticalMode=n[23]),s[0]&1&&(f.exploredCharCount=n[0]),t.$set(f),s[1]&4&&M(e,"color",(d=n[33])==null?void 0:d.fontColor),s[1]&8&&M(e,"background-color",n[34])},i(l){o||(j(t.$$.fragment,l),l&&(i||$o(()=>{i=cr(e,Hn,{x:-100,duration:100,easing:Nn}),i.start()})),o=!0)},o(l){Y(t.$$.fragment,l),o=!1},d(l){l&&R(e),ye(t),r=!1,a()}}}function jo(n){let e,t,i;return{c(){e=Q("div"),t=ie(),i=Q("div"),this.h()},l(o){e=Z(o,"DIV",{class:!0}),x(e).forEach(R),t=re(o),i=Z(o,"DIV",{class:!0}),x(i).forEach(R),this.h()},h(){U(e,"class","fixed left-0 z-20 h-[1px] w-full border border-red-500"),M(e,"top",`${n[14]}px`),U(i,"class","fixed top-0 z-20 h-full w-[1px] border border-red-500"),M(i,"left",`${n[15]}px`)},m(o,r){H(o,e,r),H(o,t,r),H(o,i,r)},p(o,r){r[0]&16384&&M(e,"top",`${o[14]}px`),r[0]&32768&&M(i,"left",`${o[15]}px`)},d(o){o&&R(e),o&&R(t),o&&R(i)}}}function Xo(n){let e,t,i;return t=new rt({props:{icon:Kn,spin:!0}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(o){e=Z(o,"DIV",{class:!0});var r=x(e);Pe(t.$$.fragment,r),r.forEach(R),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl")},m(o,r){H(o,e,r),ve(t,e,null),i=!0},p:Et,i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&R(e),ye(t)}}}function qo(n){let e,t,i,o,r;return t=new rt({props:{icon:la}}),{c(){e=Q("div"),Se(t.$$.fragment),this.h()},l(a){e=Z(a,"DIV",{class:!0});var l=x(e);Pe(t.$$.fragment,l),l.forEach(R),this.h()},h(){U(e,"class","flex h-full w-8 items-center justify-center text-lg"),K(e,"text-red-500",n[20]>1),K(e,"animate-pulse",n[20]>1||n[21])},m(a,l){H(a,e,l),ve(t,e,null),i=!0,o||(r=[de(e,"click",hr(n[100])),de(e,"keyup",Ct)],o=!0)},p(a,l){(!i||l[0]&1048576)&&K(e,"text-red-500",a[20]>1),(!i||l[0]&3145728)&&K(e,"animate-pulse",a[20]>1||a[21])},i(a){i||(j(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&R(e),ye(t),o=!1,_t(r)}}}function Ko(n){let e,t,i,o,r,a=(n[0]/n[1]*100).toFixed(2)+"",l,s;return{c(){e=Q("div"),t=_e(n[0]),i=_e(" / "),o=_e(n[1]),r=_e(" ("),l=_e(a),s=_e("%)"),this.h()},l(f){e=Z(f,"DIV",{class:!0});var d=x(e);t=we(d,n[0]),i=we(d," / "),o=we(d,n[1]),r=we(d," ("),l=we(d,a),s=we(d,"%)"),d.forEach(R),this.h()},h(){var f;U(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),M(e,"color",(f=n[33])==null?void 0:f.tooltipTextFontColor)},m(f,d){H(f,e,d),ee(e,t),ee(e,i),ee(e,o),ee(e,r),ee(e,l),ee(e,s)},p(f,d){var w;d[0]&1&&Ye(t,f[0]),d[0]&2&&Ye(o,f[1]),d[0]&3&&a!==(a=(f[0]/f[1]*100).toFixed(2)+"")&&Ye(l,a),d[1]&4&&M(e,"color",(w=f[33])==null?void 0:w.tooltipTextFontColor)},d(f){f&&R(e)}}}function cs(n){var N;let e,t,i=(n[27]??"")+"",o,r,a,l,s,f,d,w,p,v,E,u,k,g,y,T,P;On.title=e=ho(((N=n[25])==null?void 0:N.title)??"");let F=n[9]&&Go(n);const D=[fs,us],X=[];function B(b,L){return b[30]?0:1}f=B(n),d=X[f]=D[f](n);let A=n[7]&&Wo(n),z=(n[18]&&!n[53]||!n[22]&&n[5])&&jo(n),I=n[8]&&Xo(),O=n[19].length&&qo(n),_=n[11]&&n[1]&&Ko(n);return{c(){t=ie(),o=_e(i),r=ie(),a=Q("button"),l=ie(),F&&F.c(),s=ie(),d.c(),w=ie(),A&&A.c(),p=ie(),z&&z.c(),v=ie(),I&&I.c(),E=ie(),u=Q("div"),k=Q("div"),O&&O.c(),g=ie(),_&&_.c(),this.h()},l(b){fr("svelte-rnuhm6",On.head).forEach(R),t=re(b),o=we(b,i),r=re(b),a=Z(b,"BUTTON",{class:!0}),x(a).forEach(R),l=re(b),F&&F.l(b),s=re(b),d.l(b),w=re(b),A&&A.l(b),p=re(b),z&&z.l(b),v=re(b),I&&I.l(b),E=re(b),u=Z(b,"DIV",{class:!0});var $=x(u);k=Z($,"DIV",{class:!0});var se=x(k);O&&O.l(se),se.forEach(R),g=re($),_&&_.l($),$.forEach(R),this.h()},h(){var b;U(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),U(k,"class","h-full"),U(u,"class","writing-horizontal-tb fixed bottom-0 left-0 z-10 flex h-8 w-full cursor-pointer items-center justify-between text-xs leading-none"),M(u,"color",(b=n[33])==null?void 0:b.tooltipTextFontColor)},m(b,L){H(b,t,L),H(b,o,L),H(b,r,L),H(b,a,L),H(b,l,L),F&&F.m(b,L),H(b,s,L),X[f].m(b,L),H(b,w,L),A&&A.m(b,L),H(b,p,L),z&&z.m(b,L),H(b,v,L),I&&I.m(b,L),H(b,E,L),H(b,u,L),ee(u,k),O&&O.m(k,null),ee(u,g),_&&_.m(u,null),y=!0,T||(P=[de(Ho,"keydown",n[69]),de(Ho,"beforeunload",n[68]),de(a,"click",n[78]),de(u,"click",n[101]),de(u,"keyup",Ct)],T=!0)},p(b,L){var se,ke;(!y||L[0]&33554432)&&e!==(e=ho(((se=b[25])==null?void 0:se.title)??""))&&(On.title=e),(!y||L[0]&134217728)&&i!==(i=(b[27]??"")+"")&&Ye(o,i),b[9]?F?(F.p(b,L),L[0]&512&&j(F,1)):(F=Go(b),F.c(),j(F,1),F.m(s.parentNode,s)):F&&(ot(),Y(F,1,1,()=>{F=null}),it());let $=f;f=B(b),f===$?X[f].p(b,L):(ot(),Y(X[$],1,1,()=>{X[$]=null}),it(),d=X[f],d?d.p(b,L):(d=X[f]=D[f](b),d.c()),j(d,1),d.m(w.parentNode,w)),b[7]?A?(A.p(b,L),L[0]&128&&j(A,1)):(A=Wo(b),A.c(),j(A,1),A.m(p.parentNode,p)):A&&(ot(),Y(A,1,1,()=>{A=null}),it()),b[18]&&!b[53]||!b[22]&&b[5]?z?z.p(b,L):(z=jo(b),z.c(),z.m(v.parentNode,v)):z&&(z.d(1),z=null),b[8]?I?(I.p(b,L),L[0]&256&&j(I,1)):(I=Xo(),I.c(),j(I,1),I.m(E.parentNode,E)):I&&(ot(),Y(I,1,1,()=>{I=null}),it()),b[19].length?O?(O.p(b,L),L[0]&524288&&j(O,1)):(O=qo(b),O.c(),j(O,1),O.m(k,null)):O&&(ot(),Y(O,1,1,()=>{O=null}),it()),b[11]&&b[1]?_?_.p(b,L):(_=Ko(b),_.c(),_.m(u,null)):_&&(_.d(1),_=null),L[1]&4&&M(u,"color",(ke=b[33])==null?void 0:ke.tooltipTextFontColor)},i(b){y||(j(F),j(d),j(A),j(I),j(O),y=!0)},o(b){Y(F),Y(d),Y(A),Y(I),Y(O),y=!1},d(b){b&&R(t),b&&R(o),b&&R(r),b&&R(a),b&&R(l),F&&F.d(b),b&&R(s),X[f].d(b),b&&R(w),A&&A.d(b),b&&R(p),z&&z.d(b),b&&R(v),I&&I.d(b),b&&R(E),b&&R(u),O&&O.d(),_&&_.d(),T=!1,_t(P)}}}const Yo="background-color",Uo="writing-mode";function hs(n,e,t){let i,o,r,a,l,s,f,d,w,p,v,E,u,k,g,y,T,P,F,D,X,B,A,z,I,O,_,N,b,L,$,se,ke,Ve,Me,Re,Ie,ze,ge,ae,le,Te,J,te,Ne,Ee;W(n,Ar,c=>t(23,r=c)),W(n,ai,c=>t(24,a=c)),W(n,Or,c=>t(108,l=c)),W(n,Lr,c=>t(109,s=c)),W(n,Vr,c=>t(110,d=c)),W(n,zr,c=>t(111,w=c)),W(n,li,c=>t(112,v=c)),W(n,Yt,c=>t(113,E=c)),W(n,Nr,c=>t(77,u=c)),W(n,Hr,c=>t(114,k=c)),W(n,Gr,c=>t(115,g=c)),W(n,si,c=>t(6,y=c)),W(n,Nt,c=>t(7,T=c)),W(n,Fn,c=>t(116,P=c)),W(n,Tn,c=>t(117,F=c)),W(n,Xn,c=>t(28,X=c)),W(n,Bn,c=>t(29,B=c)),W(n,Wr,c=>t(35,N=c)),W(n,jr,c=>t(36,b=c)),W(n,Xr,c=>t(37,L=c)),W(n,qr,c=>t(38,$=c)),W(n,Kr,c=>t(39,se=c)),W(n,Yr,c=>t(40,ke=c)),W(n,Ur,c=>t(41,Ve=c)),W(n,Jr,c=>t(42,Me=c)),W(n,Qr,c=>t(43,Re=c)),W(n,Zr,c=>t(44,Ie=c)),W(n,xr,c=>t(45,ze=c)),W(n,$r,c=>t(46,ge=c)),W(n,qn,c=>t(53,Ee=c));let De=!0,C=!0,V=!1,He=!0,q=0,Be=0,be,Ae,dt,Ue=Promise.resolve(void 0),Ce=-2,pe=-2,Je=r?F:P,Qe=0,me,ut,Ge=!0,pt=!1,je=!1,Ze,Xe=[],gt=[],Fe,kt=0,S=!1,ue=0;const We=nn(2500).pipe(St(()=>t(9,C=!1)),Mt());W(n,We,c=>t(27,D=c));const Oe=Ot(()=>ls(ea)).pipe(Ke(c=>Number(c.url.searchParams.get("id"))),Vn({refCount:!0,bufferSize:1})),m=Oe.pipe(zt(async c=>{let G;try{if(Ze=ln(window,sn.BROWSER,void 0,!0,l,s),Ze.startContext({id:c,title:""}),G=await Ze.getBook(),!G)return G;Ze.startContext({id:G.id,title:G.title,imagePath:G.coverImage}),G.storageSource?t(76,Fe=await oo(G.storageSource,!0)):u!==Xt.Off&&t(76,Fe=await oo(w)),G.lastBookOpen=new Date().getTime(),await Ze.updateLastRead(G),G=await Mi(Fe,G),await Ei(Fe)}catch(fe){const Le=`Error loading book: ${fe.message}`;mt.warn(Le),tt.dialogs$.next([{component:wt,props:{title:"Load Error",message:Le}}]);return}finally{t(8,De=!1)}return Fe&&Fe.updateSettings(window,!0,s,l,!1,G.storageSource||w),G}),zn());W(n,m,c=>t(25,f=c));const ne=m.pipe(St(c=>{c||go(`${fo}${qe.MANAGE.routeId}`)}),Mt());W(n,ne,c=>t(52,Ne=c));const h=m.pipe(St(c=>{!c||t(3,Ue=Dn.getBookmark(c.id))}),Mt());W(n,h,c=>t(47,ae=c));const ft=m.pipe(zt(c=>c?(Un.next(c.sections||[]),as(c,".book-content",document)):Gt),Vn({refCount:!0,bufferSize:1}));W(n,ft,c=>t(30,A=c));const an=Ot(()=>visualViewport?st(visualViewport,"resize"):Yn()).pipe(zn()),Qn=an.pipe(Ln(0),Ke(()=>(visualViewport==null?void 0:visualViewport.width)||0),cn());W(n,Qn,c=>t(31,z=c));const Zn=an.pipe(Ln(0),Ke(()=>(visualViewport==null?void 0:visualViewport.height)||0),cn());W(n,Zn,c=>t(32,I=c));const yn=Dr.pipe(Ke(c=>ga.get(c)),$t(c=>!!c));W(n,yn,c=>t(33,O=c));const Rn=yn.pipe(Ke(c=>c.backgroundColor));W(n,Rn,c=>t(34,_=c));const xn=Rn.pipe(No(()=>document.body,(c,G)=>G.style.setProperty(Yo,c),c=>c.style.removeProperty(Yo)),Mt(),cn());W(n,xn,c=>t(48,le=c));const $n=Fr.pipe(No(()=>document.documentElement,(c,G)=>G.style.setProperty(Uo,c),c=>c.style.removeProperty(Uo)),Mt(),cn());W(n,$n,c=>t(49,Te=c));const eo=Ot(()=>bn).pipe(Ke(c=>[...c.values()]));W(n,eo,c=>t(26,p=c));const to=Ot(()=>st(document,"selectionchange")).pipe(xt(200),St(()=>{var G,fe;const c=((G=window.getSelection())==null?void 0:G.toString())||"";!c&&Ge?ut=void 0:c?(ut=(fe=window.getSelection())==null?void 0:fe.getRangeAt(0),Ge=!1):Ge=!0}),Mt());W(n,to,c=>t(50,J=c));const no=In.pipe(Ba(6e4),zt(()=>jt()),Mt());W(n,no,c=>t(51,te=c));function Ri(c){return g&&(S||ue!==q||o&&Xe.length||o&&gt.length)?(c.preventDefault(),c.returnValue="Are you sure you want to exit?"):c}async function oo(c,G=!1){if(!c){if(G)throw new Error("No storage source found");return}if(c===uo.GDRIVE_DEFAULT){if(!k){tt.dialogs$.next([{component:wt,props:{title:"Load Error",message:"Sync disabled due to missing Online Connection - refresh Page after going Online to try again"}}]);return}return ln(window,sn.GDRIVE,c,!0,l,s)}if(c===uo.ONEDRIVE_DEFAULT){if(!k){tt.dialogs$.next([{component:wt,props:{title:"Load Error",message:"Sync disabled due to missing Online Connection - refresh Page after going Online to try again"}}]);return}return ln(window,sn.ONEDRIVE,c,!0,l,s)}if(c){const xe=await(await Dn.db).get("storageSource",c);if(xe){if(xe.type!==sn.FS&&!k){tt.dialogs$.next([{component:wt,props:{title:"Load Error",message:"Sync disabled due to missing Online Connection - refresh Page after going Online to try again"}}]);return}return ln(window,xe.type,c,!0,l,s)}if(G)throw new Error(`No storage source with name ${c} found`)}const fe=`No storage source with name ${c} found - skipping auto import/export`;mt.warn(fe),tt.dialogs$.next([{component:wt,props:{title:"Configuration Error",message:fe}}])}async function Mi(c,G){if(!c)return G;l||c.clearData(!1),c.startContext({id:G.id,title:G.title,imagePath:G.coverImage||""});let{id:fe,...Le}=G;if(G.storageSource){const at=await c.getBook();at&&!(at instanceof File)&&(Le={...at,id:G.id,lastBookOpen:G.lastBookOpen,storageSource:G.storageSource})}else if(!G.elementHtml)throw new Error("Book has no data stored");const xe={id:fe,...Le};return await c.updateLastRead(xe).catch(at=>{const $e=`Failed to update last read on external storage: ${at.message}`;mt.warn($e),tt.dialogs$.next([{component:wt,props:{title:"Update Error",message:$e}}])}),xe}async function Ei(c){if(Ze&&c&&(u===Xt.Down||u===Xt.All)){const G=await c.getProgress();G&&!(G instanceof File)&&(await Ze.saveProgress(G),ue=G.exploredCharCount||0)}}function Di(c){E||!ss(c,Ir.getValue(),Mn,Ti,fe=>Bn.next(Bn.getValue()+fe),be,dt,r,Ai,ro)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),c.preventDefault())}function Fi(){let c;return Oe.subscribe(G=>c=G).unsubscribe(),c}async function Mn(c){var Le;const G=Fi();if(!G||!Ae)return;let fe;if(t(9,C=!1),i){const xe=v?ja(window,ut):void 0,at=xe||me;Kt((Le=at==null?void 0:at.endContainer)==null?void 0:Le.parentElement,"add",.5,500),fe=Ae.formatBookmarkDataByRange(G,at),xe&&Ci(window)}else fe=Ae.formatBookmarkData(G,Qe);if(await Ze.saveProgress(fe),o){const xe=S?gt:Xe;xe.includes(co.PROGRESS)||xe.push(co.PROGRESS),c&&In.next()}t(3,Ue=Promise.resolve(fe))}async function Ti(){const c=await Ue;!c||!Ae||Ae.scrollToBookmark(c,Qe)}function Bi(){if(t(9,C=!1),!dn.fullscreenElement){dn.requestFullscreen(document.documentElement);return}dn.exitFullscreen()}function Ii(){tt.dialogs$.next([{component:wt,props:{title:"Old Domain",message:"You are currently using the old domain of ッツ Reader - consider switching to https://reader.ttsu.app to prevent issues and to ensure full features"},disableCloseOnClick:!0}])}function Ai(c){if(!(p!=null&&p.length))return;const[G,fe]=ki(p);!fe&&c===-1||c===1&&fe===G.length-1||rn.next(G[fe+c].reference)}async function jt(c=!0){if(S||!Xe.length||!f||!Fe)return;t(21,S=!0),c||(Yt.next(!0),mt.clearHistory(),io());const G=f.storageSource||w;Fe.updateSettings(window,!1,s,l,!c,G);const fe=await Tr(Ze,Fe,!c&&d===Fe.storageType,[{id:f.id,title:f.title,imagePath:f.coverImage}],Xe).catch(Le=>Le.message);if(Fe.updateSettings(window,!0,s,l,!1,G),t(21,S=!1),fe){if(!c){const Le=mt.errorCount>1;mt.warn(fe),tt.dialogs$.next([{component:Le?Br:wt,props:{title:"Error Processing Data",message:Le?"Some or all data could not be stored on an external storage":fe}}])}t(20,kt+=1)}else t(20,kt=0),c||tt.dialogs$.next([]),gt.length?(t(19,Xe=JSON.parse(JSON.stringify(gt))),gt=[],c?In.next():await jt(!1)):t(19,Xe=[]);c||Yt.next(!1)}function io(){tt.dialogs$.next([{component:"<div/>",disableCloseOnClick:!0}])}async function En(c,G=!0){io();let fe;try{G&&await Dn.deleteLastItem(),await Mn(!1),tt.dialogs$.next([]),o&&await jt(!1)}catch(Le){fe=Le.message}fe&&(mt.warn(fe),tt.dialogs$.next([{component:wt,props:{title:"Error",message:fe},disableCloseOnClick:!0}])),go(`${fo}${c}`)}function ro(){const c=document.querySelector(".book-content");if(!c)return;i&&(t(14,Ce=window.innerHeight/2-2),t(15,pe=window.innerWidth/2-2)),t(9,C=!1),t(18,pt=!0),document.body.classList.add("cursor-crosshair");const{elLeftReferencePoint:G,elTopReferencePoint:fe,elRightReferencePoint:Le,elBottomReferencePoint:xe,pointGap:at}=_i(window,c,r,a);on(st(document,"pointerup"),st(document,"pointermove")).pipe(Va(()=>pt)).subscribe($e=>{if($e instanceof PointerEvent)if($e.type==="pointerup")document.body.classList.remove("cursor-crosshair"),t(18,pt=!1),dr().then(()=>{t(15,pe=r?$e.x:pe),t(14,Ce=r?Ce:$e.y);const yt=Wa(pe,Ce);if(yt&&Kt(yt.parent,"add",.5,500),i)t(4,me=yt==null?void 0:yt.range);else{let Rt=0;r?(Rt=Math.ceil(Math.max(0,pe-G)/(Le-G)*100),Tn.next(Rt)):(Rt=Math.ceil(Math.max(0,Ce-fe)/(xe-fe)*100),Fn.next(Rt)),t(16,Je=Rt)}});else{const yt=$e.x>=G+at&&$e.x<=Le,Rt=$e.y>=fe&&$e.y<=xe-at;i?(t(14,Ce=Rt?$e.y:Ce),t(15,pe=yt?$e.x:pe)):r&&yt?t(15,pe=$e.x):!r&&Rt&&t(14,Ce=$e.y)}})}const Oi=()=>t(9,C=!0);function Li(c){V=c,t(10,V)}const Vi=()=>{t(9,C=!1),Nt.next(!0)},zi=()=>{t(9,C=!1),t(5,je=!0)},Ni=()=>{t(9,C=!1),i?t(4,me=void 0):r?(Tn.next(100),t(16,Je=100)):(Fn.next(0),t(16,Je=0))},Hi=()=>En(qe.SETTINGS.routeId,!1),Gi=()=>En(qe.MANAGE.routeId),Wi=()=>t(9,C=!1);function ji(c){q=c,t(0,q)}function Xi(c){Be=c,t(1,Be)}function qi(c){V=c,t(10,V)}function Ki(c){Ue=c,t(3,Ue)}function Yi(c){be=c,t(2,be)}function Ui(c){Ae=c,t(12,Ae)}function Ji(c){dt=c,t(13,dt)}function Qi(c){Je=c,t(16,Je)}function Zi(c){Ce=c,t(14,Ce)}function xi(c){pe=c,t(15,pe)}function $i(c){Qe=c,t(17,Qe)}function er(c){me=c,t(4,me)}function tr(c){je=c,t(5,je),t(4,me)}const nr=()=>Nt.next(!1),or=()=>jt(!1),ir=()=>t(11,He=!He);return n.$$.update=()=>{var c;n.$$.dirty[0]&132&&T&&(be==null||be.off()),n.$$.dirty[0]&3&&Be&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{exploredCharCount:q}})),n.$$.dirty[0]&2&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{bookCharCount:Be}})),n.$$.dirty[0]&48&&je&&(Kt((c=me==null?void 0:me.endContainer)==null?void 0:c.parentElement,"add",1),st(document,"click").pipe(mn(1),Wt(1)).subscribe(()=>{var G;t(5,je=!1),Kt((G=me==null?void 0:me.endContainer)==null?void 0:G.parentElement,"remove",1)})),n.$$.dirty[0]&64&&t(22,i=y===Bt.Paginated),n.$$.dirty[2]&49152&&(o=Fe&&(u===Xt.Up||u===Xt.All)),n.$$.dirty[0]&8&&Ue.then(G=>ue=(G==null?void 0:G.exploredCharCount)||0)},[q,Be,be,Ue,me,je,y,T,De,C,V,He,Ae,dt,Ce,pe,Je,Qe,pt,Xe,kt,S,i,r,a,f,p,D,X,B,A,z,I,O,_,N,b,L,$,se,ke,Ve,Me,Re,Ie,ze,ge,ae,le,Te,J,te,Ne,Ee,We,m,ne,h,ft,Qn,Zn,yn,Rn,xn,$n,eo,to,no,Ri,Di,Mn,Bi,Ii,jt,En,ro,Fe,u,Oi,Li,Vi,zi,Ni,Hi,Gi,Wi,ji,Xi,qi,Ki,Yi,Ui,Ji,Qi,Zi,xi,$i,er,tr,nr,or,ir]}class vs extends Dt{constructor(e){super(),Ft(this,e,hs,cs,Tt,{},null,[-1,-1,-1,-1,-1])}}export{vs as default};
