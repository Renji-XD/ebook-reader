var tr=Object.defineProperty;var nr=(t,e,n)=>e in t?tr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var xe=(t,e,n)=>(nr(t,typeof e!="symbol"?e+"":e,n),n);import{S as yt,i as Rt,n as Mt,V as or,e as zt,W as ir,a as G,B as vt,f as R,a2 as _n,h as rr,j as Z,w as Pe,s as ie,k as x,l as $,x as ve,c as re,m as Y,a8 as K,p as M,y as ye,N as ge,d as j,g as it,t as U,b as rt,z as Re,R as kt,D as W,_ as Gn,T as Wn,a1 as te,G as ee,a5 as jn,a9 as Ko,q as _e,r as we,u as qe,aa as io,ab as fe,ac as ce,o as Yo,Y as Uo,Z as Jo,F as ar,L as Qo,a0 as ro,$ as lr,ad as sr,A as ur}from"../../../chunks/index-be8ea2fc.js";import{j as fr,k as Zo,l as xo,n as cr,o as cn,q as Tt,r as hr,s as dr,u as mr,v as ht,w as Ct,B as dn,x as wn,y as Vt,m as Xe,z as Zt,A as $o,F as ot,C as qt,D as ei,E as Xn,G as mn,H as ti,I as ao,t as bt,J as ni,c as qn,K as oi,L as gr,N as It,O as pr,P as Vn,Q as Ln,R as kr,S as zn,V as Dt,T as Sn,U as br,W as Cr,X as _r,f as pt,Y as ii,i as wr,a as mt,Z as Sr,_ as ri,$ as Pr,a0 as vr,a1 as gt,a2 as ln,a3 as En,a4 as Wt,M as Ft,a5 as yr,a6 as Rr,a7 as lo,h as Dn,a8 as Mr,a9 as Er,p as so,aa as Dr,ab as Bn,ac as Nn,ad as Hn,ae as Br,af as Tr,ag as Fr,ah as Ir,ai as Ar,aj as Or,ak as Vr,al as Tn,am as Fn,an as Lr,ao as zr,ap as Nr,aq as Hr,ar as Gr,as as Wr,at as jr,au as Xr,av as qr,aw as Kr,ax as Yr,ay as Ur,az as uo}from"../../../chunks/store-12fb6ab6.js";import{p as Jr}from"../../../chunks/stores-6a6870f3.js";import{f as fo,g as co}from"../../../chunks/format-page-title-2ca75b98.js";import{F as lt,a as Yt,f as ai,b as Qr,c as Zr,d as xr,e as $r,g as ea,h as ta,i as na}from"../../../chunks/fa-f7462c86.js";import{t as li,k as gn,l as Ut,_ as xt,u as oa,O as _t,i as Bt,n as ia,h as ra,a as et,m as Et,v as In}from"../../../chunks/error-handler-df8dffd6.js";import{m as aa,t as ct,c as Jt,f as ho}from"../../../chunks/index-6454b96b.js";import{r as Pt,M as la,m as je,P as sa,c as si}from"../../../chunks/merged-header-icon-bd37420f.js";import{a as ua}from"../../../chunks/theme-option-f9f8f697.js";var Kt={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,i=Kt.delegate;i&&(e=i.requestAnimationFrame,n=i.cancelAnimationFrame);var o=e(function(r){n=void 0,t(r)});return new li(function(){return n==null?void 0:n(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Kt.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,gn([],Ut(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Kt.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,gn([],Ut(t)))},delegate:void 0},fa=function(t){xt(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(li),pn={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=pn.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,gn([t,e],Ut(n))):setInterval.apply(void 0,gn([t,e],Ut(n)))},clearInterval:function(t){var e=pn.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},ui=function(t){xt(e,t);function e(n,i){var o=t.call(this,n,i)||this;return o.scheduler=n,o.work=i,o.pending=!1,o}return e.prototype.schedule=function(n,i){var o;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var r=this.id,a=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(a,r,i)),this.pending=!0,this.delay=i,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,i),this},e.prototype.requestAsyncId=function(n,i,o){return o===void 0&&(o=0),pn.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,i,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return i;i!=null&&pn.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,i);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var o=!1,r;try{this.work(n)}catch(a){o=!0,r=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,o=n.scheduler,r=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,oa(r,this),i!=null&&(this.id=this.recycleAsyncId(o,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(fa),mo=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=fr.now,t}(),fi=function(t){xt(e,t);function e(n,i){i===void 0&&(i=mo.now);var o=t.call(this,n,i)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,o){for(;n=i.shift();)n.unsubscribe();throw o}},e}(mo),$t=new fi(ui),ca=$t,ha=function(t){xt(e,t);function e(n,i){var o=t.call(this,n,i)||this;return o.scheduler=n,o.work=i,o}return e.prototype.requestAsyncId=function(n,i,o){return o===void 0&&(o=0),o!==null&&o>0?t.prototype.requestAsyncId.call(this,n,i,o):(n.actions.push(this),n._scheduled||(n._scheduled=Kt.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,i,o){var r;if(o===void 0&&(o=0),o!=null?o>0:this.delay>0)return t.prototype.recycleAsyncId.call(this,n,i,o);var a=n.actions;i!=null&&((r=a[a.length-1])===null||r===void 0?void 0:r.id)!==i&&(Kt.cancelAnimationFrame(i),n._scheduled=void 0)},e}(ui),da=function(t){xt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var i=this._scheduled;this._scheduled=void 0;var o=this.actions,r;n=n||o.shift();do if(r=n.execute(n.state,n.delay))break;while((n=o[0])&&n.id===i&&o.shift());if(this._active=!1,r){for(;(n=o[0])&&n.id===i&&o.shift();)n.unsubscribe();throw r}},e}(fi),Pn=new da(ha),Nt=new _t(function(t){return t.complete()});function Kn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Zo(t);return xo(t,n)}function ma(t){return t instanceof Date&&!isNaN(t)}var ga=["addListener","removeListener"],pa=["addEventListener","removeEventListener"],ka=["on","off"];function at(t,e,n,i){if(Bt(n)&&(i=n,n=void 0),i)return at(t,e,n).pipe(aa(i));var o=Ut(_a(t)?pa.map(function(l){return function(s){return t[l](e,s,n)}}):ba(t)?ga.map(go(t,e)):Ca(t)?ka.map(go(t,e)):[],2),r=o[0],a=o[1];if(!r&&cr(t))return cn(function(l){return at(l,e,n)})(Tt(t));if(!r)throw new TypeError("Invalid event target");return new _t(function(l){var s=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return l.next(1<u.length?u:u[0])};return r(s),function(){return a(s)}})}function go(t,e){return function(n){return function(i){return t[n](e,i)}}}function ba(t){return Bt(t.addListener)&&Bt(t.removeListener)}function Ca(t){return Bt(t.on)&&Bt(t.off)}function _a(t){return Bt(t.addEventListener)&&Bt(t.removeEventListener)}function en(t,e,n){t===void 0&&(t=0),n===void 0&&(n=ca);var i=-1;return e!=null&&(hr(e)?n=e:i=e),new _t(function(o){var r=ma(t)?+t-n.now():t;r<0&&(r=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=i?this.schedule(void 0,i):o.complete())},r)})}function wa(t,e){return t===void 0&&(t=0),e===void 0&&(e=$t),t<0&&(t=0),en(t,t,e)}function tn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Zo(t),i=dr(t,1/0),o=t;return o.length?o.length===1?Tt(o[0]):mr(i)(xo(o,n)):Nt}var Sa=Array.isArray;function Pa(t){return t.length===1&&Sa(t[0])?t[0]:t}function va(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=Pa(t),t.length===1?Tt(t[0]):new _t(ya(t))}function ya(t){return function(e){for(var n=[],i=function(r){n.push(Tt(t[r]).subscribe(ht(e,function(a){if(n){for(var l=0;l<n.length;l++)l!==r&&n[l].unsubscribe();n=null}e.next(a)})))},o=0;n&&!e.closed&&o<t.length;o++)i(o)}}function Ra(t){return Ct(function(e,n){var i=!1,o=null,r=null,a=!1,l=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var u=o;o=null,n.next(u)}a&&n.complete()},s=function(){r=null,a&&n.complete()};e.subscribe(ht(n,function(u){i=!0,o=u,r||Tt(t(u)).subscribe(r=ht(n,l,s))},function(){a=!0,(!i||!r||r.closed)&&n.complete()}))})}function Ma(t,e){return e===void 0&&(e=$t),Ra(function(){return en(t,e)})}function Ea(t){return Ct(function(e,n){var i=!1,o=null,r=null,a=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var l=o;o=null,n.next(l)}};e.subscribe(ht(n,function(l){r==null||r.unsubscribe(),i=!0,o=l,r=ht(n,a,ia),Tt(t(l)).subscribe(r)},function(){a(),n.complete()},void 0,function(){o=r=null}))})}function Qt(t,e){return e===void 0&&(e=$t),Ct(function(n,i){var o=null,r=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var u=r;r=null,i.next(u)}};function s(){var u=a+t,h=e.now();if(h<u){o=this.schedule(void 0,u-h),i.add(o);return}l()}n.subscribe(ht(i,function(u){r=u,a=e.now(),o||(o=e.schedule(s,t),i.add(o))},function(){l(),i.complete()},void 0,function(){r=o=null}))})}function Ht(t){return t<=0?function(){return Nt}:Ct(function(e,n){var i=0;e.subscribe(ht(n,function(o){++i<=t&&(n.next(o),t<=i&&n.complete())}))})}function ci(t,e){return e===void 0&&(e=ra),t=t??Da,Ct(function(n,i){var o,r=!0;n.subscribe(ht(i,function(a){var l=e(a);(r||!t(o,l))&&(r=!1,o=l,i.next(a))}))})}function Da(t,e){return t===e}function Ba(t){return Ct(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function Ta(){return Ct(function(t,e){var n,i=!1;t.subscribe(ht(e,function(o){var r=n;n=o,i&&e.next([r,o]),i=!0}))})}function Fa(t,e){return e===void 0&&(e=!1),Ct(function(n,i){var o=0;n.subscribe(ht(i,function(r){var a=t(r,o++);(a||e)&&i.next(r),!a&&i.complete()}))})}var hi={leading:!0,trailing:!1};function Ia(t,e){return e===void 0&&(e=hi),Ct(function(n,i){var o=e.leading,r=e.trailing,a=!1,l=null,s=null,u=!1,h=function(){s==null||s.unsubscribe(),s=null,r&&(d(),u&&i.complete())},k=function(){s=null,u&&i.complete()},c=function(b){return s=Tt(t(b)).subscribe(ht(i,h,k))},d=function(){if(a){a=!1;var b=l;l=null,i.next(b),!u&&c(b)}};n.subscribe(ht(i,function(b){a=!0,l=b,!(s&&!s.closed)&&(o?d():c(b))},function(){u=!0,!(r&&a&&s&&!s.closed)&&i.complete()}))})}function Aa(t,e,n){e===void 0&&(e=$t),n===void 0&&(n=hi);var i=en(t,e);return Ia(function(){return i},n)}const Yn=new dn([]),kn=new et,nn=new et,Lt=new et;function di(t){const e=t.filter(r=>!r.parentChapter);let n=t.find(r=>r.progress<100);n||(n=t[t.length-1]);const i=n.parentChapter||n.reference,o=e.findIndex(r=>r.reference===i);return[e,o,i]}function Oa(t){let e,n;return{c(){e=new or(!1),n=zt(),this.h()},l(i){e=ir(i,!1),n=zt(),this.h()},h(){e.a=n},m(i,o){e.m(t[0],i,o),G(i,n,o)},p(i,[o]){o&1&&e.p(i[0])},i:vt,o:vt,d(i){i&&R(n),i&&e.d()}}}function Va(t,e,n){let{html:i}=e;const o=_n();return rr(()=>{o("load")}),t.$$set=r=>{"html"in r&&n(0,i=r.html)},[i]}class mi extends yt{constructor(e){super(),Rt(this,e,Va,Oa,Mt,{html:0})}}function La(t,e){var o;const n=(o=document.elementFromPoint(t,e))==null?void 0:o.closest("p");if(!n)return;const i=wn(n);if(!!i.length)return{range:Un(i[0]),parent:n}}function Un(t,e=0,n=0){const i=new Range;return i.setStart(t,e),i.setEnd(t,n),i}function za(t,e){var a,l,s;const n=(a=t.getSelection())!=null&&a.toString().trim()?(l=t.getSelection())==null?void 0:l.getRangeAt(0):void 0;let i;if(n?i=n:i=e,!i)return;const o=(s=i.endContainer.parentElement)==null?void 0:s.closest("p");if(!o)return;const r=wn(o);if(!!r.length)return Un(r[0])}function po(t,e){const n=t.createRange();return n.selectNode(e),n.getBoundingClientRect()}function gi(t,e=250){var n;(n=t.getSelection())==null||n.removeAllRanges(),setTimeout(()=>{var i;(i=t.getSelection())==null||i.addRange(new Range)},e)}function pi(t,e,n,i){const o=Math.min(Math.max(i,0),n?t.innerWidth/4:t.innerHeight/4),r=e.getBoundingClientRect(),a=n?o:r.left,l=n?t.innerWidth-o:r.right,s=n?r.top:o,u=n?r.bottom:t.innerHeight-o,h=Number(getComputedStyle(e).lineHeight.replace(/px$/,""));return{elLeftReferencePoint:a,elRightReferencePoint:l,elTopReferencePoint:s,elBottomReferencePoint:u,firstDimensionMargin:o,pointGap:h}}function Xt(t,e,n,i=0){if(!t)return;const o=`animate-[pulse_${n}s_cubic-bezier(0.4,0,0.6,1)_${i?"1":"infinite"}]`;t.classList[e](o),i&&setTimeout(()=>t.classList.remove(o),i)}class Na{constructor(e,n,i,o,r=Pn){xe(this,"enabled$",new dn(!1));this.multiplier=e,this.verticalMode=n,this.enabled$.pipe(Vt(a=>{if(!a)return Nt;let l=0;return wa(0,r).pipe(Xe(()=>Date.now()),Ta(),Xe(s=>this.calcNewPos(s)),Xe(s=>{l+=s;const u=Math.trunc(l);return l-=u,u}),Zt(s=>s!==0))}),ct(i)).subscribe(a=>{let l="top";n&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,n]){let i=.00365956;return this.verticalMode&&(i=-91489e-8),i*this.multiplier*(n-e)}}function At(t,e){return e==="rtl"?-t:t}class Ha{constructor(e,n,i){this.calculator=e,this.window=n,this.firstDimensionMargin=i}scrollToBookmark(e,n=0){const i=this.getBookmarkPosition(e);if(!i)return;const{scrollToData:o}=ko(i,this.firstDimensionMargin),r=this.calculator.verticalMode?"left":"top";o.left!==void 0&&r==="left"?o.left+=n:o.top!==void 0&&r==="top"&&(o.top-=n),this.window.scrollTo(o)}formatBookmarkData(e,n=0){const i=this.calculator.calcExploredCharCount(n),o=this.calculator.charCount,{verticalMode:r}=this.calculator,a=r?"scrollX":"scrollY";return{dataId:e,exploredCharCount:i,progress:i/o,[a]:this.window[a],lastBookmarkModified:new Date().getTime()}}formatBookmarkDataByRange(e){return this.formatBookmarkData(e)}getBookmarkBarPosition(e){const n=this.getBookmarkPosition(e);if(!!n)return ko(n,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:n}=this.calculator,i=this.getBookmarkTargetPosByScrollValue(e);if(i)return i;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return n?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:n}=e,i=o=>{const r=e[o];if(!r)return;const a=At(r,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===n)return{[o]:r}};return this.calculator.verticalMode?i("scrollX"):i("scrollY")}}function ko(t,e){return"scrollX"in t?{scrollToData:{left:t.scrollX},bookmarkPosData:{right:`${-t.scrollX+e}px`}}:{scrollToData:{top:t.scrollY},bookmarkPosData:{top:`${t.scrollY+e}px`}}}function ki(t){const e=(n,i,o,r)=>{if(o<i)return t??o;const a=Math.floor((i+o)/2);return n[a]===r?a:n[a]>r?e(n,i,a-1,r):e(n,a+1,o,r)};return(n,i)=>e(n,0,n.length-1,i)}function Ga(){const t=(e,n,i,o)=>{if(i<n)return-1;const r=Math.floor((n+i)/2);return o.intersectsNode(e[r])?r:o.comparePoint(e[r],0)>0?t(e,n,r-1,o):t(e,r+1,i,o)};return(e,n)=>t(e,0,e.length-1,n)}const Wa=Ga(),ja=ki(-1),bn=ki(void 0);class bi{constructor(e,n,i,o,r){xe(this,"charCount");xe(this,"accumulatedCharCount");xe(this,"paragraphPos");xe(this,"paragraphs");xe(this,"paragraphPosToAccCharCount",new Map);this.containerEl=e,this.axis=n,this.direction=i,this.scrollEl=o,this.document=r,this.paragraphs=wn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=$o(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const n=this.scrollEl.getBoundingClientRect(),i=At(this.verticalMode?n.right:n.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),r=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=po(this.document,l),h=(()=>(this.verticalMode?s.width:s.height)<=0?this.paragraphPos[a-1]||0:At(this.verticalMode?s.left:s.bottom,this.direction)-i-o+e)();this.paragraphPos[a]=h;const k=r.get(h)||[];r.set(h,k),k.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(r.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(e=0){return this.getCharCountByScrollPos(this.scrollPos+e)}getCharCountByScrollPos(e){const n=bn(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[n])||0}getBookMarkPosForSection(e,n){const i=Math.max(0,ja(this.accumulatedCharCount,n-e));let o=i,r=this.processSectionBookmarkIteration(i,e,n);if(!r){for(let a=i+1,{length:l}=this.accumulatedCharCount;a<l;a+=1)if(r=this.processSectionBookmarkIteration(a,e,n),r){o=a;break}}return{bookmarkPos:r,node:r?this.paragraphs[o]:void 0,isFirstNode:o===0}}getScrollPosByCharCount(e){const n=bn(this.accumulatedCharCount,e);return At(this.paragraphPos[n],this.direction)||0}getCharCountToPoint(e){const n=Math.max(0,Wa(this.paragraphs,e));return this.accumulatedCharCount[n-1]||0}processSectionBookmarkIteration(e,n,i){const o=this.accumulatedCharCount[e]+n;let r;if(o>i){let a=this.paragraphs[e];a.parentElement&&(a=a.parentElement.closest("p")||a.parentElement);const{top:l,right:s,left:u}=po(this.document,a);r=this.axis==="horizontal"?{left:s}:{top:l,left:u}}return r}get scrollPos(){return At(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}function Xa(t,e,n){const i=Ya(e,n)(t,"scrollLeft");return(o,r,a)=>{if(!qa(o))return;const l=Ka(o,r,a);i(-l),o.preventDefault()}}function qa(t){return!(!t.deltaY||t.deltaX||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)}function Ka(t,e,n){switch(t.deltaMode){case 0:return t.deltaY;case 1:return t.deltaY*e*1.75;default:return t.deltaY*n}}function Ya(t,e){return(n,i)=>{let o=!1,r=t[i],a=t[i];const l=()=>{o=!0;const s=Math.trunc((r-t[i])/n);if(t[i]!==a){o=!1;return}if(a+=s,t.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(r=t[i],a=t[i]),r+=s,o||e(l)}}}class Ua{constructor(e,n,i){this.verticalMode=e,this.firstDimensionMargin=n,this.window=i}nextPage(){this.scrollByPercent(.95)}prevPage(){this.scrollByPercent(-.95)}updateSectionDataByOffset(){}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let n=this.window.innerHeight,i="top",o=1;this.verticalMode&&(n=this.window.innerWidth,i="left",o=-1);const r=n-this.firstDimensionMargin*2;this.window.scrollBy({[i]:r*e*o,behavior:"smooth"})}}const{document:bo,window:Ja}=Wn;function Co(t){let e,n,i,o,r;return{c(){e=Z("div"),i=ie(),o=Z("div"),this.h()},l(a){e=x(a,"DIV",{class:!0,style:!0}),$(e).forEach(R),i=re(a),o=x(a,"DIV",{class:!0,style:!0}),$(o).forEach(R),this.h()},h(){Y(e,"class","fixed z-[5]"),Y(e,"style",n=t[22]+": 100%; "+t[21]+": "+t[15]+"px; "+t[20][0]+": 0"),K(e,"inset-y-0",t[2]),K(e,"inset-x-0",!t[2]),M(e,"background-color",t[4]),Y(o,"class","fixed z-[5]"),Y(o,"style",r=t[22]+": 100%; "+t[21]+": "+t[15]+"px; "+t[20][1]+": 0"),K(o,"inset-y-0",t[2]),K(o,"inset-x-0",!t[2]),M(o,"background-color",t[4])},m(a,l){G(a,e,l),G(a,i,l),G(a,o,l)},p(a,l){l[0]&7372800&&n!==(n=a[22]+": 100%; "+a[21]+": "+a[15]+"px; "+a[20][0]+": 0")&&Y(e,"style",n),l[0]&4&&K(e,"inset-y-0",a[2]),l[0]&4&&K(e,"inset-x-0",!a[2]),l[0]&16&&M(e,"background-color",a[4]),l[0]&7372800&&r!==(r=a[22]+": 100%; "+a[21]+": "+a[15]+"px; "+a[20][1]+": 0")&&Y(o,"style",r),l[0]&4&&K(o,"inset-y-0",a[2]),l[0]&4&&K(o,"inset-x-0",!a[2]),l[0]&16&&M(o,"background-color",a[4])},d(a){a&&R(e),a&&R(i),a&&R(o)}}}function _o(t){let e,n,i,o;const r=[Za,Qa],a=[];function l(s,u){return s[2]?0:1}return e=l(t),n=a[e]=r[e](t),{c(){n.c(),i=zt()},l(s){n.l(s),i=zt()},m(s,u){a[e].m(s,u),G(s,i,u),o=!0},p(s,u){let h=e;e=l(s),e===h?a[e].p(s,u):(it(),U(a[h],1,1,()=>{a[h]=null}),rt(),n=a[e],n?n.p(s,u):(n=a[e]=r[e](s),n.c()),j(n,1),n.m(i.parentNode,i))},i(s){o||(j(n),o=!0)},o(s){U(n),o=!1},d(s){a[e].d(s),s&&R(i)}}}function Qa(t){let e,n,i;return n=new lt({props:{icon:Yt}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(o){e=x(o,"DIV",{class:!0});var r=$(e);ve(n.$$.fragment,r),r.forEach(R),this.h()},h(){Y(e,"class","pointer-events-none absolute text-sm opacity-25 sm:text-xl"),M(e,"color",t[3]),M(e,"left",t[17]),M(e,"top",`calc(${t[18].top} + 1.5rem)`)},m(o,r){G(o,e,r),ye(n,e,null),i=!0},p(o,r){r[0]&8&&M(e,"color",o[3]),r[0]&131072&&M(e,"left",o[17]),r[0]&262144&&M(e,"top",`calc(${o[18].top} + 1.5rem)`)},i(o){i||(j(n.$$.fragment,o),i=!0)},o(o){U(n.$$.fragment,o),i=!1},d(o){o&&R(e),Re(n)}}}function Za(t){let e,n,i;return n=new lt({props:{icon:Yt}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(o){e=x(o,"DIV",{class:!0});var r=$(e);ve(n.$$.fragment,r),r.forEach(R),this.h()},h(){Y(e,"class","pointer-events-none absolute text-xl opacity-25"),M(e,"color",t[3]),M(e,"right",`calc(${t[18].right} + 1rem)`),M(e,"top",t[17])},m(o,r){G(o,e,r),ye(n,e,null),i=!0},p(o,r){r[0]&8&&M(e,"color",o[3]),r[0]&262144&&M(e,"right",`calc(${o[18].right} + 1rem)`),r[0]&131072&&M(e,"top",o[17])},i(o){i||(j(n.$$.fragment,o),i=!0)},o(o){U(n.$$.fragment,o),i=!1},d(o){o&&R(e),Re(n)}}}function xa(t){let e,n,i=`${t[9]}px`,o=`${t[19]||t[1]}px`,r,a,l,s,u,h;n=new mi({props:{html:t[0]}}),n.$on("load",t[26]);let k=t[15]&&Co(t),c=t[18]&&_o(t);return{c(){e=Z("div"),Pe(n.$$.fragment),r=ie(),k&&k.c(),a=ie(),c&&c.c(),l=ie(),this.h()},l(d){e=x(d,"DIV",{class:!0});var b=$(e);ve(n.$$.fragment,b),b.forEach(R),r=re(d),k&&k.l(d),a=re(d),c&&c.l(d),l=re(d),this.h()},h(){Y(e,"class","book-content m-auto svelte-1ouz3ba"),K(e,"book-content--writing-vertical-rl",t[2]),K(e,"book-content--writing-horizontal-rl",!t[2]),K(e,"book-content--hide-furigana",t[12]),K(e,"book-content--hide-spoiler-image",t[11]),K(e,"book-content--furigana-style-partial",t[13]===ot.Partial),K(e,"book-content--furigana-style-full",t[13]===ot.Full),K(e,"book-content--furigana-style-toggle",t[13]===ot.Toggle),M(e,"color",t[3]),M(e,"font-size",i),M(e,"line-height",t[10]),M(e,"max-width",!t[2]&&t[14]?`${t[14]}px`:void 0),M(e,"max-height",t[19]?`${t[19]}px`:void 0),M(e,"padding-left",t[2]&&t[15]?`${t[15]}px`:void 0),M(e,"padding-right",t[2]&&t[15]?`${t[15]}px`:void 0),M(e,"padding-top",!t[2]&&t[15]?`${t[15]}px`:void 0),M(e,"padding-bottom",!t[2]&&t[15]?`${t[15]}px`:void 0),M(e,"--font-family-serif",t[7]),M(e,"--font-family-sans-serif",t[8]),M(e,"--book-content-hint-furigana-font-color",t[5]),M(e,"--book-content-hint-furigana-shadow-color",t[6]),M(e,"--book-content-child-height",o)},m(d,b){G(d,e,b),ye(n,e,null),t[48](e),G(d,r,b),k&&k.m(d,b),G(d,a,b),c&&c.m(d,b),G(d,l,b),s=!0,u||(h=[ge(Ja,"scroll",t[25]),ge(bo.body,"wheel",t[24],{passive:!1}),ge(bo.body,"mousedown",t[49])],u=!0)},p(d,b){const S={};b[0]&1&&(S.html=d[0]),n.$set(S),(!s||b[0]&4)&&K(e,"book-content--writing-vertical-rl",d[2]),(!s||b[0]&4)&&K(e,"book-content--writing-horizontal-rl",!d[2]),(!s||b[0]&4096)&&K(e,"book-content--hide-furigana",d[12]),(!s||b[0]&2048)&&K(e,"book-content--hide-spoiler-image",d[11]),(!s||b[0]&8192)&&K(e,"book-content--furigana-style-partial",d[13]===ot.Partial),(!s||b[0]&8192)&&K(e,"book-content--furigana-style-full",d[13]===ot.Full),(!s||b[0]&8192)&&K(e,"book-content--furigana-style-toggle",d[13]===ot.Toggle),b[0]&8&&M(e,"color",d[3]),b[0]&512&&i!==(i=`${d[9]}px`)&&M(e,"font-size",i),b[0]&1024&&M(e,"line-height",d[10]),b[0]&16388&&M(e,"max-width",!d[2]&&d[14]?`${d[14]}px`:void 0),b[0]&524288&&M(e,"max-height",d[19]?`${d[19]}px`:void 0),b[0]&32772&&M(e,"padding-left",d[2]&&d[15]?`${d[15]}px`:void 0),b[0]&32772&&M(e,"padding-right",d[2]&&d[15]?`${d[15]}px`:void 0),b[0]&32772&&M(e,"padding-top",!d[2]&&d[15]?`${d[15]}px`:void 0),b[0]&32772&&M(e,"padding-bottom",!d[2]&&d[15]?`${d[15]}px`:void 0),b[0]&128&&M(e,"--font-family-serif",d[7]),b[0]&256&&M(e,"--font-family-sans-serif",d[8]),b[0]&32&&M(e,"--book-content-hint-furigana-font-color",d[5]),b[0]&64&&M(e,"--book-content-hint-furigana-shadow-color",d[6]),b[0]&524290&&o!==(o=`${d[19]||d[1]}px`)&&M(e,"--book-content-child-height",o),d[15]?k?k.p(d,b):(k=Co(d),k.c(),k.m(a.parentNode,a)):k&&(k.d(1),k=null),d[18]?c?(c.p(d,b),b[0]&262144&&j(c,1)):(c=_o(d),c.c(),j(c,1),c.m(l.parentNode,l)):c&&(it(),U(c,1,1,()=>{c=null}),rt())},i(d){s||(j(n.$$.fragment,d),j(c),s=!0)},o(d){U(n.$$.fragment,d),U(c),s=!1},d(d){d&&R(e),Re(n),t[48](null),d&&R(r),k&&k.d(d),d&&R(a),c&&c.d(d),d&&R(l),u=!1,kt(h)}}}function $a(t,e,n){let i,o,r,a,l,s,u,h;W(t,qt,P=>n(55,l=P)),W(t,ei,P=>n(23,s=P)),W(t,Lt,P=>n(56,u=P)),W(t,Xn,P=>n(47,h=P));let{htmlContent:k}=e,{width:c}=e,{height:d}=e,{verticalMode:b}=e,{fontColor:S}=e,{backgroundColor:E}=e,{hintFuriganaFontColor:m}=e,{hintFuriganaShadowColor:y}=e,{fontFamilyGroupOne:F}=e,{fontFamilyGroupTwo:v}=e,{fontSize:B}=e,{lineHeight:D}=e,{hideSpoilerImage:X}=e,{hideFurigana:I}=e,{furiganaStyle:A}=e,{secondDimensionMaxValue:V}=e,{firstDimensionMargin:T}=e,{autoPositionOnResize:N}=e,{autoBookmark:w}=e,{loadingState:L}=e,{multiplier:C}=e,{bookmarkData:O}=e,{exploredCharCount:Q}=e,{bookCharCount:he}=e,{autoScroller:Se}=e,{bookmarkManager:Me}=e,{pageManager:be}=e,{customReadingPoint:Oe}=e,{customReadingPointLeft:Ne}=e,{customReadingPointTop:pe}=e,{customReadingPointScrollOffset:ne}=e;const ue=_n();let me,J,Ke={},ae,Ee,Ge,ke,_,z=0,De=!1,q=window.matchMedia("(min-width: 640px)").matches?"0.5rem":"0.25rem";const Ie=Xa(4,document.documentElement,requestAnimationFrame),Ve=new et,Ye=new et,Ce=new et,Be=new Map,Te=new Map;let He=0,Ue=!1;Gn(()=>{Ce.next(),Ce.complete()}),ae=new Na(C,b,Ce,document),Se=ae,Jt([Ve,Ye]).pipe(Zt(()=>N),mn(1),Xe(([P,de])=>b?de:P),ci(),Qt(10),ti(Pn),ct(Ce)).subscribe(()=>{if(!J||!Ge)return;const P=J.getScrollPosByCharCount(z)+(b?ne:-ne);De=!0,Ge.scrollTo(P)});function Fe(){if(!h||!me)return;const{elLeftReferencePoint:P,elTopReferencePoint:de,elRightReferencePoint:Le,elBottomReferencePoint:Ae,firstDimensionMargin:p,pointGap:le}=pi(window,me,b,T);if(b){n(33,pe=de),n(32,Ne=Math.min(Math.max(p+(Le-P)*(Oe/100)-2,P+le),Le-2)),n(34,ne=window.innerWidth-p-Ne);return}n(33,pe=Math.min(Math.max(p+(Ae-de)*(Oe/100),p),Ae-le*1.5)),n(32,Ne=P),n(34,ne=pe-p)}function We(P){P.updateParagraphPos(),Fe(),n(27,Q=P.calcExploredCharCount(ne)),_&&(_=!1,O.then(de=>{!de||!Me||(z=de.exploredCharCount||0,Me.scrollToBookmark(de,ne))}).finally(()=>{w&&at(window,"scroll").pipe(mn(1),Qt(3e3),ct(Ce)).subscribe(()=>{ue("bookmark")}),Yn.pipe(Ht(1),Vt(de=>de.length?(de.forEach(Le=>{const Ae=Le.reference,p=document.getElementById(Ae);p&&(He||(He=Number(getComputedStyle(p)[b?"marginLeft":"marginBottom"].replace(/px$/,""))/2),Te.set(Ae,{...Le,progress:0}),Be.set(Ae,p))}),Be.size?(dt(),at(window,"scroll")):Nt):Nt),Ea(()=>en(Ue?100:500)),ct(Ce)).subscribe(dt)})),n(43,Ke={})}function dt(){const P=[...Te.entries()];for(let de=0,{length:Le}=P;de<Le;de+=1){const[Ae,p]=P[de],oe=Be.get(Ae).getBoundingClientRect();p.progress=b?Math.min(Math.max(oe.right+(T||0)-window.innerWidth+ne,0),oe.width)/(oe.width||1)*100:Math.abs(Math.min(Math.max(oe.top-(T||0)-ne,-oe.height),0))/(oe.height||1)*100,Te.set(Ae,p)}Ue=!1,kn.next(Te)}function st(P){b&&!u&&!s&&!l&&Ie(P,B,window.innerWidth)}function tt(){requestAnimationFrame(()=>{!J||(n(27,Q=J.calcExploredCharCount(ne)),!De&&Q&&(z=Q),De=!1)})}function Je(){!me||(n(42,J=new bi(me,b?"vertical":"horizontal",b?"rtl":"ltr",document.documentElement,document)),n(27,Q=0),z=Q,n(28,he=J.charCount),ue("contentChange",me))}nn.pipe(ct(Ce)).subscribe(P=>{let de=document.getElementById(P);if(!de)return;de=!P.startsWith(ao)&&de.closest(`div[id^="${ao}"]`)||de,Ue=!0;const Ae=de.getBoundingClientRect();b?window.scrollBy(-(window.innerWidth-Ae.right-(T||0)-ne-(!ne||ne&&He>ne?He:0)),0):window.scrollBy(0,Ae.top-(T||0)-ne-(!ne||ne&&He>ne?He:0))});function Qe(P){te[P?"unshift":"push"](()=>{me=P,n(16,me)})}const ut=P=>{s&&P.button===1&&P.preventDefault()};return t.$$set=P=>{"htmlContent"in P&&n(0,k=P.htmlContent),"width"in P&&n(35,c=P.width),"height"in P&&n(1,d=P.height),"verticalMode"in P&&n(2,b=P.verticalMode),"fontColor"in P&&n(3,S=P.fontColor),"backgroundColor"in P&&n(4,E=P.backgroundColor),"hintFuriganaFontColor"in P&&n(5,m=P.hintFuriganaFontColor),"hintFuriganaShadowColor"in P&&n(6,y=P.hintFuriganaShadowColor),"fontFamilyGroupOne"in P&&n(7,F=P.fontFamilyGroupOne),"fontFamilyGroupTwo"in P&&n(8,v=P.fontFamilyGroupTwo),"fontSize"in P&&n(9,B=P.fontSize),"lineHeight"in P&&n(10,D=P.lineHeight),"hideSpoilerImage"in P&&n(11,X=P.hideSpoilerImage),"hideFurigana"in P&&n(12,I=P.hideFurigana),"furiganaStyle"in P&&n(13,A=P.furiganaStyle),"secondDimensionMaxValue"in P&&n(14,V=P.secondDimensionMaxValue),"firstDimensionMargin"in P&&n(15,T=P.firstDimensionMargin),"autoPositionOnResize"in P&&n(36,N=P.autoPositionOnResize),"autoBookmark"in P&&n(37,w=P.autoBookmark),"loadingState"in P&&n(38,L=P.loadingState),"multiplier"in P&&n(39,C=P.multiplier),"bookmarkData"in P&&n(40,O=P.bookmarkData),"exploredCharCount"in P&&n(27,Q=P.exploredCharCount),"bookCharCount"in P&&n(28,he=P.bookCharCount),"autoScroller"in P&&n(29,Se=P.autoScroller),"bookmarkManager"in P&&n(30,Me=P.bookmarkManager),"pageManager"in P&&n(31,be=P.pageManager),"customReadingPoint"in P&&n(41,Oe=P.customReadingPoint),"customReadingPointLeft"in P&&n(32,Ne=P.customReadingPointLeft),"customReadingPointTop"in P&&n(33,pe=P.customReadingPointTop),"customReadingPointScrollOffset"in P&&n(34,ne=P.customReadingPointScrollOffset)},t.$$.update=()=>{if(t.$$.dirty[0]&4&&n(22,i=b?"height":"width"),t.$$.dirty[0]&4&&n(21,o=b?"width":"height"),t.$$.dirty[0]&4&&n(20,r=b?["left","right"]:["top","bottom"]),t.$$.dirty[1]&16&&Ve.next(c),t.$$.dirty[0]&2&&Ye.next(d),t.$$.dirty[0]&16388&&n(19,a=b&&V?V:void 0),t.$$.dirty[0]&212996&&V&&me){const P=Number(getComputedStyle(me)[b?"marginTop":"marginRight"].replace(/px$/,""));n(17,q=`min(max(calc(${`${P}px - ${q}`}), ${q}), ${P?`${P}px`:q})`)}if(t.$$.dirty[0]&1&&k&&(_=!0),t.$$.dirty[0]&2|t.$$.dirty[1]&2192&&J&&c&&d&&!L){const P=J;requestAnimationFrame(()=>{We(P)})}t.$$.dirty[0]&4|t.$$.dirty[1]&8448&&ae&&(n(44,ae.multiplier=C,ae),n(44,ae.verticalMode=b,ae)),t.$$.dirty[0]&32768|t.$$.dirty[1]&18432&&J&&(n(45,Ee=J&&new Ha(J,window,T||0)),n(30,Me=Ee)),t.$$.dirty[1]&20992&&Ke&&(n(18,ke=void 0),O.then(P=>{!P||n(18,ke=Ee==null?void 0:Ee.getBookmarkBarPosition(P))})),t.$$.dirty[0]&32772|t.$$.dirty[1]&32768&&(n(46,Ge=new Ua(b,T,window)),n(31,be=Ge)),t.$$.dirty[0]&65536|t.$$.dirty[1]&66560&&h&&me&&Number.isFinite(Oe)&&(Fe(),tt(),dt())},[k,d,b,S,E,m,y,F,v,B,D,X,I,A,V,T,me,q,ke,a,r,o,i,s,st,tt,Je,Q,he,Se,Me,be,Ne,pe,ne,c,N,w,L,C,O,Oe,J,Ke,ae,Ee,Ge,h,Qe,ut]}class el extends yt{constructor(e){super(),Rt(this,e,$a,xa,Mt,{htmlContent:0,width:35,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontFamilyGroupOne:7,fontFamilyGroupTwo:8,fontSize:9,lineHeight:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,secondDimensionMaxValue:14,firstDimensionMargin:15,autoPositionOnResize:36,autoBookmark:37,loadingState:38,multiplier:39,bookmarkData:40,exploredCharCount:27,bookCharCount:28,autoScroller:29,bookmarkManager:30,pageManager:31,customReadingPoint:41,customReadingPointLeft:32,customReadingPointTop:33,customReadingPointScrollOffset:34},null,[-1,-1,-1])}}const tl="px-4 md:px-8";function nl(t){const e=Array.from(t.getElementsByTagName("img"));return new _t(n=>{const i=e.filter(r=>r.src).map(ol);if(i.length<=0){n.next(!1),n.complete();return}const o=Jt(i).subscribe(()=>{n.next(!1),n.complete()});return n.next(!0),o})}function ol(t){return t.complete?Kn(1):va(at(t,"load"),at(t,"error"))}function il(t,e){const n=rl(t),i=ll(t);return o=>tn(n(o),al(o,e),i(o))}function rl(t){return e=>{const n=Array.from(e.getElementsByTagName("a"));n.forEach(o=>{o.href=t.location.pathname+o.hash});const i=n.map(o=>Cn(o).pipe(bt(()=>nn.next(o.hash.substring(1)))));return tn(...i)}}function al(t,e){const n=e===ot.Toggle,o=Array.from(t.getElementsByTagName("ruby")).map(r=>n?Cn(r).pipe(bt(()=>{r.classList.toggle("reveal-rt")})):Cn(r).pipe(Ht(1),bt(()=>{r.classList.add("reveal-rt")})));return tn(...o)}function ll(t){return e=>{const i=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const r=t.createElement("span");return r.classList.add("spoiler-label"),r.setAttribute("aria-hidden","true"),r.innerText="ネタバレ",o.appendChild(r),Cn(o).pipe(Ht(1),bt(()=>{o.removeChild(r),o.removeAttribute("data-ttu-spoiler-img")}))});return tn(...i)}}function Cn(t){return at(t,"click").pipe(bt(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const sl=300,ul=60,Ci="none";function jt(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function fl(t,e){return e.filter(n=>t.pointerId!==n.pointerId)}function sn(t,e,n,i,o){t.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:n,pointersCount:i.length}}))}function cl(t,e,n,i,o,r=Ci){e.style.touchAction=r;let a=[];function l(u){a.push(u),sn(e,t,u,a,"down"),i==null||i(a,u);const h=u.pointerId;function k(m){h===m.pointerId&&(a=fl(m,a),a.length||c(),sn(e,t,m,a,"up"),o==null||o(a,m))}function c(){d(),b(),S(),E()}const d=jt(e,"pointermove",m=>{a=a.map(y=>m.pointerId===y.pointerId?m:y),sn(e,t,m,a,"move"),n==null||n(a,m)}),b=jt(e,"lostpointercapture",m=>{k(m)}),S=jt(e,"pointerup",m=>{k(m)}),E=jt(e,"pointerleave",m=>{a=[],c(),sn(e,t,m,a,"up"),o==null||o(a,m)})}const s=jt(e,"pointerdown",l);return{destroy:()=>{s()}}}function hl(t,e={timeframe:sl,minSwipeDistance:ul,touchAction:Ci}){const n="swipe";let i,o,r,a;function l(u,h){o=h.clientX,r=h.clientY,i=Date.now(),u.length===1&&(a=h.target)}function s(u,h){if(h.type==="pointerup"&&u.length===0&&Date.now()-i<e.timeframe){const k=h.clientX-o,c=h.clientY-r,d=Math.abs(k),b=Math.abs(c);let S=null;d>=2*b&&d>e.minSwipeDistance?S=k>0?"right":"left":b>=2*d&&b>e.minSwipeDistance&&(S=c>0?"bottom":"top"),S&&t.dispatchEvent(new CustomEvent(n,{detail:{direction:S,target:a}}))}}return cl(n,t,null,l,s,e.touchAction)}class dl{constructor(e,n,i,o,r){this.calculator=e,this.pageManager=n,this.sectionReady$=i,this.sectionIndex$=o,this.setIntendedCharCount=r}scrollToBookmark(e){const n=e.exploredCharCount;if(!n)return;const i=this.calculator.getSectionIndexByCharCount(n),o=l=>{const s=l.getScrollPosByCharCount(n);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(n)};if(this.sectionIndex$.getValue()===i){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(i)}formatBookmarkData(e){return this.formatBookmarkDataByRange(e,void 0)}formatBookmarkDataByRange(e,n){const i=this.calculator.calcExploredCharCount(n),o=this.calculator.charCount;return{dataId:e,exploredCharCount:i,progress:i/o,lastBookmarkModified:new Date().getTime()}}}class ml{constructor(e,n,i,o,r,a,l,s,u,h,k){xe(this,"translateX",0);xe(this,"sectionData",new Map);this.contentEl=e,this.scrollEl=n,this.sections=i,this.sectionIndex$=o,this.virtualScrollPos$=r,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=u,this.pageChange$=h,this.sectionRenderComplete$=k,Yn.pipe(Ht(1)).subscribe(c=>{!c.length||(c.forEach(d=>{this.sectionData.set(d.reference,{...d,progress:0})}),kn.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}updateSectionDataByOffset(e=0){var o,r;const n=this.verticalMode?this.height:this.width,i=this.virtualScrollPos$.getValue()/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100;if(e){const l=(this.virtualScrollPos$.getValue()+n+this.pageGap)/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100-i;this.updateSectionData((o=this.sections[this.sectionIndex$.getValue()])==null?void 0:o.id,i+l*e)}else this.updateSectionData((r=this.sections[this.sectionIndex$.getValue()])==null?void 0:r.id,i)}flipPage(e){const n=this.verticalMode?"scrollHeight":"scrollWidth",i=this.verticalMode?this.height:this.width,o=i+this.pageGap,r=!0;if(this.translateX){const k=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const c=this.translateX;k(),this.scrollToPos(-c-o,r);return}if(this.nextSection(r)){k();return}return}const a=0,l=this.scrollEl[n],s=this.virtualScrollPos$.getValue(),u=s+o*e,h=Math.ceil(u);if(h<a){if(s!==a){this.scrollToPos(a,r);return}this.prevSection(o,n,i,r);return}if(h>=l){this.nextSection(r);return}this.scrollOrTranslateToPos(u,l,i,r)}scrollTo(e,n){const i=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[i],o,n)}prevSection(e,n,i,o){const r=this.sectionIndex$.getValue()-1;return r<0?!1:(this.updateSectionIndex(r).subscribe(()=>{const a=this.scrollEl[n];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,i,o)}),!0)}nextSection(e){const n=this.sectionIndex$.getValue()+1;return n>=this.sections.length?!1:(this.updateSectionIndex(n).subscribe(()=>{var i,o;this.scrollToPos(0,e),this.updateSectionData((i=this.sections[n-1])==null?void 0:i.id,100,!1),this.updateSectionData((o=this.sections[n])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,n,i,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/n*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+i<=n){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,n){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(n)}translateXToPos(e,n){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(n)}updateSectionIndex(e){return new _t(n=>{if(this.sectionIndex$.getValue()===e){n.next(),n.complete();return}const i=this.sectionRenderComplete$.subscribe(o=>{o===e&&n.next(),n.complete(),i.unsubscribe()});return this.sectionIndex$.next(e),i})}updateSectionData(e,n,i=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let r=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=n:r?l.progress=0:l.progress=100,!r&&s&&(r=!0),this.sectionData.set(a.reference,l)}),i&&kn.next(this.sectionData)}}class gl{constructor(e,n,i,o,r,a,l,s,u){xe(this,"charCount");xe(this,"sectionAccCharCounts");xe(this,"sectionIndex",-1);xe(this,"calculator");this.containerEl=e,this.sections=n,this.virtualScrollPos$=i,this.getWidth=o,this.getHeight=r,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=u;const h=c=>wn(c).reduce((b,S)=>b+$o(S),0);let k=0;this.sectionAccCharCounts=n.map(c=>(k+=h(c),k)),this.charCount=k}updateCurrentSection(e){this.calculator=new bi(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(e){if(e&&this.calculator)return this.getSectionStartCount()+this.calculator.getCharCountToPoint(e);const n=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+n)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const n=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+n}getSectionIndexByCharCount(e){return bn(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const n=this.getSectionStartCount(),i=this.sectionAccCharCounts[this.sectionIndex],o=e-n,r=e===i&&i-n>0;if(o<0||e>i||r)return-1;if(o===0)return 0;const a=bn(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,u=l[a];if(Number.isNaN(Number(s[a])))return-1;const h=(S,E)=>S>=E?E:l[S]>u?S:h(S+1,E),k=s[h(a+1,l.length-1)],{screenSize:c}=this,d=this.verticalMode?-1:0,b=c*(Math.ceil(k/c)+d);return At(b,this.calculator.direction)}checkBookmarkOnScreen(e){const n=this.getScrollPosByCharCount(e),i=this.virtualScrollPos$.getValue();return n===i&&this.calculator?{isBookmarkScreen:!0,...this.calculator.getBookMarkPosForSection(this.getSectionStartCount(),e)}:{isBookmarkScreen:n===i,bookmarkPos:void 0,node:void 0,isFirstNode:!0}}getOffsetToRange(e,n){if(!e)return 0;const i=e.getBoundingClientRect();if(this.verticalMode)return 1-i.left/this.screenSizeMirrored;const o=Math.floor(100/n),r=Math.floor(this.screenSize/n),a=o*i.bottom/this.screenSizeMirrored;let l=a,s=0;for(let u=0;u<this.screenSize&&i.right>=u;u+=r)l=s*o+a,s+=1;return l/100}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}get screenSizeMirrored(){return(this.verticalMode?this.getWidth():this.getHeight())+this.getPageGap()}}const{window:pl}=Wn;function wo(t){let e,n,i;return n=new lt({props:{icon:ai,spin:!0}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(o){e=x(o,"DIV",{class:!0});var r=$(e);ve(n.$$.fragment,r),r.forEach(R),this.h()},h(){Y(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),M(e,"color",t[4]),M(e,"background-color",t[5])},m(o,r){G(o,e,r),ye(n,e,null),i=!0},p(o,r){r[0]&16&&M(e,"color",o[4]),r[0]&32&&M(e,"background-color",o[5])},i(o){i||(j(n.$$.fragment,o),i=!0)},o(o){U(n.$$.fragment,o),i=!1},d(o){o&&R(e),Re(n)}}}function So(t){let e,n,i;return n=new lt({props:{icon:Yt}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(o){e=x(o,"DIV",{class:!0});var r=$(e);ve(n.$$.fragment,r),r.forEach(R),this.h()},h(){Y(e,"class","fixed h-3 w-3 text-base opacity-25 sm:text-xl"),M(e,"color",t[4]),M(e,"top",t[21]),M(e,"left",t[22]),M(e,"right",t[23])},m(o,r){G(o,e,r),ye(n,e,null),i=!0},p(o,r){r[0]&16&&M(e,"color",o[4]),r[0]&2097152&&M(e,"top",o[21]),r[0]&4194304&&M(e,"left",o[22]),r[0]&8388608&&M(e,"right",o[23])},i(o){i||(j(n.$$.fragment,o),i=!0)},o(o){U(n.$$.fragment,o),i=!1},d(o){o&&R(e),Re(n)}}}function kl(t){let e,n,i,o,r=`${t[10]}px`,a=`${t[1]}px`,l=`${t[2]}px`,s=`${t[3]?t[1]:(t[1]+Ot)/t[24]-Ot}px`,u,h,k,c,d,b;i=new mi({props:{html:t[20]}}),i.$on("load",t[26]);let S=!t[19]&&wo(t),E=t[0]&&So(t);return{c(){e=Z("div"),n=Z("div"),Pe(i.$$.fragment),u=ie(),S&&S.c(),h=ie(),E&&E.c(),k=zt(),this.h()},l(m){e=x(m,"DIV",{class:!0});var y=$(e);n=x(y,"DIV",{class:!0});var F=$(n);ve(i.$$.fragment,F),F.forEach(R),y.forEach(R),u=re(m),S&&S.l(m),h=re(m),E&&E.l(m),k=zt(),this.h()},h(){Y(n,"class","book-content-container svelte-u9j5ct"),Y(e,"class","book-content m-auto svelte-u9j5ct"),K(e,"book-content--avoid-page-break",t[15]),K(e,"book-content--writing-vertical-rl",t[3]),K(e,"book-content--writing-horizontal-rl",!t[3]),K(e,"book-content--hide-furigana",t[13]),K(e,"book-content--hide-spoiler-image",t[12]),K(e,"book-content--furigana-style-partial",t[14]===ot.Partial),K(e,"book-content--furigana-style-full",t[14]===ot.Full),K(e,"book-content--furigana-style-toggle",t[14]===ot.Toggle),M(e,"color",t[4]),M(e,"font-size",r),M(e,"line-height",t[11]),M(e,"padding-top",!t[3]&&t[16]?`${t[16]}px`:void 0),M(e,"padding-bottom",!t[3]&&t[16]?`${t[16]}px`:void 0),M(e,"padding-left",t[3]&&t[16]?`${t[16]}px`:void 0),M(e,"padding-right",t[3]&&t[16]?`${t[16]}px`:void 0),M(e,"max-width",t[1]?`${t[1]}px`:void 0),M(e,"max-height",t[3]&&t[2]?`${t[2]}px`:void 0),M(e,"--font-family-serif",t[8]),M(e,"--font-family-sans-serif",t[9]),M(e,"--book-content-hint-furigana-font-color",t[6]),M(e,"--book-content-hint-furigana-shadow-color",t[7]),M(e,"--book-content-child-width",a),M(e,"--book-content-child-height",l),M(e,"--book-content-child-column-width",!t[3]&&t[24]===1?`${t[1]}px`:""),M(e,"--book-content-column-count",t[24]),M(e,"--book-content-image-max-width",s)},m(m,y){G(m,e,y),ee(e,n),ye(i,n,null),t[44](n),t[45](e),G(m,u,y),S&&S.m(m,y),G(m,h,y),E&&E.m(m,y),G(m,k,y),c=!0,d||(b=[ge(pl,"keydown",t[28]),jn(o=hl.call(null,e,{timeframe:500,minSwipeDistance:t[25],touchAction:"pan-y"})),ge(e,"swipe",t[27])],d=!0)},p(m,y){const F={};y[0]&1048576&&(F.html=m[20]),i.$set(F),o&&Ko(o.update)&&y[0]&33554432&&o.update.call(null,{timeframe:500,minSwipeDistance:m[25],touchAction:"pan-y"}),(!c||y[0]&32768)&&K(e,"book-content--avoid-page-break",m[15]),(!c||y[0]&8)&&K(e,"book-content--writing-vertical-rl",m[3]),(!c||y[0]&8)&&K(e,"book-content--writing-horizontal-rl",!m[3]),(!c||y[0]&8192)&&K(e,"book-content--hide-furigana",m[13]),(!c||y[0]&4096)&&K(e,"book-content--hide-spoiler-image",m[12]),(!c||y[0]&16384)&&K(e,"book-content--furigana-style-partial",m[14]===ot.Partial),(!c||y[0]&16384)&&K(e,"book-content--furigana-style-full",m[14]===ot.Full),(!c||y[0]&16384)&&K(e,"book-content--furigana-style-toggle",m[14]===ot.Toggle),y[0]&16&&M(e,"color",m[4]),y[0]&1024&&r!==(r=`${m[10]}px`)&&M(e,"font-size",r),y[0]&2048&&M(e,"line-height",m[11]),y[0]&65544&&M(e,"padding-top",!m[3]&&m[16]?`${m[16]}px`:void 0),y[0]&65544&&M(e,"padding-bottom",!m[3]&&m[16]?`${m[16]}px`:void 0),y[0]&65544&&M(e,"padding-left",m[3]&&m[16]?`${m[16]}px`:void 0),y[0]&65544&&M(e,"padding-right",m[3]&&m[16]?`${m[16]}px`:void 0),y[0]&2&&M(e,"max-width",m[1]?`${m[1]}px`:void 0),y[0]&12&&M(e,"max-height",m[3]&&m[2]?`${m[2]}px`:void 0),y[0]&256&&M(e,"--font-family-serif",m[8]),y[0]&512&&M(e,"--font-family-sans-serif",m[9]),y[0]&64&&M(e,"--book-content-hint-furigana-font-color",m[6]),y[0]&128&&M(e,"--book-content-hint-furigana-shadow-color",m[7]),y[0]&2&&a!==(a=`${m[1]}px`)&&M(e,"--book-content-child-width",a),y[0]&4&&l!==(l=`${m[2]}px`)&&M(e,"--book-content-child-height",l),y[0]&16777226&&M(e,"--book-content-child-column-width",!m[3]&&m[24]===1?`${m[1]}px`:""),y[0]&16777216&&M(e,"--book-content-column-count",m[24]),y[0]&16777226&&s!==(s=`${m[3]?m[1]:(m[1]+Ot)/m[24]-Ot}px`)&&M(e,"--book-content-image-max-width",s),m[19]?S&&(it(),U(S,1,1,()=>{S=null}),rt()):S?(S.p(m,y),y[0]&524288&&j(S,1)):(S=wo(m),S.c(),j(S,1),S.m(h.parentNode,h)),m[0]?E?(E.p(m,y),y[0]&1&&j(E,1)):(E=So(m),E.c(),j(E,1),E.m(k.parentNode,k)):E&&(it(),U(E,1,1,()=>{E=null}),rt())},i(m){c||(j(i.$$.fragment,m),j(S),j(E),c=!0)},o(m){U(i.$$.fragment,m),U(S),U(E),c=!1},d(m){m&&R(e),Re(i),t[44](null),t[45](null),m&&R(u),S&&S.d(m),m&&R(h),E&&E.d(m),m&&R(k),d=!1,kt(b)}}}const Po="overflow-hidden",Ot=40;function bl(t,e,n){let i,o,r,a,l,s,u,h;W(t,qt,p=>n(50,o=p)),W(t,Lt,p=>n(51,r=p)),W(t,ni,p=>n(52,a=p)),W(t,qn,p=>n(53,l=p)),W(t,ei,p=>n(54,s=p)),W(t,oi,p=>n(55,u=p)),W(t,gr,p=>n(25,h=p));let{htmlContent:k}=e,{width:c}=e,{height:d}=e,{verticalMode:b}=e,{fontColor:S}=e,{backgroundColor:E}=e,{hintFuriganaFontColor:m}=e,{hintFuriganaShadowColor:y}=e,{fontFamilyGroupOne:F}=e,{fontFamilyGroupTwo:v}=e,{fontSize:B}=e,{lineHeight:D}=e,{hideSpoilerImage:X}=e,{hideFurigana:I}=e,{furiganaStyle:A}=e,{loadingState:V}=e,{bookmarkData:T}=e,{pageManager:N}=e,{bookmarkManager:w}=e,{exploredCharCount:L}=e,{bookCharCount:C}=e,{isBookmarkScreen:O=!1}=e,{avoidPageBreak:Q=!0}=e,{pageColumns:he}=e,{firstDimensionMargin:Se}=e,{autoBookmark:Me=!1}=e,{customReadingPointRange:be}=e,{showCustomReadingPoint:Oe}=e;const Ne=_n();let pe,ne,ue,me=[],J,Ke,ae,Ee=!1,Ge="",ke=!0,_=0,z=!1,De,q,Ie;const Ve=new et,Ye=new et,Ce=new dn(-1),Be=new et,Te=new dn(0),He=new et,Ue=new et,Fe=Ce.pipe(Xe(p=>{var le;return((le=me[p])==null?void 0:le.innerHTML)||""})),We=new et;Gn(()=>{document.body.classList.remove(Po),We.next(),We.complete()}),Jt([Ve,Ye]).pipe(mn(1),Vt(()=>Ue.pipe(Ht(1))),ct(We)).subscribe(()=>{if(!ue||!J)return;const p=ue.getScrollPosByCharCount(_);p<0||J.scrollTo(p,!1)}),Be.pipe(ct(We)).subscribe(p=>{var le;!ue||(n(34,Oe=!1),Xt((le=be==null?void 0:be.endContainer)==null?void 0:le.parentElement,"remove",1),n(29,be=void 0),n(32,L=ue.calcExploredCharCount(be)),p&&(_=L,u&&gi(window)),T.then(Qe))}),Me&&Be.pipe(Qt(3e3),ct(We)).subscribe(p=>{p&&Ne("bookmark")}),Fe.pipe(ci(),ct(We)).subscribe(()=>{n(19,Ee=!1)}),Fe.pipe(ct(We)).subscribe(p=>{const le=(oe,ft)=>{if(ft===0){oe();return}requestAnimationFrame(()=>le(oe,ft-1))};le(()=>{n(20,Ge=p)},2)}),It(()=>at(document.body,"wheel",{passive:!0})).pipe(Zt(()=>!s&&!o),Aa(50),ct(We)).subscribe(p=>{if(!r){let le=(p.deltaX<0?-1:1)*(b?-1:1);p.deltaX||(le=p.deltaY<0?-1:1),J==null||J.flipPage(le)}});function dt(p){!ue||(n(32,L=ue.calcExploredCharCount(p)),_=L,st(p))}function st(p){!J||!ue||J.updateSectionDataByOffset(ue.getOffsetToRange(p,i))}function tt(){if(ke){ke=!1;return}!pe||(n(40,ue=new gl(pe,me,Te,()=>c,()=>d,()=>Ot,b,pe,document)),n(32,L=0),_=0,n(33,C=ue.charCount),ue.updateCurrentSection(Ce.getValue()),Ne("contentChange",pe))}function Je(p){p.updateParagraphPos(),n(32,L=p.calcExploredCharCount(be)),Ue.next(p),T.then(Qe),ae&&(ae=!1,T.then(le=>{!le||!w||(n(32,L=le.exploredCharCount||0),w.scrollToBookmark(le))})),n(19,Ee=!0)}function Qe(p){const le=p==null?void 0:p.exploredCharCount;if(!ue||!le)return;const oe=ue.checkBookmarkOnScreen(le);if(pe&&oe.isBookmarkScreen){const ft=Number(getComputedStyle(pe)[b?"marginTop":"marginRight"].replace(/px$/,""));oe.bookmarkPos?b?(n(21,De=ft?`${ft}px`:"0.5rem"),n(22,q=`${oe.bookmarkPos.left}px`),n(23,Ie=void 0)):(n(21,De=`${oe.bookmarkPos.top}px`),n(23,Ie=void 0),n(22,q=oe.bookmarkPos.left>0?`calc(${oe.bookmarkPos.left}px - ${l?"15":"20"}px)`:`calc(${Math.max(l?15:20,ft)}px)`)):ut(ft)}else ut(0);oe.isBookmarkScreen&&p.exploredCharCount&&(oe.node&&!z&&!oe.isFirstNode?st(Un(oe.node)):oe.isFirstNode&&st(void 0),n(32,L=z?L:p.exploredCharCount),_=L,z=!0),n(0,O=oe.isBookmarkScreen)}function ut(p){b?(n(21,De=p?`${p}px`:"0.5rem"),n(22,q=a?`${c-a}px`:void 0),n(23,Ie=a?void 0:"0.75rem")):(n(21,De=a?`${a}px`:"0.5rem"),n(22,q=p?`calc(${p}px + 0.75rem)`:"0.75rem"),n(23,Ie=void 0))}function P(p){if(!J||r||o||p.detail.direction!=="left"&&p.detail.direction!=="right")return;const le=p.detail.direction==="left",oe=b?!le:le;J.flipPage(oe?1:-1)}function de(p){if(!(!J||r||o))switch(p.code){case"ArrowLeft":J[b?"nextPage":"prevPage"]();break;case"ArrowRight":J[b?"prevPage":"nextPage"]();break;case"ArrowUp":J.prevPage();break;case"ArrowDown":J.nextPage();break}}nn.pipe(ct(We)).subscribe(p=>{const le=me.findIndex(oe=>oe.id===p||oe.querySelector(`[id="${p}"]`));le>-1&&(Ce.next(le),J==null||J.scrollTo(0,!0))});function Le(p){te[p?"unshift":"push"](()=>{ne=p,n(18,ne)})}function Ae(p){te[p?"unshift":"push"](()=>{pe=p,n(17,pe)})}return t.$$set=p=>{"htmlContent"in p&&n(35,k=p.htmlContent),"width"in p&&n(1,c=p.width),"height"in p&&n(2,d=p.height),"verticalMode"in p&&n(3,b=p.verticalMode),"fontColor"in p&&n(4,S=p.fontColor),"backgroundColor"in p&&n(5,E=p.backgroundColor),"hintFuriganaFontColor"in p&&n(6,m=p.hintFuriganaFontColor),"hintFuriganaShadowColor"in p&&n(7,y=p.hintFuriganaShadowColor),"fontFamilyGroupOne"in p&&n(8,F=p.fontFamilyGroupOne),"fontFamilyGroupTwo"in p&&n(9,v=p.fontFamilyGroupTwo),"fontSize"in p&&n(10,B=p.fontSize),"lineHeight"in p&&n(11,D=p.lineHeight),"hideSpoilerImage"in p&&n(12,X=p.hideSpoilerImage),"hideFurigana"in p&&n(13,I=p.hideFurigana),"furiganaStyle"in p&&n(14,A=p.furiganaStyle),"loadingState"in p&&n(36,V=p.loadingState),"bookmarkData"in p&&n(37,T=p.bookmarkData),"pageManager"in p&&n(30,N=p.pageManager),"bookmarkManager"in p&&n(31,w=p.bookmarkManager),"exploredCharCount"in p&&n(32,L=p.exploredCharCount),"bookCharCount"in p&&n(33,C=p.bookCharCount),"isBookmarkScreen"in p&&n(0,O=p.isBookmarkScreen),"avoidPageBreak"in p&&n(15,Q=p.avoidPageBreak),"pageColumns"in p&&n(38,he=p.pageColumns),"firstDimensionMargin"in p&&n(16,Se=p.firstDimensionMargin),"autoBookmark"in p&&n(39,Me=p.autoBookmark),"customReadingPointRange"in p&&n(29,be=p.customReadingPointRange),"showCustomReadingPoint"in p&&n(34,Oe=p.showCustomReadingPoint)},t.$$.update=()=>{if(t.$$.dirty[1]&64&&T.then(p=>{z=!1,Qe(p)}),t.$$.dirty[0]&2&&c&&Ve.next(c),t.$$.dirty[0]&4&&d&&Ye.next(d),t.$$.dirty[0]&10|t.$$.dirty[1]&128&&n(24,i=b?1:he||Math.ceil(c/1e3)),t.$$.dirty[1]&16&&k&&(ae=!0),t.$$.dirty[1]&16){const p=document.createElement("div");p.innerHTML=k,n(41,me=Array.from(p.children)),Ce.next(0)}if(t.$$.dirty[0]&393230|t.$$.dirty[1]&3072&&ne&&pe&&me&&(n(42,J=new ml(ne,pe,me,Ce,Te,c,d,Ot,b,Be,He)),n(30,N=J)),t.$$.dirty[0]&6|t.$$.dirty[1]&544&&ue&&c&&d&&!V){const p=ue;requestAnimationFrame(()=>{Je(p)})}t.$$.dirty[1]&544&&ue&&!V&&He.next(Ce.getValue()),t.$$.dirty[1]&6656&&ue&&J&&(n(43,Ke=new dl(ue,J,Ue,Ce,p=>_=p)),n(31,w=Ke)),t.$$.dirty[0]&536870912&&dt(be)},document.body.classList.add(Po),[O,c,d,b,S,E,m,y,F,v,B,D,X,I,A,Q,Se,pe,ne,Ee,Ge,De,q,Ie,i,h,tt,P,de,be,N,w,L,C,Oe,k,V,T,he,Me,ue,me,J,Ke,Le,Ae]}class Cl extends yt{constructor(e){super(),Rt(this,e,bl,kl,Mt,{htmlContent:35,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,fontSize:10,lineHeight:11,hideSpoilerImage:12,hideFurigana:13,furiganaStyle:14,loadingState:36,bookmarkData:37,pageManager:30,bookmarkManager:31,exploredCharCount:32,bookCharCount:33,isBookmarkScreen:0,avoidPageBreak:15,pageColumns:38,firstDimensionMargin:16,autoBookmark:39,customReadingPointRange:29,showCustomReadingPoint:34},null,[-1,-1,-1])}}function _l(t){let e,n,i,o,r,a,l,s,u,h;function k(v){t[59](v)}function c(v){t[60](v)}function d(v){t[61](v)}function b(v){t[62](v)}function S(v){t[63](v)}function E(v){t[64](v)}function m(v){t[65](v)}function y(v){t[66](v)}let F={htmlContent:t[13],width:t[35]??0,height:t[36]??0,verticalMode:t[14],fontColor:t[15],backgroundColor:t[16],hintFuriganaFontColor:t[17],hintFuriganaShadowColor:t[18],fontFamilyGroupOne:t[19],fontFamilyGroupTwo:t[20],fontSize:t[21],lineHeight:t[22],hideSpoilerImage:t[23],hideFurigana:t[24],furiganaStyle:t[25],loadingState:t[37]??!0,avoidPageBreak:t[29],pageColumns:t[30],autoBookmark:t[31],firstDimensionMargin:t[27]};return t[0]!==void 0&&(F.exploredCharCount=t[0]),t[1]!==void 0&&(F.bookCharCount=t[1]),t[6]!==void 0&&(F.isBookmarkScreen=t[6]),t[2]!==void 0&&(F.bookmarkData=t[2]),t[4]!==void 0&&(F.bookmarkManager=t[4]),t[5]!==void 0&&(F.pageManager=t[5]),t[11]!==void 0&&(F.customReadingPointRange=t[11]),t[12]!==void 0&&(F.showCustomReadingPoint=t[12]),e=new Cl({props:F}),te.push(()=>fe(e,"exploredCharCount",k,t[0])),te.push(()=>fe(e,"bookCharCount",c,t[1])),te.push(()=>fe(e,"isBookmarkScreen",d,t[6])),te.push(()=>fe(e,"bookmarkData",b,t[2])),te.push(()=>fe(e,"bookmarkManager",S,t[4])),te.push(()=>fe(e,"pageManager",E,t[5])),te.push(()=>fe(e,"customReadingPointRange",m,t[11])),te.push(()=>fe(e,"showCustomReadingPoint",y,t[12])),e.$on("contentChange",t[67]),e.$on("bookmark",t[68]),{c(){Pe(e.$$.fragment)},l(v){ve(e.$$.fragment,v)},m(v,B){ye(e,v,B),h=!0},p(v,B){const D={};B[0]&8192&&(D.htmlContent=v[13]),B[1]&16&&(D.width=v[35]??0),B[1]&32&&(D.height=v[36]??0),B[0]&16384&&(D.verticalMode=v[14]),B[0]&32768&&(D.fontColor=v[15]),B[0]&65536&&(D.backgroundColor=v[16]),B[0]&131072&&(D.hintFuriganaFontColor=v[17]),B[0]&262144&&(D.hintFuriganaShadowColor=v[18]),B[0]&524288&&(D.fontFamilyGroupOne=v[19]),B[0]&1048576&&(D.fontFamilyGroupTwo=v[20]),B[0]&2097152&&(D.fontSize=v[21]),B[0]&4194304&&(D.lineHeight=v[22]),B[0]&8388608&&(D.hideSpoilerImage=v[23]),B[0]&16777216&&(D.hideFurigana=v[24]),B[0]&33554432&&(D.furiganaStyle=v[25]),B[1]&64&&(D.loadingState=v[37]??!0),B[0]&536870912&&(D.avoidPageBreak=v[29]),B[0]&1073741824&&(D.pageColumns=v[30]),B[1]&1&&(D.autoBookmark=v[31]),B[0]&134217728&&(D.firstDimensionMargin=v[27]),!n&&B[0]&1&&(n=!0,D.exploredCharCount=v[0],ce(()=>n=!1)),!i&&B[0]&2&&(i=!0,D.bookCharCount=v[1],ce(()=>i=!1)),!o&&B[0]&64&&(o=!0,D.isBookmarkScreen=v[6],ce(()=>o=!1)),!r&&B[0]&4&&(r=!0,D.bookmarkData=v[2],ce(()=>r=!1)),!a&&B[0]&16&&(a=!0,D.bookmarkManager=v[4],ce(()=>a=!1)),!l&&B[0]&32&&(l=!0,D.pageManager=v[5],ce(()=>l=!1)),!s&&B[0]&2048&&(s=!0,D.customReadingPointRange=v[11],ce(()=>s=!1)),!u&&B[0]&4096&&(u=!0,D.showCustomReadingPoint=v[12],ce(()=>u=!1)),e.$set(D)},i(v){h||(j(e.$$.fragment,v),h=!0)},o(v){U(e.$$.fragment,v),h=!1},d(v){Re(e,v)}}}function wl(t){let e,n,i,o,r,a,l,s,u,h,k,c;function d(I){t[47](I)}function b(I){t[48](I)}function S(I){t[49](I)}function E(I){t[50](I)}function m(I){t[51](I)}function y(I){t[52](I)}function F(I){t[53](I)}function v(I){t[54](I)}function B(I){t[55](I)}function D(I){t[56](I)}let X={htmlContent:t[13],width:t[35]??0,height:t[36]??0,verticalMode:t[14],fontColor:t[15],backgroundColor:t[16],hintFuriganaFontColor:t[17],hintFuriganaShadowColor:t[18],fontFamilyGroupOne:t[19],fontFamilyGroupTwo:t[20],fontSize:t[21],lineHeight:t[22],hideSpoilerImage:t[23],hideFurigana:t[24],furiganaStyle:t[25],secondDimensionMaxValue:t[26],firstDimensionMargin:t[27],autoPositionOnResize:t[28],autoBookmark:t[31],multiplier:t[33],loadingState:t[37]??!0};return t[0]!==void 0&&(X.exploredCharCount=t[0]),t[1]!==void 0&&(X.bookCharCount=t[1]),t[2]!==void 0&&(X.bookmarkData=t[2]),t[3]!==void 0&&(X.autoScroller=t[3]),t[4]!==void 0&&(X.bookmarkManager=t[4]),t[5]!==void 0&&(X.pageManager=t[5]),t[7]!==void 0&&(X.customReadingPoint=t[7]),t[8]!==void 0&&(X.customReadingPointTop=t[8]),t[9]!==void 0&&(X.customReadingPointLeft=t[9]),t[10]!==void 0&&(X.customReadingPointScrollOffset=t[10]),e=new el({props:X}),te.push(()=>fe(e,"exploredCharCount",d,t[0])),te.push(()=>fe(e,"bookCharCount",b,t[1])),te.push(()=>fe(e,"bookmarkData",S,t[2])),te.push(()=>fe(e,"autoScroller",E,t[3])),te.push(()=>fe(e,"bookmarkManager",m,t[4])),te.push(()=>fe(e,"pageManager",y,t[5])),te.push(()=>fe(e,"customReadingPoint",F,t[7])),te.push(()=>fe(e,"customReadingPointTop",v,t[8])),te.push(()=>fe(e,"customReadingPointLeft",B,t[9])),te.push(()=>fe(e,"customReadingPointScrollOffset",D,t[10])),e.$on("contentChange",t[57]),e.$on("bookmark",t[58]),{c(){Pe(e.$$.fragment)},l(I){ve(e.$$.fragment,I)},m(I,A){ye(e,I,A),c=!0},p(I,A){const V={};A[0]&8192&&(V.htmlContent=I[13]),A[1]&16&&(V.width=I[35]??0),A[1]&32&&(V.height=I[36]??0),A[0]&16384&&(V.verticalMode=I[14]),A[0]&32768&&(V.fontColor=I[15]),A[0]&65536&&(V.backgroundColor=I[16]),A[0]&131072&&(V.hintFuriganaFontColor=I[17]),A[0]&262144&&(V.hintFuriganaShadowColor=I[18]),A[0]&524288&&(V.fontFamilyGroupOne=I[19]),A[0]&1048576&&(V.fontFamilyGroupTwo=I[20]),A[0]&2097152&&(V.fontSize=I[21]),A[0]&4194304&&(V.lineHeight=I[22]),A[0]&8388608&&(V.hideSpoilerImage=I[23]),A[0]&16777216&&(V.hideFurigana=I[24]),A[0]&33554432&&(V.furiganaStyle=I[25]),A[0]&67108864&&(V.secondDimensionMaxValue=I[26]),A[0]&134217728&&(V.firstDimensionMargin=I[27]),A[0]&268435456&&(V.autoPositionOnResize=I[28]),A[1]&1&&(V.autoBookmark=I[31]),A[1]&4&&(V.multiplier=I[33]),A[1]&64&&(V.loadingState=I[37]??!0),!n&&A[0]&1&&(n=!0,V.exploredCharCount=I[0],ce(()=>n=!1)),!i&&A[0]&2&&(i=!0,V.bookCharCount=I[1],ce(()=>i=!1)),!o&&A[0]&4&&(o=!0,V.bookmarkData=I[2],ce(()=>o=!1)),!r&&A[0]&8&&(r=!0,V.autoScroller=I[3],ce(()=>r=!1)),!a&&A[0]&16&&(a=!0,V.bookmarkManager=I[4],ce(()=>a=!1)),!l&&A[0]&32&&(l=!0,V.pageManager=I[5],ce(()=>l=!1)),!s&&A[0]&128&&(s=!0,V.customReadingPoint=I[7],ce(()=>s=!1)),!u&&A[0]&256&&(u=!0,V.customReadingPointTop=I[8],ce(()=>u=!1)),!h&&A[0]&512&&(h=!0,V.customReadingPointLeft=I[9],ce(()=>h=!1)),!k&&A[0]&1024&&(k=!0,V.customReadingPointScrollOffset=I[10],ce(()=>k=!1)),e.$set(V)},i(I){c||(j(e.$$.fragment,I),c=!0)},o(I){U(e.$$.fragment,I),c=!1},d(I){Re(e,I)}}}function Sl(t){let e,n,i,o,r=(t[38]??"")+"",a,l;const s=[wl,_l],u=[];function h(k,c){return k[32]===Dt.Continuous?0:1}return n=h(t),i=u[n]=s[n](t),{c(){e=Z("div"),i.c(),o=ie(),a=_e(r),this.h()},l(k){e=x(k,"DIV",{class:!0});var c=$(e);i.l(c),c.forEach(R),o=re(k),a=we(k,r),this.h()},h(){Y(e,"class",tl+" py-8")},m(k,c){G(k,e,c),u[n].m(e,null),t[69](e),G(k,o,c),G(k,a,c),l=!0},p(k,c){let d=n;n=h(k),n===d?u[n].p(k,c):(it(),U(u[d],1,1,()=>{u[d]=null}),rt(),i=u[n],i?i.p(k,c):(i=u[n]=s[n](k),i.c()),j(i,1),i.m(e,null)),(!l||c[1]&128)&&r!==(r=(k[38]??"")+"")&&qe(a,r)},i(k){l||(j(i),l=!0)},o(k){U(i),l=!1},d(k){k&&R(e),u[n].d(),t[69](null),k&&R(o),k&&R(a)}}}function un(t){return Number(t.replace(/px$/,""))}function Pl(t,e,n){let i,o,r,a,l,s,{htmlContent:u}=e,{width:h}=e,{height:k}=e,{verticalMode:c}=e,{fontColor:d}=e,{backgroundColor:b}=e,{hintFuriganaFontColor:S}=e,{hintFuriganaShadowColor:E}=e,{fontFamilyGroupOne:m}=e,{fontFamilyGroupTwo:y}=e,{fontSize:F}=e,{lineHeight:v}=e,{hideSpoilerImage:B}=e,{hideFurigana:D}=e,{furiganaStyle:X}=e,{secondDimensionMaxValue:I}=e,{firstDimensionMargin:A}=e,{autoPositionOnResize:V}=e,{avoidPageBreak:T}=e,{pageColumns:N}=e,{autoBookmark:w}=e,{viewMode:L}=e,{exploredCharCount:C}=e,{bookCharCount:O}=e,{multiplier:Q}=e,{bookmarkData:he}=e,{autoScroller:Se}=e,{bookmarkManager:Me}=e,{pageManager:be}=e,{isBookmarkScreen:Oe}=e,{customReadingPoint:Ne}=e,{customReadingPointTop:pe}=e,{customReadingPointLeft:ne}=e,{customReadingPointScrollOffset:ue}=e,{customReadingPointRange:me}=e,{showCustomReadingPoint:J}=e;const Ke=new et,ae=new et,Ee=pr(null);W(t,Ee,g=>n(34,o=g));const Ge=Jt([Ee.pipe(Zt(g=>!!g)),Jt([Ke,ae]).pipe(Vn(0))]).pipe(Qt(0,Pn),Xe(([g])=>getComputedStyle(g)),Ln({refCount:!0,bufferSize:1})),ke=new kr(1),_=Ge.pipe(Xe(g=>Ie(h-un(g.paddingLeft)-un(g.paddingRight))));W(t,_,g=>n(35,r=g));const z=Ge.pipe(Xe(g=>Ve(k-un(g.paddingTop)-un(g.paddingBottom)-i)));W(t,z,g=>n(36,a=g));const De=It(()=>Kn(document)).pipe(cn(g=>{const rn=il(g,X);return ke.pipe(cn(an=>rn(an)))}),Pt());W(t,De,g=>n(38,s=g));const q=ke.pipe(cn(g=>nl(g)),zn());W(t,q,g=>n(37,l=g));function Ie(g){return Dt.Paginated===L&&!c&&I?Math.min(I,g):g}function Ve(g){return Dt.Paginated===L&&c&&I?Math.min(I,g):g}function Ye(g){C=g,n(0,C)}function Ce(g){O=g,n(1,O)}function Be(g){he=g,n(2,he)}function Te(g){Se=g,n(3,Se)}function He(g){Me=g,n(4,Me)}function Ue(g){be=g,n(5,be)}function Fe(g){Ne=g,n(7,Ne)}function We(g){pe=g,n(8,pe)}function dt(g){ne=g,n(9,ne)}function st(g){ue=g,n(10,ue)}const tt=g=>ke.next(g.detail);function Je(g){io.call(this,t,g)}function Qe(g){C=g,n(0,C)}function ut(g){O=g,n(1,O)}function P(g){Oe=g,n(6,Oe)}function de(g){he=g,n(2,he)}function Le(g){Me=g,n(4,Me)}function Ae(g){be=g,n(5,be)}function p(g){me=g,n(11,me)}function le(g){J=g,n(12,J)}const oe=g=>ke.next(g.detail);function ft(g){io.call(this,t,g)}function on(g){te[g?"unshift":"push"](()=>{o=g,Ee.set(o)})}return t.$$set=g=>{"htmlContent"in g&&n(13,u=g.htmlContent),"width"in g&&n(45,h=g.width),"height"in g&&n(46,k=g.height),"verticalMode"in g&&n(14,c=g.verticalMode),"fontColor"in g&&n(15,d=g.fontColor),"backgroundColor"in g&&n(16,b=g.backgroundColor),"hintFuriganaFontColor"in g&&n(17,S=g.hintFuriganaFontColor),"hintFuriganaShadowColor"in g&&n(18,E=g.hintFuriganaShadowColor),"fontFamilyGroupOne"in g&&n(19,m=g.fontFamilyGroupOne),"fontFamilyGroupTwo"in g&&n(20,y=g.fontFamilyGroupTwo),"fontSize"in g&&n(21,F=g.fontSize),"lineHeight"in g&&n(22,v=g.lineHeight),"hideSpoilerImage"in g&&n(23,B=g.hideSpoilerImage),"hideFurigana"in g&&n(24,D=g.hideFurigana),"furiganaStyle"in g&&n(25,X=g.furiganaStyle),"secondDimensionMaxValue"in g&&n(26,I=g.secondDimensionMaxValue),"firstDimensionMargin"in g&&n(27,A=g.firstDimensionMargin),"autoPositionOnResize"in g&&n(28,V=g.autoPositionOnResize),"avoidPageBreak"in g&&n(29,T=g.avoidPageBreak),"pageColumns"in g&&n(30,N=g.pageColumns),"autoBookmark"in g&&n(31,w=g.autoBookmark),"viewMode"in g&&n(32,L=g.viewMode),"exploredCharCount"in g&&n(0,C=g.exploredCharCount),"bookCharCount"in g&&n(1,O=g.bookCharCount),"multiplier"in g&&n(33,Q=g.multiplier),"bookmarkData"in g&&n(2,he=g.bookmarkData),"autoScroller"in g&&n(3,Se=g.autoScroller),"bookmarkManager"in g&&n(4,Me=g.bookmarkManager),"pageManager"in g&&n(5,be=g.pageManager),"isBookmarkScreen"in g&&n(6,Oe=g.isBookmarkScreen),"customReadingPoint"in g&&n(7,Ne=g.customReadingPoint),"customReadingPointTop"in g&&n(8,pe=g.customReadingPointTop),"customReadingPointLeft"in g&&n(9,ne=g.customReadingPointLeft),"customReadingPointScrollOffset"in g&&n(10,ue=g.customReadingPointScrollOffset),"customReadingPointRange"in g&&n(11,me=g.customReadingPointRange),"showCustomReadingPoint"in g&&n(12,J=g.showCustomReadingPoint)},t.$$.update=()=>{t.$$.dirty[0]&134234112|t.$$.dirty[1]&2&&(i=A&&Dt.Paginated===L&&!c?A*2:0),t.$$.dirty[1]&16384&&Ke.next(h),t.$$.dirty[1]&32768&&ae.next(k)},[C,O,he,Se,Me,be,Oe,Ne,pe,ne,ue,me,J,u,c,d,b,S,E,m,y,F,v,B,D,X,I,A,V,T,N,w,L,Q,o,r,a,l,s,Ee,ke,_,z,De,q,h,k,Ye,Ce,Be,Te,He,Ue,Fe,We,dt,st,tt,Je,Qe,ut,P,de,Le,Ae,p,le,oe,ft,on]}class vl extends yt{constructor(e){super(),Rt(this,e,Pl,Sl,Mt,{htmlContent:13,width:45,height:46,verticalMode:14,fontColor:15,backgroundColor:16,hintFuriganaFontColor:17,hintFuriganaShadowColor:18,fontFamilyGroupOne:19,fontFamilyGroupTwo:20,fontSize:21,lineHeight:22,hideSpoilerImage:23,hideFurigana:24,furiganaStyle:25,secondDimensionMaxValue:26,firstDimensionMargin:27,autoPositionOnResize:28,avoidPageBreak:29,pageColumns:30,autoBookmark:31,viewMode:32,exploredCharCount:0,bookCharCount:1,multiplier:33,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6,customReadingPoint:7,customReadingPointTop:8,customReadingPointLeft:9,customReadingPointScrollOffset:10,customReadingPointRange:11,showCustomReadingPoint:12},null,[-1,-1,-1])}}function yl(t,e){const n=document.createTextNode(e);if(t.firstChild){t.replaceChild(n,t.firstChild);return}t.appendChild(n)}function Rl(t,e,n){let{styleSheet:i}=e,o;return Yo(()=>{n(1,o=document.createElement("style")),document.head.appendChild(o)}),Gn(()=>{o&&document.head.removeChild(o)}),t.$$set=r=>{"styleSheet"in r&&n(0,i=r.styleSheet)},t.$$.update=()=>{t.$$.dirty&3&&o&&yl(o,i)},[i,o]}class Ml extends yt{constructor(e){super(),Rt(this,e,Rl,null,Mt,{styleSheet:0})}}function vo(t,e,n){const i=t.slice();return i[19]=e[n],i}function yo(t){let e,n,i,o,r;return n=new lt({props:{icon:Qr}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(a){e=x(a,"DIV",{role:!0,class:!0});var l=$(e);ve(n.$$.fragment,l),l.forEach(R),this.h()},h(){Y(e,"role","button"),Y(e,"class",Sn)},m(a,l){G(a,e,l),ye(n,e,null),i=!0,o||(r=[ge(e,"click",t[13]),ge(e,"keyup",pt)],o=!0)},p:vt,i(a){i||(j(n.$$.fragment,a),i=!0)},o(a){U(n.$$.fragment,a),i=!1},d(a){a&&R(e),Re(n),o=!1,kt(r)}}}function Ro(t){let e,n,i;return{c(){e=Z("div"),n=_e(t[1]),i=_e("x"),this.h()},l(o){e=x(o,"DIV",{class:!0});var r=$(e);n=we(r,t[1]),i=we(r,"x"),r.forEach(R),this.h()},h(){Y(e,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg")},m(o,r){G(o,e,r),ee(e,n),ee(e,i)},p(o,r){r&2&&qe(n,o[1])},d(o){o&&R(e)}}}function Mo(t){let e,n,i,o={placement:"bottom",fallbackPlacements:["bottom-end","bottom-start"],yOffset:0,$$slots:{content:[Dl],icon:[El]},$$scope:{ctx:t}};return n=new sa({props:o}),t[16](n),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(r){e=x(r,"DIV",{class:!0});var a=$(e);ve(n.$$.fragment,a),a.forEach(R),this.h()},h(){Y(e,"class","flex")},m(r,a){G(r,e,a),ye(n,e,null),i=!0},p(r,a){const l={};a&4194304&&(l.$$scope={dirty:a,ctx:r}),n.$set(l)},i(r){i||(j(n.$$.fragment,r),i=!0)},o(r){U(n.$$.fragment,r),i=!1},d(r){r&&R(e),t[16](null),Re(n)}}}function El(t){let e,n,i;return n=new lt({props:{icon:xr}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(o){e=x(o,"DIV",{slot:!0,class:!0});var r=$(e);ve(n.$$.fragment,r),r.forEach(R),this.h()},h(){Y(e,"slot","icon"),Y(e,"class",Sn)},m(o,r){G(o,e,r),ye(n,e,null),i=!0},p:vt,i(o){i||(j(n.$$.fragment,o),i=!0)},o(o){U(n.$$.fragment,o),i=!1},d(o){o&&R(e),Re(n)}}}function Eo(t,e){let n,i=e[19].label+"",o,r,a,l;function s(){return e[15](e[19])}return{key:t,first:null,c(){n=Z("div"),o=_e(i),r=ie(),this.h()},l(u){n=x(u,"DIV",{role:!0,class:!0});var h=$(n);o=we(h,i),r=re(h),h.forEach(R),this.h()},h(){Y(n,"role","button"),Y(n,"class","px-4 py-2 text-sm hover:bg-white hover:text-gray-700"),this.first=n},m(u,h){G(u,n,h),ee(n,o),ee(n,r),a||(l=[ge(n,"click",s),ge(n,"keyup",pt)],a=!0)},p(u,h){e=u},d(u){u&&R(n),a=!1,kt(l)}}}function Dl(t){let e,n=[],i=new Map,o=t[10];const r=a=>a[19].label;for(let a=0;a<o.length;a+=1){let l=vo(t,o,a),s=r(l);i.set(s,n[a]=Eo(s,l))}return{c(){e=Z("div");for(let a=0;a<n.length;a+=1)n[a].c();this.h()},l(a){e=x(a,"DIV",{class:!0,slot:!0});var l=$(e);for(let s=0;s<n.length;s+=1)n[s].l(l);l.forEach(R),this.h()},h(){Y(e,"class","w-40 bg-gray-700 md:w-32"),Y(e,"slot","content")},m(a,l){G(a,e,l);for(let s=0;s<n.length;s+=1)n[s].m(e,null)},p(a,l){l&3072&&(o=a[10],n=Uo(n,l,r,1,a,o,i,e,Jo,Eo,null,vo))},d(a){a&&R(e);for(let l=0;l<n.length;l+=1)n[l].d()}}}function Do(t){let e,n,i,o,r;return n=new lt({props:{icon:Zr}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(a){e=x(a,"DIV",{role:!0,class:!0});var l=$(e);ve(n.$$.fragment,l),l.forEach(R),this.h()},h(){Y(e,"role","button"),Y(e,"class",Sn)},m(a,l){G(a,e,l),ye(n,e,null),i=!0,o||(r=[ge(e,"click",t[17]),ge(e,"keyup",pt)],o=!0)},p:vt,i(a){i||(j(n.$$.fragment,a),i=!0)},o(a){U(n.$$.fragment,a),i=!1},d(a){a&&R(e),Re(n),o=!1,kt(r)}}}function Bl(t){let e,n,i,o,r,a,l,s,u,h,k,c,d,b,S=t[0]&&yo(t);r=new lt({props:{icon:t[3]?Yt:ho}});let E=!t[6]&&Ro(t),m=(t[7]||t[8]===Dt.Paginated)&&Mo(t),y=t[2]&&Do(t);return k=new la({props:{disableRouteNavigation:!0,items:t[5]?[je.SETTINGS,je.DOMAIN_HINT,je.MANAGE]:[je.SETTINGS,je.MANAGE]}}),k.$on("action",t[18]),{c(){e=Z("div"),n=Z("div"),S&&S.c(),i=ie(),o=Z("div"),Pe(r.$$.fragment),a=ie(),E&&E.c(),l=ie(),s=Z("div"),m&&m.c(),u=ie(),y&&y.c(),h=ie(),Pe(k.$$.fragment),this.h()},l(F){e=x(F,"DIV",{class:!0});var v=$(e);n=x(v,"DIV",{class:!0});var B=$(n);S&&S.l(B),i=re(B),o=x(B,"DIV",{role:!0,class:!0});var D=$(o);ve(r.$$.fragment,D),D.forEach(R),a=re(B),E&&E.l(B),B.forEach(R),l=re(v),s=x(v,"DIV",{class:!0});var X=$(s);m&&m.l(X),u=re(X),y&&y.l(X),h=re(X),ve(k.$$.fragment,X),X.forEach(R),v.forEach(R),this.h()},h(){Y(o,"role","button"),Y(o,"class",Sn),Y(n,"class","flex transform-gpu "+br),Y(s,"class","flex transform-gpu "+Cr),Y(e,"class","flex justify-between bg-gray-700 px-4 md:px-8 "+_r)},m(F,v){G(F,e,v),ee(e,n),S&&S.m(n,null),ee(n,i),ee(n,o),ye(r,o,null),ee(n,a),E&&E.m(n,null),ee(e,l),ee(e,s),m&&m.m(s,null),ee(s,u),y&&y.m(s,null),ee(s,h),ye(k,s,null),c=!0,d||(b=[ge(o,"click",t[14]),ge(o,"keyup",pt)],d=!0)},p(F,[v]){F[0]?S?(S.p(F,v),v&1&&j(S,1)):(S=yo(F),S.c(),j(S,1),S.m(n,i)):S&&(it(),U(S,1,1,()=>{S=null}),rt());const B={};v&8&&(B.icon=F[3]?Yt:ho),r.$set(B),F[6]?E&&(E.d(1),E=null):E?E.p(F,v):(E=Ro(F),E.c(),E.m(n,null)),F[7]||F[8]===Dt.Paginated?m?(m.p(F,v),v&384&&j(m,1)):(m=Mo(F),m.c(),j(m,1),m.m(s,u)):m&&(it(),U(m,1,1,()=>{m=null}),rt()),F[2]?y?(y.p(F,v),v&4&&j(y,1)):(y=Do(F),y.c(),j(y,1),y.m(s,h)):y&&(it(),U(y,1,1,()=>{y=null}),rt());const D={};v&32&&(D.items=F[5]?[je.SETTINGS,je.DOMAIN_HINT,je.MANAGE]:[je.SETTINGS,je.MANAGE]),k.$set(D)},i(F){c||(j(S),j(r.$$.fragment,F),j(m),j(y),j(k.$$.fragment,F),c=!0)},o(F){U(S),U(r.$$.fragment,F),U(m),U(y),U(k.$$.fragment,F),c=!1},d(F){F&&R(e),S&&S.d(),Re(r),E&&E.d(),m&&m.d(),y&&y.d(),Re(k),d=!1,kt(b)}}}function Tl(t,e,n){let i,o,r,a;W(t,qn,D=>n(6,o=D)),W(t,Xn,D=>n(7,r=D)),W(t,ii,D=>n(8,a=D));let{hasChapterData:l}=e,{autoScrollMultiplier:s}=e,{hasCustomReadingPoint:u}=e,{showFullscreenButton:h}=e,{isBookmarkScreen:k}=e;const c=_n(),d=[...u?[{label:"Show Point",action:"showCustomReadingPoint"}]:[],{label:"Set Point",action:"setCustomReadingPoint"},...u?[{label:"Reset Point",action:"resetCustomReadingPoint"}]:[]];let b;function S(D){c(D),b.toggleOpen()}const E=()=>c("tocClick"),m=()=>c("bookmarkClick"),y=D=>S(D.action);function F(D){te[D?"unshift":"push"](()=>{b=D,n(4,b)})}const v=()=>c("fullscreenClick"),B=({detail:D})=>{D===je.SETTINGS.label?c("settingsClick"):D===je.DOMAIN_HINT.label?c("domainHintClick"):D===je.MANAGE.label&&c("bookManagerClick")};return t.$$set=D=>{"hasChapterData"in D&&n(0,l=D.hasChapterData),"autoScrollMultiplier"in D&&n(1,s=D.autoScrollMultiplier),"hasCustomReadingPoint"in D&&n(12,u=D.hasCustomReadingPoint),"showFullscreenButton"in D&&n(2,h=D.showFullscreenButton),"isBookmarkScreen"in D&&n(3,k=D.isBookmarkScreen)},n(5,i=wr(window)),[l,s,h,k,b,i,o,r,a,c,d,S,u,E,m,y,F,v,B]}class Fl extends yt{constructor(e){super(),Rt(this,e,Tl,Bl,Mt,{hasChapterData:0,autoScrollMultiplier:1,hasCustomReadingPoint:12,showFullscreenButton:2,isBookmarkScreen:3})}}function Bo(t,e,n){const i=t.slice();return i[16]=e[n],i}function To(t,e){let n,i,o=e[16].label+"",r,a,l,s,u=e[16].startCharacter+"",h,k,c,d;function b(){return e[13](e[16])}return{key:t,first:null,c(){n=Z("div"),i=Z("div"),r=_e(o),l=ie(),s=Z("div"),h=_e(u),k=ie(),this.h()},l(S){n=x(S,"DIV",{class:!0});var E=$(n);i=x(E,"DIV",{id:!0,class:!0});var m=$(i);r=we(m,o),m.forEach(R),l=re(E),s=x(E,"DIV",{});var y=$(s);h=we(y,u),y.forEach(R),k=re(E),E.forEach(R),this.h()},h(){Y(i,"id",a=`for${e[16].reference}`),Y(i,"class","mr-4 cursor-pointer"),K(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),K(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),K(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),K(s,"opacity-30",e[16].progress===100&&e[16]!==e[2]),Y(n,"class","my-6 flex justify-between"),this.first=n},m(S,E){G(S,n,E),ee(n,i),ee(i,r),ee(n,l),ee(n,s),ee(s,h),ee(n,k),c||(d=[ge(i,"click",b),ge(i,"keydown",pt)],c=!0)},p(S,E){e=S,E&2&&o!==(o=e[16].label+"")&&qe(r,o),E&2&&a!==(a=`for${e[16].reference}`)&&Y(i,"id",a),E&6&&K(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),E&6&&K(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),E&6&&K(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),E&2&&u!==(u=e[16].startCharacter+"")&&qe(h,u),E&6&&K(s,"opacity-30",e[16].progress===100&&e[16]!==e[2])},d(S){S&&R(n),c=!1,kt(d)}}}function Il(t){let e,n,i,o,r,a,l,s,u,h,k,c,d=[],b=new Map,S,E,m,y,F,v,B,D,X,I;h=new lt({props:{icon:$r}});let A=t[1];const V=T=>T[16].reference;for(let T=0;T<A.length;T+=1){let N=Bo(t,A,T),w=V(N);b.set(w,d[T]=To(w,N))}return y=new lt({props:{icon:ea}}),B=new lt({props:{icon:ta}}),{c(){e=Z("div"),n=Z("div"),i=_e("Chapter Progress: "),o=_e(t[3]),r=_e(" ("),a=_e(t[4]),l=_e("%)"),s=ie(),u=Z("div"),Pe(h.$$.fragment),k=ie(),c=Z("div");for(let T=0;T<d.length;T+=1)d[T].c();S=ie(),E=Z("div"),m=Z("div"),Pe(y.$$.fragment),F=ie(),v=Z("div"),Pe(B.$$.fragment),this.h()},l(T){e=x(T,"DIV",{class:!0});var N=$(e);n=x(N,"DIV",{});var w=$(n);i=we(w,"Chapter Progress: "),o=we(w,t[3]),r=we(w," ("),a=we(w,t[4]),l=we(w,"%)"),w.forEach(R),s=re(N),u=x(N,"DIV",{class:!0});var L=$(u);ve(h.$$.fragment,L),L.forEach(R),N.forEach(R),k=re(T),c=x(T,"DIV",{class:!0});var C=$(c);for(let Se=0;Se<d.length;Se+=1)d[Se].l(C);C.forEach(R),S=re(T),E=x(T,"DIV",{class:!0});var O=$(E);m=x(O,"DIV",{class:!0});var Q=$(m);ve(y.$$.fragment,Q),Q.forEach(R),F=re(O),v=x(O,"DIV",{class:!0});var he=$(v);ve(B.$$.fragment,he),he.forEach(R),O.forEach(R),this.h()},h(){Y(u,"class","flex cursor-pointer items-end md:items-center"),Y(e,"class","flex justify-between p-4"),Y(c,"class","flex-1 overflow-auto p-4"),Y(m,"class","cursor-pointer"),K(m,"opacity-30",!t[6]),Y(v,"class","cursor-pointer"),K(v,"opacity-30",!t[5]),Y(E,"class","flex justify-between px-4 py-6")},m(T,N){G(T,e,N),ee(e,n),ee(n,i),ee(n,o),ee(n,r),ee(n,a),ee(n,l),ee(e,s),ee(e,u),ye(h,u,null),G(T,k,N),G(T,c,N);for(let w=0;w<d.length;w+=1)d[w].m(c,null);G(T,S,N),G(T,E,N),ee(E,m),ye(y,m,null),ee(E,F),ee(E,v),ye(B,v,null),D=!0,X||(I=[ge(u,"click",t[9]),ge(u,"keydown",pt),ge(m,"click",t[14]),ge(m,"keydown",pt),ge(v,"click",t[15]),ge(v,"keydown",pt)],X=!0)},p(T,[N]){(!D||N&8)&&qe(o,T[3]),(!D||N&16)&&qe(a,T[4]),N&262&&(A=T[1],d=Uo(d,N,V,1,T,A,b,c,Jo,To,null,Bo)),(!D||N&64)&&K(m,"opacity-30",!T[6]),(!D||N&32)&&K(v,"opacity-30",!T[5])},i(T){D||(j(h.$$.fragment,T),j(y.$$.fragment,T),j(B.$$.fragment,T),D=!0)},o(T){U(h.$$.fragment,T),U(y.$$.fragment,T),U(B.$$.fragment,T),D=!1},d(T){T&&R(e),Re(h),T&&R(k),T&&R(c);for(let N=0;N<d.length;N+=1)d[N].d();T&&R(S),T&&R(E),Re(y),Re(B),X=!1,kt(I)}}}function Al(t,e){const[n,i]=e.reduce((o,r,a)=>(o[0]+=t[a]*r,o[1]+=r,o),[0,0]);return n/i}function Fo(t){!t||(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView())}function Ol(t,e,n){let i,o,{sectionData:r=[]}=e,{exploredCharCount:a=0}=e,{verticalMode:l}=e,s=[],u,h=-1,k="0/0",c="0.00";Yo(()=>{mt.dialogs$.next([{component:"<div/>"}]),u&&Fo(document.getElementById(`for${u.reference}`))});function d(F,v){if(F){const B=s[h+v];b(B.reference,!1)}}function b(F,v=!1){nn.next(F),v&&S()}function S(){Lt.next(!1),mt.dialogs$.next([])}const E=F=>b(F.reference,!0),m=()=>d(i,l?1:-1),y=()=>d(o,l?-1:1);return t.$$set=F=>{"sectionData"in F&&n(10,r=F.sectionData),"exploredCharCount"in F&&n(11,a=F.exploredCharCount),"verticalMode"in F&&n(0,l=F.verticalMode)},t.$$.update=()=>{if(t.$$.dirty&5120&&r){const[F,v,B]=di(r),D=r.filter(X=>X.reference===B||X.parentChapter===B);n(4,c=Al(D.map(X=>X.progress),D.map(X=>X.charactersWeight)).toFixed(2)),n(1,s=F),n(12,h=v),n(2,u=F[h])}if(t.$$.dirty&4099&&n(6,i=l?h<s.length-1:!!h),t.$$.dirty&4099&&n(5,o=l?!!h:h<s.length-1),t.$$.dirty&2052&&u){Fo(document.getElementById(`for${u.reference}`));const F=u.characters;n(3,k=`${Math.min(Math.max(a-u.startCharacter,0),F)} / ${F}`)}},[l,s,u,k,c,o,i,d,b,S,r,a,h,E,m,y]}class Vl extends yt{constructor(e){super(),Rt(this,e,Ol,Il,Mt,{sectionData:10,exploredCharCount:11,verticalMode:0})}}class Ll{constructor(e){xe(this,"fallbackSpec");this.fallbackSpec=Io(e)}get fullscreenEnabled(){return this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled")??!1}get fullscreenElement(){return this.fallbackSpec("fullscreenElement","webkitFullscreenElement")??null}async requestFullscreen(e,n){const i=Io(e)("requestFullscreen","webkitRequestFullscreen");!i||await i(n)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function Io(t){return(e,n)=>Ao(t,e)??Ao(t,n)}function Ao(t,e){const n=t[e];return typeof n=="function"?n.bind(t):n}const hn=new Ll(document);function zl(t,e){return Nl(t).pipe(Xe(n=>{const i=e.createElement("div");return i.innerHTML=n,Hl(i),Gl(i),Wl(i,e),jl(i),i.innerHTML}))}function Nl(t){return new _t(e=>{const{blobs:n}=t;let{elementHtml:i}=t;const o=[];return Object.entries(n).forEach(([r,a])=>{const l=URL.createObjectURL(a);o.push(l),i=i.replaceAll(Sr(r),l).replaceAll(`ttu:${r}`,l)}),e.next(i),()=>{o.forEach(r=>URL.revokeObjectURL(r))}})}function Hl(t){Array.from(t.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:ri(e)})).forEach(({parentEl:e,isGaiji:n})=>{e==null||e.classList.add("ttu-img-container"),n||e==null||e.classList.add("ttu-illustration-container")})}function Gl(t){Array.from(t.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function Wl(t,e){const n=()=>{let o=[...t.children];const r=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return r>0&&r<o.length&&(o=o.slice(r)),o},i=(o,r)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||r).insertBefore(a,o),a.appendChild(o)};n().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(r=>!ri(r)).forEach(r=>i(r,o)),Array.from(o.getElementsByTagName("svg")).filter(r=>r.getElementsByTagName("image").length).forEach(r=>i(r,o))})}function jl(t){t.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Xl=_i;function _i(t,e,n){t instanceof RegExp&&(t=Oo(t,n)),e instanceof RegExp&&(e=Oo(e,n));const i=wi(t,e,n);return i&&{start:i[0],end:i[1],pre:n.slice(0,i[0]),body:n.slice(i[0]+t.length,i[1]),post:n.slice(i[1]+e.length)}}function Oo(t,e){const n=e.match(t);return n?n[0]:null}_i.range=wi;function wi(t,e,n){let i,o,r,a,l,s=n.indexOf(t),u=n.indexOf(e,s+1),h=s;if(s>=0&&u>0){if(t===e)return[s,u];for(i=[],r=n.length;h>=0&&!l;)h===s?(i.push(h),s=n.indexOf(t,h+1)):i.length===1?l=[i.pop(),u]:(o=i.pop(),o<r&&(r=o,a=u),u=n.indexOf(e,h+1)),h=s<u&&s>=0?s:u;i.length&&(l=[r,a])}return l}function ql(t,e={}){const i=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function r(w){throw new Error(`CSS parse error: ${w}`)}function a(w){const L=w.exec(t);if(L)return t=t.slice(L[0].length),L}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function u(){a(/^\s*/)}function h(){if(u(),t[0]!=="/"||t[1]!=="*")return;let w=2;for(;t[w]&&(t[w]!=="*"||t[w+1]!=="/");)w++;if(!t[w])return r("end of comment is missing");const L=t.slice(2,w);return t=t.slice(w+2),{type:"comment",comment:L}}function k(){const w=[];let L;for(;L=h();)w.push(L);return i.removeComments?[]:w}function c(){for(u();t[0]==="}";)r("extra closing bracket");const w=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(w)return w[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(L){return L.replace(/,/g,"‌")}).split(/\s*(?![^(]*\)),\s*/).map(function(L){return L.replace(/\u200C/g,",")})}function d(){if(t[0]==="@")return V();a(/^([;\s]*)+/);const w=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let L=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!L)return;if(L=L[0].trim(),!a(/^:\s*/))return r("property missing ':'");const C=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),O={type:"declaration",property:L.replace(w,""),value:C?C[0].replace(w,"").trim():""};return a(/^[;\s]*/),O}function b(){if(!l())return r("missing '{'");let w,L=k();for(;w=d();)L.push(w),L=L.concat(k());return s()?L:r("missing '}'")}function S(){u();const w=[];let L;for(;L=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)w.push(L[1]),a(/^,\s*/);if(w.length)return{type:"keyframe",values:w,declarations:b()}}function E(){let w=a(/^@([-\w]+)?keyframes\s*/);if(!w)return;const L=w[1];if(w=a(/^([-\w]+)\s*/),!w)return r("@keyframes missing name");const C=w[1];if(!l())return r("@keyframes missing '{'");let O,Q=k();for(;O=S();)Q.push(O),Q=Q.concat(k());return s()?{type:"keyframes",name:C,vendor:L,keyframes:Q}:r("@keyframes missing '}'")}function m(){if(a(/^@page */))return{type:"page",selectors:c()||[],declarations:b()}}function y(){const w=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(w)return{type:"page-margin-box",name:`${w[1]}-${w[2]}`+(w[3]?`-${w[3]}`:""),declarations:b()}}function F(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:b()}}function v(){const w=a(/^@supports *([^{]+)/);if(w)return{type:"supports",supports:w[1].trim(),rules:N()}}function B(){if(a(/^@host\s*/))return{type:"host",rules:N()}}function D(){const w=a(/^@media([^{]+)*/);if(w)return{type:"media",media:(w[1]||"").trim(),rules:N()}}function X(){const w=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(w)return{type:"custom-media",name:w[1].trim(),media:w[2].trim()}}function I(){const w=a(/^@([-\w]+)?document *([^{]+)/);if(w)return{type:"document",document:w[2].trim(),vendor:w[1]?w[1].trim():null,rules:N()}}function A(){const w=a(/^@(import|charset|namespace)\s*([^;]+);/);if(w)return{type:w[1],name:w[2].trim()}}function V(){if(u(),t[0]==="@"){const w=A()||F()||D()||E()||v()||I()||X()||B()||m()||y();if(w&&!i.preserveStatic){let L=!1;return w.declarations?L=w.declarations.some(C=>/var\(/.test(C.value)):L=(w.keyframes||w.rules||[]).some(O=>(O.declarations||[]).some(Q=>/var\(/.test(Q.value))),L?w:{}}return w}}function T(){if(!i.preserveStatic){const C=Xl("{","}",t);if(C){const O=/:(?:root|host)(?![.:#(])/.test(C.pre)&&/--\S*\s*:/.test(C.body),Q=/var\(/.test(C.body);if(!O&&!Q)return t=t.slice(C.end+1),{}}}const w=c()||[],L=i.preserveStatic?b():b().filter(C=>{const O=w.some(he=>/:(?:root|host)(?![.:#(])/.test(he))&&/^--\S/.test(C.property),Q=/var\(/.test(C.value);return O||Q});return w.length||r("selector missing"),{type:"rule",selectors:w,declarations:L}}function N(w){if(!w&&!l())return r("missing '{'");let L,C=k();for(;t.length&&(w||t[0]!=="}")&&(L=V()||T());)L.type&&C.push(L),C=C.concat(k());return!w&&!s()?r("missing '}'"):C}return{type:"stylesheet",stylesheet:{rules:N(!0),errors:o}}}function Kl(t,e="",n){const i={charset(r){return"@charset "+r.name+";"},comment(r){return r.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+r.comment+"*/":""},"custom-media"(r){return"@custom-media "+r.name+" "+r.media+";"},declaration(r){return r.property+":"+r.value+";"},document(r){return"@"+(r.vendor||"")+"document "+r.document+"{"+o(r.rules)+"}"},"font-face"(r){return"@font-face{"+o(r.declarations)+"}"},host(r){return"@host{"+o(r.rules)+"}"},import(r){return"@import "+r.name+";"},keyframe(r){return r.values.join(",")+"{"+o(r.declarations)+"}"},keyframes(r){return"@"+(r.vendor||"")+"keyframes "+r.name+"{"+o(r.keyframes)+"}"},media(r){return"@media "+r.media+"{"+o(r.rules)+"}"},namespace(r){return"@namespace "+r.name+";"},page(r){return"@page "+(r.selectors.length?r.selectors.join(", "):"")+"{"+o(r.declarations)+"}"},"page-margin-box"(r){return"@"+r.name+"{"+o(r.declarations)+"}"},rule(r){const a=r.declarations;if(a.length)return r.selectors.join(",")+"{"+o(a)+"}"},supports(r){return"@supports "+r.supports+"{"+o(r.rules)+"}"}};function o(r){let a="";for(let l=0;l<r.length;l++){const s=r[l];n&&n(s);const u=i[s.type](s);u&&(a+=u,u.length&&s.selectors&&(a+=e))}return a}return o(t.stylesheet.rules)}const Yl=/\s?html\s?/gi,Ul=/\s?body\s?/gi;function Jl(t,e){const i=ql(t.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(r=>Yl.test(r)||Ul.test(r)));return i.forEach(o=>{const r={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new $l(o.declarations,r);o.declarations.forEach(l=>{An(r,Zl(l)),An(r,xl(l)),An(r,a.convert(l))}),Object.entries(r).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),i.push(es()),i.forEach(o=>{o.selectors=Ql(o.selectors,e)}),Kl({stylesheet:{rules:i},type:"stylesheet"})}function Ql(t,e){return t.map(n=>`${e} ${n}`)}function An(t,e){return e&&(t[e.key]=e.value),t}function Zl(t){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(t.property);if(e)return{key:e[1],value:t.value}}function xl(t){if(t.property==="font-family"){let e=t.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:t.property,value:e}}}class $l{constructor(e,n){xe(this,"hasLineBreakDefined");this.ruleDeclarations=e,this.newDeclarations=n}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(n=>n.type==="declaration"&&n.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function es(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}function ts(t,e,n){return zl(t,n).pipe(Xe(i=>({htmlContent:i,styleSheet:Jl(t,e)})))}function ns(t){return new _t(e=>t.subscribe(n=>{e.next(n)}))}function fn(t=vr){return e=>t?e:Pr}function Vo(t,e,n){return i=>new _t(o=>{const r=t();return i.pipe(ti(Pn),Ba(()=>n(r))).subscribe({next:a=>{e(a,r),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}function os(t,e,n,i,o,r,a,l,s,u){switch(e[t.code]){case gt.BOOKMARK:return n(!0),!0;case gt.JUMP_TO_BOOKMARK:return i(),!0;case gt.AUTO_SCROLL_TOGGLE:return r==null||r.toggle(),!0;case gt.AUTO_SCROLL_INCREASE:return o(1),!0;case gt.AUTO_SCROLL_DECREASE:return o(-1),!0;case gt.NEXT_PAGE:return a==null||a.nextPage(),!0;case gt.PREV_PAGE:return a==null||a.prevPage(),!0;case gt.PREV_CHAPTER:return s(l?1:-1),!0;case gt.NEXT_CHAPTER:return s(l?-1:1),!0;case gt.SET_READING_POINT:return u(),!0;default:return!1}}const{document:On,window:Lo}=Wn;function zo(t){var k;let e,n,i,o,r,a,l,s;function u(c){t[79](c)}let h={hasChapterData:!!((k=t[26])!=null&&k.length),hasCustomReadingPoint:!!(t[28]&&(t[22]&&t[4]||!t[22]&&t[15]>-1&&t[14]>-1)),showFullscreenButton:hn.fullscreenEnabled,autoScrollMultiplier:t[29]};return t[10]!==void 0&&(h.isBookmarkScreen=t[10]),n=new Fl({props:h}),te.push(()=>fe(n,"isBookmarkScreen",u,t[10])),n.$on("tocClick",t[80]),n.$on("setCustomReadingPoint",t[75]),n.$on("showCustomReadingPoint",t[81]),n.$on("resetCustomReadingPoint",t[82]),n.$on("fullscreenClick",t[71]),n.$on("bookmarkClick",t[70]),n.$on("settingsClick",t[83]),n.$on("domainHintClick",t[72]),n.$on("bookManagerClick",t[84]),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(c){e=x(c,"DIV",{class:!0});var d=$(e);ve(n.$$.fragment,d),d.forEach(R),this.h()},h(){Y(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(c,d){G(c,e,d),ye(n,e,null),a=!0,l||(s=jn(o=si.call(null,e,t[85])),l=!0)},p(c,d){var S;t=c;const b={};d[0]&67108864&&(b.hasChapterData=!!((S=t[26])!=null&&S.length)),d[0]&272678928&&(b.hasCustomReadingPoint=!!(t[28]&&(t[22]&&t[4]||!t[22]&&t[15]>-1&&t[14]>-1))),d[0]&536870912&&(b.autoScrollMultiplier=t[29]),!i&&d[0]&1024&&(i=!0,b.isBookmarkScreen=t[10],ce(()=>i=!1)),n.$set(b),o&&Ko(o.update)&&d[0]&512&&o.update.call(null,t[85])},i(c){a||(j(n.$$.fragment,c),c&&Qo(()=>{r||(r=ro(e,Hn,{y:-300,easing:Nn},!0)),r.run(1)}),a=!0)},o(c){U(n.$$.fragment,c),c&&(r||(r=ro(e,Hn,{y:-300,easing:Nn},!1)),r.run(0)),a=!1},d(c){c&&R(e),Re(n),c&&r&&r.end(),l=!1,s()}}}function is(t){let e=(t[52]??"")+"",n;return{c(){n=_e(e)},l(i){n=we(i,e)},m(i,o){G(i,n,o)},p(i,o){o[1]&2097152&&e!==(e=(i[52]??"")+"")&&qe(n,e)},i:vt,o:vt,d(i){i&&R(n)}}}function rs(t){var Ee,Ge,ke;let e,n,i,o,r,a,l,s,u,h,k,c,d,b,S,E,m,y=(t[47]??"")+"",F,v,B=(t[48]??"")+"",D,X,I=(t[49]??"")+"",A,V,T=(t[50]??"")+"",N,w,L=(t[51]??"")+"",C,O;e=new Ml({props:{styleSheet:t[30].styleSheet}});function Q(_){t[86](_)}function he(_){t[87](_)}function Se(_){t[88](_)}function Me(_){t[89](_)}function be(_){t[90](_)}function Oe(_){t[91](_)}function Ne(_){t[92](_)}function pe(_){t[93](_)}function ne(_){t[94](_)}function ue(_){t[95](_)}function me(_){t[96](_)}function J(_){t[97](_)}function Ke(_){t[98](_)}let ae={htmlContent:t[30].htmlContent,width:t[31]??0,height:t[32]??0,verticalMode:t[23],fontColor:(Ee=t[33])==null?void 0:Ee.fontColor,backgroundColor:t[34],hintFuriganaFontColor:(Ge=t[33])==null?void 0:Ge.hintFuriganaFontColor,hintFuriganaShadowColor:(ke=t[33])==null?void 0:ke.hintFuriganaShadowColor,fontFamilyGroupOne:t[35],fontFamilyGroupTwo:t[36],fontSize:t[37],lineHeight:t[38],hideSpoilerImage:t[39],hideFurigana:t[40],furiganaStyle:t[41],viewMode:t[6],secondDimensionMaxValue:t[42],firstDimensionMargin:t[24],autoPositionOnResize:t[43],avoidPageBreak:t[44],pageColumns:t[45],autoBookmark:t[46],multiplier:t[29]};return t[0]!==void 0&&(ae.exploredCharCount=t[0]),t[1]!==void 0&&(ae.bookCharCount=t[1]),t[10]!==void 0&&(ae.isBookmarkScreen=t[10]),t[3]!==void 0&&(ae.bookmarkData=t[3]),t[2]!==void 0&&(ae.autoScroller=t[2]),t[12]!==void 0&&(ae.bookmarkManager=t[12]),t[13]!==void 0&&(ae.pageManager=t[13]),t[16]!==void 0&&(ae.customReadingPoint=t[16]),t[14]!==void 0&&(ae.customReadingPointTop=t[14]),t[15]!==void 0&&(ae.customReadingPointLeft=t[15]),t[17]!==void 0&&(ae.customReadingPointScrollOffset=t[17]),t[4]!==void 0&&(ae.customReadingPointRange=t[4]),t[5]!==void 0&&(ae.showCustomReadingPoint=t[5]),i=new vl({props:ae}),te.push(()=>fe(i,"exploredCharCount",Q,t[0])),te.push(()=>fe(i,"bookCharCount",he,t[1])),te.push(()=>fe(i,"isBookmarkScreen",Se,t[10])),te.push(()=>fe(i,"bookmarkData",Me,t[3])),te.push(()=>fe(i,"autoScroller",be,t[2])),te.push(()=>fe(i,"bookmarkManager",Oe,t[12])),te.push(()=>fe(i,"pageManager",Ne,t[13])),te.push(()=>fe(i,"customReadingPoint",pe,t[16])),te.push(()=>fe(i,"customReadingPointTop",ne,t[14])),te.push(()=>fe(i,"customReadingPointLeft",ue,t[15])),te.push(()=>fe(i,"customReadingPointScrollOffset",me,t[17])),te.push(()=>fe(i,"customReadingPointRange",J,t[4])),te.push(()=>fe(i,"showCustomReadingPoint",Ke,t[5])),i.$on("bookmark",t[70]),{c(){Pe(e.$$.fragment),n=ie(),Pe(i.$$.fragment),m=ie(),F=_e(y),v=ie(),D=_e(B),X=ie(),A=_e(I),V=ie(),N=_e(T),w=ie(),C=_e(L)},l(_){ve(e.$$.fragment,_),n=re(_),ve(i.$$.fragment,_),m=re(_),F=we(_,y),v=re(_),D=we(_,B),X=re(_),A=we(_,I),V=re(_),N=we(_,T),w=re(_),C=we(_,L)},m(_,z){ye(e,_,z),G(_,n,z),ye(i,_,z),G(_,m,z),G(_,F,z),G(_,v,z),G(_,D,z),G(_,X,z),G(_,A,z),G(_,V,z),G(_,N,z),G(_,w,z),G(_,C,z),O=!0},p(_,z){var Ie,Ve,Ye;const De={};z[0]&1073741824&&(De.styleSheet=_[30].styleSheet),e.$set(De);const q={};z[0]&1073741824&&(q.htmlContent=_[30].htmlContent),z[1]&1&&(q.width=_[31]??0),z[1]&2&&(q.height=_[32]??0),z[0]&8388608&&(q.verticalMode=_[23]),z[1]&4&&(q.fontColor=(Ie=_[33])==null?void 0:Ie.fontColor),z[1]&8&&(q.backgroundColor=_[34]),z[1]&4&&(q.hintFuriganaFontColor=(Ve=_[33])==null?void 0:Ve.hintFuriganaFontColor),z[1]&4&&(q.hintFuriganaShadowColor=(Ye=_[33])==null?void 0:Ye.hintFuriganaShadowColor),z[1]&16&&(q.fontFamilyGroupOne=_[35]),z[1]&32&&(q.fontFamilyGroupTwo=_[36]),z[1]&64&&(q.fontSize=_[37]),z[1]&128&&(q.lineHeight=_[38]),z[1]&256&&(q.hideSpoilerImage=_[39]),z[1]&512&&(q.hideFurigana=_[40]),z[1]&1024&&(q.furiganaStyle=_[41]),z[0]&64&&(q.viewMode=_[6]),z[1]&2048&&(q.secondDimensionMaxValue=_[42]),z[0]&16777216&&(q.firstDimensionMargin=_[24]),z[1]&4096&&(q.autoPositionOnResize=_[43]),z[1]&8192&&(q.avoidPageBreak=_[44]),z[1]&16384&&(q.pageColumns=_[45]),z[1]&32768&&(q.autoBookmark=_[46]),z[0]&536870912&&(q.multiplier=_[29]),!o&&z[0]&1&&(o=!0,q.exploredCharCount=_[0],ce(()=>o=!1)),!r&&z[0]&2&&(r=!0,q.bookCharCount=_[1],ce(()=>r=!1)),!a&&z[0]&1024&&(a=!0,q.isBookmarkScreen=_[10],ce(()=>a=!1)),!l&&z[0]&8&&(l=!0,q.bookmarkData=_[3],ce(()=>l=!1)),!s&&z[0]&4&&(s=!0,q.autoScroller=_[2],ce(()=>s=!1)),!u&&z[0]&4096&&(u=!0,q.bookmarkManager=_[12],ce(()=>u=!1)),!h&&z[0]&8192&&(h=!0,q.pageManager=_[13],ce(()=>h=!1)),!k&&z[0]&65536&&(k=!0,q.customReadingPoint=_[16],ce(()=>k=!1)),!c&&z[0]&16384&&(c=!0,q.customReadingPointTop=_[14],ce(()=>c=!1)),!d&&z[0]&32768&&(d=!0,q.customReadingPointLeft=_[15],ce(()=>d=!1)),!b&&z[0]&131072&&(b=!0,q.customReadingPointScrollOffset=_[17],ce(()=>b=!1)),!S&&z[0]&16&&(S=!0,q.customReadingPointRange=_[4],ce(()=>S=!1)),!E&&z[0]&32&&(E=!0,q.showCustomReadingPoint=_[5],ce(()=>E=!1)),i.$set(q),(!O||z[1]&65536)&&y!==(y=(_[47]??"")+"")&&qe(F,y),(!O||z[1]&131072)&&B!==(B=(_[48]??"")+"")&&qe(D,B),(!O||z[1]&262144)&&I!==(I=(_[49]??"")+"")&&qe(A,I),(!O||z[1]&524288)&&T!==(T=(_[50]??"")+"")&&qe(N,T),(!O||z[1]&1048576)&&L!==(L=(_[51]??"")+"")&&qe(C,L)},i(_){O||(j(e.$$.fragment,_),j(i.$$.fragment,_),O=!0)},o(_){U(e.$$.fragment,_),U(i.$$.fragment,_),O=!1},d(_){Re(e,_),_&&R(n),Re(i,_),_&&R(m),_&&R(F),_&&R(v),_&&R(D),_&&R(X),_&&R(A),_&&R(V),_&&R(N),_&&R(w),_&&R(C)}}}function No(t){let e,n,i,o,r,a;return n=new Vl({props:{sectionData:t[26],verticalMode:t[23],exploredCharCount:t[0]}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(l){e=x(l,"DIV",{class:!0});var s=$(e);ve(n.$$.fragment,s),s.forEach(R),this.h()},h(){var l;Y(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),M(e,"color",(l=t[33])==null?void 0:l.fontColor),M(e,"background-color",t[34])},m(l,s){G(l,e,s),ye(n,e,null),o=!0,r||(a=jn(si.call(null,e,t[99])),r=!0)},p(l,s){var h;t=l;const u={};s[0]&67108864&&(u.sectionData=t[26]),s[0]&8388608&&(u.verticalMode=t[23]),s[0]&1&&(u.exploredCharCount=t[0]),n.$set(u),s[1]&4&&M(e,"color",(h=t[33])==null?void 0:h.fontColor),s[1]&8&&M(e,"background-color",t[34])},i(l){o||(j(n.$$.fragment,l),l&&(i||Qo(()=>{i=lr(e,Hn,{x:-100,duration:100,easing:Nn}),i.start()})),o=!0)},o(l){U(n.$$.fragment,l),o=!1},d(l){l&&R(e),Re(n),r=!1,a()}}}function Ho(t){let e,n,i;return{c(){e=Z("div"),n=ie(),i=Z("div"),this.h()},l(o){e=x(o,"DIV",{class:!0}),$(e).forEach(R),n=re(o),i=x(o,"DIV",{class:!0}),$(i).forEach(R),this.h()},h(){Y(e,"class","fixed left-0 z-20 h-[1px] w-full border border-red-500"),M(e,"top",`${t[14]}px`),Y(i,"class","fixed top-0 z-20 h-full w-[1px] border border-red-500"),M(i,"left",`${t[15]}px`)},m(o,r){G(o,e,r),G(o,n,r),G(o,i,r)},p(o,r){r[0]&16384&&M(e,"top",`${o[14]}px`),r[0]&32768&&M(i,"left",`${o[15]}px`)},d(o){o&&R(e),o&&R(n),o&&R(i)}}}function Go(t){let e,n,i;return n=new lt({props:{icon:ai,spin:!0}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(o){e=x(o,"DIV",{class:!0});var r=$(e);ve(n.$$.fragment,r),r.forEach(R),this.h()},h(){Y(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl")},m(o,r){G(o,e,r),ye(n,e,null),i=!0},p:vt,i(o){i||(j(n.$$.fragment,o),i=!0)},o(o){U(n.$$.fragment,o),i=!1},d(o){o&&R(e),Re(n)}}}function Wo(t){let e,n,i,o,r;return n=new lt({props:{icon:na}}),{c(){e=Z("div"),Pe(n.$$.fragment),this.h()},l(a){e=x(a,"DIV",{class:!0});var l=$(e);ve(n.$$.fragment,l),l.forEach(R),this.h()},h(){Y(e,"class","flex h-full w-8 items-center justify-center text-lg"),K(e,"text-red-500",t[20]>1),K(e,"animate-pulse",t[20]>1||t[21])},m(a,l){G(a,e,l),ye(n,e,null),i=!0,o||(r=[ge(e,"click",sr(t[100])),ge(e,"keyup",pt)],o=!0)},p(a,l){(!i||l[0]&1048576)&&K(e,"text-red-500",a[20]>1),(!i||l[0]&3145728)&&K(e,"animate-pulse",a[20]>1||a[21])},i(a){i||(j(n.$$.fragment,a),i=!0)},o(a){U(n.$$.fragment,a),i=!1},d(a){a&&R(e),Re(n),o=!1,kt(r)}}}function jo(t){let e,n,i,o,r,a=(t[0]/t[1]*100).toFixed(2)+"",l,s;return{c(){e=Z("div"),n=_e(t[0]),i=_e(" / "),o=_e(t[1]),r=_e(" ("),l=_e(a),s=_e("%)"),this.h()},l(u){e=x(u,"DIV",{class:!0});var h=$(e);n=we(h,t[0]),i=we(h," / "),o=we(h,t[1]),r=we(h," ("),l=we(h,a),s=we(h,"%)"),h.forEach(R),this.h()},h(){var u;Y(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),M(e,"color",(u=t[33])==null?void 0:u.tooltipTextFontColor)},m(u,h){G(u,e,h),ee(e,n),ee(e,i),ee(e,o),ee(e,r),ee(e,l),ee(e,s)},p(u,h){var k;h[0]&1&&qe(n,u[0]),h[0]&2&&qe(o,u[1]),h[0]&3&&a!==(a=(u[0]/u[1]*100).toFixed(2)+"")&&qe(l,a),h[1]&4&&M(e,"color",(k=u[33])==null?void 0:k.tooltipTextFontColor)},d(u){u&&R(e)}}}function as(t){var L;let e,n,i=(t[27]??"")+"",o,r,a,l,s,u,h,k,c,d,b,S,E,m,y,F,v;On.title=e=fo(((L=t[25])==null?void 0:L.title)??"");let B=t[9]&&zo(t);const D=[rs,is],X=[];function I(C,O){return C[30]?0:1}u=I(t),h=X[u]=D[u](t);let A=t[7]&&No(t),V=(t[18]&&!t[53]||!t[22]&&t[5])&&Ho(t),T=t[8]&&Go(),N=t[19].length&&Wo(t),w=t[11]&&t[1]&&jo(t);return{c(){n=ie(),o=_e(i),r=ie(),a=Z("button"),l=ie(),B&&B.c(),s=ie(),h.c(),k=ie(),A&&A.c(),c=ie(),V&&V.c(),d=ie(),T&&T.c(),b=ie(),S=Z("div"),E=Z("div"),N&&N.c(),m=ie(),w&&w.c(),this.h()},l(C){ar("svelte-rnuhm6",On.head).forEach(R),n=re(C),o=we(C,i),r=re(C),a=x(C,"BUTTON",{class:!0}),$(a).forEach(R),l=re(C),B&&B.l(C),s=re(C),h.l(C),k=re(C),A&&A.l(C),c=re(C),V&&V.l(C),d=re(C),T&&T.l(C),b=re(C),S=x(C,"DIV",{class:!0});var Q=$(S);E=x(Q,"DIV",{class:!0});var he=$(E);N&&N.l(he),he.forEach(R),m=re(Q),w&&w.l(Q),Q.forEach(R),this.h()},h(){var C;Y(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),Y(E,"class","h-full"),Y(S,"class","writing-horizontal-tb fixed bottom-0 left-0 z-10 flex h-8 w-full cursor-pointer items-center justify-between text-xs leading-none"),M(S,"color",(C=t[33])==null?void 0:C.tooltipTextFontColor)},m(C,O){G(C,n,O),G(C,o,O),G(C,r,O),G(C,a,O),G(C,l,O),B&&B.m(C,O),G(C,s,O),X[u].m(C,O),G(C,k,O),A&&A.m(C,O),G(C,c,O),V&&V.m(C,O),G(C,d,O),T&&T.m(C,O),G(C,b,O),G(C,S,O),ee(S,E),N&&N.m(E,null),ee(S,m),w&&w.m(S,null),y=!0,F||(v=[ge(Lo,"keydown",t[69]),ge(Lo,"beforeunload",t[68]),ge(a,"click",t[78]),ge(S,"click",t[101]),ge(S,"keyup",pt)],F=!0)},p(C,O){var he,Se;(!y||O[0]&33554432)&&e!==(e=fo(((he=C[25])==null?void 0:he.title)??""))&&(On.title=e),(!y||O[0]&134217728)&&i!==(i=(C[27]??"")+"")&&qe(o,i),C[9]?B?(B.p(C,O),O[0]&512&&j(B,1)):(B=zo(C),B.c(),j(B,1),B.m(s.parentNode,s)):B&&(it(),U(B,1,1,()=>{B=null}),rt());let Q=u;u=I(C),u===Q?X[u].p(C,O):(it(),U(X[Q],1,1,()=>{X[Q]=null}),rt(),h=X[u],h?h.p(C,O):(h=X[u]=D[u](C),h.c()),j(h,1),h.m(k.parentNode,k)),C[7]?A?(A.p(C,O),O[0]&128&&j(A,1)):(A=No(C),A.c(),j(A,1),A.m(c.parentNode,c)):A&&(it(),U(A,1,1,()=>{A=null}),rt()),C[18]&&!C[53]||!C[22]&&C[5]?V?V.p(C,O):(V=Ho(C),V.c(),V.m(d.parentNode,d)):V&&(V.d(1),V=null),C[8]?T?(T.p(C,O),O[0]&256&&j(T,1)):(T=Go(),T.c(),j(T,1),T.m(b.parentNode,b)):T&&(it(),U(T,1,1,()=>{T=null}),rt()),C[19].length?N?(N.p(C,O),O[0]&524288&&j(N,1)):(N=Wo(C),N.c(),j(N,1),N.m(E,null)):N&&(it(),U(N,1,1,()=>{N=null}),rt()),C[11]&&C[1]?w?w.p(C,O):(w=jo(C),w.c(),w.m(S,null)):w&&(w.d(1),w=null),O[1]&4&&M(S,"color",(Se=C[33])==null?void 0:Se.tooltipTextFontColor)},i(C){y||(j(B),j(h),j(A),j(T),j(N),y=!0)},o(C){U(B),U(h),U(A),U(T),U(N),y=!1},d(C){C&&R(n),C&&R(o),C&&R(r),C&&R(a),C&&R(l),B&&B.d(C),C&&R(s),X[u].d(C),C&&R(k),A&&A.d(C),C&&R(c),V&&V.d(C),C&&R(d),T&&T.d(C),C&&R(b),C&&R(S),N&&N.d(),w&&w.d(),F=!1,kt(v)}}}const Xo="background-color",qo="writing-mode";function ls(t,e,n){let i,o,r,a,l,s,u,h,k,c,d,b,S,E,m,y,F,v,B,D,X,I,A,V,T,N,w,L,C,O,Q,he,Se,Me,be,Oe,Ne,pe,ne,ue,me,J,Ke,ae,Ee;W(t,Br,f=>n(23,r=f)),W(t,ni,f=>n(24,a=f)),W(t,Tr,f=>n(108,l=f)),W(t,Fr,f=>n(109,s=f)),W(t,Ir,f=>n(110,h=f)),W(t,Ar,f=>n(111,k=f)),W(t,oi,f=>n(112,d=f)),W(t,qt,f=>n(113,b=f)),W(t,Or,f=>n(77,S=f)),W(t,Vr,f=>n(114,E=f)),W(t,ii,f=>n(6,m=f)),W(t,Lt,f=>n(7,y=f)),W(t,Bn,f=>n(115,F=f)),W(t,Tn,f=>n(116,v=f)),W(t,Xn,f=>n(28,D=f)),W(t,Fn,f=>n(29,X=f)),W(t,Lr,f=>n(35,w=f)),W(t,zr,f=>n(36,L=f)),W(t,Nr,f=>n(37,C=f)),W(t,Hr,f=>n(38,O=f)),W(t,Gr,f=>n(39,Q=f)),W(t,Wr,f=>n(40,he=f)),W(t,jr,f=>n(41,Se=f)),W(t,Xr,f=>n(42,Me=f)),W(t,qr,f=>n(43,be=f)),W(t,Kr,f=>n(44,Oe=f)),W(t,Yr,f=>n(45,Ne=f)),W(t,Ur,f=>n(46,pe=f)),W(t,qn,f=>n(53,Ee=f));let Ge=!0,ke=!0,_=!1,z=!0,De=0,q=0,Ie,Ve,Ye,Ce=Promise.resolve(void 0),Be=-2,Te=-2,He=r?v:F,Ue=0,Fe,We,dt=!0,st=!1,tt=!1,Je,Qe=[],ut=[],P,de=0,Le=!1,Ae=0;const p=en(2500).pipe(bt(()=>n(9,ke=!1)),Pt());W(t,p,f=>n(27,B=f));const le=It(()=>ns(Jr)).pipe(Xe(f=>Number(f.url.searchParams.get("id"))),Ln({refCount:!0,bufferSize:1})),oe=le.pipe(Vt(async f=>{let H;try{if(Je=ln(window,En.BROWSER,void 0,!0,l,s),Je.startContext({id:f,title:""}),H=await Je.getBook(),!H)return H;Je.startContext({id:H.id,title:H.title,imagePath:H.coverImage}),H.storageSource?n(76,P=await to(H.storageSource,!0)):S!==Wt.Off&&n(76,P=await to(k)),H.lastBookOpen=new Date().getTime(),await Je.updateLastRead(H),H=await Pi(P,H),await vi(P)}catch(se){const ze=`Error loading book: ${se.message}`;Et.warn(ze),mt.dialogs$.next([{component:Ft,props:{title:"Load Error",message:ze}}]);return}finally{n(8,Ge=!1)}return P&&P.updateSettings(window,!0,s,l,!1,H.storageSource||k),H}),zn());W(t,oe,f=>n(25,u=f));const ft=oe.pipe(bt(f=>{f||co(`${so}${je.MANAGE.routeId}`)}),Pt());W(t,ft,f=>n(52,ae=f));const on=oe.pipe(bt(f=>{!f||n(3,Ce=Dn.getBookmark(f.id))}),Pt());W(t,on,f=>n(47,ne=f));const g=oe.pipe(Vt(f=>f?(Yn.next(f.sections||[]),ts(f,".book-content",document)):Nt),Ln({refCount:!0,bufferSize:1}));W(t,g,f=>n(30,I=f));const rn=It(()=>visualViewport?at(visualViewport,"resize"):Kn()).pipe(zn()),an=rn.pipe(Vn(0),Xe(()=>(visualViewport==null?void 0:visualViewport.width)||0),fn());W(t,an,f=>n(31,A=f));const Jn=rn.pipe(Vn(0),Xe(()=>(visualViewport==null?void 0:visualViewport.height)||0),fn());W(t,Jn,f=>n(32,V=f));const vn=yr.pipe(Xe(f=>ua.get(f)),Zt(f=>!!f));W(t,vn,f=>n(33,T=f));const yn=vn.pipe(Xe(f=>f.backgroundColor));W(t,yn,f=>n(34,N=f));const Qn=yn.pipe(Vo(()=>document.body,(f,H)=>H.style.setProperty(Xo,f),f=>f.style.removeProperty(Xo)),Pt(),fn());W(t,Qn,f=>n(48,ue=f));const Zn=Rr.pipe(Vo(()=>document.documentElement,(f,H)=>H.style.setProperty(qo,f),f=>f.style.removeProperty(qo)),Pt(),fn());W(t,Zn,f=>n(49,me=f));const xn=It(()=>kn).pipe(Xe(f=>[...f.values()]));W(t,xn,f=>n(26,c=f));const $n=It(()=>at(document,"selectionchange")).pipe(Qt(200),bt(()=>{var H,se;const f=((H=window.getSelection())==null?void 0:H.toString())||"";!f&&dt?We=void 0:f?(We=(se=window.getSelection())==null?void 0:se.getRangeAt(0),dt=!1):dt=!0}),Pt());W(t,$n,f=>n(50,J=f));const eo=In.pipe(Ma(6e4),Vt(()=>Gt()),Pt());W(t,eo,f=>n(51,Ke=f));function Si(f){return E&&(Le||Ae!==De||o&&Qe.length||o&&ut.length)?(f.preventDefault(),f.returnValue="Are you sure you want to exit?"):f}async function to(f,H=!1){if(!f){if(H)throw new Error("No storage source found");return}if(f===lo.GDRIVE_DEFAULT)return ln(window,En.GDRIVE,f,!0,l,s);if(f===lo.ONEDRIVE_DEFAULT)return ln(window,En.ONEDRIVE,f,!0,l,s);if(f){const $e=await(await Dn.db).get("storageSource",f);if($e)return ln(window,$e.type,f,!0,l,s);if(H)throw new Error(`No storage source with name ${f} found`)}const se=`No storage source with name ${f} found - skipping auto import/export`;Et.warn(se),mt.dialogs$.next([{component:Ft,props:{title:"Configuration Error",message:se}}])}async function Pi(f,H){if(!f)return H;l||f.clearData(!1),f.startContext({id:H.id,title:H.title,imagePath:H.coverImage||""});let{id:se,...ze}=H;if(H.storageSource){const nt=await f.getBook();nt&&!(nt instanceof File)&&(ze={...nt,id:H.id,lastBookOpen:H.lastBookOpen,storageSource:H.storageSource})}else if(!H.elementHtml)throw new Error("Book has no data stored");const $e={id:se,...ze};return await f.updateLastRead($e).catch(nt=>{const Ze=`Failed to update last read on external storage: ${nt.message}`;Et.warn(Ze),mt.dialogs$.next([{component:Ft,props:{title:"Update Error",message:Ze}}])}),$e}async function vi(f){if(Je&&f&&(S===Wt.Down||S===Wt.All)){const H=await f.getProgress();H&&!(H instanceof File)&&(await Je.saveProgress(H),Ae=H.exploredCharCount||0)}}function yi(f){b||!os(f,Dr.getValue(),Rn,Mi,se=>Fn.next(Fn.getValue()+se),Ie,Ye,r,Bi,oo)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),f.preventDefault())}function Ri(){let f;return le.subscribe(H=>f=H).unsubscribe(),f}async function Rn(f){var ze;const H=Ri();if(!H||!Ve)return;let se;if(n(9,ke=!1),i){const $e=d?za(window,We):void 0,nt=$e||Fe;Xt((ze=nt==null?void 0:nt.endContainer)==null?void 0:ze.parentElement,"add",.5,500),se=Ve.formatBookmarkDataByRange(H,nt),$e&&gi(window)}else se=Ve.formatBookmarkData(H,Ue);if(await Je.saveProgress(se),o){const $e=Le?ut:Qe;$e.includes(uo.PROGRESS)||$e.push(uo.PROGRESS),f&&In.next()}n(3,Ce=Promise.resolve(se))}async function Mi(){const f=await Ce;!f||!Ve||Ve.scrollToBookmark(f,Ue)}function Ei(){if(n(9,ke=!1),!hn.fullscreenElement){hn.requestFullscreen(document.documentElement);return}hn.exitFullscreen()}function Di(){mt.dialogs$.next([{component:Ft,props:{title:"Old Domain",message:"You are currently using the old domain of ッツ Reader - consider switching to https://reader.ttsu.app to prevent issues and to ensure full features"},disableCloseOnClick:!0}])}function Bi(f){if(!(c!=null&&c.length))return;const[H,se]=di(c);!se&&f===-1||f===1&&se===H.length-1||nn.next(H[se+f].reference)}async function Gt(f=!0){if(Le||!Qe.length||!u||!P)return;n(21,Le=!0),f||(qt.next(!0),Et.clearHistory(),no());const H=u.storageSource||k;P.updateSettings(window,!1,s,l,!f,H);const se=await Mr(Je,P,!f&&h===P.storageType,[{id:u.id,title:u.title,imagePath:u.coverImage}],Qe).catch(ze=>ze.message);if(P.updateSettings(window,!0,s,l,!1,H),n(21,Le=!1),se){if(!f){const ze=Et.errorCount>1;Et.warn(se),mt.dialogs$.next([{component:ze?Er:Ft,props:{title:"Error Processing Data",message:ze?"Some or all data could not be stored on an external storage":se}}])}n(20,de+=1)}else n(20,de=0),f||mt.dialogs$.next([]),ut.length?(n(19,Qe=JSON.parse(JSON.stringify(ut))),ut=[],f?In.next():await Gt(!1)):n(19,Qe=[]);f||qt.next(!1)}function no(){mt.dialogs$.next([{component:"<div/>",disableCloseOnClick:!0}])}async function Mn(f,H=!0){no();let se;try{H&&await Dn.deleteLastItem(),await Rn(!1),mt.dialogs$.next([]),o&&await Gt(!1)}catch(ze){se=ze.message}se&&(Et.warn(se),mt.dialogs$.next([{component:Ft,props:{title:"Error",message:se},disableCloseOnClick:!0}])),co(`${so}${f}`)}function oo(){const f=document.querySelector(".book-content");if(!f)return;i&&(n(14,Be=window.innerHeight/2-2),n(15,Te=window.innerWidth/2-2)),n(9,ke=!1),n(18,st=!0),document.body.classList.add("cursor-crosshair");const{elLeftReferencePoint:H,elTopReferencePoint:se,elRightReferencePoint:ze,elBottomReferencePoint:$e,pointGap:nt}=pi(window,f,r,a);tn(at(document,"pointerup"),at(document,"pointermove")).pipe(Fa(()=>st)).subscribe(Ze=>{if(Ze instanceof PointerEvent)if(Ze.type==="pointerup")document.body.classList.remove("cursor-crosshair"),n(18,st=!1),ur().then(()=>{n(15,Te=r?Ze.x:Te),n(14,Be=r?Be:Ze.y);const wt=La(Te,Be);if(wt&&Xt(wt.parent,"add",.5,500),i)n(4,Fe=wt==null?void 0:wt.range);else{let St=0;r?(St=Math.ceil(Math.max(0,Te-H)/(ze-H)*100),Tn.next(St)):(St=Math.ceil(Math.max(0,Be-se)/($e-se)*100),Bn.next(St)),n(16,He=St)}});else{const wt=Ze.x>=H+nt&&Ze.x<=ze,St=Ze.y>=se&&Ze.y<=$e-nt;i?(n(14,Be=St?Ze.y:Be),n(15,Te=wt?Ze.x:Te)):r&&wt?n(15,Te=Ze.x):!r&&St&&n(14,Be=Ze.y)}})}const Ti=()=>n(9,ke=!0);function Fi(f){_=f,n(10,_)}const Ii=()=>{n(9,ke=!1),Lt.next(!0)},Ai=()=>{n(9,ke=!1),n(5,tt=!0)},Oi=()=>{n(9,ke=!1),i?n(4,Fe=void 0):r?(Tn.next(100),n(16,He=100)):(Bn.next(0),n(16,He=0))},Vi=()=>Mn(je.SETTINGS.routeId,!1),Li=()=>Mn(je.MANAGE.routeId),zi=()=>n(9,ke=!1);function Ni(f){De=f,n(0,De)}function Hi(f){q=f,n(1,q)}function Gi(f){_=f,n(10,_)}function Wi(f){Ce=f,n(3,Ce)}function ji(f){Ie=f,n(2,Ie)}function Xi(f){Ve=f,n(12,Ve)}function qi(f){Ye=f,n(13,Ye)}function Ki(f){He=f,n(16,He)}function Yi(f){Be=f,n(14,Be)}function Ui(f){Te=f,n(15,Te)}function Ji(f){Ue=f,n(17,Ue)}function Qi(f){Fe=f,n(4,Fe)}function Zi(f){tt=f,n(5,tt),n(4,Fe)}const xi=()=>Lt.next(!1),$i=()=>Gt(!1),er=()=>n(11,z=!z);return t.$$.update=()=>{var f;t.$$.dirty[0]&132&&y&&(Ie==null||Ie.off()),t.$$.dirty[0]&3&&q&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{exploredCharCount:De}})),t.$$.dirty[0]&2&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{bookCharCount:q}})),t.$$.dirty[0]&48&&tt&&(Xt((f=Fe==null?void 0:Fe.endContainer)==null?void 0:f.parentElement,"add",1),at(document,"click").pipe(mn(1),Ht(1)).subscribe(()=>{var H;n(5,tt=!1),Xt((H=Fe==null?void 0:Fe.endContainer)==null?void 0:H.parentElement,"remove",1)})),t.$$.dirty[0]&64&&n(22,i=m===Dt.Paginated),t.$$.dirty[2]&49152&&(o=P&&(S===Wt.Up||S===Wt.All)),t.$$.dirty[0]&8&&Ce.then(H=>Ae=(H==null?void 0:H.exploredCharCount)||0)},[De,q,Ie,Ce,Fe,tt,m,y,Ge,ke,_,z,Ve,Ye,Be,Te,He,Ue,st,Qe,de,Le,i,r,a,u,c,B,D,X,I,A,V,T,N,w,L,C,O,Q,he,Se,Me,be,Oe,Ne,pe,ne,ue,me,J,Ke,ae,Ee,p,oe,ft,on,g,an,Jn,vn,yn,Qn,Zn,xn,$n,eo,Si,yi,Rn,Ei,Di,Gt,Mn,oo,P,S,Ti,Fi,Ii,Ai,Oi,Vi,Li,zi,Ni,Hi,Gi,Wi,ji,Xi,qi,Ki,Yi,Ui,Ji,Qi,Zi,xi,$i,er]}class bs extends yt{constructor(e){super(),Rt(this,e,ls,as,Mt,{},null,[-1,-1,-1,-1,-1])}}export{bs as default};
