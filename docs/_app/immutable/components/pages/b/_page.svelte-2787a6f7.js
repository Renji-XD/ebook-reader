var or=Object.defineProperty;var ir=(n,e,t)=>e in n?or(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var et=(n,e,t)=>(ir(n,typeof e!="symbol"?e+"":e,t),t);import{S as Et,i as Dt,n as Ft,V as rr,e as Nt,W as ar,a as H,B as Mt,f as M,a2 as wn,h as lr,j as x,w as we,s as oe,k as $,l as ee,x as Se,c as ie,m as U,a8 as K,p as E,y as Pe,N as me,d as j,g as it,t as Y,b as rt,z as ve,R as kt,D as W,_ as Gn,T as Wn,a1 as ne,G as te,a5 as jn,a9 as Jo,q as Ce,r as _e,u as Qe,aa as ao,ab as fe,ac as ce,o as Qo,Y as Zo,Z as xo,F as sr,L as $o,a0 as lo,$ as ur,ad as fr,A as cr}from"../../../chunks/index-876111f7.js";import{k as hr,l as ei,n as ti,o as dr,q as hn,r as It,s as gr,u as mr,v as pr,w as gt,x as St,B as gn,y as Sn,z as Vt,m as Je,A as xt,C as ni,F as st,D as Kt,E as oi,G as Xn,H as mn,I as ii,J as so,t as wt,K as ri,c as qn,L as ai,N as kr,O as At,P as br,Q as Ln,R as Vn,S as Cr,T as zn,V as Bt,U as Pn,W as _r,X as wr,Y as Sr,f as pt,Z as li,i as Pr,a as nt,_ as vr,$ as si,a0 as yr,a1 as Rr,a2 as mt,a3 as ln,a4 as sn,a5 as jt,M as Ct,a6 as Mr,a7 as Er,a8 as uo,j as Dn,a9 as Dr,aa as Fr,p as fo,ab as Br,ac as Fn,ad as Nn,ae as Hn,af as Tr,ag as Ir,ah as Ar,ai as Or,aj as Lr,ak as Vr,g as zr,al as Nr,am as Bn,an as Tn,h as Hr,ao as Gr,ap as Wr,aq as jr,ar as Xr,as as qr,at as Kr,au as Yr,av as Ur,aw as Jr,ax as Qr,ay as Zr,az as co}from"../../../chunks/store-980e8526.js";import{p as xr}from"../../../chunks/stores-b581bec8.js";import{f as ho,g as go}from"../../../chunks/format-page-title-91f1c985.js";import{F as at,f as Kn,a as Ut,b as $r,c as ea,d as ta,e as na,g as oa,h as ia,i as ra}from"../../../chunks/fa-26600f17.js";import{t as ui,k as pn,l as Jt,_ as $t,u as aa,O as Pt,i as Tt,n as la,h as sa,a as ot,m as _t,v as In}from"../../../chunks/error-handler-df8dffd6.js";import{m as ua,t as dt,c as Qt,f as mo}from"../../../chunks/index-cfdc196c.js";import{r as Rt,M as fa,m as Ue,P as ca,c as fi}from"../../../chunks/merged-header-icon-fd5992a9.js";import{a as ha}from"../../../chunks/theme-option-f9f8f697.js";var Yt={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,i=Yt.delegate;i&&(e=i.requestAnimationFrame,t=i.cancelAnimationFrame);var o=e(function(r){t=void 0,n(r)});return new ui(function(){return t==null?void 0:t(o)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Yt.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,pn([],Jt(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Yt.delegate;return((t==null?void 0:t.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,pn([],Jt(n)))},delegate:void 0},da=function(n){$t(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e}(ui),kn={setInterval:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var o=kn.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,pn([n,e],Jt(t))):setInterval.apply(void 0,pn([n,e],Jt(t)))},clearInterval:function(n){var e=kn.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0},ci=function(n){$t(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.scheduler=t,o.work=i,o.pending=!1,o}return e.prototype.schedule=function(t,i){var o;if(i===void 0&&(i=0),this.closed)return this;this.state=t;var r=this.id,a=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(a,r,i)),this.pending=!0,this.delay=i,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,i),this},e.prototype.requestAsyncId=function(t,i,o){return o===void 0&&(o=0),kn.setInterval(t.flush.bind(t,this),o)},e.prototype.recycleAsyncId=function(t,i,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return i;i!=null&&kn.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(t,i);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var o=!1,r;try{this.work(t)}catch(a){o=!0,r=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,o=t.scheduler,r=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,aa(r,this),i!=null&&(this.id=this.recycleAsyncId(o,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(da),po=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=hr.now,n}(),hi=function(n){$t(e,n);function e(t,i){i===void 0&&(i=po.now);var o=n.call(this,t,i)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var o;this._active=!0;do if(o=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,o){for(;t=i.shift();)t.unsubscribe();throw o}},e}(po),en=new hi(ci),ga=en,ma=function(n){$t(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.scheduler=t,o.work=i,o}return e.prototype.requestAsyncId=function(t,i,o){return o===void 0&&(o=0),o!==null&&o>0?n.prototype.requestAsyncId.call(this,t,i,o):(t.actions.push(this),t._scheduled||(t._scheduled=Yt.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,i,o){var r;if(o===void 0&&(o=0),o!=null?o>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,i,o);var a=t.actions;i!=null&&((r=a[a.length-1])===null||r===void 0?void 0:r.id)!==i&&(Yt.cancelAnimationFrame(i),t._scheduled=void 0)},e}(ci),pa=function(n){$t(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var i=this._scheduled;this._scheduled=void 0;var o=this.actions,r;t=t||o.shift();do if(r=t.execute(t.state,t.delay))break;while((t=o[0])&&t.id===i&&o.shift());if(this._active=!1,r){for(;(t=o[0])&&t.id===i&&o.shift();)t.unsubscribe();throw r}},e}(hi),vn=new pa(ma),Ht=new Pt(function(n){return n.complete()});function Yn(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ei(n);return ti(n,t)}function ka(n){return n instanceof Date&&!isNaN(n)}var ba=["addListener","removeListener"],Ca=["addEventListener","removeEventListener"],_a=["on","off"];function ut(n,e,t,i){if(Tt(t)&&(i=t,t=void 0),i)return ut(n,e,t).pipe(ua(i));var o=Jt(Pa(n)?Ca.map(function(l){return function(s){return n[l](e,s,t)}}):wa(n)?ba.map(ko(n,e)):Sa(n)?_a.map(ko(n,e)):[],2),r=o[0],a=o[1];if(!r&&dr(n))return hn(function(l){return ut(l,e,t)})(It(n));if(!r)throw new TypeError("Invalid event target");return new Pt(function(l){var s=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return l.next(1<u.length?u:u[0])};return r(s),function(){return a(s)}})}function ko(n,e){return function(t){return function(i){return n[t](e,i)}}}function wa(n){return Tt(n.addListener)&&Tt(n.removeListener)}function Sa(n){return Tt(n.on)&&Tt(n.off)}function Pa(n){return Tt(n.addEventListener)&&Tt(n.removeEventListener)}function tn(n,e,t){n===void 0&&(n=0),t===void 0&&(t=ga);var i=-1;return e!=null&&(gr(e)?t=e:i=e),new Pt(function(o){var r=ka(n)?+n-t.now():n;r<0&&(r=0);var a=0;return t.schedule(function(){o.closed||(o.next(a++),0<=i?this.schedule(void 0,i):o.complete())},r)})}function va(n,e){return n===void 0&&(n=0),e===void 0&&(e=en),n<0&&(n=0),tn(n,n,e)}function nn(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ei(n),i=mr(n,1/0),o=n;return o.length?o.length===1?It(o[0]):pr(i)(ti(o,t)):Ht}var ya=Array.isArray;function Ra(n){return n.length===1&&ya(n[0])?n[0]:n}function Ma(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=Ra(n),n.length===1?It(n[0]):new Pt(Ea(n))}function Ea(n){return function(e){for(var t=[],i=function(r){t.push(It(n[r]).subscribe(gt(e,function(a){if(t){for(var l=0;l<t.length;l++)l!==r&&t[l].unsubscribe();t=null}e.next(a)})))},o=0;t&&!e.closed&&o<n.length;o++)i(o)}}function Da(n){return St(function(e,t){var i=!1,o=null,r=null,a=!1,l=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var u=o;o=null,t.next(u)}a&&t.complete()},s=function(){r=null,a&&t.complete()};e.subscribe(gt(t,function(u){i=!0,o=u,r||It(n(u)).subscribe(r=gt(t,l,s))},function(){a=!0,(!i||!r||r.closed)&&t.complete()}))})}function Fa(n,e){return e===void 0&&(e=en),Da(function(){return tn(n,e)})}function Ba(n){return St(function(e,t){var i=!1,o=null,r=null,a=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var l=o;o=null,t.next(l)}};e.subscribe(gt(t,function(l){r==null||r.unsubscribe(),i=!0,o=l,r=gt(t,a,la),It(n(l)).subscribe(r)},function(){a(),t.complete()},void 0,function(){o=r=null}))})}function Zt(n,e){return e===void 0&&(e=en),St(function(t,i){var o=null,r=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var u=r;r=null,i.next(u)}};function s(){var u=a+n,h=e.now();if(h<u){o=this.schedule(void 0,u-h),i.add(o);return}l()}t.subscribe(gt(i,function(u){r=u,a=e.now(),o||(o=e.schedule(s,n),i.add(o))},function(){l(),i.complete()},void 0,function(){r=o=null}))})}function Gt(n){return n<=0?function(){return Ht}:St(function(e,t){var i=0;e.subscribe(gt(t,function(o){++i<=n&&(t.next(o),n<=i&&t.complete())}))})}function di(n,e){return e===void 0&&(e=sa),n=n??Ta,St(function(t,i){var o,r=!0;t.subscribe(gt(i,function(a){var l=e(a);(r||!n(o,l))&&(r=!1,o=l,i.next(a))}))})}function Ta(n,e){return n===e}function Ia(n){return St(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function Aa(){return St(function(n,e){var t,i=!1;n.subscribe(gt(e,function(o){var r=t;t=o,i&&e.next([r,o]),i=!0}))})}function Oa(n,e){return e===void 0&&(e=!1),St(function(t,i){var o=0;t.subscribe(gt(i,function(r){var a=n(r,o++);(a||e)&&i.next(r),!a&&i.complete()}))})}var gi={leading:!0,trailing:!1};function La(n,e){return e===void 0&&(e=gi),St(function(t,i){var o=e.leading,r=e.trailing,a=!1,l=null,s=null,u=!1,h=function(){s==null||s.unsubscribe(),s=null,r&&(P(),u&&i.complete())},w=function(){s=null,u&&i.complete()},g=function(S){return s=It(n(S)).subscribe(gt(i,h,w))},P=function(){if(a){a=!1;var S=l;l=null,i.next(S),!u&&g(S)}};t.subscribe(gt(i,function(S){a=!0,l=S,!(s&&!s.closed)&&(o?P():g(S))},function(){u=!0,!(r&&a&&s&&!s.closed)&&i.complete()}))})}function Va(n,e,t){e===void 0&&(e=en),t===void 0&&(t=gi);var i=tn(n,e);return La(function(){return i},t)}const Un=new gn([]),bn=new ot,on=new ot,zt=new ot;function mi(n){const e=n.filter(r=>!r.parentChapter);let t=n.find(r=>r.progress<100);t||(t=n[n.length-1]);const i=t.parentChapter||t.reference,o=e.findIndex(r=>r.reference===i);return[e,o,i]}function za(n){let e,t;return{c(){e=new rr(!1),t=Nt(),this.h()},l(i){e=ar(i,!1),t=Nt(),this.h()},h(){e.a=t},m(i,o){e.m(n[0],i,o),H(i,t,o)},p(i,[o]){o&1&&e.p(i[0])},i:Mt,o:Mt,d(i){i&&M(t),i&&e.d()}}}function Na(n,e,t){let{html:i}=e;const o=wn();return lr(()=>{o("load")}),n.$$set=r=>{"html"in r&&t(0,i=r.html)},[i]}class pi extends Et{constructor(e){super(),Dt(this,e,Na,za,Ft,{html:0})}}function Ha(n,e){var o;const t=(o=document.elementFromPoint(n,e))==null?void 0:o.closest("p");if(!t)return;const i=Sn(t);if(!!i.length)return{range:Jn(i[0]),parent:t}}function Jn(n,e=0,t=0){const i=new Range;return i.setStart(n,e),i.setEnd(n,t),i}function Ga(n,e){var a,l,s;const t=(a=n.getSelection())!=null&&a.toString().trim()?(l=n.getSelection())==null?void 0:l.getRangeAt(0):void 0;let i;if(t?i=t:i=e,!i)return;const o=(s=i.endContainer.parentElement)==null?void 0:s.closest("p");if(!o)return;const r=Sn(o);if(!!r.length)return Jn(r[0])}function bo(n,e){const t=n.createRange();return t.selectNode(e),t.getBoundingClientRect()}function ki(n,e=250){var t;(t=n.getSelection())==null||t.removeAllRanges(),setTimeout(()=>{var i;(i=n.getSelection())==null||i.addRange(new Range)},e)}function bi(n,e,t,i){const o=Math.min(Math.max(i,0),t?n.innerWidth/4:n.innerHeight/4),r=e.getBoundingClientRect(),a=t?o:r.left,l=t?n.innerWidth-o:r.right,s=t?r.top:o,u=t?r.bottom:n.innerHeight-o,h=Number(getComputedStyle(e).lineHeight.replace(/px$/,""));return{elLeftReferencePoint:a,elRightReferencePoint:l,elTopReferencePoint:s,elBottomReferencePoint:u,firstDimensionMargin:o,pointGap:h}}function qt(n,e,t,i=0){if(!n)return;const o=`animate-[pulse_${t}s_cubic-bezier(0.4,0,0.6,1)_${i?"1":"infinite"}]`;n.classList[e](o),i&&setTimeout(()=>n.classList.remove(o),i)}class Wa{constructor(e,t,i,o,r=vn){et(this,"enabled$",new gn(!1));this.multiplier=e,this.verticalMode=t,this.enabled$.pipe(Vt(a=>{if(!a)return Ht;let l=0;return va(0,r).pipe(Je(()=>Date.now()),Aa(),Je(s=>this.calcNewPos(s)),Je(s=>{l+=s;const u=Math.trunc(l);return l-=u,u}),xt(s=>s!==0))}),dt(i)).subscribe(a=>{let l="top";t&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,t]){let i=.00365956;return this.verticalMode&&(i=-91489e-8),i*this.multiplier*(t-e)}}function Ot(n,e){return e==="rtl"?-n:n}class ja{constructor(e,t,i){this.calculator=e,this.window=t,this.firstDimensionMargin=i}scrollToBookmark(e,t=0){const i=this.getBookmarkPosition(e);if(!i)return;const{scrollToData:o}=Co(i,this.firstDimensionMargin),r=this.calculator.verticalMode?"left":"top";o.left!==void 0&&r==="left"?o.left+=t:o.top!==void 0&&r==="top"&&(o.top-=t),this.window.scrollTo(o)}formatBookmarkData(e,t=0){const i=this.calculator.calcExploredCharCount(t),o=this.calculator.charCount,{verticalMode:r}=this.calculator,a=r?"scrollX":"scrollY";return{dataId:e,exploredCharCount:i,progress:i/o,[a]:this.window[a],lastBookmarkModified:new Date().getTime()}}formatBookmarkDataByRange(e){return this.formatBookmarkData(e)}getBookmarkBarPosition(e){const t=this.getBookmarkPosition(e);if(!!t)return Co(t,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:t}=this.calculator,i=this.getBookmarkTargetPosByScrollValue(e);if(i)return i;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return t?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:t}=e,i=o=>{const r=e[o];if(!r)return;const a=Ot(r,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===t)return{[o]:r}};return this.calculator.verticalMode?i("scrollX"):i("scrollY")}}function Co(n,e){return"scrollX"in n?{scrollToData:{left:n.scrollX},bookmarkPosData:{right:`${-n.scrollX+e}px`}}:{scrollToData:{top:n.scrollY},bookmarkPosData:{top:`${n.scrollY+e}px`}}}function Ci(n){const e=(t,i,o,r)=>{if(o<i)return n??o;const a=Math.floor((i+o)/2);return t[a]===r?a:t[a]>r?e(t,i,a-1,r):e(t,a+1,o,r)};return(t,i)=>e(t,0,t.length-1,i)}function Xa(){const n=(e,t,i,o)=>{if(i<t)return-1;const r=Math.floor((t+i)/2);return o.intersectsNode(e[r])?r:o.comparePoint(e[r],0)>0?n(e,t,r-1,o):n(e,r+1,i,o)};return(e,t)=>n(e,0,e.length-1,t)}const qa=Xa(),Ka=Ci(-1),Cn=Ci(void 0);class _i{constructor(e,t,i,o,r){et(this,"charCount");et(this,"accumulatedCharCount");et(this,"paragraphPos");et(this,"paragraphs");et(this,"paragraphPosToAccCharCount",new Map);this.containerEl=e,this.axis=t,this.direction=i,this.scrollEl=o,this.document=r,this.paragraphs=Sn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=ni(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const t=this.scrollEl.getBoundingClientRect(),i=Ot(this.verticalMode?t.right:t.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),r=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=bo(this.document,l),h=(()=>(this.verticalMode?s.width:s.height)<=0?this.paragraphPos[a-1]||0:Ot(this.verticalMode?s.left:s.bottom,this.direction)-i-o+e)();this.paragraphPos[a]=h;const w=r.get(h)||[];r.set(h,w),w.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(r.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(e=0){return this.getCharCountByScrollPos(this.scrollPos+e)}getCharCountByScrollPos(e){const t=Cn(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[t])||0}getBookMarkPosForSection(e,t){const i=Math.max(0,Ka(this.accumulatedCharCount,t-e));let o=i,r=this.processSectionBookmarkIteration(i,e,t);if(!r){for(let a=i+1,{length:l}=this.accumulatedCharCount;a<l;a+=1)if(r=this.processSectionBookmarkIteration(a,e,t),r){o=a;break}}return{bookmarkPos:r,node:r?this.paragraphs[o]:void 0,isFirstNode:o===0}}getScrollPosByCharCount(e){const t=Cn(this.accumulatedCharCount,e);return Ot(this.paragraphPos[t],this.direction)||0}getCharCountToPoint(e){const t=Math.max(0,qa(this.paragraphs,e));return this.accumulatedCharCount[t-1]||0}processSectionBookmarkIteration(e,t,i){const o=this.accumulatedCharCount[e]+t;let r;if(o>i){let a=this.paragraphs[e];a.parentElement&&(a=a.parentElement.closest("p")||a.parentElement);const{top:l,right:s,left:u}=bo(this.document,a);r=this.axis==="horizontal"?{left:s}:{top:l,left:u}}return r}get scrollPos(){return Ot(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}function Ya(n,e,t){const i=Qa(e,t)(n,"scrollLeft");return(o,r,a)=>{if(!Ua(o))return;const l=Ja(o,r,a);i(-l),o.preventDefault()}}function Ua(n){return!(!n.deltaY||n.deltaX||n.altKey||n.shiftKey||n.ctrlKey||n.metaKey)}function Ja(n,e,t){switch(n.deltaMode){case 0:return n.deltaY;case 1:return n.deltaY*e*1.75;default:return n.deltaY*t}}function Qa(n,e){return(t,i)=>{let o=!1,r=n[i],a=n[i];const l=()=>{o=!0;const s=Math.trunc((r-n[i])/t);if(n[i]!==a){o=!1;return}if(a+=s,n.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(r=n[i],a=n[i]),r+=s,o||e(l)}}}class Za{constructor(e,t,i){this.verticalMode=e,this.firstDimensionMargin=t,this.window=i}nextPage(){this.scrollByPercent(.95)}prevPage(){this.scrollByPercent(-.95)}updateSectionDataByOffset(){}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let t=this.window.innerHeight,i="top",o=1;this.verticalMode&&(t=this.window.innerWidth,i="left",o=-1);const r=t-this.firstDimensionMargin*2;this.window.scrollBy({[i]:r*e*o,behavior:"smooth"})}}const{document:_o,window:xa}=Wn;function wo(n){let e,t,i,o,r;return{c(){e=x("div"),i=oe(),o=x("div"),this.h()},l(a){e=$(a,"DIV",{class:!0,style:!0}),ee(e).forEach(M),i=ie(a),o=$(a,"DIV",{class:!0,style:!0}),ee(o).forEach(M),this.h()},h(){U(e,"class","fixed z-[5]"),U(e,"style",t=n[23]+": 100%; "+n[22]+": "+n[15]+"px; "+n[21][0]+": 0"),K(e,"inset-y-0",n[2]),K(e,"inset-x-0",!n[2]),E(e,"background-color",n[4]),U(o,"class","fixed z-[5]"),U(o,"style",r=n[23]+": 100%; "+n[22]+": "+n[15]+"px; "+n[21][1]+": 0"),K(o,"inset-y-0",n[2]),K(o,"inset-x-0",!n[2]),E(o,"background-color",n[4])},m(a,l){H(a,e,l),H(a,i,l),H(a,o,l)},p(a,l){l[0]&14712832&&t!==(t=a[23]+": 100%; "+a[22]+": "+a[15]+"px; "+a[21][0]+": 0")&&U(e,"style",t),l[0]&4&&K(e,"inset-y-0",a[2]),l[0]&4&&K(e,"inset-x-0",!a[2]),l[0]&16&&E(e,"background-color",a[4]),l[0]&14712832&&r!==(r=a[23]+": 100%; "+a[22]+": "+a[15]+"px; "+a[21][1]+": 0")&&U(o,"style",r),l[0]&4&&K(o,"inset-y-0",a[2]),l[0]&4&&K(o,"inset-x-0",!a[2]),l[0]&16&&E(o,"background-color",a[4])},d(a){a&&M(e),a&&M(i),a&&M(o)}}}function So(n){let e,t,i,o;const r=[el,$a],a=[];function l(s,u){return s[2]?0:1}return e=l(n),t=a[e]=r[e](n),{c(){t.c(),i=Nt()},l(s){t.l(s),i=Nt()},m(s,u){a[e].m(s,u),H(s,i,u),o=!0},p(s,u){let h=e;e=l(s),e===h?a[e].p(s,u):(it(),Y(a[h],1,1,()=>{a[h]=null}),rt(),t=a[e],t?t.p(s,u):(t=a[e]=r[e](s),t.c()),j(t,1),t.m(i.parentNode,i))},i(s){o||(j(t),o=!0)},o(s){Y(t),o=!1},d(s){a[e].d(s),s&&M(i)}}}function $a(n){let e,t,i;return t=new at({props:{icon:Ut}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Se(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","pointer-events-none absolute text-sm opacity-25 sm:text-xl"),E(e,"color",n[3]),E(e,"left",n[17]),E(e,"top",`calc(${n[19].top} + 1.5rem)`)},m(o,r){H(o,e,r),Pe(t,e,null),i=!0},p(o,r){r[0]&8&&E(e,"color",o[3]),r[0]&131072&&E(e,"left",o[17]),r[0]&524288&&E(e,"top",`calc(${o[19].top} + 1.5rem)`)},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),ve(t)}}}function el(n){let e,t,i;return t=new at({props:{icon:Ut}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Se(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","pointer-events-none absolute text-xl opacity-25"),E(e,"color",n[3]),E(e,"right",`calc(${n[19].right} + 1rem)`),E(e,"top",n[17])},m(o,r){H(o,e,r),Pe(t,e,null),i=!0},p(o,r){r[0]&8&&E(e,"color",o[3]),r[0]&524288&&E(e,"right",`calc(${o[19].right} + 1rem)`),r[0]&131072&&E(e,"top",o[17])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),ve(t)}}}function Po(n){let e,t,i;return t=new at({props:{icon:Kn,spin:!0}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Se(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),E(e,"color",n[3]),E(e,"background-color",n[4])},m(o,r){H(o,e,r),Pe(t,e,null),i=!0},p(o,r){r[0]&8&&E(e,"color",o[3]),r[0]&16&&E(e,"background-color",o[4])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),ve(t)}}}function tl(n){let e,t,i=`${n[9]}px`,o=`${n[20]||n[1]}px`,r,a,l,s,u,h,w;t=new pi({props:{html:n[0]}}),t.$on("load",n[27]);let g=n[15]&&wo(n),P=n[19]&&So(n),S=!n[18]&&Po(n);return{c(){e=x("div"),we(t.$$.fragment),r=oe(),g&&g.c(),a=oe(),P&&P.c(),l=oe(),S&&S.c(),s=oe(),this.h()},l(c){e=$(c,"DIV",{class:!0});var k=ee(e);Se(t.$$.fragment,k),k.forEach(M),r=ie(c),g&&g.l(c),a=ie(c),P&&P.l(c),l=ie(c),S&&S.l(c),s=ie(c),this.h()},h(){U(e,"class","book-content m-auto svelte-1ouz3ba"),K(e,"book-content--writing-vertical-rl",n[2]),K(e,"book-content--writing-horizontal-rl",!n[2]),K(e,"book-content--hide-furigana",n[12]),K(e,"book-content--hide-spoiler-image",n[11]),K(e,"book-content--furigana-style-partial",n[13]===st.Partial),K(e,"book-content--furigana-style-full",n[13]===st.Full),K(e,"book-content--furigana-style-toggle",n[13]===st.Toggle),E(e,"color",n[3]),E(e,"font-size",i),E(e,"line-height",n[10]),E(e,"max-width",!n[2]&&n[14]?`${n[14]}px`:void 0),E(e,"max-height",n[20]?`${n[20]}px`:void 0),E(e,"padding-left",n[2]&&n[15]?`${n[15]}px`:void 0),E(e,"padding-right",n[2]&&n[15]?`${n[15]}px`:void 0),E(e,"padding-top",!n[2]&&n[15]?`${n[15]}px`:void 0),E(e,"padding-bottom",!n[2]&&n[15]?`${n[15]}px`:void 0),E(e,"--font-family-serif",n[7]),E(e,"--font-family-sans-serif",n[8]),E(e,"--book-content-hint-furigana-font-color",n[5]),E(e,"--book-content-hint-furigana-shadow-color",n[6]),E(e,"--book-content-child-height",o)},m(c,k){H(c,e,k),Pe(t,e,null),n[49](e),H(c,r,k),g&&g.m(c,k),H(c,a,k),P&&P.m(c,k),H(c,l,k),S&&S.m(c,k),H(c,s,k),u=!0,h||(w=[me(xa,"scroll",n[26]),me(_o.body,"wheel",n[25],{passive:!1}),me(_o.body,"mousedown",n[50])],h=!0)},p(c,k){const d={};k[0]&1&&(d.html=c[0]),t.$set(d),(!u||k[0]&4)&&K(e,"book-content--writing-vertical-rl",c[2]),(!u||k[0]&4)&&K(e,"book-content--writing-horizontal-rl",!c[2]),(!u||k[0]&4096)&&K(e,"book-content--hide-furigana",c[12]),(!u||k[0]&2048)&&K(e,"book-content--hide-spoiler-image",c[11]),(!u||k[0]&8192)&&K(e,"book-content--furigana-style-partial",c[13]===st.Partial),(!u||k[0]&8192)&&K(e,"book-content--furigana-style-full",c[13]===st.Full),(!u||k[0]&8192)&&K(e,"book-content--furigana-style-toggle",c[13]===st.Toggle),k[0]&8&&E(e,"color",c[3]),k[0]&512&&i!==(i=`${c[9]}px`)&&E(e,"font-size",i),k[0]&1024&&E(e,"line-height",c[10]),k[0]&16388&&E(e,"max-width",!c[2]&&c[14]?`${c[14]}px`:void 0),k[0]&1048576&&E(e,"max-height",c[20]?`${c[20]}px`:void 0),k[0]&32772&&E(e,"padding-left",c[2]&&c[15]?`${c[15]}px`:void 0),k[0]&32772&&E(e,"padding-right",c[2]&&c[15]?`${c[15]}px`:void 0),k[0]&32772&&E(e,"padding-top",!c[2]&&c[15]?`${c[15]}px`:void 0),k[0]&32772&&E(e,"padding-bottom",!c[2]&&c[15]?`${c[15]}px`:void 0),k[0]&128&&E(e,"--font-family-serif",c[7]),k[0]&256&&E(e,"--font-family-sans-serif",c[8]),k[0]&32&&E(e,"--book-content-hint-furigana-font-color",c[5]),k[0]&64&&E(e,"--book-content-hint-furigana-shadow-color",c[6]),k[0]&1048578&&o!==(o=`${c[20]||c[1]}px`)&&E(e,"--book-content-child-height",o),c[15]?g?g.p(c,k):(g=wo(c),g.c(),g.m(a.parentNode,a)):g&&(g.d(1),g=null),c[19]?P?(P.p(c,k),k[0]&524288&&j(P,1)):(P=So(c),P.c(),j(P,1),P.m(l.parentNode,l)):P&&(it(),Y(P,1,1,()=>{P=null}),rt()),c[18]?S&&(it(),Y(S,1,1,()=>{S=null}),rt()):S?(S.p(c,k),k[0]&262144&&j(S,1)):(S=Po(c),S.c(),j(S,1),S.m(s.parentNode,s))},i(c){u||(j(t.$$.fragment,c),j(P),j(S),u=!0)},o(c){Y(t.$$.fragment,c),Y(P),Y(S),u=!1},d(c){c&&M(e),ve(t),n[49](null),c&&M(r),g&&g.d(c),c&&M(a),P&&P.d(c),c&&M(l),S&&S.d(c),c&&M(s),h=!1,kt(w)}}}function nl(n,e,t){let i,o,r,a,l,s,u,h;W(n,Kt,v=>t(57,l=v)),W(n,oi,v=>t(24,s=v)),W(n,zt,v=>t(58,u=v)),W(n,Xn,v=>t(48,h=v));let{htmlContent:w}=e,{width:g}=e,{height:P}=e,{verticalMode:S}=e,{fontColor:c}=e,{backgroundColor:k}=e,{hintFuriganaFontColor:d}=e,{hintFuriganaShadowColor:R}=e,{fontFamilyGroupOne:B}=e,{fontFamilyGroupTwo:y}=e,{fontSize:D}=e,{lineHeight:F}=e,{hideSpoilerImage:X}=e,{hideFurigana:I}=e,{furiganaStyle:A}=e,{secondDimensionMaxValue:L}=e,{firstDimensionMargin:T}=e,{autoPositionOnResize:N}=e,{autoBookmark:_}=e,{loadingState:V}=e,{multiplier:C}=e,{bookmarkData:O}=e,{exploredCharCount:Z}=e,{bookCharCount:he}=e,{autoScroller:ye}=e,{bookmarkManager:De}=e,{pageManager:pe}=e,{customReadingPoint:Oe}=e,{customReadingPointLeft:Le}=e,{customReadingPointTop:de}=e,{customReadingPointScrollOffset:re}=e;const ae=wn();let Be=!1,J,be,ge={},Re,He,Te,b,z,Ie=0,q=!1,Me=window.matchMedia("(min-width: 640px)").matches?"0.5rem":"0.25rem",Ge=!1;const We=Ya(4,document.documentElement,requestAnimationFrame),ft=new ot,Fe=new ot,ke=new ot,Ae=new Map,qe=new Map;let je=0,Ee=!1;Gn(()=>{ke.next(),ke.complete()}),Re=new Wa(C,S,ke,document),ye=Re,Qt([ft,Fe]).pipe(xt(()=>N),mn(1),Je(([v,le])=>S?le:v),di(),Zt(10),ii(vn),dt(ke)).subscribe(()=>{if(!be||!Te)return;const v=be.getScrollPosByCharCount(Ie)+(S?re:-re);q=!0,Te.scrollTo(v)});function Xe(){if(!h||!J)return;const{elLeftReferencePoint:v,elTopReferencePoint:le,elRightReferencePoint:Ye,elBottomReferencePoint:p,firstDimensionMargin:Q,pointGap:ue}=bi(window,J,S,T);if(S){t(34,de=le),t(33,Le=Math.min(Math.max(Q+(Ye-v)*(Oe/100)-2,v+ue),Ye-2)),t(35,re=window.innerWidth-Q-Le);return}t(34,de=Math.min(Math.max(Q+(p-le)*(Oe/100),Q),p-ue*1.5)),t(33,Le=v),t(35,re=de-Q)}function bt(v){v.updateParagraphPos(),Xe(),t(28,Z=v.calcExploredCharCount(re)),z&&(z=!1,O.then(le=>{!le||!De||(Ie=le.exploredCharCount||0,De.scrollToBookmark(le,re))}).finally(()=>{_&&ut(window,"scroll").pipe(mn(1),Zt(3e3),dt(ke)).subscribe(()=>{ae("bookmark")}),Un.pipe(Gt(1),Vt(le=>le.length?(le.forEach(Ye=>{const p=Ye.reference,Q=document.getElementById(p);Q&&(je||(je=Number(getComputedStyle(Q)[S?"marginLeft":"marginBottom"].replace(/px$/,""))/2),qe.set(p,{...Ye,progress:0}),Ae.set(p,Q))}),Ae.size?(tt(),ut(window,"scroll")):Ht):Ht),Ba(()=>tn(Ee?100:500)),dt(ke)).subscribe(tt)})),t(44,ge={}),t(18,Be=!0)}function tt(){const v=[...qe.entries()];for(let le=0,{length:Ye}=v;le<Ye;le+=1){const[p,Q]=v[le],ze=Ae.get(p).getBoundingClientRect();Q.progress=S?Math.min(Math.max(ze.right+(T||0)-window.innerWidth+re,0),ze.width)/(ze.width||1)*100:Math.abs(Math.min(Math.max(ze.top-(T||0)-re,-ze.height),0))/(ze.height||1)*100,qe.set(p,Q)}Ee=!1,bn.next(qe)}function ct(v){S&&!u&&!s&&!l&&We(v,D,window.innerWidth)}function Ke(){requestAnimationFrame(()=>{!be||(t(28,Z=be.calcExploredCharCount(re)),!q&&Z&&(Ie=Z),q=!1)})}function Ze(){if(!J)return;t(43,be=new _i(J,S?"vertical":"horizontal",S?"rtl":"ltr",document.documentElement,document)),t(28,Z=0),Ie=Z,t(29,he=be.charCount);let v=!1;try{v=document.fonts.check(`${D}px ${B||"Noto Serif JP"}`)}catch(le){_t.error(`Error checking Font Load: ${le.message}`),v=!0}v?ae("contentChange",J):Ge||(Ge=!0,document.fonts.addEventListener("loadingdone",()=>{ae("contentChange",J)}))}on.pipe(dt(ke)).subscribe(v=>{let le=document.getElementById(v);if(!le)return;le=!v.startsWith(so)&&le.closest(`div[id^="${so}"]`)||le,Ee=!0;const p=le.getBoundingClientRect();S?window.scrollBy(-(window.innerWidth-p.right-(T||0)-re-(!re||re&&je>re?je:0)),0):window.scrollBy(0,p.top-(T||0)-re-(!re||re&&je>re?je:0))});function ht(v){ne[v?"unshift":"push"](()=>{J=v,t(16,J)})}const Ve=v=>{s&&v.button===1&&v.preventDefault()};return n.$$set=v=>{"htmlContent"in v&&t(0,w=v.htmlContent),"width"in v&&t(36,g=v.width),"height"in v&&t(1,P=v.height),"verticalMode"in v&&t(2,S=v.verticalMode),"fontColor"in v&&t(3,c=v.fontColor),"backgroundColor"in v&&t(4,k=v.backgroundColor),"hintFuriganaFontColor"in v&&t(5,d=v.hintFuriganaFontColor),"hintFuriganaShadowColor"in v&&t(6,R=v.hintFuriganaShadowColor),"fontFamilyGroupOne"in v&&t(7,B=v.fontFamilyGroupOne),"fontFamilyGroupTwo"in v&&t(8,y=v.fontFamilyGroupTwo),"fontSize"in v&&t(9,D=v.fontSize),"lineHeight"in v&&t(10,F=v.lineHeight),"hideSpoilerImage"in v&&t(11,X=v.hideSpoilerImage),"hideFurigana"in v&&t(12,I=v.hideFurigana),"furiganaStyle"in v&&t(13,A=v.furiganaStyle),"secondDimensionMaxValue"in v&&t(14,L=v.secondDimensionMaxValue),"firstDimensionMargin"in v&&t(15,T=v.firstDimensionMargin),"autoPositionOnResize"in v&&t(37,N=v.autoPositionOnResize),"autoBookmark"in v&&t(38,_=v.autoBookmark),"loadingState"in v&&t(39,V=v.loadingState),"multiplier"in v&&t(40,C=v.multiplier),"bookmarkData"in v&&t(41,O=v.bookmarkData),"exploredCharCount"in v&&t(28,Z=v.exploredCharCount),"bookCharCount"in v&&t(29,he=v.bookCharCount),"autoScroller"in v&&t(30,ye=v.autoScroller),"bookmarkManager"in v&&t(31,De=v.bookmarkManager),"pageManager"in v&&t(32,pe=v.pageManager),"customReadingPoint"in v&&t(42,Oe=v.customReadingPoint),"customReadingPointLeft"in v&&t(33,Le=v.customReadingPointLeft),"customReadingPointTop"in v&&t(34,de=v.customReadingPointTop),"customReadingPointScrollOffset"in v&&t(35,re=v.customReadingPointScrollOffset)},n.$$.update=()=>{if(n.$$.dirty[0]&4&&t(23,i=S?"height":"width"),n.$$.dirty[0]&4&&t(22,o=S?"width":"height"),n.$$.dirty[0]&4&&t(21,r=S?["left","right"]:["top","bottom"]),n.$$.dirty[1]&32&&ft.next(g),n.$$.dirty[0]&2&&Fe.next(P),n.$$.dirty[0]&16388&&t(20,a=S&&L?L:void 0),n.$$.dirty[0]&212996&&L&&J){const v=Number(getComputedStyle(J)[S?"marginTop":"marginRight"].replace(/px$/,""));t(17,Me=`min(max(calc(${`${v}px - ${Me}`}), ${Me}), ${v?`${v}px`:Me})`)}if(n.$$.dirty[0]&1&&w&&(z=!0),n.$$.dirty[0]&2|n.$$.dirty[1]&4384&&be&&g&&P&&!V){const v=be;requestAnimationFrame(()=>{bt(v)})}n.$$.dirty[0]&4|n.$$.dirty[1]&16896&&Re&&(t(45,Re.multiplier=C,Re),t(45,Re.verticalMode=S,Re)),n.$$.dirty[0]&32768|n.$$.dirty[1]&36864&&be&&(t(46,He=be&&new ja(be,window,T||0)),t(31,De=He)),n.$$.dirty[1]&41984&&ge&&(t(19,b=void 0),O.then(v=>{!v||t(19,b=He==null?void 0:He.getBookmarkBarPosition(v))})),n.$$.dirty[0]&32772|n.$$.dirty[1]&65536&&(t(47,Te=new Za(S,T,window)),t(32,pe=Te)),n.$$.dirty[0]&65536|n.$$.dirty[1]&133120&&h&&J&&Number.isFinite(Oe)&&(Xe(),Ke(),tt())},[w,P,S,c,k,d,R,B,y,D,F,X,I,A,L,T,J,Me,Be,b,a,r,o,i,s,ct,Ke,Ze,Z,he,ye,De,pe,Le,de,re,g,N,_,V,C,O,Oe,be,ge,Re,He,Te,h,ht,Ve]}class ol extends Et{constructor(e){super(),Dt(this,e,nl,tl,Ft,{htmlContent:0,width:36,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontFamilyGroupOne:7,fontFamilyGroupTwo:8,fontSize:9,lineHeight:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,secondDimensionMaxValue:14,firstDimensionMargin:15,autoPositionOnResize:37,autoBookmark:38,loadingState:39,multiplier:40,bookmarkData:41,exploredCharCount:28,bookCharCount:29,autoScroller:30,bookmarkManager:31,pageManager:32,customReadingPoint:42,customReadingPointLeft:33,customReadingPointTop:34,customReadingPointScrollOffset:35},null,[-1,-1,-1])}}const il="px-4 md:px-8";function rl(n){const e=Array.from(n.getElementsByTagName("img"));return new Pt(t=>{const i=e.filter(r=>r.src).map(al);if(i.length<=0){t.next(!1),t.complete();return}const o=Qt(i).subscribe(()=>{t.next(!1),t.complete()});return t.next(!0),o})}function al(n){return n.complete?Yn(1):Ma(ut(n,"load"),ut(n,"error"))}function ll(n,e){const t=sl(n),i=fl(n);return o=>nn(t(o),ul(o,e),i(o))}function sl(n){return e=>{const t=Array.from(e.getElementsByTagName("a"));t.forEach(o=>{o.href=n.location.pathname+o.hash});const i=t.map(o=>_n(o).pipe(wt(()=>on.next(o.hash.substring(1)))));return nn(...i)}}function ul(n,e){const t=e===st.Toggle,o=Array.from(n.getElementsByTagName("ruby")).map(r=>t?_n(r).pipe(wt(()=>{r.classList.toggle("reveal-rt")})):_n(r).pipe(Gt(1),wt(()=>{r.classList.add("reveal-rt")})));return nn(...o)}function fl(n){return e=>{const i=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const r=n.createElement("span");return r.classList.add("spoiler-label"),r.setAttribute("aria-hidden","true"),r.innerText="ネタバレ",o.appendChild(r),_n(o).pipe(Gt(1),wt(()=>{o.removeChild(r),o.removeAttribute("data-ttu-spoiler-img")}))});return nn(...i)}}function _n(n){return ut(n,"click").pipe(wt(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const cl=300,hl=60,wi="none";function Xt(n,e,t){return n.addEventListener(e,t),()=>n.removeEventListener(e,t)}function dl(n,e){return e.filter(t=>n.pointerId!==t.pointerId)}function un(n,e,t,i,o){n.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:t,pointersCount:i.length}}))}function gl(n,e,t,i,o,r=wi){e.style.touchAction=r;let a=[];function l(u){a.push(u),un(e,n,u,a,"down"),i==null||i(a,u);const h=u.pointerId;function w(d){h===d.pointerId&&(a=dl(d,a),a.length||g(),un(e,n,d,a,"up"),o==null||o(a,d))}function g(){P(),S(),c(),k()}const P=Xt(e,"pointermove",d=>{a=a.map(R=>d.pointerId===R.pointerId?d:R),un(e,n,d,a,"move"),t==null||t(a,d)}),S=Xt(e,"lostpointercapture",d=>{w(d)}),c=Xt(e,"pointerup",d=>{w(d)}),k=Xt(e,"pointerleave",d=>{a=[],g(),un(e,n,d,a,"up"),o==null||o(a,d)})}const s=Xt(e,"pointerdown",l);return{destroy:()=>{s()}}}function ml(n,e={timeframe:cl,minSwipeDistance:hl,touchAction:wi}){const t="swipe";let i,o,r,a;function l(u,h){o=h.clientX,r=h.clientY,i=Date.now(),u.length===1&&(a=h.target)}function s(u,h){if(h.type==="pointerup"&&u.length===0&&Date.now()-i<e.timeframe){const w=h.clientX-o,g=h.clientY-r,P=Math.abs(w),S=Math.abs(g);let c=null;P>=2*S&&P>e.minSwipeDistance?c=w>0?"right":"left":S>=2*P&&S>e.minSwipeDistance&&(c=g>0?"bottom":"top"),c&&n.dispatchEvent(new CustomEvent(t,{detail:{direction:c,target:a}}))}}return gl(t,n,null,l,s,e.touchAction)}class pl{constructor(e,t,i,o,r){this.calculator=e,this.pageManager=t,this.sectionReady$=i,this.sectionIndex$=o,this.setIntendedCharCount=r}scrollToBookmark(e){const t=e.exploredCharCount;if(!t)return;const i=this.calculator.getSectionIndexByCharCount(t),o=l=>{const s=l.getScrollPosByCharCount(t);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(t)};if(this.sectionIndex$.getValue()===i){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(i)}formatBookmarkData(e){return this.formatBookmarkDataByRange(e,void 0)}formatBookmarkDataByRange(e,t){const i=this.calculator.calcExploredCharCount(t),o=this.calculator.charCount;return{dataId:e,exploredCharCount:i,progress:i/o,lastBookmarkModified:new Date().getTime()}}}class kl{constructor(e,t,i,o,r,a,l,s,u,h,w){et(this,"translateX",0);et(this,"sectionData",new Map);this.contentEl=e,this.scrollEl=t,this.sections=i,this.sectionIndex$=o,this.virtualScrollPos$=r,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=u,this.pageChange$=h,this.sectionRenderComplete$=w,Un.pipe(Gt(1)).subscribe(g=>{!g.length||(g.forEach(P=>{this.sectionData.set(P.reference,{...P,progress:0})}),bn.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}updateSectionDataByOffset(e=0){var o,r;const t=this.verticalMode?this.height:this.width,i=this.virtualScrollPos$.getValue()/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100;if(e){const l=(this.virtualScrollPos$.getValue()+t+this.pageGap)/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100-i;this.updateSectionData((o=this.sections[this.sectionIndex$.getValue()])==null?void 0:o.id,i+l*e)}else this.updateSectionData((r=this.sections[this.sectionIndex$.getValue()])==null?void 0:r.id,i)}flipPage(e){const t=this.verticalMode?"scrollHeight":"scrollWidth",i=this.verticalMode?this.height:this.width,o=i+this.pageGap,r=!0;if(this.translateX){const w=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const g=this.translateX;w(),this.scrollToPos(-g-o,r);return}if(this.nextSection(r)){w();return}return}const a=0,l=this.scrollEl[t],s=this.virtualScrollPos$.getValue(),u=s+o*e,h=Math.ceil(u);if(h<a){if(s!==a){this.scrollToPos(a,r);return}this.prevSection(o,t,i,r);return}if(h>=l){this.nextSection(r);return}this.scrollOrTranslateToPos(u,l,i,r)}scrollTo(e,t){const i=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[i],o,t)}prevSection(e,t,i,o){const r=this.sectionIndex$.getValue()-1;return r<0?!1:(this.updateSectionIndex(r).subscribe(()=>{const a=this.scrollEl[t];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,i,o)}),!0)}nextSection(e){const t=this.sectionIndex$.getValue()+1;return t>=this.sections.length?!1:(this.updateSectionIndex(t).subscribe(()=>{var i,o;this.scrollToPos(0,e),this.updateSectionData((i=this.sections[t-1])==null?void 0:i.id,100,!1),this.updateSectionData((o=this.sections[t])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,t,i,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/t*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+i<=t){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,t){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(t)}translateXToPos(e,t){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(t)}updateSectionIndex(e){return new Pt(t=>{if(this.sectionIndex$.getValue()===e){t.next(),t.complete();return}const i=this.sectionRenderComplete$.subscribe(o=>{o===e&&t.next(),t.complete(),i.unsubscribe()});return this.sectionIndex$.next(e),i})}updateSectionData(e,t,i=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let r=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=t:r?l.progress=0:l.progress=100,!r&&s&&(r=!0),this.sectionData.set(a.reference,l)}),i&&bn.next(this.sectionData)}}class bl{constructor(e,t,i,o,r,a,l,s,u){et(this,"charCount");et(this,"sectionAccCharCounts");et(this,"sectionIndex",-1);et(this,"calculator");this.containerEl=e,this.sections=t,this.virtualScrollPos$=i,this.getWidth=o,this.getHeight=r,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=u;const h=g=>Sn(g).reduce((S,c)=>S+ni(c),0);let w=0;this.sectionAccCharCounts=t.map(g=>(w+=h(g),w)),this.charCount=w}updateCurrentSection(e){this.calculator=new _i(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(e){if(e&&this.calculator)return this.getSectionStartCount()+this.calculator.getCharCountToPoint(e);const t=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+t)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const t=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+t}getSectionIndexByCharCount(e){return Cn(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const t=this.getSectionStartCount(),i=this.sectionAccCharCounts[this.sectionIndex],o=e-t,r=e===i&&i-t>0;if(o<0||e>i||r)return-1;if(o===0)return 0;const a=Cn(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,u=l[a];if(Number.isNaN(Number(s[a])))return-1;const h=(c,k)=>c>=k?k:l[c]>u?c:h(c+1,k),w=s[h(a+1,l.length-1)],{screenSize:g}=this,P=this.verticalMode?-1:0,S=g*(Math.ceil(w/g)+P);return Ot(S,this.calculator.direction)}checkBookmarkOnScreen(e){const t=this.getScrollPosByCharCount(e),i=this.virtualScrollPos$.getValue();return t===i&&this.calculator?{isBookmarkScreen:!0,...this.calculator.getBookMarkPosForSection(this.getSectionStartCount(),e)}:{isBookmarkScreen:t===i,bookmarkPos:void 0,node:void 0,isFirstNode:!0}}getOffsetToRange(e,t){if(!e)return 0;const i=e.getBoundingClientRect();if(this.verticalMode)return 1-i.left/this.screenSizeMirrored;const o=Math.floor(100/t),r=Math.floor(this.screenSize/t),a=o*i.bottom/this.screenSizeMirrored;let l=a,s=0;for(let u=0;u<this.screenSize&&i.right>=u;u+=r)l=s*o+a,s+=1;return l/100}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}get screenSizeMirrored(){return(this.verticalMode?this.getWidth():this.getHeight())+this.getPageGap()}}const{window:Cl}=Wn;function vo(n){let e,t,i;return t=new at({props:{icon:Kn,spin:!0}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Se(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),E(e,"color",n[4]),E(e,"background-color",n[5])},m(o,r){H(o,e,r),Pe(t,e,null),i=!0},p(o,r){r[0]&16&&E(e,"color",o[4]),r[0]&32&&E(e,"background-color",o[5])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),ve(t)}}}function yo(n){let e,t,i;return t=new at({props:{icon:Ut}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Se(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","fixed h-3 w-3 text-base opacity-25 sm:text-xl"),E(e,"color",n[4]),E(e,"top",n[21]),E(e,"left",n[22]),E(e,"right",n[23])},m(o,r){H(o,e,r),Pe(t,e,null),i=!0},p(o,r){r[0]&16&&E(e,"color",o[4]),r[0]&2097152&&E(e,"top",o[21]),r[0]&4194304&&E(e,"left",o[22]),r[0]&8388608&&E(e,"right",o[23])},i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),ve(t)}}}function _l(n){let e,t,i,o,r=`${n[10]}px`,a=`${n[1]}px`,l=`${n[2]}px`,s=`${n[3]?n[1]:(n[1]+Lt)/n[24]-Lt}px`,u,h,w,g,P,S;i=new pi({props:{html:n[20]}}),i.$on("load",n[26]);let c=!n[19]&&vo(n),k=n[0]&&yo(n);return{c(){e=x("div"),t=x("div"),we(i.$$.fragment),u=oe(),c&&c.c(),h=oe(),k&&k.c(),w=Nt(),this.h()},l(d){e=$(d,"DIV",{class:!0});var R=ee(e);t=$(R,"DIV",{class:!0});var B=ee(t);Se(i.$$.fragment,B),B.forEach(M),R.forEach(M),u=ie(d),c&&c.l(d),h=ie(d),k&&k.l(d),w=Nt(),this.h()},h(){U(t,"class","book-content-container svelte-u9j5ct"),U(e,"class","book-content m-auto svelte-u9j5ct"),K(e,"book-content--avoid-page-break",n[15]),K(e,"book-content--writing-vertical-rl",n[3]),K(e,"book-content--writing-horizontal-rl",!n[3]),K(e,"book-content--hide-furigana",n[13]),K(e,"book-content--hide-spoiler-image",n[12]),K(e,"book-content--furigana-style-partial",n[14]===st.Partial),K(e,"book-content--furigana-style-full",n[14]===st.Full),K(e,"book-content--furigana-style-toggle",n[14]===st.Toggle),E(e,"color",n[4]),E(e,"font-size",r),E(e,"line-height",n[11]),E(e,"padding-top",!n[3]&&n[16]?`${n[16]}px`:void 0),E(e,"padding-bottom",!n[3]&&n[16]?`${n[16]}px`:void 0),E(e,"padding-left",n[3]&&n[16]?`${n[16]}px`:void 0),E(e,"padding-right",n[3]&&n[16]?`${n[16]}px`:void 0),E(e,"max-width",n[1]?`${n[1]}px`:void 0),E(e,"max-height",n[3]&&n[2]?`${n[2]}px`:void 0),E(e,"--font-family-serif",n[8]),E(e,"--font-family-sans-serif",n[9]),E(e,"--book-content-hint-furigana-font-color",n[6]),E(e,"--book-content-hint-furigana-shadow-color",n[7]),E(e,"--book-content-child-width",a),E(e,"--book-content-child-height",l),E(e,"--book-content-child-column-width",!n[3]&&n[24]===1?`${n[1]}px`:""),E(e,"--book-content-column-count",n[24]),E(e,"--book-content-image-max-width",s)},m(d,R){H(d,e,R),te(e,t),Pe(i,t,null),n[44](t),n[45](e),H(d,u,R),c&&c.m(d,R),H(d,h,R),k&&k.m(d,R),H(d,w,R),g=!0,P||(S=[me(Cl,"keydown",n[28]),jn(o=ml.call(null,e,{timeframe:500,minSwipeDistance:n[25],touchAction:"pan-y"})),me(e,"swipe",n[27])],P=!0)},p(d,R){const B={};R[0]&1048576&&(B.html=d[20]),i.$set(B),o&&Jo(o.update)&&R[0]&33554432&&o.update.call(null,{timeframe:500,minSwipeDistance:d[25],touchAction:"pan-y"}),(!g||R[0]&32768)&&K(e,"book-content--avoid-page-break",d[15]),(!g||R[0]&8)&&K(e,"book-content--writing-vertical-rl",d[3]),(!g||R[0]&8)&&K(e,"book-content--writing-horizontal-rl",!d[3]),(!g||R[0]&8192)&&K(e,"book-content--hide-furigana",d[13]),(!g||R[0]&4096)&&K(e,"book-content--hide-spoiler-image",d[12]),(!g||R[0]&16384)&&K(e,"book-content--furigana-style-partial",d[14]===st.Partial),(!g||R[0]&16384)&&K(e,"book-content--furigana-style-full",d[14]===st.Full),(!g||R[0]&16384)&&K(e,"book-content--furigana-style-toggle",d[14]===st.Toggle),R[0]&16&&E(e,"color",d[4]),R[0]&1024&&r!==(r=`${d[10]}px`)&&E(e,"font-size",r),R[0]&2048&&E(e,"line-height",d[11]),R[0]&65544&&E(e,"padding-top",!d[3]&&d[16]?`${d[16]}px`:void 0),R[0]&65544&&E(e,"padding-bottom",!d[3]&&d[16]?`${d[16]}px`:void 0),R[0]&65544&&E(e,"padding-left",d[3]&&d[16]?`${d[16]}px`:void 0),R[0]&65544&&E(e,"padding-right",d[3]&&d[16]?`${d[16]}px`:void 0),R[0]&2&&E(e,"max-width",d[1]?`${d[1]}px`:void 0),R[0]&12&&E(e,"max-height",d[3]&&d[2]?`${d[2]}px`:void 0),R[0]&256&&E(e,"--font-family-serif",d[8]),R[0]&512&&E(e,"--font-family-sans-serif",d[9]),R[0]&64&&E(e,"--book-content-hint-furigana-font-color",d[6]),R[0]&128&&E(e,"--book-content-hint-furigana-shadow-color",d[7]),R[0]&2&&a!==(a=`${d[1]}px`)&&E(e,"--book-content-child-width",a),R[0]&4&&l!==(l=`${d[2]}px`)&&E(e,"--book-content-child-height",l),R[0]&16777226&&E(e,"--book-content-child-column-width",!d[3]&&d[24]===1?`${d[1]}px`:""),R[0]&16777216&&E(e,"--book-content-column-count",d[24]),R[0]&16777226&&s!==(s=`${d[3]?d[1]:(d[1]+Lt)/d[24]-Lt}px`)&&E(e,"--book-content-image-max-width",s),d[19]?c&&(it(),Y(c,1,1,()=>{c=null}),rt()):c?(c.p(d,R),R[0]&524288&&j(c,1)):(c=vo(d),c.c(),j(c,1),c.m(h.parentNode,h)),d[0]?k?(k.p(d,R),R[0]&1&&j(k,1)):(k=yo(d),k.c(),j(k,1),k.m(w.parentNode,w)):k&&(it(),Y(k,1,1,()=>{k=null}),rt())},i(d){g||(j(i.$$.fragment,d),j(c),j(k),g=!0)},o(d){Y(i.$$.fragment,d),Y(c),Y(k),g=!1},d(d){d&&M(e),ve(i),n[44](null),n[45](null),d&&M(u),c&&c.d(d),d&&M(h),k&&k.d(d),d&&M(w),P=!1,kt(S)}}}const Ro="overflow-hidden",Lt=40;function wl(n,e,t){let i,o,r,a,l,s,u,h;W(n,Kt,p=>t(51,o=p)),W(n,zt,p=>t(52,r=p)),W(n,ri,p=>t(53,a=p)),W(n,qn,p=>t(54,l=p)),W(n,oi,p=>t(55,s=p)),W(n,ai,p=>t(56,u=p)),W(n,kr,p=>t(25,h=p));let{htmlContent:w}=e,{width:g}=e,{height:P}=e,{verticalMode:S}=e,{fontColor:c}=e,{backgroundColor:k}=e,{hintFuriganaFontColor:d}=e,{hintFuriganaShadowColor:R}=e,{fontFamilyGroupOne:B}=e,{fontFamilyGroupTwo:y}=e,{fontSize:D}=e,{lineHeight:F}=e,{hideSpoilerImage:X}=e,{hideFurigana:I}=e,{furiganaStyle:A}=e,{loadingState:L}=e,{bookmarkData:T}=e,{pageManager:N}=e,{bookmarkManager:_}=e,{exploredCharCount:V}=e,{bookCharCount:C}=e,{isBookmarkScreen:O=!1}=e,{avoidPageBreak:Z=!0}=e,{pageColumns:he}=e,{firstDimensionMargin:ye}=e,{autoBookmark:De=!1}=e,{customReadingPointRange:pe}=e,{showCustomReadingPoint:Oe}=e;const Le=wn();let de,re,ae,Be=[],J,be,ge,Re=!1,He="",Te=!0,b=0,z=!1,Ie,q,Me,Ge=!1;const We=new ot,ft=new ot,Fe=new gn(-1),ke=new ot,Ae=new gn(0),qe=new ot,je=new ot,Ee=Fe.pipe(Je(p=>{var Q;return((Q=Be[p])==null?void 0:Q.innerHTML)||""})),Xe=new ot;Gn(()=>{document.body.classList.remove(Ro),Xe.next(),Xe.complete()}),Qt([We,ft]).pipe(mn(1),Vt(()=>je.pipe(Gt(1))),dt(Xe)).subscribe(()=>{if(!ae||!J)return;const p=ae.getScrollPosByCharCount(b);p<0||J.scrollTo(p,!1)}),ke.pipe(dt(Xe)).subscribe(p=>{var Q;!ae||(t(34,Oe=!1),qt((Q=pe==null?void 0:pe.endContainer)==null?void 0:Q.parentElement,"remove",1),t(29,pe=void 0),t(32,V=ae.calcExploredCharCount(pe)),p&&(b=V,u&&ki(window)),T.then(Ze))}),De&&ke.pipe(Zt(3e3),dt(Xe)).subscribe(p=>{p&&Le("bookmark")}),Ee.pipe(di(),dt(Xe)).subscribe(()=>{t(19,Re=!1)}),Ee.pipe(dt(Xe)).subscribe(p=>{const Q=(ue,ze)=>{if(ze===0){ue();return}requestAnimationFrame(()=>Q(ue,ze-1))};Q(()=>{t(20,He=p)},2)}),At(()=>ut(document.body,"wheel",{passive:!0})).pipe(xt(()=>!s&&!o),Va(50),dt(Xe)).subscribe(p=>{if(!r){let Q=(p.deltaX<0?-1:1)*(S?-1:1);p.deltaX||(Q=p.deltaY<0?-1:1),J==null||J.flipPage(Q)}});function bt(p){!ae||(t(32,V=ae.calcExploredCharCount(p)),b=V,tt(p))}function tt(p){!J||!ae||J.updateSectionDataByOffset(ae.getOffsetToRange(p,i))}function ct(){if(Te){Te=!1;return}if(!de)return;t(40,ae=new bl(de,Be,Ae,()=>g,()=>P,()=>Lt,S,de,document)),t(32,V=0),b=0,t(33,C=ae.charCount);let p=!1;try{p=document.fonts.check(`${D}px ${B||"Noto Serif JP"}`)}catch(Q){_t.error(`Error checking Font Load: ${Q.message}`),p=!0}p?(ae.updateCurrentSection(Fe.getValue()),Le("contentChange",de)):Ge||(Ge=!0,document.fonts.addEventListener("loadingdone",()=>{!ae||(ae.updateCurrentSection(Fe.getValue()),Le("contentChange",de))}))}function Ke(p){p.updateParagraphPos(),t(32,V=p.calcExploredCharCount(pe)),je.next(p),T.then(Ze),ge&&(ge=!1,T.then(Q=>{!Q||!_||(t(32,V=Q.exploredCharCount||0),_.scrollToBookmark(Q))})),t(19,Re=!0)}function Ze(p){const Q=p==null?void 0:p.exploredCharCount;if(!ae||!Q)return;const ue=ae.checkBookmarkOnScreen(Q);if(de&&ue.isBookmarkScreen){const ze=Number(getComputedStyle(de)[S?"marginTop":"marginRight"].replace(/px$/,""));ue.bookmarkPos?S?(t(21,Ie=ze?`${ze}px`:"0.5rem"),t(22,q=`${ue.bookmarkPos.left}px`),t(23,Me=void 0)):(t(21,Ie=`${ue.bookmarkPos.top}px`),t(23,Me=void 0),t(22,q=ue.bookmarkPos.left>0?`calc(${ue.bookmarkPos.left}px - ${l?"15":"20"}px)`:`calc(${Math.max(l?15:20,ze)}px)`)):ht(ze)}else ht(0);ue.isBookmarkScreen&&p.exploredCharCount&&(ue.node&&!z&&!ue.isFirstNode?tt(Jn(ue.node)):ue.isFirstNode&&tt(void 0),t(32,V=z?V:p.exploredCharCount),b=V,z=!0),t(0,O=ue.isBookmarkScreen)}function ht(p){S?(t(21,Ie=p?`${p}px`:"0.5rem"),t(22,q=a?`${g-a}px`:void 0),t(23,Me=a?void 0:"0.75rem")):(t(21,Ie=a?`${a}px`:"0.5rem"),t(22,q=p?`calc(${p}px + 0.75rem)`:"0.75rem"),t(23,Me=void 0))}function Ve(p){if(!J||r||o||p.detail.direction!=="left"&&p.detail.direction!=="right")return;const Q=p.detail.direction==="left",ue=S?!Q:Q;J.flipPage(ue?1:-1)}function v(p){if(!(!J||r||o))switch(p.code){case"ArrowLeft":J[S?"nextPage":"prevPage"]();break;case"ArrowRight":J[S?"prevPage":"nextPage"]();break;case"ArrowUp":J.prevPage();break;case"ArrowDown":J.nextPage();break}}on.pipe(dt(Xe)).subscribe(p=>{const Q=Be.findIndex(ue=>ue.id===p||ue.querySelector(`[id="${p}"]`));Q>-1&&(Fe.next(Q),J==null||J.scrollTo(0,!0))});function le(p){ne[p?"unshift":"push"](()=>{re=p,t(18,re)})}function Ye(p){ne[p?"unshift":"push"](()=>{de=p,t(17,de)})}return n.$$set=p=>{"htmlContent"in p&&t(35,w=p.htmlContent),"width"in p&&t(1,g=p.width),"height"in p&&t(2,P=p.height),"verticalMode"in p&&t(3,S=p.verticalMode),"fontColor"in p&&t(4,c=p.fontColor),"backgroundColor"in p&&t(5,k=p.backgroundColor),"hintFuriganaFontColor"in p&&t(6,d=p.hintFuriganaFontColor),"hintFuriganaShadowColor"in p&&t(7,R=p.hintFuriganaShadowColor),"fontFamilyGroupOne"in p&&t(8,B=p.fontFamilyGroupOne),"fontFamilyGroupTwo"in p&&t(9,y=p.fontFamilyGroupTwo),"fontSize"in p&&t(10,D=p.fontSize),"lineHeight"in p&&t(11,F=p.lineHeight),"hideSpoilerImage"in p&&t(12,X=p.hideSpoilerImage),"hideFurigana"in p&&t(13,I=p.hideFurigana),"furiganaStyle"in p&&t(14,A=p.furiganaStyle),"loadingState"in p&&t(36,L=p.loadingState),"bookmarkData"in p&&t(37,T=p.bookmarkData),"pageManager"in p&&t(30,N=p.pageManager),"bookmarkManager"in p&&t(31,_=p.bookmarkManager),"exploredCharCount"in p&&t(32,V=p.exploredCharCount),"bookCharCount"in p&&t(33,C=p.bookCharCount),"isBookmarkScreen"in p&&t(0,O=p.isBookmarkScreen),"avoidPageBreak"in p&&t(15,Z=p.avoidPageBreak),"pageColumns"in p&&t(38,he=p.pageColumns),"firstDimensionMargin"in p&&t(16,ye=p.firstDimensionMargin),"autoBookmark"in p&&t(39,De=p.autoBookmark),"customReadingPointRange"in p&&t(29,pe=p.customReadingPointRange),"showCustomReadingPoint"in p&&t(34,Oe=p.showCustomReadingPoint)},n.$$.update=()=>{if(n.$$.dirty[1]&64&&T.then(p=>{z=!1,Ze(p)}),n.$$.dirty[0]&2&&g&&We.next(g),n.$$.dirty[0]&4&&P&&ft.next(P),n.$$.dirty[0]&10|n.$$.dirty[1]&128&&t(24,i=S?1:he||Math.ceil(g/1e3)),n.$$.dirty[1]&16&&w&&(ge=!0),n.$$.dirty[1]&16){const p=document.createElement("div");p.innerHTML=w,t(41,Be=Array.from(p.children)),Fe.next(0)}if(n.$$.dirty[0]&393230|n.$$.dirty[1]&3072&&re&&de&&Be&&(t(42,J=new kl(re,de,Be,Fe,Ae,g,P,Lt,S,ke,qe)),t(30,N=J)),n.$$.dirty[0]&6|n.$$.dirty[1]&544&&ae&&g&&P&&!L){const p=ae;requestAnimationFrame(()=>{Ke(p)})}n.$$.dirty[1]&544&&ae&&!L&&qe.next(Fe.getValue()),n.$$.dirty[1]&6656&&ae&&J&&(t(43,be=new pl(ae,J,je,Fe,p=>b=p)),t(31,_=be)),n.$$.dirty[0]&536870912&&bt(pe)},document.body.classList.add(Ro),[O,g,P,S,c,k,d,R,B,y,D,F,X,I,A,Z,ye,de,re,Re,He,Ie,q,Me,i,h,ct,Ve,v,pe,N,_,V,C,Oe,w,L,T,he,De,ae,Be,J,be,le,Ye]}class Sl extends Et{constructor(e){super(),Dt(this,e,wl,_l,Ft,{htmlContent:35,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,fontSize:10,lineHeight:11,hideSpoilerImage:12,hideFurigana:13,furiganaStyle:14,loadingState:36,bookmarkData:37,pageManager:30,bookmarkManager:31,exploredCharCount:32,bookCharCount:33,isBookmarkScreen:0,avoidPageBreak:15,pageColumns:38,firstDimensionMargin:16,autoBookmark:39,customReadingPointRange:29,showCustomReadingPoint:34},null,[-1,-1,-1])}}function Pl(n){let e,t,i,o,r,a,l,s,u,h;function w(y){n[59](y)}function g(y){n[60](y)}function P(y){n[61](y)}function S(y){n[62](y)}function c(y){n[63](y)}function k(y){n[64](y)}function d(y){n[65](y)}function R(y){n[66](y)}let B={htmlContent:n[13],width:n[35]??0,height:n[36]??0,verticalMode:n[14],fontColor:n[15],backgroundColor:n[16],hintFuriganaFontColor:n[17],hintFuriganaShadowColor:n[18],fontFamilyGroupOne:n[19],fontFamilyGroupTwo:n[20],fontSize:n[21],lineHeight:n[22],hideSpoilerImage:n[23],hideFurigana:n[24],furiganaStyle:n[25],loadingState:n[37]??!0,avoidPageBreak:n[29],pageColumns:n[30],autoBookmark:n[31],firstDimensionMargin:n[27]};return n[0]!==void 0&&(B.exploredCharCount=n[0]),n[1]!==void 0&&(B.bookCharCount=n[1]),n[6]!==void 0&&(B.isBookmarkScreen=n[6]),n[2]!==void 0&&(B.bookmarkData=n[2]),n[4]!==void 0&&(B.bookmarkManager=n[4]),n[5]!==void 0&&(B.pageManager=n[5]),n[11]!==void 0&&(B.customReadingPointRange=n[11]),n[12]!==void 0&&(B.showCustomReadingPoint=n[12]),e=new Sl({props:B}),ne.push(()=>fe(e,"exploredCharCount",w)),ne.push(()=>fe(e,"bookCharCount",g)),ne.push(()=>fe(e,"isBookmarkScreen",P)),ne.push(()=>fe(e,"bookmarkData",S)),ne.push(()=>fe(e,"bookmarkManager",c)),ne.push(()=>fe(e,"pageManager",k)),ne.push(()=>fe(e,"customReadingPointRange",d)),ne.push(()=>fe(e,"showCustomReadingPoint",R)),e.$on("contentChange",n[67]),e.$on("bookmark",n[68]),{c(){we(e.$$.fragment)},l(y){Se(e.$$.fragment,y)},m(y,D){Pe(e,y,D),h=!0},p(y,D){const F={};D[0]&8192&&(F.htmlContent=y[13]),D[1]&16&&(F.width=y[35]??0),D[1]&32&&(F.height=y[36]??0),D[0]&16384&&(F.verticalMode=y[14]),D[0]&32768&&(F.fontColor=y[15]),D[0]&65536&&(F.backgroundColor=y[16]),D[0]&131072&&(F.hintFuriganaFontColor=y[17]),D[0]&262144&&(F.hintFuriganaShadowColor=y[18]),D[0]&524288&&(F.fontFamilyGroupOne=y[19]),D[0]&1048576&&(F.fontFamilyGroupTwo=y[20]),D[0]&2097152&&(F.fontSize=y[21]),D[0]&4194304&&(F.lineHeight=y[22]),D[0]&8388608&&(F.hideSpoilerImage=y[23]),D[0]&16777216&&(F.hideFurigana=y[24]),D[0]&33554432&&(F.furiganaStyle=y[25]),D[1]&64&&(F.loadingState=y[37]??!0),D[0]&536870912&&(F.avoidPageBreak=y[29]),D[0]&1073741824&&(F.pageColumns=y[30]),D[1]&1&&(F.autoBookmark=y[31]),D[0]&134217728&&(F.firstDimensionMargin=y[27]),!t&&D[0]&1&&(t=!0,F.exploredCharCount=y[0],ce(()=>t=!1)),!i&&D[0]&2&&(i=!0,F.bookCharCount=y[1],ce(()=>i=!1)),!o&&D[0]&64&&(o=!0,F.isBookmarkScreen=y[6],ce(()=>o=!1)),!r&&D[0]&4&&(r=!0,F.bookmarkData=y[2],ce(()=>r=!1)),!a&&D[0]&16&&(a=!0,F.bookmarkManager=y[4],ce(()=>a=!1)),!l&&D[0]&32&&(l=!0,F.pageManager=y[5],ce(()=>l=!1)),!s&&D[0]&2048&&(s=!0,F.customReadingPointRange=y[11],ce(()=>s=!1)),!u&&D[0]&4096&&(u=!0,F.showCustomReadingPoint=y[12],ce(()=>u=!1)),e.$set(F)},i(y){h||(j(e.$$.fragment,y),h=!0)},o(y){Y(e.$$.fragment,y),h=!1},d(y){ve(e,y)}}}function vl(n){let e,t,i,o,r,a,l,s,u,h,w,g;function P(I){n[47](I)}function S(I){n[48](I)}function c(I){n[49](I)}function k(I){n[50](I)}function d(I){n[51](I)}function R(I){n[52](I)}function B(I){n[53](I)}function y(I){n[54](I)}function D(I){n[55](I)}function F(I){n[56](I)}let X={htmlContent:n[13],width:n[35]??0,height:n[36]??0,verticalMode:n[14],fontColor:n[15],backgroundColor:n[16],hintFuriganaFontColor:n[17],hintFuriganaShadowColor:n[18],fontFamilyGroupOne:n[19],fontFamilyGroupTwo:n[20],fontSize:n[21],lineHeight:n[22],hideSpoilerImage:n[23],hideFurigana:n[24],furiganaStyle:n[25],secondDimensionMaxValue:n[26],firstDimensionMargin:n[27],autoPositionOnResize:n[28],autoBookmark:n[31],multiplier:n[33],loadingState:n[37]??!0};return n[0]!==void 0&&(X.exploredCharCount=n[0]),n[1]!==void 0&&(X.bookCharCount=n[1]),n[2]!==void 0&&(X.bookmarkData=n[2]),n[3]!==void 0&&(X.autoScroller=n[3]),n[4]!==void 0&&(X.bookmarkManager=n[4]),n[5]!==void 0&&(X.pageManager=n[5]),n[7]!==void 0&&(X.customReadingPoint=n[7]),n[8]!==void 0&&(X.customReadingPointTop=n[8]),n[9]!==void 0&&(X.customReadingPointLeft=n[9]),n[10]!==void 0&&(X.customReadingPointScrollOffset=n[10]),e=new ol({props:X}),ne.push(()=>fe(e,"exploredCharCount",P)),ne.push(()=>fe(e,"bookCharCount",S)),ne.push(()=>fe(e,"bookmarkData",c)),ne.push(()=>fe(e,"autoScroller",k)),ne.push(()=>fe(e,"bookmarkManager",d)),ne.push(()=>fe(e,"pageManager",R)),ne.push(()=>fe(e,"customReadingPoint",B)),ne.push(()=>fe(e,"customReadingPointTop",y)),ne.push(()=>fe(e,"customReadingPointLeft",D)),ne.push(()=>fe(e,"customReadingPointScrollOffset",F)),e.$on("contentChange",n[57]),e.$on("bookmark",n[58]),{c(){we(e.$$.fragment)},l(I){Se(e.$$.fragment,I)},m(I,A){Pe(e,I,A),g=!0},p(I,A){const L={};A[0]&8192&&(L.htmlContent=I[13]),A[1]&16&&(L.width=I[35]??0),A[1]&32&&(L.height=I[36]??0),A[0]&16384&&(L.verticalMode=I[14]),A[0]&32768&&(L.fontColor=I[15]),A[0]&65536&&(L.backgroundColor=I[16]),A[0]&131072&&(L.hintFuriganaFontColor=I[17]),A[0]&262144&&(L.hintFuriganaShadowColor=I[18]),A[0]&524288&&(L.fontFamilyGroupOne=I[19]),A[0]&1048576&&(L.fontFamilyGroupTwo=I[20]),A[0]&2097152&&(L.fontSize=I[21]),A[0]&4194304&&(L.lineHeight=I[22]),A[0]&8388608&&(L.hideSpoilerImage=I[23]),A[0]&16777216&&(L.hideFurigana=I[24]),A[0]&33554432&&(L.furiganaStyle=I[25]),A[0]&67108864&&(L.secondDimensionMaxValue=I[26]),A[0]&134217728&&(L.firstDimensionMargin=I[27]),A[0]&268435456&&(L.autoPositionOnResize=I[28]),A[1]&1&&(L.autoBookmark=I[31]),A[1]&4&&(L.multiplier=I[33]),A[1]&64&&(L.loadingState=I[37]??!0),!t&&A[0]&1&&(t=!0,L.exploredCharCount=I[0],ce(()=>t=!1)),!i&&A[0]&2&&(i=!0,L.bookCharCount=I[1],ce(()=>i=!1)),!o&&A[0]&4&&(o=!0,L.bookmarkData=I[2],ce(()=>o=!1)),!r&&A[0]&8&&(r=!0,L.autoScroller=I[3],ce(()=>r=!1)),!a&&A[0]&16&&(a=!0,L.bookmarkManager=I[4],ce(()=>a=!1)),!l&&A[0]&32&&(l=!0,L.pageManager=I[5],ce(()=>l=!1)),!s&&A[0]&128&&(s=!0,L.customReadingPoint=I[7],ce(()=>s=!1)),!u&&A[0]&256&&(u=!0,L.customReadingPointTop=I[8],ce(()=>u=!1)),!h&&A[0]&512&&(h=!0,L.customReadingPointLeft=I[9],ce(()=>h=!1)),!w&&A[0]&1024&&(w=!0,L.customReadingPointScrollOffset=I[10],ce(()=>w=!1)),e.$set(L)},i(I){g||(j(e.$$.fragment,I),g=!0)},o(I){Y(e.$$.fragment,I),g=!1},d(I){ve(e,I)}}}function yl(n){let e,t,i,o,r=(n[38]??"")+"",a,l;const s=[vl,Pl],u=[];function h(w,g){return w[32]===Bt.Continuous?0:1}return t=h(n),i=u[t]=s[t](n),{c(){e=x("div"),i.c(),o=oe(),a=Ce(r),this.h()},l(w){e=$(w,"DIV",{class:!0});var g=ee(e);i.l(g),g.forEach(M),o=ie(w),a=_e(w,r),this.h()},h(){U(e,"class",il+" py-8")},m(w,g){H(w,e,g),u[t].m(e,null),n[69](e),H(w,o,g),H(w,a,g),l=!0},p(w,g){let P=t;t=h(w),t===P?u[t].p(w,g):(it(),Y(u[P],1,1,()=>{u[P]=null}),rt(),i=u[t],i?i.p(w,g):(i=u[t]=s[t](w),i.c()),j(i,1),i.m(e,null)),(!l||g[1]&128)&&r!==(r=(w[38]??"")+"")&&Qe(a,r)},i(w){l||(j(i),l=!0)},o(w){Y(i),l=!1},d(w){w&&M(e),u[t].d(),n[69](null),w&&M(o),w&&M(a)}}}function fn(n){return Number(n.replace(/px$/,""))}function Rl(n,e,t){let i,o,r,a,l,s,{htmlContent:u}=e,{width:h}=e,{height:w}=e,{verticalMode:g}=e,{fontColor:P}=e,{backgroundColor:S}=e,{hintFuriganaFontColor:c}=e,{hintFuriganaShadowColor:k}=e,{fontFamilyGroupOne:d}=e,{fontFamilyGroupTwo:R}=e,{fontSize:B}=e,{lineHeight:y}=e,{hideSpoilerImage:D}=e,{hideFurigana:F}=e,{furiganaStyle:X}=e,{secondDimensionMaxValue:I}=e,{firstDimensionMargin:A}=e,{autoPositionOnResize:L}=e,{avoidPageBreak:T}=e,{pageColumns:N}=e,{autoBookmark:_}=e,{viewMode:V}=e,{exploredCharCount:C}=e,{bookCharCount:O}=e,{multiplier:Z}=e,{bookmarkData:he}=e,{autoScroller:ye}=e,{bookmarkManager:De}=e,{pageManager:pe}=e,{isBookmarkScreen:Oe}=e,{customReadingPoint:Le}=e,{customReadingPointTop:de}=e,{customReadingPointLeft:re}=e,{customReadingPointScrollOffset:ae}=e,{customReadingPointRange:Be}=e,{showCustomReadingPoint:J}=e;const be=new ot,ge=new ot,Re=br(null);W(n,Re,m=>t(34,o=m));const He=Qt([Re.pipe(xt(m=>!!m)),Qt([be,ge]).pipe(Ln(0))]).pipe(Zt(0,vn),Je(([m])=>getComputedStyle(m)),Vn({refCount:!0,bufferSize:1})),Te=new Cr(1),b=He.pipe(Je(m=>Me(h-fn(m.paddingLeft)-fn(m.paddingRight))));W(n,b,m=>t(35,r=m));const z=He.pipe(Je(m=>Ge(w-fn(m.paddingTop)-fn(m.paddingBottom)-i)));W(n,z,m=>t(36,a=m));const Ie=At(()=>Yn(document)).pipe(hn(m=>{const rn=ll(m,X);return Te.pipe(hn(an=>rn(an)))}),Rt());W(n,Ie,m=>t(38,s=m));const q=Te.pipe(hn(m=>rl(m)),zn());W(n,q,m=>t(37,l=m));function Me(m){return Bt.Paginated===V&&!g&&I?Math.min(I,m):m}function Ge(m){return Bt.Paginated===V&&g&&I?Math.min(I,m):m}function We(m){C=m,t(0,C)}function ft(m){O=m,t(1,O)}function Fe(m){he=m,t(2,he)}function ke(m){ye=m,t(3,ye)}function Ae(m){De=m,t(4,De)}function qe(m){pe=m,t(5,pe)}function je(m){Le=m,t(7,Le)}function Ee(m){de=m,t(8,de)}function Xe(m){re=m,t(9,re)}function bt(m){ae=m,t(10,ae)}const tt=m=>Te.next(m.detail);function ct(m){ao.call(this,n,m)}function Ke(m){C=m,t(0,C)}function Ze(m){O=m,t(1,O)}function ht(m){Oe=m,t(6,Oe)}function Ve(m){he=m,t(2,he)}function v(m){De=m,t(4,De)}function le(m){pe=m,t(5,pe)}function Ye(m){Be=m,t(11,Be)}function p(m){J=m,t(12,J)}const Q=m=>Te.next(m.detail);function ue(m){ao.call(this,n,m)}function ze(m){ne[m?"unshift":"push"](()=>{o=m,Re.set(o)})}return n.$$set=m=>{"htmlContent"in m&&t(13,u=m.htmlContent),"width"in m&&t(45,h=m.width),"height"in m&&t(46,w=m.height),"verticalMode"in m&&t(14,g=m.verticalMode),"fontColor"in m&&t(15,P=m.fontColor),"backgroundColor"in m&&t(16,S=m.backgroundColor),"hintFuriganaFontColor"in m&&t(17,c=m.hintFuriganaFontColor),"hintFuriganaShadowColor"in m&&t(18,k=m.hintFuriganaShadowColor),"fontFamilyGroupOne"in m&&t(19,d=m.fontFamilyGroupOne),"fontFamilyGroupTwo"in m&&t(20,R=m.fontFamilyGroupTwo),"fontSize"in m&&t(21,B=m.fontSize),"lineHeight"in m&&t(22,y=m.lineHeight),"hideSpoilerImage"in m&&t(23,D=m.hideSpoilerImage),"hideFurigana"in m&&t(24,F=m.hideFurigana),"furiganaStyle"in m&&t(25,X=m.furiganaStyle),"secondDimensionMaxValue"in m&&t(26,I=m.secondDimensionMaxValue),"firstDimensionMargin"in m&&t(27,A=m.firstDimensionMargin),"autoPositionOnResize"in m&&t(28,L=m.autoPositionOnResize),"avoidPageBreak"in m&&t(29,T=m.avoidPageBreak),"pageColumns"in m&&t(30,N=m.pageColumns),"autoBookmark"in m&&t(31,_=m.autoBookmark),"viewMode"in m&&t(32,V=m.viewMode),"exploredCharCount"in m&&t(0,C=m.exploredCharCount),"bookCharCount"in m&&t(1,O=m.bookCharCount),"multiplier"in m&&t(33,Z=m.multiplier),"bookmarkData"in m&&t(2,he=m.bookmarkData),"autoScroller"in m&&t(3,ye=m.autoScroller),"bookmarkManager"in m&&t(4,De=m.bookmarkManager),"pageManager"in m&&t(5,pe=m.pageManager),"isBookmarkScreen"in m&&t(6,Oe=m.isBookmarkScreen),"customReadingPoint"in m&&t(7,Le=m.customReadingPoint),"customReadingPointTop"in m&&t(8,de=m.customReadingPointTop),"customReadingPointLeft"in m&&t(9,re=m.customReadingPointLeft),"customReadingPointScrollOffset"in m&&t(10,ae=m.customReadingPointScrollOffset),"customReadingPointRange"in m&&t(11,Be=m.customReadingPointRange),"showCustomReadingPoint"in m&&t(12,J=m.showCustomReadingPoint)},n.$$.update=()=>{n.$$.dirty[0]&134234112|n.$$.dirty[1]&2&&(i=A&&Bt.Paginated===V&&!g?A*2:0),n.$$.dirty[1]&16384&&be.next(h),n.$$.dirty[1]&32768&&ge.next(w)},[C,O,he,ye,De,pe,Oe,Le,de,re,ae,Be,J,u,g,P,S,c,k,d,R,B,y,D,F,X,I,A,L,T,N,_,V,Z,o,r,a,l,s,Re,Te,b,z,Ie,q,h,w,We,ft,Fe,ke,Ae,qe,je,Ee,Xe,bt,tt,ct,Ke,Ze,ht,Ve,v,le,Ye,p,Q,ue,ze]}class Ml extends Et{constructor(e){super(),Dt(this,e,Rl,yl,Ft,{htmlContent:13,width:45,height:46,verticalMode:14,fontColor:15,backgroundColor:16,hintFuriganaFontColor:17,hintFuriganaShadowColor:18,fontFamilyGroupOne:19,fontFamilyGroupTwo:20,fontSize:21,lineHeight:22,hideSpoilerImage:23,hideFurigana:24,furiganaStyle:25,secondDimensionMaxValue:26,firstDimensionMargin:27,autoPositionOnResize:28,avoidPageBreak:29,pageColumns:30,autoBookmark:31,viewMode:32,exploredCharCount:0,bookCharCount:1,multiplier:33,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6,customReadingPoint:7,customReadingPointTop:8,customReadingPointLeft:9,customReadingPointScrollOffset:10,customReadingPointRange:11,showCustomReadingPoint:12},null,[-1,-1,-1])}}function El(n,e){const t=document.createTextNode(e);if(n.firstChild){n.replaceChild(t,n.firstChild);return}n.appendChild(t)}function Dl(n,e,t){let{styleSheet:i}=e,o;return Qo(()=>{t(1,o=document.createElement("style")),document.head.appendChild(o)}),Gn(()=>{o&&document.head.removeChild(o)}),n.$$set=r=>{"styleSheet"in r&&t(0,i=r.styleSheet)},n.$$.update=()=>{n.$$.dirty&3&&o&&El(o,i)},[i,o]}class Fl extends Et{constructor(e){super(),Dt(this,e,Dl,null,Ft,{styleSheet:0})}}function Mo(n,e,t){const i=n.slice();return i[19]=e[t],i}function Eo(n){let e,t,i,o,r;return t=new at({props:{icon:$r}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(a){e=$(a,"DIV",{role:!0,class:!0});var l=ee(e);Se(t.$$.fragment,l),l.forEach(M),this.h()},h(){U(e,"role","button"),U(e,"class",Pn)},m(a,l){H(a,e,l),Pe(t,e,null),i=!0,o||(r=[me(e,"click",n[13]),me(e,"keyup",pt)],o=!0)},p:Mt,i(a){i||(j(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&M(e),ve(t),o=!1,kt(r)}}}function Do(n){let e,t,i;return{c(){e=x("div"),t=Ce(n[1]),i=Ce("x"),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);t=_e(r,n[1]),i=_e(r,"x"),r.forEach(M),this.h()},h(){U(e,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg")},m(o,r){H(o,e,r),te(e,t),te(e,i)},p(o,r){r&2&&Qe(t,o[1])},d(o){o&&M(e)}}}function Fo(n){let e,t,i,o={placement:"bottom",fallbackPlacements:["bottom-end","bottom-start"],yOffset:0,$$slots:{content:[Tl],icon:[Bl]},$$scope:{ctx:n}};return t=new ca({props:o}),n[16](t),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(r){e=$(r,"DIV",{class:!0});var a=ee(e);Se(t.$$.fragment,a),a.forEach(M),this.h()},h(){U(e,"class","flex")},m(r,a){H(r,e,a),Pe(t,e,null),i=!0},p(r,a){const l={};a&4194304&&(l.$$scope={dirty:a,ctx:r}),t.$set(l)},i(r){i||(j(t.$$.fragment,r),i=!0)},o(r){Y(t.$$.fragment,r),i=!1},d(r){r&&M(e),n[16](null),ve(t)}}}function Bl(n){let e,t,i;return t=new at({props:{icon:ta}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{slot:!0,class:!0});var r=ee(e);Se(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"slot","icon"),U(e,"class",Pn)},m(o,r){H(o,e,r),Pe(t,e,null),i=!0},p:Mt,i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),ve(t)}}}function Bo(n,e){let t,i=e[19].label+"",o,r,a,l;function s(){return e[15](e[19])}return{key:n,first:null,c(){t=x("div"),o=Ce(i),r=oe(),this.h()},l(u){t=$(u,"DIV",{role:!0,class:!0});var h=ee(t);o=_e(h,i),r=ie(h),h.forEach(M),this.h()},h(){U(t,"role","button"),U(t,"class","px-4 py-2 text-sm hover:bg-white hover:text-gray-700"),this.first=t},m(u,h){H(u,t,h),te(t,o),te(t,r),a||(l=[me(t,"click",s),me(t,"keyup",pt)],a=!0)},p(u,h){e=u},d(u){u&&M(t),a=!1,kt(l)}}}function Tl(n){let e,t=[],i=new Map,o=n[10];const r=a=>a[19].label;for(let a=0;a<o.length;a+=1){let l=Mo(n,o,a),s=r(l);i.set(s,t[a]=Bo(s,l))}return{c(){e=x("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=$(a,"DIV",{class:!0,slot:!0});var l=ee(e);for(let s=0;s<t.length;s+=1)t[s].l(l);l.forEach(M),this.h()},h(){U(e,"class","w-40 bg-gray-700 md:w-32"),U(e,"slot","content")},m(a,l){H(a,e,l);for(let s=0;s<t.length;s+=1)t[s].m(e,null)},p(a,l){l&3072&&(o=a[10],t=Zo(t,l,r,1,a,o,i,e,xo,Bo,null,Mo))},d(a){a&&M(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function To(n){let e,t,i,o,r;return t=new at({props:{icon:ea}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(a){e=$(a,"DIV",{role:!0,class:!0});var l=ee(e);Se(t.$$.fragment,l),l.forEach(M),this.h()},h(){U(e,"role","button"),U(e,"class",Pn)},m(a,l){H(a,e,l),Pe(t,e,null),i=!0,o||(r=[me(e,"click",n[17]),me(e,"keyup",pt)],o=!0)},p:Mt,i(a){i||(j(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&M(e),ve(t),o=!1,kt(r)}}}function Il(n){let e,t,i,o,r,a,l,s,u,h,w,g,P,S,c=n[0]&&Eo(n);r=new at({props:{icon:n[3]?Ut:mo}});let k=!n[6]&&Do(n),d=(n[7]||n[8]===Bt.Paginated)&&Fo(n),R=n[2]&&To(n);return w=new fa({props:{disableRouteNavigation:!0,items:n[5]?[Ue.SETTINGS,Ue.DOMAIN_HINT,Ue.MANAGE]:[Ue.SETTINGS,Ue.MANAGE]}}),w.$on("action",n[18]),{c(){e=x("div"),t=x("div"),c&&c.c(),i=oe(),o=x("div"),we(r.$$.fragment),a=oe(),k&&k.c(),l=oe(),s=x("div"),d&&d.c(),u=oe(),R&&R.c(),h=oe(),we(w.$$.fragment),this.h()},l(B){e=$(B,"DIV",{class:!0});var y=ee(e);t=$(y,"DIV",{class:!0});var D=ee(t);c&&c.l(D),i=ie(D),o=$(D,"DIV",{role:!0,class:!0});var F=ee(o);Se(r.$$.fragment,F),F.forEach(M),a=ie(D),k&&k.l(D),D.forEach(M),l=ie(y),s=$(y,"DIV",{class:!0});var X=ee(s);d&&d.l(X),u=ie(X),R&&R.l(X),h=ie(X),Se(w.$$.fragment,X),X.forEach(M),y.forEach(M),this.h()},h(){U(o,"role","button"),U(o,"class",Pn),U(t,"class","flex transform-gpu "+_r),U(s,"class","flex transform-gpu "+wr),U(e,"class","flex justify-between bg-gray-700 px-4 md:px-8 "+Sr)},m(B,y){H(B,e,y),te(e,t),c&&c.m(t,null),te(t,i),te(t,o),Pe(r,o,null),te(t,a),k&&k.m(t,null),te(e,l),te(e,s),d&&d.m(s,null),te(s,u),R&&R.m(s,null),te(s,h),Pe(w,s,null),g=!0,P||(S=[me(o,"click",n[14]),me(o,"keyup",pt)],P=!0)},p(B,[y]){B[0]?c?(c.p(B,y),y&1&&j(c,1)):(c=Eo(B),c.c(),j(c,1),c.m(t,i)):c&&(it(),Y(c,1,1,()=>{c=null}),rt());const D={};y&8&&(D.icon=B[3]?Ut:mo),r.$set(D),B[6]?k&&(k.d(1),k=null):k?k.p(B,y):(k=Do(B),k.c(),k.m(t,null)),B[7]||B[8]===Bt.Paginated?d?(d.p(B,y),y&384&&j(d,1)):(d=Fo(B),d.c(),j(d,1),d.m(s,u)):d&&(it(),Y(d,1,1,()=>{d=null}),rt()),B[2]?R?(R.p(B,y),y&4&&j(R,1)):(R=To(B),R.c(),j(R,1),R.m(s,h)):R&&(it(),Y(R,1,1,()=>{R=null}),rt());const F={};y&32&&(F.items=B[5]?[Ue.SETTINGS,Ue.DOMAIN_HINT,Ue.MANAGE]:[Ue.SETTINGS,Ue.MANAGE]),w.$set(F)},i(B){g||(j(c),j(r.$$.fragment,B),j(d),j(R),j(w.$$.fragment,B),g=!0)},o(B){Y(c),Y(r.$$.fragment,B),Y(d),Y(R),Y(w.$$.fragment,B),g=!1},d(B){B&&M(e),c&&c.d(),ve(r),k&&k.d(),d&&d.d(),R&&R.d(),ve(w),P=!1,kt(S)}}}function Al(n,e,t){let i,o,r,a;W(n,qn,F=>t(6,o=F)),W(n,Xn,F=>t(7,r=F)),W(n,li,F=>t(8,a=F));let{hasChapterData:l}=e,{autoScrollMultiplier:s}=e,{hasCustomReadingPoint:u}=e,{showFullscreenButton:h}=e,{isBookmarkScreen:w}=e;const g=wn(),P=[...u?[{label:"Show Point",action:"showCustomReadingPoint"}]:[],{label:"Set Point",action:"setCustomReadingPoint"},...u?[{label:"Reset Point",action:"resetCustomReadingPoint"}]:[]];let S;function c(F){g(F),S.toggleOpen()}const k=()=>g("tocClick"),d=()=>g("bookmarkClick"),R=F=>c(F.action);function B(F){ne[F?"unshift":"push"](()=>{S=F,t(4,S)})}const y=()=>g("fullscreenClick"),D=({detail:F})=>{F===Ue.SETTINGS.label?g("settingsClick"):F===Ue.DOMAIN_HINT.label?g("domainHintClick"):F===Ue.MANAGE.label&&g("bookManagerClick")};return n.$$set=F=>{"hasChapterData"in F&&t(0,l=F.hasChapterData),"autoScrollMultiplier"in F&&t(1,s=F.autoScrollMultiplier),"hasCustomReadingPoint"in F&&t(12,u=F.hasCustomReadingPoint),"showFullscreenButton"in F&&t(2,h=F.showFullscreenButton),"isBookmarkScreen"in F&&t(3,w=F.isBookmarkScreen)},t(5,i=Pr(window)),[l,s,h,w,S,i,o,r,a,g,P,c,u,k,d,R,B,y,D]}class Ol extends Et{constructor(e){super(),Dt(this,e,Al,Il,Ft,{hasChapterData:0,autoScrollMultiplier:1,hasCustomReadingPoint:12,showFullscreenButton:2,isBookmarkScreen:3})}}function Io(n,e,t){const i=n.slice();return i[16]=e[t],i}function Ao(n,e){let t,i,o=e[16].label+"",r,a,l,s,u=e[16].startCharacter+"",h,w,g,P;function S(){return e[13](e[16])}return{key:n,first:null,c(){t=x("div"),i=x("div"),r=Ce(o),l=oe(),s=x("div"),h=Ce(u),w=oe(),this.h()},l(c){t=$(c,"DIV",{class:!0});var k=ee(t);i=$(k,"DIV",{id:!0,class:!0});var d=ee(i);r=_e(d,o),d.forEach(M),l=ie(k),s=$(k,"DIV",{});var R=ee(s);h=_e(R,u),R.forEach(M),w=ie(k),k.forEach(M),this.h()},h(){U(i,"id",a=`for${e[16].reference}`),U(i,"class","mr-4 cursor-pointer"),K(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),K(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),K(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),K(s,"opacity-30",e[16].progress===100&&e[16]!==e[2]),U(t,"class","my-6 flex justify-between"),this.first=t},m(c,k){H(c,t,k),te(t,i),te(i,r),te(t,l),te(t,s),te(s,h),te(t,w),g||(P=[me(i,"click",S),me(i,"keydown",pt)],g=!0)},p(c,k){e=c,k&2&&o!==(o=e[16].label+"")&&Qe(r,o),k&2&&a!==(a=`for${e[16].reference}`)&&U(i,"id",a),k&6&&K(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),k&6&&K(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),k&6&&K(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),k&2&&u!==(u=e[16].startCharacter+"")&&Qe(h,u),k&6&&K(s,"opacity-30",e[16].progress===100&&e[16]!==e[2])},d(c){c&&M(t),g=!1,kt(P)}}}function Ll(n){let e,t,i,o,r,a,l,s,u,h,w,g,P=[],S=new Map,c,k,d,R,B,y,D,F,X,I;h=new at({props:{icon:na}});let A=n[1];const L=T=>T[16].reference;for(let T=0;T<A.length;T+=1){let N=Io(n,A,T),_=L(N);S.set(_,P[T]=Ao(_,N))}return R=new at({props:{icon:oa}}),D=new at({props:{icon:ia}}),{c(){e=x("div"),t=x("div"),i=Ce("Chapter Progress: "),o=Ce(n[3]),r=Ce(" ("),a=Ce(n[4]),l=Ce("%)"),s=oe(),u=x("div"),we(h.$$.fragment),w=oe(),g=x("div");for(let T=0;T<P.length;T+=1)P[T].c();c=oe(),k=x("div"),d=x("div"),we(R.$$.fragment),B=oe(),y=x("div"),we(D.$$.fragment),this.h()},l(T){e=$(T,"DIV",{class:!0});var N=ee(e);t=$(N,"DIV",{});var _=ee(t);i=_e(_,"Chapter Progress: "),o=_e(_,n[3]),r=_e(_," ("),a=_e(_,n[4]),l=_e(_,"%)"),_.forEach(M),s=ie(N),u=$(N,"DIV",{class:!0});var V=ee(u);Se(h.$$.fragment,V),V.forEach(M),N.forEach(M),w=ie(T),g=$(T,"DIV",{class:!0});var C=ee(g);for(let ye=0;ye<P.length;ye+=1)P[ye].l(C);C.forEach(M),c=ie(T),k=$(T,"DIV",{class:!0});var O=ee(k);d=$(O,"DIV",{class:!0});var Z=ee(d);Se(R.$$.fragment,Z),Z.forEach(M),B=ie(O),y=$(O,"DIV",{class:!0});var he=ee(y);Se(D.$$.fragment,he),he.forEach(M),O.forEach(M),this.h()},h(){U(u,"class","flex cursor-pointer items-end md:items-center"),U(e,"class","flex justify-between p-4"),U(g,"class","flex-1 overflow-auto p-4"),U(d,"class","cursor-pointer"),K(d,"opacity-30",!n[6]),U(y,"class","cursor-pointer"),K(y,"opacity-30",!n[5]),U(k,"class","flex justify-between px-4 py-6")},m(T,N){H(T,e,N),te(e,t),te(t,i),te(t,o),te(t,r),te(t,a),te(t,l),te(e,s),te(e,u),Pe(h,u,null),H(T,w,N),H(T,g,N);for(let _=0;_<P.length;_+=1)P[_].m(g,null);H(T,c,N),H(T,k,N),te(k,d),Pe(R,d,null),te(k,B),te(k,y),Pe(D,y,null),F=!0,X||(I=[me(u,"click",n[9]),me(u,"keydown",pt),me(d,"click",n[14]),me(d,"keydown",pt),me(y,"click",n[15]),me(y,"keydown",pt)],X=!0)},p(T,[N]){(!F||N&8)&&Qe(o,T[3]),(!F||N&16)&&Qe(a,T[4]),N&262&&(A=T[1],P=Zo(P,N,L,1,T,A,S,g,xo,Ao,null,Io)),(!F||N&64)&&K(d,"opacity-30",!T[6]),(!F||N&32)&&K(y,"opacity-30",!T[5])},i(T){F||(j(h.$$.fragment,T),j(R.$$.fragment,T),j(D.$$.fragment,T),F=!0)},o(T){Y(h.$$.fragment,T),Y(R.$$.fragment,T),Y(D.$$.fragment,T),F=!1},d(T){T&&M(e),ve(h),T&&M(w),T&&M(g);for(let N=0;N<P.length;N+=1)P[N].d();T&&M(c),T&&M(k),ve(R),ve(D),X=!1,kt(I)}}}function Vl(n,e){const[t,i]=e.reduce((o,r,a)=>(o[0]+=n[a]*r,o[1]+=r,o),[0,0]);return t/i}function Oo(n){!n||(n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView())}function zl(n,e,t){let i,o,{sectionData:r=[]}=e,{exploredCharCount:a=0}=e,{verticalMode:l}=e,s=[],u,h=-1,w="0/0",g="0.00";Qo(()=>{nt.dialogs$.next([{component:"<div/>"}]),u&&Oo(document.getElementById(`for${u.reference}`))});function P(B,y){if(B){const D=s[h+y];S(D.reference,!1)}}function S(B,y=!1){on.next(B),y&&c()}function c(){zt.next(!1),nt.dialogs$.next([])}const k=B=>S(B.reference,!0),d=()=>P(i,l?1:-1),R=()=>P(o,l?-1:1);return n.$$set=B=>{"sectionData"in B&&t(10,r=B.sectionData),"exploredCharCount"in B&&t(11,a=B.exploredCharCount),"verticalMode"in B&&t(0,l=B.verticalMode)},n.$$.update=()=>{if(n.$$.dirty&5120&&r){const[B,y,D]=mi(r),F=r.filter(X=>X.reference===D||X.parentChapter===D);t(4,g=Vl(F.map(X=>X.progress),F.map(X=>X.charactersWeight)).toFixed(2)),t(1,s=B),t(12,h=y),t(2,u=B[h])}if(n.$$.dirty&4099&&t(6,i=l?h<s.length-1:!!h),n.$$.dirty&4099&&t(5,o=l?!!h:h<s.length-1),n.$$.dirty&2052&&u){Oo(document.getElementById(`for${u.reference}`));const B=u.characters;t(3,w=`${Math.min(Math.max(a-u.startCharacter,0),B)} / ${B}`)}},[l,s,u,w,g,o,i,P,S,c,r,a,h,k,d,R]}class Nl extends Et{constructor(e){super(),Dt(this,e,zl,Ll,Ft,{sectionData:10,exploredCharCount:11,verticalMode:0})}}class Hl{constructor(e){et(this,"fallbackSpec");this.fallbackSpec=Lo(e)}get fullscreenEnabled(){return this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled")??!1}get fullscreenElement(){return this.fallbackSpec("fullscreenElement","webkitFullscreenElement")??null}async requestFullscreen(e,t){const i=Lo(e)("requestFullscreen","webkitRequestFullscreen");!i||await i(t)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function Lo(n){return(e,t)=>Vo(n,e)??Vo(n,t)}function Vo(n,e){const t=n[e];return typeof t=="function"?t.bind(n):t}const dn=new Hl(document);function Gl(n,e){return Wl(n).pipe(Je(t=>{const i=e.createElement("div");return i.innerHTML=t,jl(i),Xl(i),ql(i,e),Kl(i),i.innerHTML}))}function Wl(n){return new Pt(e=>{const{blobs:t}=n;let{elementHtml:i}=n;const o=[];return Object.entries(t).forEach(([r,a])=>{const l=URL.createObjectURL(a);o.push(l),i=i.replaceAll(vr(r),l).replaceAll(`ttu:${r}`,l)}),e.next(i),()=>{o.forEach(r=>URL.revokeObjectURL(r))}})}function jl(n){Array.from(n.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:si(e)})).forEach(({parentEl:e,isGaiji:t})=>{e==null||e.classList.add("ttu-img-container"),t||e==null||e.classList.add("ttu-illustration-container")})}function Xl(n){Array.from(n.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function ql(n,e){const t=()=>{let o=[...n.children];const r=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return r>0&&r<o.length&&(o=o.slice(r)),o},i=(o,r)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||r).insertBefore(a,o),a.appendChild(o)};t().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(r=>!si(r)).forEach(r=>i(r,o)),Array.from(o.getElementsByTagName("svg")).filter(r=>r.getElementsByTagName("image").length).forEach(r=>i(r,o))})}function Kl(n){n.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Yl=Si;function Si(n,e,t){n instanceof RegExp&&(n=zo(n,t)),e instanceof RegExp&&(e=zo(e,t));const i=Pi(n,e,t);return i&&{start:i[0],end:i[1],pre:t.slice(0,i[0]),body:t.slice(i[0]+n.length,i[1]),post:t.slice(i[1]+e.length)}}function zo(n,e){const t=e.match(n);return t?t[0]:null}Si.range=Pi;function Pi(n,e,t){let i,o,r,a,l,s=t.indexOf(n),u=t.indexOf(e,s+1),h=s;if(s>=0&&u>0){if(n===e)return[s,u];for(i=[],r=t.length;h>=0&&!l;)h===s?(i.push(h),s=t.indexOf(n,h+1)):i.length===1?l=[i.pop(),u]:(o=i.pop(),o<r&&(r=o,a=u),u=t.indexOf(e,h+1)),h=s<u&&s>=0?s:u;i.length&&(l=[r,a])}return l}function Ul(n,e={}){const i=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function r(_){throw new Error(`CSS parse error: ${_}`)}function a(_){const V=_.exec(n);if(V)return n=n.slice(V[0].length),V}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function u(){a(/^\s*/)}function h(){if(u(),n[0]!=="/"||n[1]!=="*")return;let _=2;for(;n[_]&&(n[_]!=="*"||n[_+1]!=="/");)_++;if(!n[_])return r("end of comment is missing");const V=n.slice(2,_);return n=n.slice(_+2),{type:"comment",comment:V}}function w(){const _=[];let V;for(;V=h();)_.push(V);return i.removeComments?[]:_}function g(){for(u();n[0]==="}";)r("extra closing bracket");const _=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(_)return _[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(V){return V.replace(/,/g,"‌")}).split(/\s*(?![^(]*\)),\s*/).map(function(V){return V.replace(/\u200C/g,",")})}function P(){if(n[0]==="@")return L();a(/^([;\s]*)+/);const _=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let V=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!V)return;if(V=V[0].trim(),!a(/^:\s*/))return r("property missing ':'");const C=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),O={type:"declaration",property:V.replace(_,""),value:C?C[0].replace(_,"").trim():""};return a(/^[;\s]*/),O}function S(){if(!l())return r("missing '{'");let _,V=w();for(;_=P();)V.push(_),V=V.concat(w());return s()?V:r("missing '}'")}function c(){u();const _=[];let V;for(;V=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)_.push(V[1]),a(/^,\s*/);if(_.length)return{type:"keyframe",values:_,declarations:S()}}function k(){let _=a(/^@([-\w]+)?keyframes\s*/);if(!_)return;const V=_[1];if(_=a(/^([-\w]+)\s*/),!_)return r("@keyframes missing name");const C=_[1];if(!l())return r("@keyframes missing '{'");let O,Z=w();for(;O=c();)Z.push(O),Z=Z.concat(w());return s()?{type:"keyframes",name:C,vendor:V,keyframes:Z}:r("@keyframes missing '}'")}function d(){if(a(/^@page */))return{type:"page",selectors:g()||[],declarations:S()}}function R(){const _=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(_)return{type:"page-margin-box",name:`${_[1]}-${_[2]}`+(_[3]?`-${_[3]}`:""),declarations:S()}}function B(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:S()}}function y(){const _=a(/^@supports *([^{]+)/);if(_)return{type:"supports",supports:_[1].trim(),rules:N()}}function D(){if(a(/^@host\s*/))return{type:"host",rules:N()}}function F(){const _=a(/^@media([^{]+)*/);if(_)return{type:"media",media:(_[1]||"").trim(),rules:N()}}function X(){const _=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(_)return{type:"custom-media",name:_[1].trim(),media:_[2].trim()}}function I(){const _=a(/^@([-\w]+)?document *([^{]+)/);if(_)return{type:"document",document:_[2].trim(),vendor:_[1]?_[1].trim():null,rules:N()}}function A(){const _=a(/^@(import|charset|namespace)\s*([^;]+);/);if(_)return{type:_[1],name:_[2].trim()}}function L(){if(u(),n[0]==="@"){const _=A()||B()||F()||k()||y()||I()||X()||D()||d()||R();if(_&&!i.preserveStatic){let V=!1;return _.declarations?V=_.declarations.some(C=>/var\(/.test(C.value)):V=(_.keyframes||_.rules||[]).some(O=>(O.declarations||[]).some(Z=>/var\(/.test(Z.value))),V?_:{}}return _}}function T(){if(!i.preserveStatic){const C=Yl("{","}",n);if(C){const O=/:(?:root|host)(?![.:#(])/.test(C.pre)&&/--\S*\s*:/.test(C.body),Z=/var\(/.test(C.body);if(!O&&!Z)return n=n.slice(C.end+1),{}}}const _=g()||[],V=i.preserveStatic?S():S().filter(C=>{const O=_.some(he=>/:(?:root|host)(?![.:#(])/.test(he))&&/^--\S/.test(C.property),Z=/var\(/.test(C.value);return O||Z});return _.length||r("selector missing"),{type:"rule",selectors:_,declarations:V}}function N(_){if(!_&&!l())return r("missing '{'");let V,C=w();for(;n.length&&(_||n[0]!=="}")&&(V=L()||T());)V.type&&C.push(V),C=C.concat(w());return!_&&!s()?r("missing '}'"):C}return{type:"stylesheet",stylesheet:{rules:N(!0),errors:o}}}function Jl(n,e="",t){const i={charset(r){return"@charset "+r.name+";"},comment(r){return r.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+r.comment+"*/":""},"custom-media"(r){return"@custom-media "+r.name+" "+r.media+";"},declaration(r){return r.property+":"+r.value+";"},document(r){return"@"+(r.vendor||"")+"document "+r.document+"{"+o(r.rules)+"}"},"font-face"(r){return"@font-face{"+o(r.declarations)+"}"},host(r){return"@host{"+o(r.rules)+"}"},import(r){return"@import "+r.name+";"},keyframe(r){return r.values.join(",")+"{"+o(r.declarations)+"}"},keyframes(r){return"@"+(r.vendor||"")+"keyframes "+r.name+"{"+o(r.keyframes)+"}"},media(r){return"@media "+r.media+"{"+o(r.rules)+"}"},namespace(r){return"@namespace "+r.name+";"},page(r){return"@page "+(r.selectors.length?r.selectors.join(", "):"")+"{"+o(r.declarations)+"}"},"page-margin-box"(r){return"@"+r.name+"{"+o(r.declarations)+"}"},rule(r){const a=r.declarations;if(a.length)return r.selectors.join(",")+"{"+o(a)+"}"},supports(r){return"@supports "+r.supports+"{"+o(r.rules)+"}"}};function o(r){let a="";for(let l=0;l<r.length;l++){const s=r[l];t&&t(s);const u=i[s.type](s);u&&(a+=u,u.length&&s.selectors&&(a+=e))}return a}return o(n.stylesheet.rules)}const Ql=/\s?html\s?/gi,Zl=/\s?body\s?/gi;function xl(n,e){const i=Ul(n.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(r=>Ql.test(r)||Zl.test(r)));return i.forEach(o=>{const r={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new ns(o.declarations,r);o.declarations.forEach(l=>{An(r,es(l)),An(r,ts(l)),An(r,a.convert(l))}),Object.entries(r).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),i.push(os()),i.forEach(o=>{o.selectors=$l(o.selectors,e)}),Jl({stylesheet:{rules:i},type:"stylesheet"})}function $l(n,e){return n.map(t=>`${e} ${t}`)}function An(n,e){return e&&(n[e.key]=e.value),n}function es(n){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(n.property);if(e)return{key:e[1],value:n.value}}function ts(n){if(n.property==="font-family"){let e=n.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:n.property,value:e}}}class ns{constructor(e,t){et(this,"hasLineBreakDefined");this.ruleDeclarations=e,this.newDeclarations=t}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(t=>t.type==="declaration"&&t.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function os(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}function is(n,e,t){return Gl(n,t).pipe(Je(i=>({htmlContent:i,styleSheet:xl(n,e)})))}function rs(n){return new Pt(e=>n.subscribe(t=>{e.next(t)}))}function cn(n=Rr){return e=>n?e:yr}function No(n,e,t){return i=>new Pt(o=>{const r=n();return i.pipe(ii(vn),Ia(()=>t(r))).subscribe({next:a=>{e(a,r),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}function as(n,e,t,i,o,r,a,l,s,u){switch(e[n.code]){case mt.BOOKMARK:return t(!0),!0;case mt.JUMP_TO_BOOKMARK:return i(),!0;case mt.AUTO_SCROLL_TOGGLE:return r==null||r.toggle(),!0;case mt.AUTO_SCROLL_INCREASE:return o(1),!0;case mt.AUTO_SCROLL_DECREASE:return o(-1),!0;case mt.NEXT_PAGE:return a==null||a.nextPage(),!0;case mt.PREV_PAGE:return a==null||a.prevPage(),!0;case mt.PREV_CHAPTER:return s(l?1:-1),!0;case mt.NEXT_CHAPTER:return s(l?-1:1),!0;case mt.SET_READING_POINT:return u(),!0;default:return!1}}const{document:On,window:Ho}=Wn;function Go(n){var w;let e,t,i,o,r,a,l,s;function u(g){n[79](g)}let h={hasChapterData:!!((w=n[26])!=null&&w.length),hasCustomReadingPoint:!!(n[28]&&(n[22]&&n[4]||!n[22]&&n[15]>-1&&n[14]>-1)),showFullscreenButton:dn.fullscreenEnabled,autoScrollMultiplier:n[29]};return n[10]!==void 0&&(h.isBookmarkScreen=n[10]),t=new Ol({props:h}),ne.push(()=>fe(t,"isBookmarkScreen",u)),t.$on("tocClick",n[80]),t.$on("setCustomReadingPoint",n[75]),t.$on("showCustomReadingPoint",n[81]),t.$on("resetCustomReadingPoint",n[82]),t.$on("fullscreenClick",n[71]),t.$on("bookmarkClick",n[70]),t.$on("settingsClick",n[83]),t.$on("domainHintClick",n[72]),t.$on("bookManagerClick",n[84]),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(g){e=$(g,"DIV",{class:!0});var P=ee(e);Se(t.$$.fragment,P),P.forEach(M),this.h()},h(){U(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(g,P){H(g,e,P),Pe(t,e,null),a=!0,l||(s=jn(o=fi.call(null,e,n[85])),l=!0)},p(g,P){var c;n=g;const S={};P[0]&67108864&&(S.hasChapterData=!!((c=n[26])!=null&&c.length)),P[0]&272678928&&(S.hasCustomReadingPoint=!!(n[28]&&(n[22]&&n[4]||!n[22]&&n[15]>-1&&n[14]>-1))),P[0]&536870912&&(S.autoScrollMultiplier=n[29]),!i&&P[0]&1024&&(i=!0,S.isBookmarkScreen=n[10],ce(()=>i=!1)),t.$set(S),o&&Jo(o.update)&&P[0]&512&&o.update.call(null,n[85])},i(g){a||(j(t.$$.fragment,g),g&&$o(()=>{r||(r=lo(e,Hn,{y:-300,easing:Nn},!0)),r.run(1)}),a=!0)},o(g){Y(t.$$.fragment,g),g&&(r||(r=lo(e,Hn,{y:-300,easing:Nn},!1)),r.run(0)),a=!1},d(g){g&&M(e),ve(t),g&&r&&r.end(),l=!1,s()}}}function ls(n){let e=(n[52]??"")+"",t;return{c(){t=Ce(e)},l(i){t=_e(i,e)},m(i,o){H(i,t,o)},p(i,o){o[1]&2097152&&e!==(e=(i[52]??"")+"")&&Qe(t,e)},i:Mt,o:Mt,d(i){i&&M(t)}}}function ss(n){var Re,He,Te;let e,t,i,o,r,a,l,s,u,h,w,g,P,S,c,k,d,R=(n[47]??"")+"",B,y,D=(n[48]??"")+"",F,X,I=(n[49]??"")+"",A,L,T=(n[50]??"")+"",N,_,V=(n[51]??"")+"",C,O;e=new Fl({props:{styleSheet:n[30].styleSheet}});function Z(b){n[86](b)}function he(b){n[87](b)}function ye(b){n[88](b)}function De(b){n[89](b)}function pe(b){n[90](b)}function Oe(b){n[91](b)}function Le(b){n[92](b)}function de(b){n[93](b)}function re(b){n[94](b)}function ae(b){n[95](b)}function Be(b){n[96](b)}function J(b){n[97](b)}function be(b){n[98](b)}let ge={htmlContent:n[30].htmlContent,width:n[31]??0,height:n[32]??0,verticalMode:n[23],fontColor:(Re=n[33])==null?void 0:Re.fontColor,backgroundColor:n[34],hintFuriganaFontColor:(He=n[33])==null?void 0:He.hintFuriganaFontColor,hintFuriganaShadowColor:(Te=n[33])==null?void 0:Te.hintFuriganaShadowColor,fontFamilyGroupOne:n[35],fontFamilyGroupTwo:n[36],fontSize:n[37],lineHeight:n[38],hideSpoilerImage:n[39],hideFurigana:n[40],furiganaStyle:n[41],viewMode:n[6],secondDimensionMaxValue:n[42],firstDimensionMargin:n[24],autoPositionOnResize:n[43],avoidPageBreak:n[44],pageColumns:n[45],autoBookmark:n[46],multiplier:n[29]};return n[0]!==void 0&&(ge.exploredCharCount=n[0]),n[1]!==void 0&&(ge.bookCharCount=n[1]),n[10]!==void 0&&(ge.isBookmarkScreen=n[10]),n[3]!==void 0&&(ge.bookmarkData=n[3]),n[2]!==void 0&&(ge.autoScroller=n[2]),n[12]!==void 0&&(ge.bookmarkManager=n[12]),n[13]!==void 0&&(ge.pageManager=n[13]),n[16]!==void 0&&(ge.customReadingPoint=n[16]),n[14]!==void 0&&(ge.customReadingPointTop=n[14]),n[15]!==void 0&&(ge.customReadingPointLeft=n[15]),n[17]!==void 0&&(ge.customReadingPointScrollOffset=n[17]),n[4]!==void 0&&(ge.customReadingPointRange=n[4]),n[5]!==void 0&&(ge.showCustomReadingPoint=n[5]),i=new Ml({props:ge}),ne.push(()=>fe(i,"exploredCharCount",Z)),ne.push(()=>fe(i,"bookCharCount",he)),ne.push(()=>fe(i,"isBookmarkScreen",ye)),ne.push(()=>fe(i,"bookmarkData",De)),ne.push(()=>fe(i,"autoScroller",pe)),ne.push(()=>fe(i,"bookmarkManager",Oe)),ne.push(()=>fe(i,"pageManager",Le)),ne.push(()=>fe(i,"customReadingPoint",de)),ne.push(()=>fe(i,"customReadingPointTop",re)),ne.push(()=>fe(i,"customReadingPointLeft",ae)),ne.push(()=>fe(i,"customReadingPointScrollOffset",Be)),ne.push(()=>fe(i,"customReadingPointRange",J)),ne.push(()=>fe(i,"showCustomReadingPoint",be)),i.$on("bookmark",n[70]),{c(){we(e.$$.fragment),t=oe(),we(i.$$.fragment),d=oe(),B=Ce(R),y=oe(),F=Ce(D),X=oe(),A=Ce(I),L=oe(),N=Ce(T),_=oe(),C=Ce(V)},l(b){Se(e.$$.fragment,b),t=ie(b),Se(i.$$.fragment,b),d=ie(b),B=_e(b,R),y=ie(b),F=_e(b,D),X=ie(b),A=_e(b,I),L=ie(b),N=_e(b,T),_=ie(b),C=_e(b,V)},m(b,z){Pe(e,b,z),H(b,t,z),Pe(i,b,z),H(b,d,z),H(b,B,z),H(b,y,z),H(b,F,z),H(b,X,z),H(b,A,z),H(b,L,z),H(b,N,z),H(b,_,z),H(b,C,z),O=!0},p(b,z){var Me,Ge,We;const Ie={};z[0]&1073741824&&(Ie.styleSheet=b[30].styleSheet),e.$set(Ie);const q={};z[0]&1073741824&&(q.htmlContent=b[30].htmlContent),z[1]&1&&(q.width=b[31]??0),z[1]&2&&(q.height=b[32]??0),z[0]&8388608&&(q.verticalMode=b[23]),z[1]&4&&(q.fontColor=(Me=b[33])==null?void 0:Me.fontColor),z[1]&8&&(q.backgroundColor=b[34]),z[1]&4&&(q.hintFuriganaFontColor=(Ge=b[33])==null?void 0:Ge.hintFuriganaFontColor),z[1]&4&&(q.hintFuriganaShadowColor=(We=b[33])==null?void 0:We.hintFuriganaShadowColor),z[1]&16&&(q.fontFamilyGroupOne=b[35]),z[1]&32&&(q.fontFamilyGroupTwo=b[36]),z[1]&64&&(q.fontSize=b[37]),z[1]&128&&(q.lineHeight=b[38]),z[1]&256&&(q.hideSpoilerImage=b[39]),z[1]&512&&(q.hideFurigana=b[40]),z[1]&1024&&(q.furiganaStyle=b[41]),z[0]&64&&(q.viewMode=b[6]),z[1]&2048&&(q.secondDimensionMaxValue=b[42]),z[0]&16777216&&(q.firstDimensionMargin=b[24]),z[1]&4096&&(q.autoPositionOnResize=b[43]),z[1]&8192&&(q.avoidPageBreak=b[44]),z[1]&16384&&(q.pageColumns=b[45]),z[1]&32768&&(q.autoBookmark=b[46]),z[0]&536870912&&(q.multiplier=b[29]),!o&&z[0]&1&&(o=!0,q.exploredCharCount=b[0],ce(()=>o=!1)),!r&&z[0]&2&&(r=!0,q.bookCharCount=b[1],ce(()=>r=!1)),!a&&z[0]&1024&&(a=!0,q.isBookmarkScreen=b[10],ce(()=>a=!1)),!l&&z[0]&8&&(l=!0,q.bookmarkData=b[3],ce(()=>l=!1)),!s&&z[0]&4&&(s=!0,q.autoScroller=b[2],ce(()=>s=!1)),!u&&z[0]&4096&&(u=!0,q.bookmarkManager=b[12],ce(()=>u=!1)),!h&&z[0]&8192&&(h=!0,q.pageManager=b[13],ce(()=>h=!1)),!w&&z[0]&65536&&(w=!0,q.customReadingPoint=b[16],ce(()=>w=!1)),!g&&z[0]&16384&&(g=!0,q.customReadingPointTop=b[14],ce(()=>g=!1)),!P&&z[0]&32768&&(P=!0,q.customReadingPointLeft=b[15],ce(()=>P=!1)),!S&&z[0]&131072&&(S=!0,q.customReadingPointScrollOffset=b[17],ce(()=>S=!1)),!c&&z[0]&16&&(c=!0,q.customReadingPointRange=b[4],ce(()=>c=!1)),!k&&z[0]&32&&(k=!0,q.showCustomReadingPoint=b[5],ce(()=>k=!1)),i.$set(q),(!O||z[1]&65536)&&R!==(R=(b[47]??"")+"")&&Qe(B,R),(!O||z[1]&131072)&&D!==(D=(b[48]??"")+"")&&Qe(F,D),(!O||z[1]&262144)&&I!==(I=(b[49]??"")+"")&&Qe(A,I),(!O||z[1]&524288)&&T!==(T=(b[50]??"")+"")&&Qe(N,T),(!O||z[1]&1048576)&&V!==(V=(b[51]??"")+"")&&Qe(C,V)},i(b){O||(j(e.$$.fragment,b),j(i.$$.fragment,b),O=!0)},o(b){Y(e.$$.fragment,b),Y(i.$$.fragment,b),O=!1},d(b){ve(e,b),b&&M(t),ve(i,b),b&&M(d),b&&M(B),b&&M(y),b&&M(F),b&&M(X),b&&M(A),b&&M(L),b&&M(N),b&&M(_),b&&M(C)}}}function Wo(n){let e,t,i,o,r,a;return t=new Nl({props:{sectionData:n[26],verticalMode:n[23],exploredCharCount:n[0]}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(l){e=$(l,"DIV",{class:!0});var s=ee(e);Se(t.$$.fragment,s),s.forEach(M),this.h()},h(){var l;U(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),E(e,"color",(l=n[33])==null?void 0:l.fontColor),E(e,"background-color",n[34])},m(l,s){H(l,e,s),Pe(t,e,null),o=!0,r||(a=jn(fi.call(null,e,n[99])),r=!0)},p(l,s){var h;n=l;const u={};s[0]&67108864&&(u.sectionData=n[26]),s[0]&8388608&&(u.verticalMode=n[23]),s[0]&1&&(u.exploredCharCount=n[0]),t.$set(u),s[1]&4&&E(e,"color",(h=n[33])==null?void 0:h.fontColor),s[1]&8&&E(e,"background-color",n[34])},i(l){o||(j(t.$$.fragment,l),l&&(i||$o(()=>{i=ur(e,Hn,{x:-100,duration:100,easing:Nn}),i.start()})),o=!0)},o(l){Y(t.$$.fragment,l),o=!1},d(l){l&&M(e),ve(t),r=!1,a()}}}function jo(n){let e,t,i;return{c(){e=x("div"),t=oe(),i=x("div"),this.h()},l(o){e=$(o,"DIV",{class:!0}),ee(e).forEach(M),t=ie(o),i=$(o,"DIV",{class:!0}),ee(i).forEach(M),this.h()},h(){U(e,"class","fixed left-0 z-20 h-[1px] w-full border border-red-500"),E(e,"top",`${n[14]}px`),U(i,"class","fixed top-0 z-20 h-full w-[1px] border border-red-500"),E(i,"left",`${n[15]}px`)},m(o,r){H(o,e,r),H(o,t,r),H(o,i,r)},p(o,r){r[0]&16384&&E(e,"top",`${o[14]}px`),r[0]&32768&&E(i,"left",`${o[15]}px`)},d(o){o&&M(e),o&&M(t),o&&M(i)}}}function Xo(n){let e,t,i;return t=new at({props:{icon:Kn,spin:!0}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Se(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl")},m(o,r){H(o,e,r),Pe(t,e,null),i=!0},p:Mt,i(o){i||(j(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),ve(t)}}}function qo(n){let e,t,i,o,r;return t=new at({props:{icon:ra}}),{c(){e=x("div"),we(t.$$.fragment),this.h()},l(a){e=$(a,"DIV",{class:!0});var l=ee(e);Se(t.$$.fragment,l),l.forEach(M),this.h()},h(){U(e,"class","flex h-full w-8 items-center justify-center text-lg"),K(e,"text-red-500",n[20]>1),K(e,"animate-pulse",n[20]>1||n[21])},m(a,l){H(a,e,l),Pe(t,e,null),i=!0,o||(r=[me(e,"click",fr(n[100])),me(e,"keyup",pt)],o=!0)},p(a,l){(!i||l[0]&1048576)&&K(e,"text-red-500",a[20]>1),(!i||l[0]&3145728)&&K(e,"animate-pulse",a[20]>1||a[21])},i(a){i||(j(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&M(e),ve(t),o=!1,kt(r)}}}function Ko(n){let e,t,i,o,r,a=(n[0]/n[1]*100).toFixed(2)+"",l,s;return{c(){e=x("div"),t=Ce(n[0]),i=Ce(" / "),o=Ce(n[1]),r=Ce(" ("),l=Ce(a),s=Ce("%)"),this.h()},l(u){e=$(u,"DIV",{class:!0});var h=ee(e);t=_e(h,n[0]),i=_e(h," / "),o=_e(h,n[1]),r=_e(h," ("),l=_e(h,a),s=_e(h,"%)"),h.forEach(M),this.h()},h(){var u;U(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),E(e,"color",(u=n[33])==null?void 0:u.tooltipTextFontColor)},m(u,h){H(u,e,h),te(e,t),te(e,i),te(e,o),te(e,r),te(e,l),te(e,s)},p(u,h){var w;h[0]&1&&Qe(t,u[0]),h[0]&2&&Qe(o,u[1]),h[0]&3&&a!==(a=(u[0]/u[1]*100).toFixed(2)+"")&&Qe(l,a),h[1]&4&&E(e,"color",(w=u[33])==null?void 0:w.tooltipTextFontColor)},d(u){u&&M(e)}}}function us(n){var V;let e,t,i=(n[27]??"")+"",o,r,a,l,s,u,h,w,g,P,S,c,k,d,R,B,y;On.title=e=ho(((V=n[25])==null?void 0:V.title)??"");let D=n[9]&&Go(n);const F=[ss,ls],X=[];function I(C,O){return C[30]?0:1}u=I(n),h=X[u]=F[u](n);let A=n[7]&&Wo(n),L=(n[18]&&!n[53]||!n[22]&&n[5])&&jo(n),T=n[8]&&Xo(),N=n[19].length&&qo(n),_=n[11]&&n[1]&&Ko(n);return{c(){t=oe(),o=Ce(i),r=oe(),a=x("button"),l=oe(),D&&D.c(),s=oe(),h.c(),w=oe(),A&&A.c(),g=oe(),L&&L.c(),P=oe(),T&&T.c(),S=oe(),c=x("div"),k=x("div"),N&&N.c(),d=oe(),_&&_.c(),this.h()},l(C){sr("svelte-rnuhm6",On.head).forEach(M),t=ie(C),o=_e(C,i),r=ie(C),a=$(C,"BUTTON",{class:!0}),ee(a).forEach(M),l=ie(C),D&&D.l(C),s=ie(C),h.l(C),w=ie(C),A&&A.l(C),g=ie(C),L&&L.l(C),P=ie(C),T&&T.l(C),S=ie(C),c=$(C,"DIV",{class:!0});var Z=ee(c);k=$(Z,"DIV",{class:!0});var he=ee(k);N&&N.l(he),he.forEach(M),d=ie(Z),_&&_.l(Z),Z.forEach(M),this.h()},h(){var C;U(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),U(k,"class","h-full"),U(c,"class","writing-horizontal-tb fixed bottom-0 left-0 z-10 flex h-8 w-full cursor-pointer items-center justify-between text-xs leading-none"),E(c,"color",(C=n[33])==null?void 0:C.tooltipTextFontColor)},m(C,O){H(C,t,O),H(C,o,O),H(C,r,O),H(C,a,O),H(C,l,O),D&&D.m(C,O),H(C,s,O),X[u].m(C,O),H(C,w,O),A&&A.m(C,O),H(C,g,O),L&&L.m(C,O),H(C,P,O),T&&T.m(C,O),H(C,S,O),H(C,c,O),te(c,k),N&&N.m(k,null),te(c,d),_&&_.m(c,null),R=!0,B||(y=[me(Ho,"keydown",n[69]),me(Ho,"beforeunload",n[68]),me(a,"click",n[78]),me(c,"click",n[101]),me(c,"keyup",pt)],B=!0)},p(C,O){var he,ye;(!R||O[0]&33554432)&&e!==(e=ho(((he=C[25])==null?void 0:he.title)??""))&&(On.title=e),(!R||O[0]&134217728)&&i!==(i=(C[27]??"")+"")&&Qe(o,i),C[9]?D?(D.p(C,O),O[0]&512&&j(D,1)):(D=Go(C),D.c(),j(D,1),D.m(s.parentNode,s)):D&&(it(),Y(D,1,1,()=>{D=null}),rt());let Z=u;u=I(C),u===Z?X[u].p(C,O):(it(),Y(X[Z],1,1,()=>{X[Z]=null}),rt(),h=X[u],h?h.p(C,O):(h=X[u]=F[u](C),h.c()),j(h,1),h.m(w.parentNode,w)),C[7]?A?(A.p(C,O),O[0]&128&&j(A,1)):(A=Wo(C),A.c(),j(A,1),A.m(g.parentNode,g)):A&&(it(),Y(A,1,1,()=>{A=null}),rt()),C[18]&&!C[53]||!C[22]&&C[5]?L?L.p(C,O):(L=jo(C),L.c(),L.m(P.parentNode,P)):L&&(L.d(1),L=null),C[8]?T?(T.p(C,O),O[0]&256&&j(T,1)):(T=Xo(),T.c(),j(T,1),T.m(S.parentNode,S)):T&&(it(),Y(T,1,1,()=>{T=null}),rt()),C[19].length?N?(N.p(C,O),O[0]&524288&&j(N,1)):(N=qo(C),N.c(),j(N,1),N.m(k,null)):N&&(it(),Y(N,1,1,()=>{N=null}),rt()),C[11]&&C[1]?_?_.p(C,O):(_=Ko(C),_.c(),_.m(c,null)):_&&(_.d(1),_=null),O[1]&4&&E(c,"color",(ye=C[33])==null?void 0:ye.tooltipTextFontColor)},i(C){R||(j(D),j(h),j(A),j(T),j(N),R=!0)},o(C){Y(D),Y(h),Y(A),Y(T),Y(N),R=!1},d(C){C&&M(t),C&&M(o),C&&M(r),C&&M(a),C&&M(l),D&&D.d(C),C&&M(s),X[u].d(C),C&&M(w),A&&A.d(C),C&&M(g),L&&L.d(C),C&&M(P),T&&T.d(C),C&&M(S),C&&M(c),N&&N.d(),_&&_.d(),B=!1,kt(y)}}}const Yo="background-color",Uo="writing-mode";function fs(n,e,t){let i,o,r,a,l,s,u,h,w,g,P,S,c,k,d,R,B,y,D,F,X,I,A,L,T,N,_,V,C,O,Z,he,ye,De,pe,Oe,Le,de,re,ae,Be,J,be,ge,Re,He;W(n,Tr,f=>t(23,r=f)),W(n,ri,f=>t(24,a=f)),W(n,Ir,f=>t(108,l=f)),W(n,Ar,f=>t(109,s=f)),W(n,Or,f=>t(110,h=f)),W(n,Lr,f=>t(111,w=f)),W(n,ai,f=>t(112,P=f)),W(n,Kt,f=>t(113,S=f)),W(n,Vr,f=>t(77,c=f)),W(n,zr,f=>t(114,k=f)),W(n,Nr,f=>t(115,d=f)),W(n,li,f=>t(6,R=f)),W(n,zt,f=>t(7,B=f)),W(n,Fn,f=>t(116,y=f)),W(n,Bn,f=>t(117,D=f)),W(n,Xn,f=>t(28,X=f)),W(n,Tn,f=>t(29,I=f)),W(n,Hr,f=>t(35,V=f)),W(n,Gr,f=>t(36,C=f)),W(n,Wr,f=>t(37,O=f)),W(n,jr,f=>t(38,Z=f)),W(n,Xr,f=>t(39,he=f)),W(n,qr,f=>t(40,ye=f)),W(n,Kr,f=>t(41,De=f)),W(n,Yr,f=>t(42,pe=f)),W(n,Ur,f=>t(43,Oe=f)),W(n,Jr,f=>t(44,Le=f)),W(n,Qr,f=>t(45,de=f)),W(n,Zr,f=>t(46,re=f)),W(n,qn,f=>t(53,He=f));let Te=!0,b=!0,z=!1,Ie=!0,q=0,Me=0,Ge,We,ft,Fe=Promise.resolve(void 0),ke=-2,Ae=-2,qe=r?D:y,je=0,Ee,Xe,bt=!0,tt=!1,ct=!1,Ke,Ze=[],ht=[],Ve,v=0,le=!1,Ye=0;const p=tn(2500).pipe(wt(()=>t(9,b=!1)),Rt());W(n,p,f=>t(27,F=f));const Q=At(()=>rs(xr)).pipe(Je(f=>Number(f.url.searchParams.get("id"))),Vn({refCount:!0,bufferSize:1})),ue=Q.pipe(Vt(async f=>{let G;try{if(Ke=ln(window,sn.BROWSER,void 0,!0,l,s),Ke.startContext({id:f,title:""}),G=await Ke.getBook(),!G)return G;Ke.startContext({id:G.id,title:G.title,imagePath:G.coverImage}),G.storageSource?t(76,Ve=await oo(G.storageSource,!0)):c!==jt.Off&&t(76,Ve=await oo(w)),G.lastBookOpen=new Date().getTime(),await Ke.updateLastRead(G),G=await yi(Ve,G),await Ri(Ve)}catch(se){const Ne=`Error loading book: ${se.message}`;_t.warn(Ne),nt.dialogs$.next([{component:Ct,props:{title:"Load Error",message:Ne}}]);return}finally{t(8,Te=!1)}return Ve&&Ve.updateSettings(window,!0,s,l,!1,G.storageSource||w),G}),zn());W(n,ue,f=>t(25,u=f));const ze=ue.pipe(wt(f=>{f||go(`${fo}${Ue.MANAGE.routeId}`)}),Rt());W(n,ze,f=>t(52,Re=f));const m=ue.pipe(wt(f=>{!f||t(3,Fe=Dn.getBookmark(f.id))}),Rt());W(n,m,f=>t(47,ae=f));const rn=ue.pipe(Vt(f=>f?(Un.next(f.sections||[]),is(f,".book-content",document)):Ht),Vn({refCount:!0,bufferSize:1}));W(n,rn,f=>t(30,A=f));const an=At(()=>visualViewport?ut(visualViewport,"resize"):Yn()).pipe(zn()),Qn=an.pipe(Ln(0),Je(()=>(visualViewport==null?void 0:visualViewport.width)||0),cn());W(n,Qn,f=>t(31,L=f));const Zn=an.pipe(Ln(0),Je(()=>(visualViewport==null?void 0:visualViewport.height)||0),cn());W(n,Zn,f=>t(32,T=f));const yn=Mr.pipe(Je(f=>ha.get(f)),xt(f=>!!f));W(n,yn,f=>t(33,N=f));const Rn=yn.pipe(Je(f=>f.backgroundColor));W(n,Rn,f=>t(34,_=f));const xn=Rn.pipe(No(()=>document.body,(f,G)=>G.style.setProperty(Yo,f),f=>f.style.removeProperty(Yo)),Rt(),cn());W(n,xn,f=>t(48,Be=f));const $n=Er.pipe(No(()=>document.documentElement,(f,G)=>G.style.setProperty(Uo,f),f=>f.style.removeProperty(Uo)),Rt(),cn());W(n,$n,f=>t(49,J=f));const eo=At(()=>bn).pipe(Je(f=>[...f.values()]));W(n,eo,f=>t(26,g=f));const to=At(()=>ut(document,"selectionchange")).pipe(Zt(200),wt(()=>{var G,se;const f=((G=window.getSelection())==null?void 0:G.toString())||"";!f&&bt?Xe=void 0:f?(Xe=(se=window.getSelection())==null?void 0:se.getRangeAt(0),bt=!1):bt=!0}),Rt());W(n,to,f=>t(50,be=f));const no=In.pipe(Fa(6e4),Vt(()=>Wt()),Rt());W(n,no,f=>t(51,ge=f));function vi(f){return d&&(le||Ye!==q||o&&Ze.length||o&&ht.length)?(f.preventDefault(),f.returnValue="Are you sure you want to exit?"):f}async function oo(f,G=!1){if(!f){if(G)throw new Error("No storage source found");return}if(f===uo.GDRIVE_DEFAULT){if(!k){nt.dialogs$.next([{component:Ct,props:{title:"Load Error",message:"Sync disabled due to missing Online Connection - refresh Page after going Online to try again"}}]);return}return ln(window,sn.GDRIVE,f,!0,l,s)}if(f===uo.ONEDRIVE_DEFAULT){if(!k){nt.dialogs$.next([{component:Ct,props:{title:"Load Error",message:"Sync disabled due to missing Online Connection - refresh Page after going Online to try again"}}]);return}return ln(window,sn.ONEDRIVE,f,!0,l,s)}if(f){const xe=await(await Dn.db).get("storageSource",f);if(xe){if(xe.type!==sn.FS&&!k){nt.dialogs$.next([{component:Ct,props:{title:"Load Error",message:"Sync disabled due to missing Online Connection - refresh Page after going Online to try again"}}]);return}return ln(window,xe.type,f,!0,l,s)}if(G)throw new Error(`No storage source with name ${f} found`)}const se=`No storage source with name ${f} found - skipping auto import/export`;_t.warn(se),nt.dialogs$.next([{component:Ct,props:{title:"Configuration Error",message:se}}])}async function yi(f,G){if(!f)return G;l||f.clearData(!1),f.startContext({id:G.id,title:G.title,imagePath:G.coverImage||""});let{id:se,...Ne}=G;if(G.storageSource){const lt=await f.getBook();lt&&!(lt instanceof File)&&(Ne={...lt,id:G.id,lastBookOpen:G.lastBookOpen,storageSource:G.storageSource})}else if(!G.elementHtml)throw new Error("Book has no data stored");const xe={id:se,...Ne};return await f.updateLastRead(xe).catch(lt=>{const $e=`Failed to update last read on external storage: ${lt.message}`;_t.warn($e),nt.dialogs$.next([{component:Ct,props:{title:"Update Error",message:$e}}])}),xe}async function Ri(f){if(Ke&&f&&(c===jt.Down||c===jt.All)){const G=await f.getProgress();G&&!(G instanceof File)&&(await Ke.saveProgress(G),Ye=G.exploredCharCount||0)}}function Mi(f){S||!as(f,Br.getValue(),Mn,Di,se=>Tn.next(Tn.getValue()+se),Ge,ft,r,Ti,ro)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),f.preventDefault())}function Ei(){let f;return Q.subscribe(G=>f=G).unsubscribe(),f}async function Mn(f){var Ne;const G=Ei();if(!G||!We)return;let se;if(t(9,b=!1),i){const xe=P?Ga(window,Xe):void 0,lt=xe||Ee;qt((Ne=lt==null?void 0:lt.endContainer)==null?void 0:Ne.parentElement,"add",.5,500),se=We.formatBookmarkDataByRange(G,lt),xe&&ki(window)}else se=We.formatBookmarkData(G,je);if(await Ke.saveProgress(se),o){const xe=le?ht:Ze;xe.includes(co.PROGRESS)||xe.push(co.PROGRESS),f&&In.next()}t(3,Fe=Promise.resolve(se))}async function Di(){const f=await Fe;!f||!We||We.scrollToBookmark(f,je)}function Fi(){if(t(9,b=!1),!dn.fullscreenElement){dn.requestFullscreen(document.documentElement);return}dn.exitFullscreen()}function Bi(){nt.dialogs$.next([{component:Ct,props:{title:"Old Domain",message:"You are currently using the old domain of ッツ Reader - consider switching to https://reader.ttsu.app to prevent issues and to ensure full features"},disableCloseOnClick:!0}])}function Ti(f){if(!(g!=null&&g.length))return;const[G,se]=mi(g);!se&&f===-1||f===1&&se===G.length-1||on.next(G[se+f].reference)}async function Wt(f=!0){if(le||!Ze.length||!u||!Ve)return;t(21,le=!0),f||(Kt.next(!0),_t.clearHistory(),io());const G=u.storageSource||w;Ve.updateSettings(window,!1,s,l,!f,G);const se=await Dr(Ke,Ve,!f&&h===Ve.storageType,[{id:u.id,title:u.title,imagePath:u.coverImage}],Ze).catch(Ne=>Ne.message);if(Ve.updateSettings(window,!0,s,l,!1,G),t(21,le=!1),se){if(!f){const Ne=_t.errorCount>1;_t.warn(se),nt.dialogs$.next([{component:Ne?Fr:Ct,props:{title:"Error Processing Data",message:Ne?"Some or all data could not be stored on an external storage":se}}])}t(20,v+=1)}else t(20,v=0),f||nt.dialogs$.next([]),ht.length?(t(19,Ze=JSON.parse(JSON.stringify(ht))),ht=[],f?In.next():await Wt(!1)):t(19,Ze=[]);f||Kt.next(!1)}function io(){nt.dialogs$.next([{component:"<div/>",disableCloseOnClick:!0}])}async function En(f,G=!0){io();let se;try{G&&await Dn.deleteLastItem(),await Mn(!1),nt.dialogs$.next([]),o&&await Wt(!1)}catch(Ne){se=Ne.message}se&&(_t.warn(se),nt.dialogs$.next([{component:Ct,props:{title:"Error",message:se},disableCloseOnClick:!0}])),go(`${fo}${f}`)}function ro(){const f=document.querySelector(".book-content");if(!f)return;i&&(t(14,ke=window.innerHeight/2-2),t(15,Ae=window.innerWidth/2-2)),t(9,b=!1),t(18,tt=!0),document.body.classList.add("cursor-crosshair");const{elLeftReferencePoint:G,elTopReferencePoint:se,elRightReferencePoint:Ne,elBottomReferencePoint:xe,pointGap:lt}=bi(window,f,r,a);nn(ut(document,"pointerup"),ut(document,"pointermove")).pipe(Oa(()=>tt)).subscribe($e=>{if($e instanceof PointerEvent)if($e.type==="pointerup")document.body.classList.remove("cursor-crosshair"),t(18,tt=!1),cr().then(()=>{t(15,Ae=r?$e.x:Ae),t(14,ke=r?ke:$e.y);const vt=Ha(Ae,ke);if(vt&&qt(vt.parent,"add",.5,500),i)t(4,Ee=vt==null?void 0:vt.range);else{let yt=0;r?(yt=Math.ceil(Math.max(0,Ae-G)/(Ne-G)*100),Bn.next(yt)):(yt=Math.ceil(Math.max(0,ke-se)/(xe-se)*100),Fn.next(yt)),t(16,qe=yt)}});else{const vt=$e.x>=G+lt&&$e.x<=Ne,yt=$e.y>=se&&$e.y<=xe-lt;i?(t(14,ke=yt?$e.y:ke),t(15,Ae=vt?$e.x:Ae)):r&&vt?t(15,Ae=$e.x):!r&&yt&&t(14,ke=$e.y)}})}const Ii=()=>t(9,b=!0);function Ai(f){z=f,t(10,z)}const Oi=()=>{t(9,b=!1),zt.next(!0)},Li=()=>{t(9,b=!1),t(5,ct=!0)},Vi=()=>{t(9,b=!1),i?t(4,Ee=void 0):r?(Bn.next(100),t(16,qe=100)):(Fn.next(0),t(16,qe=0))},zi=()=>En(Ue.SETTINGS.routeId,!1),Ni=()=>En(Ue.MANAGE.routeId),Hi=()=>t(9,b=!1);function Gi(f){q=f,t(0,q)}function Wi(f){Me=f,t(1,Me)}function ji(f){z=f,t(10,z)}function Xi(f){Fe=f,t(3,Fe)}function qi(f){Ge=f,t(2,Ge)}function Ki(f){We=f,t(12,We)}function Yi(f){ft=f,t(13,ft)}function Ui(f){qe=f,t(16,qe)}function Ji(f){ke=f,t(14,ke)}function Qi(f){Ae=f,t(15,Ae)}function Zi(f){je=f,t(17,je)}function xi(f){Ee=f,t(4,Ee)}function $i(f){ct=f,t(5,ct),t(4,Ee)}const er=()=>zt.next(!1),tr=()=>Wt(!1),nr=()=>t(11,Ie=!Ie);return n.$$.update=()=>{var f;n.$$.dirty[0]&132&&B&&(Ge==null||Ge.off()),n.$$.dirty[0]&3&&Me&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{exploredCharCount:q}})),n.$$.dirty[0]&2&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{bookCharCount:Me}})),n.$$.dirty[0]&48&&ct&&(qt((f=Ee==null?void 0:Ee.endContainer)==null?void 0:f.parentElement,"add",1),ut(document,"click").pipe(mn(1),Gt(1)).subscribe(()=>{var G;t(5,ct=!1),qt((G=Ee==null?void 0:Ee.endContainer)==null?void 0:G.parentElement,"remove",1)})),n.$$.dirty[0]&64&&t(22,i=R===Bt.Paginated),n.$$.dirty[2]&49152&&(o=Ve&&(c===jt.Up||c===jt.All)),n.$$.dirty[0]&8&&Fe.then(G=>Ye=(G==null?void 0:G.exploredCharCount)||0)},[q,Me,Ge,Fe,Ee,ct,R,B,Te,b,z,Ie,We,ft,ke,Ae,qe,je,tt,Ze,v,le,i,r,a,u,g,F,X,I,A,L,T,N,_,V,C,O,Z,he,ye,De,pe,Oe,Le,de,re,ae,Be,J,be,ge,Re,He,p,ue,ze,m,rn,Qn,Zn,yn,Rn,xn,$n,eo,to,no,vi,Mi,Mn,Fi,Bi,Wt,En,ro,Ve,c,Ii,Ai,Oi,Li,Vi,zi,Ni,Hi,Gi,Wi,ji,Xi,qi,Ki,Yi,Ui,Ji,Qi,Zi,xi,$i,er,tr,nr]}class ws extends Et{constructor(e){super(),Dt(this,e,fs,us,Ft,{},null,[-1,-1,-1,-1,-1])}}export{ws as default};
