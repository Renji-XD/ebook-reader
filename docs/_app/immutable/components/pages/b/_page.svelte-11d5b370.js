var nr=Object.defineProperty;var or=(n,e,t)=>e in n?nr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var xe=(n,e,t)=>(or(n,typeof e!="symbol"?e+"":e,t),t);import{S as Mt,i as Et,n as Dt,V as ir,e as Nt,W as rr,a as H,B as Rt,f as M,a2 as _n,h as ar,j as x,w as ye,s as oe,k as $,l as ee,x as Re,c as ie,m as U,a8 as K,p as E,y as Me,N as pe,d as W,g as ot,t as Y,b as it,z as Ee,R as kt,D as j,_ as Gn,T as Wn,a1 as ne,G as te,a5 as jn,a9 as Uo,q as Pe,r as ve,u as qe,aa as ro,ab as ue,ac as fe,o as Jo,Y as Qo,Z as Zo,F as lr,L as xo,a0 as ao,$ as sr,ad as ur,A as fr}from"../../../chunks/index-876111f7.js";import{k as cr,l as $o,n as ei,o as hr,q as cn,r as Tt,s as dr,u as mr,v as gr,w as ht,x as wt,B as dn,y as wn,z as Vt,m as Xe,A as xt,C as ti,F as st,D as Kt,E as ni,G as Xn,H as mn,I as oi,J as lo,t as _t,K as ii,c as qn,L as ri,N as pr,O as At,P as kr,Q as Ln,R as Vn,S as br,T as zn,V as Bt,U as Sn,W as Cr,X as _r,Y as wr,f as pt,Z as ai,i as Sr,a as dt,_ as Pr,$ as li,a0 as vr,a1 as yr,a2 as gt,a3 as ln,a4 as En,a5 as jt,M as It,a6 as Rr,a7 as Mr,a8 as so,j as Dn,a9 as Er,aa as Dr,p as uo,ab as Br,ac as Bn,ad as Nn,ae as Hn,af as Fr,ag as Tr,ah as Ir,ai as Ar,aj as Or,ak as Lr,al as Vr,am as Fn,an as Tn,h as zr,ao as Nr,ap as Hr,aq as Gr,ar as Wr,as as jr,at as Xr,au as qr,av as Kr,aw as Yr,ax as Ur,ay as Jr,az as fo}from"../../../chunks/store-980e8526.js";import{p as Qr}from"../../../chunks/stores-b581bec8.js";import{f as co,g as ho}from"../../../chunks/format-page-title-91f1c985.js";import{F as rt,f as Kn,a as Ut,b as Zr,c as xr,d as $r,e as ea,g as ta,h as na,i as oa}from"../../../chunks/fa-26600f17.js";import{t as si,k as gn,l as Jt,_ as $t,u as ia,O as St,i as Ft,n as ra,h as aa,a as nt,m as Ct,v as In}from"../../../chunks/error-handler-df8dffd6.js";import{m as la,t as ct,c as Qt,f as mo}from"../../../chunks/index-cfdc196c.js";import{r as yt,M as sa,m as je,P as ua,c as ui}from"../../../chunks/merged-header-icon-fd5992a9.js";import{a as fa}from"../../../chunks/theme-option-f9f8f697.js";var Yt={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,i=Yt.delegate;i&&(e=i.requestAnimationFrame,t=i.cancelAnimationFrame);var o=e(function(r){t=void 0,n(r)});return new si(function(){return t==null?void 0:t(o)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Yt.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,gn([],Jt(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Yt.delegate;return((t==null?void 0:t.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,gn([],Jt(n)))},delegate:void 0},ca=function(n){$t(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e}(si),pn={setInterval:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var o=pn.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,gn([n,e],Jt(t))):setInterval.apply(void 0,gn([n,e],Jt(t)))},clearInterval:function(n){var e=pn.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0},fi=function(n){$t(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.scheduler=t,o.work=i,o.pending=!1,o}return e.prototype.schedule=function(t,i){var o;if(i===void 0&&(i=0),this.closed)return this;this.state=t;var r=this.id,a=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(a,r,i)),this.pending=!0,this.delay=i,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,i),this},e.prototype.requestAsyncId=function(t,i,o){return o===void 0&&(o=0),pn.setInterval(t.flush.bind(t,this),o)},e.prototype.recycleAsyncId=function(t,i,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return i;i!=null&&pn.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(t,i);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var o=!1,r;try{this.work(t)}catch(a){o=!0,r=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,o=t.scheduler,r=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ia(r,this),i!=null&&(this.id=this.recycleAsyncId(o,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(ca),go=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=cr.now,n}(),ci=function(n){$t(e,n);function e(t,i){i===void 0&&(i=go.now);var o=n.call(this,t,i)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var o;this._active=!0;do if(o=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,o){for(;t=i.shift();)t.unsubscribe();throw o}},e}(go),en=new ci(fi),ha=en,da=function(n){$t(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.scheduler=t,o.work=i,o}return e.prototype.requestAsyncId=function(t,i,o){return o===void 0&&(o=0),o!==null&&o>0?n.prototype.requestAsyncId.call(this,t,i,o):(t.actions.push(this),t._scheduled||(t._scheduled=Yt.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,i,o){var r;if(o===void 0&&(o=0),o!=null?o>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,i,o);var a=t.actions;i!=null&&((r=a[a.length-1])===null||r===void 0?void 0:r.id)!==i&&(Yt.cancelAnimationFrame(i),t._scheduled=void 0)},e}(fi),ma=function(n){$t(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var i=this._scheduled;this._scheduled=void 0;var o=this.actions,r;t=t||o.shift();do if(r=t.execute(t.state,t.delay))break;while((t=o[0])&&t.id===i&&o.shift());if(this._active=!1,r){for(;(t=o[0])&&t.id===i&&o.shift();)t.unsubscribe();throw r}},e}(ci),Pn=new ma(da),Ht=new St(function(n){return n.complete()});function Yn(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=$o(n);return ei(n,t)}function ga(n){return n instanceof Date&&!isNaN(n)}var pa=["addListener","removeListener"],ka=["addEventListener","removeEventListener"],ba=["on","off"];function ut(n,e,t,i){if(Ft(t)&&(i=t,t=void 0),i)return ut(n,e,t).pipe(la(i));var o=Jt(wa(n)?ka.map(function(l){return function(s){return n[l](e,s,t)}}):Ca(n)?pa.map(po(n,e)):_a(n)?ba.map(po(n,e)):[],2),r=o[0],a=o[1];if(!r&&hr(n))return cn(function(l){return ut(l,e,t)})(Tt(n));if(!r)throw new TypeError("Invalid event target");return new St(function(l){var s=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return l.next(1<u.length?u:u[0])};return r(s),function(){return a(s)}})}function po(n,e){return function(t){return function(i){return n[t](e,i)}}}function Ca(n){return Ft(n.addListener)&&Ft(n.removeListener)}function _a(n){return Ft(n.on)&&Ft(n.off)}function wa(n){return Ft(n.addEventListener)&&Ft(n.removeEventListener)}function tn(n,e,t){n===void 0&&(n=0),t===void 0&&(t=ha);var i=-1;return e!=null&&(dr(e)?t=e:i=e),new St(function(o){var r=ga(n)?+n-t.now():n;r<0&&(r=0);var a=0;return t.schedule(function(){o.closed||(o.next(a++),0<=i?this.schedule(void 0,i):o.complete())},r)})}function Sa(n,e){return n===void 0&&(n=0),e===void 0&&(e=en),n<0&&(n=0),tn(n,n,e)}function nn(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=$o(n),i=mr(n,1/0),o=n;return o.length?o.length===1?Tt(o[0]):gr(i)(ei(o,t)):Ht}var Pa=Array.isArray;function va(n){return n.length===1&&Pa(n[0])?n[0]:n}function ya(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=va(n),n.length===1?Tt(n[0]):new St(Ra(n))}function Ra(n){return function(e){for(var t=[],i=function(r){t.push(Tt(n[r]).subscribe(ht(e,function(a){if(t){for(var l=0;l<t.length;l++)l!==r&&t[l].unsubscribe();t=null}e.next(a)})))},o=0;t&&!e.closed&&o<n.length;o++)i(o)}}function Ma(n){return wt(function(e,t){var i=!1,o=null,r=null,a=!1,l=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var u=o;o=null,t.next(u)}a&&t.complete()},s=function(){r=null,a&&t.complete()};e.subscribe(ht(t,function(u){i=!0,o=u,r||Tt(n(u)).subscribe(r=ht(t,l,s))},function(){a=!0,(!i||!r||r.closed)&&t.complete()}))})}function Ea(n,e){return e===void 0&&(e=en),Ma(function(){return tn(n,e)})}function Da(n){return wt(function(e,t){var i=!1,o=null,r=null,a=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var l=o;o=null,t.next(l)}};e.subscribe(ht(t,function(l){r==null||r.unsubscribe(),i=!0,o=l,r=ht(t,a,ra),Tt(n(l)).subscribe(r)},function(){a(),t.complete()},void 0,function(){o=r=null}))})}function Zt(n,e){return e===void 0&&(e=en),wt(function(t,i){var o=null,r=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var u=r;r=null,i.next(u)}};function s(){var u=a+n,h=e.now();if(h<u){o=this.schedule(void 0,u-h),i.add(o);return}l()}t.subscribe(ht(i,function(u){r=u,a=e.now(),o||(o=e.schedule(s,n),i.add(o))},function(){l(),i.complete()},void 0,function(){r=o=null}))})}function Gt(n){return n<=0?function(){return Ht}:wt(function(e,t){var i=0;e.subscribe(ht(t,function(o){++i<=n&&(t.next(o),n<=i&&t.complete())}))})}function hi(n,e){return e===void 0&&(e=aa),n=n??Ba,wt(function(t,i){var o,r=!0;t.subscribe(ht(i,function(a){var l=e(a);(r||!n(o,l))&&(r=!1,o=l,i.next(a))}))})}function Ba(n,e){return n===e}function Fa(n){return wt(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function Ta(){return wt(function(n,e){var t,i=!1;n.subscribe(ht(e,function(o){var r=t;t=o,i&&e.next([r,o]),i=!0}))})}function Ia(n,e){return e===void 0&&(e=!1),wt(function(t,i){var o=0;t.subscribe(ht(i,function(r){var a=n(r,o++);(a||e)&&i.next(r),!a&&i.complete()}))})}var di={leading:!0,trailing:!1};function Aa(n,e){return e===void 0&&(e=di),wt(function(t,i){var o=e.leading,r=e.trailing,a=!1,l=null,s=null,u=!1,h=function(){s==null||s.unsubscribe(),s=null,r&&(v(),u&&i.complete())},w=function(){s=null,u&&i.complete()},m=function(S){return s=Tt(n(S)).subscribe(ht(i,h,w))},v=function(){if(a){a=!1;var S=l;l=null,i.next(S),!u&&m(S)}};t.subscribe(ht(i,function(S){a=!0,l=S,!(s&&!s.closed)&&(o?v():m(S))},function(){u=!0,!(r&&a&&s&&!s.closed)&&i.complete()}))})}function Oa(n,e,t){e===void 0&&(e=en),t===void 0&&(t=di);var i=tn(n,e);return Aa(function(){return i},t)}const Un=new dn([]),kn=new nt,on=new nt,zt=new nt;function mi(n){const e=n.filter(r=>!r.parentChapter);let t=n.find(r=>r.progress<100);t||(t=n[n.length-1]);const i=t.parentChapter||t.reference,o=e.findIndex(r=>r.reference===i);return[e,o,i]}function La(n){let e,t;return{c(){e=new ir(!1),t=Nt(),this.h()},l(i){e=rr(i,!1),t=Nt(),this.h()},h(){e.a=t},m(i,o){e.m(n[0],i,o),H(i,t,o)},p(i,[o]){o&1&&e.p(i[0])},i:Rt,o:Rt,d(i){i&&M(t),i&&e.d()}}}function Va(n,e,t){let{html:i}=e;const o=_n();return ar(()=>{o("load")}),n.$$set=r=>{"html"in r&&t(0,i=r.html)},[i]}class gi extends Mt{constructor(e){super(),Et(this,e,Va,La,Dt,{html:0})}}function za(n,e){var o;const t=(o=document.elementFromPoint(n,e))==null?void 0:o.closest("p");if(!t)return;const i=wn(t);if(!!i.length)return{range:Jn(i[0]),parent:t}}function Jn(n,e=0,t=0){const i=new Range;return i.setStart(n,e),i.setEnd(n,t),i}function Na(n,e){var a,l,s;const t=(a=n.getSelection())!=null&&a.toString().trim()?(l=n.getSelection())==null?void 0:l.getRangeAt(0):void 0;let i;if(t?i=t:i=e,!i)return;const o=(s=i.endContainer.parentElement)==null?void 0:s.closest("p");if(!o)return;const r=wn(o);if(!!r.length)return Jn(r[0])}function ko(n,e){const t=n.createRange();return t.selectNode(e),t.getBoundingClientRect()}function pi(n,e=250){var t;(t=n.getSelection())==null||t.removeAllRanges(),setTimeout(()=>{var i;(i=n.getSelection())==null||i.addRange(new Range)},e)}function ki(n,e,t,i){const o=Math.min(Math.max(i,0),t?n.innerWidth/4:n.innerHeight/4),r=e.getBoundingClientRect(),a=t?o:r.left,l=t?n.innerWidth-o:r.right,s=t?r.top:o,u=t?r.bottom:n.innerHeight-o,h=Number(getComputedStyle(e).lineHeight.replace(/px$/,""));return{elLeftReferencePoint:a,elRightReferencePoint:l,elTopReferencePoint:s,elBottomReferencePoint:u,firstDimensionMargin:o,pointGap:h}}function qt(n,e,t,i=0){if(!n)return;const o=`animate-[pulse_${t}s_cubic-bezier(0.4,0,0.6,1)_${i?"1":"infinite"}]`;n.classList[e](o),i&&setTimeout(()=>n.classList.remove(o),i)}class Ha{constructor(e,t,i,o,r=Pn){xe(this,"enabled$",new dn(!1));this.multiplier=e,this.verticalMode=t,this.enabled$.pipe(Vt(a=>{if(!a)return Ht;let l=0;return Sa(0,r).pipe(Xe(()=>Date.now()),Ta(),Xe(s=>this.calcNewPos(s)),Xe(s=>{l+=s;const u=Math.trunc(l);return l-=u,u}),xt(s=>s!==0))}),ct(i)).subscribe(a=>{let l="top";t&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,t]){let i=.00365956;return this.verticalMode&&(i=-91489e-8),i*this.multiplier*(t-e)}}function Ot(n,e){return e==="rtl"?-n:n}class Ga{constructor(e,t,i){this.calculator=e,this.window=t,this.firstDimensionMargin=i}scrollToBookmark(e,t=0){const i=this.getBookmarkPosition(e);if(!i)return;const{scrollToData:o}=bo(i,this.firstDimensionMargin),r=this.calculator.verticalMode?"left":"top";o.left!==void 0&&r==="left"?o.left+=t:o.top!==void 0&&r==="top"&&(o.top-=t),this.window.scrollTo(o)}formatBookmarkData(e,t=0){const i=this.calculator.calcExploredCharCount(t),o=this.calculator.charCount,{verticalMode:r}=this.calculator,a=r?"scrollX":"scrollY";return{dataId:e,exploredCharCount:i,progress:i/o,[a]:this.window[a],lastBookmarkModified:new Date().getTime()}}formatBookmarkDataByRange(e){return this.formatBookmarkData(e)}getBookmarkBarPosition(e){const t=this.getBookmarkPosition(e);if(!!t)return bo(t,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:t}=this.calculator,i=this.getBookmarkTargetPosByScrollValue(e);if(i)return i;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return t?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:t}=e,i=o=>{const r=e[o];if(!r)return;const a=Ot(r,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===t)return{[o]:r}};return this.calculator.verticalMode?i("scrollX"):i("scrollY")}}function bo(n,e){return"scrollX"in n?{scrollToData:{left:n.scrollX},bookmarkPosData:{right:`${-n.scrollX+e}px`}}:{scrollToData:{top:n.scrollY},bookmarkPosData:{top:`${n.scrollY+e}px`}}}function bi(n){const e=(t,i,o,r)=>{if(o<i)return n??o;const a=Math.floor((i+o)/2);return t[a]===r?a:t[a]>r?e(t,i,a-1,r):e(t,a+1,o,r)};return(t,i)=>e(t,0,t.length-1,i)}function Wa(){const n=(e,t,i,o)=>{if(i<t)return-1;const r=Math.floor((t+i)/2);return o.intersectsNode(e[r])?r:o.comparePoint(e[r],0)>0?n(e,t,r-1,o):n(e,r+1,i,o)};return(e,t)=>n(e,0,e.length-1,t)}const ja=Wa(),Xa=bi(-1),bn=bi(void 0);class Ci{constructor(e,t,i,o,r){xe(this,"charCount");xe(this,"accumulatedCharCount");xe(this,"paragraphPos");xe(this,"paragraphs");xe(this,"paragraphPosToAccCharCount",new Map);this.containerEl=e,this.axis=t,this.direction=i,this.scrollEl=o,this.document=r,this.paragraphs=wn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=ti(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const t=this.scrollEl.getBoundingClientRect(),i=Ot(this.verticalMode?t.right:t.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),r=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=ko(this.document,l),h=(()=>(this.verticalMode?s.width:s.height)<=0?this.paragraphPos[a-1]||0:Ot(this.verticalMode?s.left:s.bottom,this.direction)-i-o+e)();this.paragraphPos[a]=h;const w=r.get(h)||[];r.set(h,w),w.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(r.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(e=0){return this.getCharCountByScrollPos(this.scrollPos+e)}getCharCountByScrollPos(e){const t=bn(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[t])||0}getBookMarkPosForSection(e,t){const i=Math.max(0,Xa(this.accumulatedCharCount,t-e));let o=i,r=this.processSectionBookmarkIteration(i,e,t);if(!r){for(let a=i+1,{length:l}=this.accumulatedCharCount;a<l;a+=1)if(r=this.processSectionBookmarkIteration(a,e,t),r){o=a;break}}return{bookmarkPos:r,node:r?this.paragraphs[o]:void 0,isFirstNode:o===0}}getScrollPosByCharCount(e){const t=bn(this.accumulatedCharCount,e);return Ot(this.paragraphPos[t],this.direction)||0}getCharCountToPoint(e){const t=Math.max(0,ja(this.paragraphs,e));return this.accumulatedCharCount[t-1]||0}processSectionBookmarkIteration(e,t,i){const o=this.accumulatedCharCount[e]+t;let r;if(o>i){let a=this.paragraphs[e];a.parentElement&&(a=a.parentElement.closest("p")||a.parentElement);const{top:l,right:s,left:u}=ko(this.document,a);r=this.axis==="horizontal"?{left:s}:{top:l,left:u}}return r}get scrollPos(){return Ot(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}function qa(n,e,t){const i=Ua(e,t)(n,"scrollLeft");return(o,r,a)=>{if(!Ka(o))return;const l=Ya(o,r,a);i(-l),o.preventDefault()}}function Ka(n){return!(!n.deltaY||n.deltaX||n.altKey||n.shiftKey||n.ctrlKey||n.metaKey)}function Ya(n,e,t){switch(n.deltaMode){case 0:return n.deltaY;case 1:return n.deltaY*e*1.75;default:return n.deltaY*t}}function Ua(n,e){return(t,i)=>{let o=!1,r=n[i],a=n[i];const l=()=>{o=!0;const s=Math.trunc((r-n[i])/t);if(n[i]!==a){o=!1;return}if(a+=s,n.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(r=n[i],a=n[i]),r+=s,o||e(l)}}}class Ja{constructor(e,t,i){this.verticalMode=e,this.firstDimensionMargin=t,this.window=i}nextPage(){this.scrollByPercent(.95)}prevPage(){this.scrollByPercent(-.95)}updateSectionDataByOffset(){}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let t=this.window.innerHeight,i="top",o=1;this.verticalMode&&(t=this.window.innerWidth,i="left",o=-1);const r=t-this.firstDimensionMargin*2;this.window.scrollBy({[i]:r*e*o,behavior:"smooth"})}}const{document:Co,window:Qa}=Wn;function _o(n){let e,t,i,o,r;return{c(){e=x("div"),i=oe(),o=x("div"),this.h()},l(a){e=$(a,"DIV",{class:!0,style:!0}),ee(e).forEach(M),i=ie(a),o=$(a,"DIV",{class:!0,style:!0}),ee(o).forEach(M),this.h()},h(){U(e,"class","fixed z-[5]"),U(e,"style",t=n[23]+": 100%; "+n[22]+": "+n[15]+"px; "+n[21][0]+": 0"),K(e,"inset-y-0",n[2]),K(e,"inset-x-0",!n[2]),E(e,"background-color",n[4]),U(o,"class","fixed z-[5]"),U(o,"style",r=n[23]+": 100%; "+n[22]+": "+n[15]+"px; "+n[21][1]+": 0"),K(o,"inset-y-0",n[2]),K(o,"inset-x-0",!n[2]),E(o,"background-color",n[4])},m(a,l){H(a,e,l),H(a,i,l),H(a,o,l)},p(a,l){l[0]&14712832&&t!==(t=a[23]+": 100%; "+a[22]+": "+a[15]+"px; "+a[21][0]+": 0")&&U(e,"style",t),l[0]&4&&K(e,"inset-y-0",a[2]),l[0]&4&&K(e,"inset-x-0",!a[2]),l[0]&16&&E(e,"background-color",a[4]),l[0]&14712832&&r!==(r=a[23]+": 100%; "+a[22]+": "+a[15]+"px; "+a[21][1]+": 0")&&U(o,"style",r),l[0]&4&&K(o,"inset-y-0",a[2]),l[0]&4&&K(o,"inset-x-0",!a[2]),l[0]&16&&E(o,"background-color",a[4])},d(a){a&&M(e),a&&M(i),a&&M(o)}}}function wo(n){let e,t,i,o;const r=[xa,Za],a=[];function l(s,u){return s[2]?0:1}return e=l(n),t=a[e]=r[e](n),{c(){t.c(),i=Nt()},l(s){t.l(s),i=Nt()},m(s,u){a[e].m(s,u),H(s,i,u),o=!0},p(s,u){let h=e;e=l(s),e===h?a[e].p(s,u):(ot(),Y(a[h],1,1,()=>{a[h]=null}),it(),t=a[e],t?t.p(s,u):(t=a[e]=r[e](s),t.c()),W(t,1),t.m(i.parentNode,i))},i(s){o||(W(t),o=!0)},o(s){Y(t),o=!1},d(s){a[e].d(s),s&&M(i)}}}function Za(n){let e,t,i;return t=new rt({props:{icon:Ut}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Re(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","pointer-events-none absolute text-sm opacity-25 sm:text-xl"),E(e,"color",n[3]),E(e,"left",n[17]),E(e,"top",`calc(${n[19].top} + 1.5rem)`)},m(o,r){H(o,e,r),Me(t,e,null),i=!0},p(o,r){r[0]&8&&E(e,"color",o[3]),r[0]&131072&&E(e,"left",o[17]),r[0]&524288&&E(e,"top",`calc(${o[19].top} + 1.5rem)`)},i(o){i||(W(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),Ee(t)}}}function xa(n){let e,t,i;return t=new rt({props:{icon:Ut}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Re(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","pointer-events-none absolute text-xl opacity-25"),E(e,"color",n[3]),E(e,"right",`calc(${n[19].right} + 1rem)`),E(e,"top",n[17])},m(o,r){H(o,e,r),Me(t,e,null),i=!0},p(o,r){r[0]&8&&E(e,"color",o[3]),r[0]&524288&&E(e,"right",`calc(${o[19].right} + 1rem)`),r[0]&131072&&E(e,"top",o[17])},i(o){i||(W(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),Ee(t)}}}function So(n){let e,t,i;return t=new rt({props:{icon:Kn,spin:!0}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Re(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),E(e,"color",n[3]),E(e,"background-color",n[4])},m(o,r){H(o,e,r),Me(t,e,null),i=!0},p(o,r){r[0]&8&&E(e,"color",o[3]),r[0]&16&&E(e,"background-color",o[4])},i(o){i||(W(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),Ee(t)}}}function $a(n){let e,t,i=`${n[9]}px`,o=`${n[20]||n[1]}px`,r,a,l,s,u,h,w;t=new gi({props:{html:n[0]}}),t.$on("load",n[27]);let m=n[15]&&_o(n),v=n[19]&&wo(n),S=!n[18]&&So(n);return{c(){e=x("div"),ye(t.$$.fragment),r=oe(),m&&m.c(),a=oe(),v&&v.c(),l=oe(),S&&S.c(),s=oe(),this.h()},l(c){e=$(c,"DIV",{class:!0});var k=ee(e);Re(t.$$.fragment,k),k.forEach(M),r=ie(c),m&&m.l(c),a=ie(c),v&&v.l(c),l=ie(c),S&&S.l(c),s=ie(c),this.h()},h(){U(e,"class","book-content m-auto svelte-1ouz3ba"),K(e,"book-content--writing-vertical-rl",n[2]),K(e,"book-content--writing-horizontal-rl",!n[2]),K(e,"book-content--hide-furigana",n[12]),K(e,"book-content--hide-spoiler-image",n[11]),K(e,"book-content--furigana-style-partial",n[13]===st.Partial),K(e,"book-content--furigana-style-full",n[13]===st.Full),K(e,"book-content--furigana-style-toggle",n[13]===st.Toggle),E(e,"color",n[3]),E(e,"font-size",i),E(e,"line-height",n[10]),E(e,"max-width",!n[2]&&n[14]?`${n[14]}px`:void 0),E(e,"max-height",n[20]?`${n[20]}px`:void 0),E(e,"padding-left",n[2]&&n[15]?`${n[15]}px`:void 0),E(e,"padding-right",n[2]&&n[15]?`${n[15]}px`:void 0),E(e,"padding-top",!n[2]&&n[15]?`${n[15]}px`:void 0),E(e,"padding-bottom",!n[2]&&n[15]?`${n[15]}px`:void 0),E(e,"--font-family-serif",n[7]),E(e,"--font-family-sans-serif",n[8]),E(e,"--book-content-hint-furigana-font-color",n[5]),E(e,"--book-content-hint-furigana-shadow-color",n[6]),E(e,"--book-content-child-height",o)},m(c,k){H(c,e,k),Me(t,e,null),n[49](e),H(c,r,k),m&&m.m(c,k),H(c,a,k),v&&v.m(c,k),H(c,l,k),S&&S.m(c,k),H(c,s,k),u=!0,h||(w=[pe(Qa,"scroll",n[26]),pe(Co.body,"wheel",n[25],{passive:!1}),pe(Co.body,"mousedown",n[50])],h=!0)},p(c,k){const d={};k[0]&1&&(d.html=c[0]),t.$set(d),(!u||k[0]&4)&&K(e,"book-content--writing-vertical-rl",c[2]),(!u||k[0]&4)&&K(e,"book-content--writing-horizontal-rl",!c[2]),(!u||k[0]&4096)&&K(e,"book-content--hide-furigana",c[12]),(!u||k[0]&2048)&&K(e,"book-content--hide-spoiler-image",c[11]),(!u||k[0]&8192)&&K(e,"book-content--furigana-style-partial",c[13]===st.Partial),(!u||k[0]&8192)&&K(e,"book-content--furigana-style-full",c[13]===st.Full),(!u||k[0]&8192)&&K(e,"book-content--furigana-style-toggle",c[13]===st.Toggle),k[0]&8&&E(e,"color",c[3]),k[0]&512&&i!==(i=`${c[9]}px`)&&E(e,"font-size",i),k[0]&1024&&E(e,"line-height",c[10]),k[0]&16388&&E(e,"max-width",!c[2]&&c[14]?`${c[14]}px`:void 0),k[0]&1048576&&E(e,"max-height",c[20]?`${c[20]}px`:void 0),k[0]&32772&&E(e,"padding-left",c[2]&&c[15]?`${c[15]}px`:void 0),k[0]&32772&&E(e,"padding-right",c[2]&&c[15]?`${c[15]}px`:void 0),k[0]&32772&&E(e,"padding-top",!c[2]&&c[15]?`${c[15]}px`:void 0),k[0]&32772&&E(e,"padding-bottom",!c[2]&&c[15]?`${c[15]}px`:void 0),k[0]&128&&E(e,"--font-family-serif",c[7]),k[0]&256&&E(e,"--font-family-sans-serif",c[8]),k[0]&32&&E(e,"--book-content-hint-furigana-font-color",c[5]),k[0]&64&&E(e,"--book-content-hint-furigana-shadow-color",c[6]),k[0]&1048578&&o!==(o=`${c[20]||c[1]}px`)&&E(e,"--book-content-child-height",o),c[15]?m?m.p(c,k):(m=_o(c),m.c(),m.m(a.parentNode,a)):m&&(m.d(1),m=null),c[19]?v?(v.p(c,k),k[0]&524288&&W(v,1)):(v=wo(c),v.c(),W(v,1),v.m(l.parentNode,l)):v&&(ot(),Y(v,1,1,()=>{v=null}),it()),c[18]?S&&(ot(),Y(S,1,1,()=>{S=null}),it()):S?(S.p(c,k),k[0]&262144&&W(S,1)):(S=So(c),S.c(),W(S,1),S.m(s.parentNode,s))},i(c){u||(W(t.$$.fragment,c),W(v),W(S),u=!0)},o(c){Y(t.$$.fragment,c),Y(v),Y(S),u=!1},d(c){c&&M(e),Ee(t),n[49](null),c&&M(r),m&&m.d(c),c&&M(a),v&&v.d(c),c&&M(l),S&&S.d(c),c&&M(s),h=!1,kt(w)}}}function el(n,e,t){let i,o,r,a,l,s,u,h;j(n,Kt,P=>t(57,l=P)),j(n,ni,P=>t(24,s=P)),j(n,zt,P=>t(58,u=P)),j(n,Xn,P=>t(48,h=P));let{htmlContent:w}=e,{width:m}=e,{height:v}=e,{verticalMode:S}=e,{fontColor:c}=e,{backgroundColor:k}=e,{hintFuriganaFontColor:d}=e,{hintFuriganaShadowColor:R}=e,{fontFamilyGroupOne:F}=e,{fontFamilyGroupTwo:y}=e,{fontSize:D}=e,{lineHeight:B}=e,{hideSpoilerImage:X}=e,{hideFurigana:I}=e,{furiganaStyle:A}=e,{secondDimensionMaxValue:L}=e,{firstDimensionMargin:T}=e,{autoPositionOnResize:N}=e,{autoBookmark:_}=e,{loadingState:V}=e,{multiplier:b}=e,{bookmarkData:O}=e,{exploredCharCount:Z}=e,{bookCharCount:ce}=e,{autoScroller:De}=e,{bookmarkManager:Te}=e,{pageManager:be}=e,{customReadingPoint:Oe}=e,{customReadingPointLeft:Le}=e,{customReadingPointTop:de}=e,{customReadingPointScrollOffset:re}=e;const ae=_n();let Ie=!1,Q,we,me={},Be,He,ge,C,z,Fe=0,q=!1,Se=window.matchMedia("(min-width: 640px)").matches?"0.5rem":"0.25rem",Ve=!1;const $e=qa(4,document.documentElement,requestAnimationFrame),Ke=new nt,Ce=new nt,_e=new nt,Ye=new Map,Ue=new Map;let ke=0,ft=!1;Gn(()=>{_e.next(),_e.complete()}),Be=new Ha(b,S,_e,document),De=Be,Qt([Ke,Ce]).pipe(xt(()=>N),mn(1),Xe(([P,se])=>S?se:P),hi(),Zt(10),oi(Pn),ct(_e)).subscribe(()=>{if(!we||!ge)return;const P=we.getScrollPosByCharCount(Fe)+(S?re:-re);q=!0,ge.scrollTo(P)});function Ge(){if(!h||!Q)return;const{elLeftReferencePoint:P,elTopReferencePoint:se,elRightReferencePoint:Qe,elBottomReferencePoint:p,firstDimensionMargin:J,pointGap:he}=ki(window,Q,S,T);if(S){t(34,de=se),t(33,Le=Math.min(Math.max(J+(Qe-P)*(Oe/100)-2,P+he),Qe-2)),t(35,re=window.innerWidth-J-Le);return}t(34,de=Math.min(Math.max(J+(p-se)*(Oe/100),J),p-he*1.5)),t(33,Le=P),t(35,re=de-J)}function mt(P){P.updateParagraphPos(),Ge(),t(28,Z=P.calcExploredCharCount(re)),z&&(z=!1,O.then(se=>{!se||!Te||(Fe=se.exploredCharCount||0,Te.scrollToBookmark(se,re))}).finally(()=>{_&&ut(window,"scroll").pipe(mn(1),Zt(3e3),ct(_e)).subscribe(()=>{ae("bookmark")}),Un.pipe(Gt(1),Vt(se=>se.length?(se.forEach(Qe=>{const p=Qe.reference,J=document.getElementById(p);J&&(ke||(ke=Number(getComputedStyle(J)[S?"marginLeft":"marginBottom"].replace(/px$/,""))/2),Ue.set(p,{...Qe,progress:0}),Ye.set(p,J))}),Ye.size?(We(),ut(window,"scroll")):Ht):Ht),Da(()=>tn(ft?100:500)),ct(_e)).subscribe(We)})),t(44,me={}),t(18,Ie=!0)}function We(){const P=[...Ue.entries()];for(let se=0,{length:Qe}=P;se<Qe;se+=1){const[p,J]=P[se],ze=Ye.get(p).getBoundingClientRect();J.progress=S?Math.min(Math.max(ze.right+(T||0)-window.innerWidth+re,0),ze.width)/(ze.width||1)*100:Math.abs(Math.min(Math.max(ze.top-(T||0)-re,-ze.height),0))/(ze.height||1)*100,Ue.set(p,J)}ft=!1,kn.next(Ue)}function Je(P){S&&!u&&!s&&!l&&$e(P,D,window.innerWidth)}function et(){requestAnimationFrame(()=>{!we||(t(28,Z=we.calcExploredCharCount(re)),!q&&Z&&(Fe=Z),q=!1)})}function at(){if(!Q)return;t(43,we=new Ci(Q,S?"vertical":"horizontal",S?"rtl":"ltr",document.documentElement,document)),t(28,Z=0),Fe=Z,t(29,ce=we.charCount);let P=!1;try{P=document.fonts.check(`${D}px ${F||"Noto Serif JP"}`)}catch(se){Ct.error(`Error checking Font Load: ${se.message}`),P=!0}P?ae("contentChange",Q):Ve||(Ve=!0,document.fonts.addEventListener("loadingdone",()=>{ae("contentChange",Q)}))}on.pipe(ct(_e)).subscribe(P=>{let se=document.getElementById(P);if(!se)return;se=!P.startsWith(lo)&&se.closest(`div[id^="${lo}"]`)||se,ft=!0;const p=se.getBoundingClientRect();S?window.scrollBy(-(window.innerWidth-p.right-(T||0)-re-(!re||re&&ke>re?ke:0)),0):window.scrollBy(0,p.top-(T||0)-re-(!re||re&&ke>re?ke:0))});function Ae(P){ne[P?"unshift":"push"](()=>{Q=P,t(16,Q)})}const bt=P=>{s&&P.button===1&&P.preventDefault()};return n.$$set=P=>{"htmlContent"in P&&t(0,w=P.htmlContent),"width"in P&&t(36,m=P.width),"height"in P&&t(1,v=P.height),"verticalMode"in P&&t(2,S=P.verticalMode),"fontColor"in P&&t(3,c=P.fontColor),"backgroundColor"in P&&t(4,k=P.backgroundColor),"hintFuriganaFontColor"in P&&t(5,d=P.hintFuriganaFontColor),"hintFuriganaShadowColor"in P&&t(6,R=P.hintFuriganaShadowColor),"fontFamilyGroupOne"in P&&t(7,F=P.fontFamilyGroupOne),"fontFamilyGroupTwo"in P&&t(8,y=P.fontFamilyGroupTwo),"fontSize"in P&&t(9,D=P.fontSize),"lineHeight"in P&&t(10,B=P.lineHeight),"hideSpoilerImage"in P&&t(11,X=P.hideSpoilerImage),"hideFurigana"in P&&t(12,I=P.hideFurigana),"furiganaStyle"in P&&t(13,A=P.furiganaStyle),"secondDimensionMaxValue"in P&&t(14,L=P.secondDimensionMaxValue),"firstDimensionMargin"in P&&t(15,T=P.firstDimensionMargin),"autoPositionOnResize"in P&&t(37,N=P.autoPositionOnResize),"autoBookmark"in P&&t(38,_=P.autoBookmark),"loadingState"in P&&t(39,V=P.loadingState),"multiplier"in P&&t(40,b=P.multiplier),"bookmarkData"in P&&t(41,O=P.bookmarkData),"exploredCharCount"in P&&t(28,Z=P.exploredCharCount),"bookCharCount"in P&&t(29,ce=P.bookCharCount),"autoScroller"in P&&t(30,De=P.autoScroller),"bookmarkManager"in P&&t(31,Te=P.bookmarkManager),"pageManager"in P&&t(32,be=P.pageManager),"customReadingPoint"in P&&t(42,Oe=P.customReadingPoint),"customReadingPointLeft"in P&&t(33,Le=P.customReadingPointLeft),"customReadingPointTop"in P&&t(34,de=P.customReadingPointTop),"customReadingPointScrollOffset"in P&&t(35,re=P.customReadingPointScrollOffset)},n.$$.update=()=>{if(n.$$.dirty[0]&4&&t(23,i=S?"height":"width"),n.$$.dirty[0]&4&&t(22,o=S?"width":"height"),n.$$.dirty[0]&4&&t(21,r=S?["left","right"]:["top","bottom"]),n.$$.dirty[1]&32&&Ke.next(m),n.$$.dirty[0]&2&&Ce.next(v),n.$$.dirty[0]&16388&&t(20,a=S&&L?L:void 0),n.$$.dirty[0]&212996&&L&&Q){const P=Number(getComputedStyle(Q)[S?"marginTop":"marginRight"].replace(/px$/,""));t(17,Se=`min(max(calc(${`${P}px - ${Se}`}), ${Se}), ${P?`${P}px`:Se})`)}if(n.$$.dirty[0]&1&&w&&(z=!0),n.$$.dirty[0]&2|n.$$.dirty[1]&4384&&we&&m&&v&&!V){const P=we;requestAnimationFrame(()=>{mt(P)})}n.$$.dirty[0]&4|n.$$.dirty[1]&16896&&Be&&(t(45,Be.multiplier=b,Be),t(45,Be.verticalMode=S,Be)),n.$$.dirty[0]&32768|n.$$.dirty[1]&36864&&we&&(t(46,He=we&&new Ga(we,window,T||0)),t(31,Te=He)),n.$$.dirty[1]&41984&&me&&(t(19,C=void 0),O.then(P=>{!P||t(19,C=He==null?void 0:He.getBookmarkBarPosition(P))})),n.$$.dirty[0]&32772|n.$$.dirty[1]&65536&&(t(47,ge=new Ja(S,T,window)),t(32,be=ge)),n.$$.dirty[0]&65536|n.$$.dirty[1]&133120&&h&&Q&&Number.isFinite(Oe)&&(Ge(),et(),We())},[w,v,S,c,k,d,R,F,y,D,B,X,I,A,L,T,Q,Se,Ie,C,a,r,o,i,s,Je,et,at,Z,ce,De,Te,be,Le,de,re,m,N,_,V,b,O,Oe,we,me,Be,He,ge,h,Ae,bt]}class tl extends Mt{constructor(e){super(),Et(this,e,el,$a,Dt,{htmlContent:0,width:36,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontFamilyGroupOne:7,fontFamilyGroupTwo:8,fontSize:9,lineHeight:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,secondDimensionMaxValue:14,firstDimensionMargin:15,autoPositionOnResize:37,autoBookmark:38,loadingState:39,multiplier:40,bookmarkData:41,exploredCharCount:28,bookCharCount:29,autoScroller:30,bookmarkManager:31,pageManager:32,customReadingPoint:42,customReadingPointLeft:33,customReadingPointTop:34,customReadingPointScrollOffset:35},null,[-1,-1,-1])}}const nl="px-4 md:px-8";function ol(n){const e=Array.from(n.getElementsByTagName("img"));return new St(t=>{const i=e.filter(r=>r.src).map(il);if(i.length<=0){t.next(!1),t.complete();return}const o=Qt(i).subscribe(()=>{t.next(!1),t.complete()});return t.next(!0),o})}function il(n){return n.complete?Yn(1):ya(ut(n,"load"),ut(n,"error"))}function rl(n,e){const t=al(n),i=sl(n);return o=>nn(t(o),ll(o,e),i(o))}function al(n){return e=>{const t=Array.from(e.getElementsByTagName("a"));t.forEach(o=>{o.href=n.location.pathname+o.hash});const i=t.map(o=>Cn(o).pipe(_t(()=>on.next(o.hash.substring(1)))));return nn(...i)}}function ll(n,e){const t=e===st.Toggle,o=Array.from(n.getElementsByTagName("ruby")).map(r=>t?Cn(r).pipe(_t(()=>{r.classList.toggle("reveal-rt")})):Cn(r).pipe(Gt(1),_t(()=>{r.classList.add("reveal-rt")})));return nn(...o)}function sl(n){return e=>{const i=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const r=n.createElement("span");return r.classList.add("spoiler-label"),r.setAttribute("aria-hidden","true"),r.innerText="ネタバレ",o.appendChild(r),Cn(o).pipe(Gt(1),_t(()=>{o.removeChild(r),o.removeAttribute("data-ttu-spoiler-img")}))});return nn(...i)}}function Cn(n){return ut(n,"click").pipe(_t(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const ul=300,fl=60,_i="none";function Xt(n,e,t){return n.addEventListener(e,t),()=>n.removeEventListener(e,t)}function cl(n,e){return e.filter(t=>n.pointerId!==t.pointerId)}function sn(n,e,t,i,o){n.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:t,pointersCount:i.length}}))}function hl(n,e,t,i,o,r=_i){e.style.touchAction=r;let a=[];function l(u){a.push(u),sn(e,n,u,a,"down"),i==null||i(a,u);const h=u.pointerId;function w(d){h===d.pointerId&&(a=cl(d,a),a.length||m(),sn(e,n,d,a,"up"),o==null||o(a,d))}function m(){v(),S(),c(),k()}const v=Xt(e,"pointermove",d=>{a=a.map(R=>d.pointerId===R.pointerId?d:R),sn(e,n,d,a,"move"),t==null||t(a,d)}),S=Xt(e,"lostpointercapture",d=>{w(d)}),c=Xt(e,"pointerup",d=>{w(d)}),k=Xt(e,"pointerleave",d=>{a=[],m(),sn(e,n,d,a,"up"),o==null||o(a,d)})}const s=Xt(e,"pointerdown",l);return{destroy:()=>{s()}}}function dl(n,e={timeframe:ul,minSwipeDistance:fl,touchAction:_i}){const t="swipe";let i,o,r,a;function l(u,h){o=h.clientX,r=h.clientY,i=Date.now(),u.length===1&&(a=h.target)}function s(u,h){if(h.type==="pointerup"&&u.length===0&&Date.now()-i<e.timeframe){const w=h.clientX-o,m=h.clientY-r,v=Math.abs(w),S=Math.abs(m);let c=null;v>=2*S&&v>e.minSwipeDistance?c=w>0?"right":"left":S>=2*v&&S>e.minSwipeDistance&&(c=m>0?"bottom":"top"),c&&n.dispatchEvent(new CustomEvent(t,{detail:{direction:c,target:a}}))}}return hl(t,n,null,l,s,e.touchAction)}class ml{constructor(e,t,i,o,r){this.calculator=e,this.pageManager=t,this.sectionReady$=i,this.sectionIndex$=o,this.setIntendedCharCount=r}scrollToBookmark(e){const t=e.exploredCharCount;if(!t)return;const i=this.calculator.getSectionIndexByCharCount(t),o=l=>{const s=l.getScrollPosByCharCount(t);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(t)};if(this.sectionIndex$.getValue()===i){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(i)}formatBookmarkData(e){return this.formatBookmarkDataByRange(e,void 0)}formatBookmarkDataByRange(e,t){const i=this.calculator.calcExploredCharCount(t),o=this.calculator.charCount;return{dataId:e,exploredCharCount:i,progress:i/o,lastBookmarkModified:new Date().getTime()}}}class gl{constructor(e,t,i,o,r,a,l,s,u,h,w){xe(this,"translateX",0);xe(this,"sectionData",new Map);this.contentEl=e,this.scrollEl=t,this.sections=i,this.sectionIndex$=o,this.virtualScrollPos$=r,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=u,this.pageChange$=h,this.sectionRenderComplete$=w,Un.pipe(Gt(1)).subscribe(m=>{!m.length||(m.forEach(v=>{this.sectionData.set(v.reference,{...v,progress:0})}),kn.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}updateSectionDataByOffset(e=0){var o,r;const t=this.verticalMode?this.height:this.width,i=this.virtualScrollPos$.getValue()/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100;if(e){const l=(this.virtualScrollPos$.getValue()+t+this.pageGap)/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100-i;this.updateSectionData((o=this.sections[this.sectionIndex$.getValue()])==null?void 0:o.id,i+l*e)}else this.updateSectionData((r=this.sections[this.sectionIndex$.getValue()])==null?void 0:r.id,i)}flipPage(e){const t=this.verticalMode?"scrollHeight":"scrollWidth",i=this.verticalMode?this.height:this.width,o=i+this.pageGap,r=!0;if(this.translateX){const w=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const m=this.translateX;w(),this.scrollToPos(-m-o,r);return}if(this.nextSection(r)){w();return}return}const a=0,l=this.scrollEl[t],s=this.virtualScrollPos$.getValue(),u=s+o*e,h=Math.ceil(u);if(h<a){if(s!==a){this.scrollToPos(a,r);return}this.prevSection(o,t,i,r);return}if(h>=l){this.nextSection(r);return}this.scrollOrTranslateToPos(u,l,i,r)}scrollTo(e,t){const i=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[i],o,t)}prevSection(e,t,i,o){const r=this.sectionIndex$.getValue()-1;return r<0?!1:(this.updateSectionIndex(r).subscribe(()=>{const a=this.scrollEl[t];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,i,o)}),!0)}nextSection(e){const t=this.sectionIndex$.getValue()+1;return t>=this.sections.length?!1:(this.updateSectionIndex(t).subscribe(()=>{var i,o;this.scrollToPos(0,e),this.updateSectionData((i=this.sections[t-1])==null?void 0:i.id,100,!1),this.updateSectionData((o=this.sections[t])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,t,i,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/t*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+i<=t){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,t){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(t)}translateXToPos(e,t){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(t)}updateSectionIndex(e){return new St(t=>{if(this.sectionIndex$.getValue()===e){t.next(),t.complete();return}const i=this.sectionRenderComplete$.subscribe(o=>{o===e&&t.next(),t.complete(),i.unsubscribe()});return this.sectionIndex$.next(e),i})}updateSectionData(e,t,i=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let r=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=t:r?l.progress=0:l.progress=100,!r&&s&&(r=!0),this.sectionData.set(a.reference,l)}),i&&kn.next(this.sectionData)}}class pl{constructor(e,t,i,o,r,a,l,s,u){xe(this,"charCount");xe(this,"sectionAccCharCounts");xe(this,"sectionIndex",-1);xe(this,"calculator");this.containerEl=e,this.sections=t,this.virtualScrollPos$=i,this.getWidth=o,this.getHeight=r,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=u;const h=m=>wn(m).reduce((S,c)=>S+ti(c),0);let w=0;this.sectionAccCharCounts=t.map(m=>(w+=h(m),w)),this.charCount=w}updateCurrentSection(e){this.calculator=new Ci(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(e){if(e&&this.calculator)return this.getSectionStartCount()+this.calculator.getCharCountToPoint(e);const t=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+t)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const t=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+t}getSectionIndexByCharCount(e){return bn(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const t=this.getSectionStartCount(),i=this.sectionAccCharCounts[this.sectionIndex],o=e-t,r=e===i&&i-t>0;if(o<0||e>i||r)return-1;if(o===0)return 0;const a=bn(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,u=l[a];if(Number.isNaN(Number(s[a])))return-1;const h=(c,k)=>c>=k?k:l[c]>u?c:h(c+1,k),w=s[h(a+1,l.length-1)],{screenSize:m}=this,v=this.verticalMode?-1:0,S=m*(Math.ceil(w/m)+v);return Ot(S,this.calculator.direction)}checkBookmarkOnScreen(e){const t=this.getScrollPosByCharCount(e),i=this.virtualScrollPos$.getValue();return t===i&&this.calculator?{isBookmarkScreen:!0,...this.calculator.getBookMarkPosForSection(this.getSectionStartCount(),e)}:{isBookmarkScreen:t===i,bookmarkPos:void 0,node:void 0,isFirstNode:!0}}getOffsetToRange(e,t){if(!e)return 0;const i=e.getBoundingClientRect();if(this.verticalMode)return 1-i.left/this.screenSizeMirrored;const o=Math.floor(100/t),r=Math.floor(this.screenSize/t),a=o*i.bottom/this.screenSizeMirrored;let l=a,s=0;for(let u=0;u<this.screenSize&&i.right>=u;u+=r)l=s*o+a,s+=1;return l/100}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}get screenSizeMirrored(){return(this.verticalMode?this.getWidth():this.getHeight())+this.getPageGap()}}const{window:kl}=Wn;function Po(n){let e,t,i;return t=new rt({props:{icon:Kn,spin:!0}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Re(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),E(e,"color",n[4]),E(e,"background-color",n[5])},m(o,r){H(o,e,r),Me(t,e,null),i=!0},p(o,r){r[0]&16&&E(e,"color",o[4]),r[0]&32&&E(e,"background-color",o[5])},i(o){i||(W(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),Ee(t)}}}function vo(n){let e,t,i;return t=new rt({props:{icon:Ut}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Re(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","fixed h-3 w-3 text-base opacity-25 sm:text-xl"),E(e,"color",n[4]),E(e,"top",n[21]),E(e,"left",n[22]),E(e,"right",n[23])},m(o,r){H(o,e,r),Me(t,e,null),i=!0},p(o,r){r[0]&16&&E(e,"color",o[4]),r[0]&2097152&&E(e,"top",o[21]),r[0]&4194304&&E(e,"left",o[22]),r[0]&8388608&&E(e,"right",o[23])},i(o){i||(W(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),Ee(t)}}}function bl(n){let e,t,i,o,r=`${n[10]}px`,a=`${n[1]}px`,l=`${n[2]}px`,s=`${n[3]?n[1]:(n[1]+Lt)/n[24]-Lt}px`,u,h,w,m,v,S;i=new gi({props:{html:n[20]}}),i.$on("load",n[26]);let c=!n[19]&&Po(n),k=n[0]&&vo(n);return{c(){e=x("div"),t=x("div"),ye(i.$$.fragment),u=oe(),c&&c.c(),h=oe(),k&&k.c(),w=Nt(),this.h()},l(d){e=$(d,"DIV",{class:!0});var R=ee(e);t=$(R,"DIV",{class:!0});var F=ee(t);Re(i.$$.fragment,F),F.forEach(M),R.forEach(M),u=ie(d),c&&c.l(d),h=ie(d),k&&k.l(d),w=Nt(),this.h()},h(){U(t,"class","book-content-container svelte-u9j5ct"),U(e,"class","book-content m-auto svelte-u9j5ct"),K(e,"book-content--avoid-page-break",n[15]),K(e,"book-content--writing-vertical-rl",n[3]),K(e,"book-content--writing-horizontal-rl",!n[3]),K(e,"book-content--hide-furigana",n[13]),K(e,"book-content--hide-spoiler-image",n[12]),K(e,"book-content--furigana-style-partial",n[14]===st.Partial),K(e,"book-content--furigana-style-full",n[14]===st.Full),K(e,"book-content--furigana-style-toggle",n[14]===st.Toggle),E(e,"color",n[4]),E(e,"font-size",r),E(e,"line-height",n[11]),E(e,"padding-top",!n[3]&&n[16]?`${n[16]}px`:void 0),E(e,"padding-bottom",!n[3]&&n[16]?`${n[16]}px`:void 0),E(e,"padding-left",n[3]&&n[16]?`${n[16]}px`:void 0),E(e,"padding-right",n[3]&&n[16]?`${n[16]}px`:void 0),E(e,"max-width",n[1]?`${n[1]}px`:void 0),E(e,"max-height",n[3]&&n[2]?`${n[2]}px`:void 0),E(e,"--font-family-serif",n[8]),E(e,"--font-family-sans-serif",n[9]),E(e,"--book-content-hint-furigana-font-color",n[6]),E(e,"--book-content-hint-furigana-shadow-color",n[7]),E(e,"--book-content-child-width",a),E(e,"--book-content-child-height",l),E(e,"--book-content-child-column-width",!n[3]&&n[24]===1?`${n[1]}px`:""),E(e,"--book-content-column-count",n[24]),E(e,"--book-content-image-max-width",s)},m(d,R){H(d,e,R),te(e,t),Me(i,t,null),n[44](t),n[45](e),H(d,u,R),c&&c.m(d,R),H(d,h,R),k&&k.m(d,R),H(d,w,R),m=!0,v||(S=[pe(kl,"keydown",n[28]),jn(o=dl.call(null,e,{timeframe:500,minSwipeDistance:n[25],touchAction:"pan-y"})),pe(e,"swipe",n[27])],v=!0)},p(d,R){const F={};R[0]&1048576&&(F.html=d[20]),i.$set(F),o&&Uo(o.update)&&R[0]&33554432&&o.update.call(null,{timeframe:500,minSwipeDistance:d[25],touchAction:"pan-y"}),(!m||R[0]&32768)&&K(e,"book-content--avoid-page-break",d[15]),(!m||R[0]&8)&&K(e,"book-content--writing-vertical-rl",d[3]),(!m||R[0]&8)&&K(e,"book-content--writing-horizontal-rl",!d[3]),(!m||R[0]&8192)&&K(e,"book-content--hide-furigana",d[13]),(!m||R[0]&4096)&&K(e,"book-content--hide-spoiler-image",d[12]),(!m||R[0]&16384)&&K(e,"book-content--furigana-style-partial",d[14]===st.Partial),(!m||R[0]&16384)&&K(e,"book-content--furigana-style-full",d[14]===st.Full),(!m||R[0]&16384)&&K(e,"book-content--furigana-style-toggle",d[14]===st.Toggle),R[0]&16&&E(e,"color",d[4]),R[0]&1024&&r!==(r=`${d[10]}px`)&&E(e,"font-size",r),R[0]&2048&&E(e,"line-height",d[11]),R[0]&65544&&E(e,"padding-top",!d[3]&&d[16]?`${d[16]}px`:void 0),R[0]&65544&&E(e,"padding-bottom",!d[3]&&d[16]?`${d[16]}px`:void 0),R[0]&65544&&E(e,"padding-left",d[3]&&d[16]?`${d[16]}px`:void 0),R[0]&65544&&E(e,"padding-right",d[3]&&d[16]?`${d[16]}px`:void 0),R[0]&2&&E(e,"max-width",d[1]?`${d[1]}px`:void 0),R[0]&12&&E(e,"max-height",d[3]&&d[2]?`${d[2]}px`:void 0),R[0]&256&&E(e,"--font-family-serif",d[8]),R[0]&512&&E(e,"--font-family-sans-serif",d[9]),R[0]&64&&E(e,"--book-content-hint-furigana-font-color",d[6]),R[0]&128&&E(e,"--book-content-hint-furigana-shadow-color",d[7]),R[0]&2&&a!==(a=`${d[1]}px`)&&E(e,"--book-content-child-width",a),R[0]&4&&l!==(l=`${d[2]}px`)&&E(e,"--book-content-child-height",l),R[0]&16777226&&E(e,"--book-content-child-column-width",!d[3]&&d[24]===1?`${d[1]}px`:""),R[0]&16777216&&E(e,"--book-content-column-count",d[24]),R[0]&16777226&&s!==(s=`${d[3]?d[1]:(d[1]+Lt)/d[24]-Lt}px`)&&E(e,"--book-content-image-max-width",s),d[19]?c&&(ot(),Y(c,1,1,()=>{c=null}),it()):c?(c.p(d,R),R[0]&524288&&W(c,1)):(c=Po(d),c.c(),W(c,1),c.m(h.parentNode,h)),d[0]?k?(k.p(d,R),R[0]&1&&W(k,1)):(k=vo(d),k.c(),W(k,1),k.m(w.parentNode,w)):k&&(ot(),Y(k,1,1,()=>{k=null}),it())},i(d){m||(W(i.$$.fragment,d),W(c),W(k),m=!0)},o(d){Y(i.$$.fragment,d),Y(c),Y(k),m=!1},d(d){d&&M(e),Ee(i),n[44](null),n[45](null),d&&M(u),c&&c.d(d),d&&M(h),k&&k.d(d),d&&M(w),v=!1,kt(S)}}}const yo="overflow-hidden",Lt=40;function Cl(n,e,t){let i,o,r,a,l,s,u,h;j(n,Kt,p=>t(51,o=p)),j(n,zt,p=>t(52,r=p)),j(n,ii,p=>t(53,a=p)),j(n,qn,p=>t(54,l=p)),j(n,ni,p=>t(55,s=p)),j(n,ri,p=>t(56,u=p)),j(n,pr,p=>t(25,h=p));let{htmlContent:w}=e,{width:m}=e,{height:v}=e,{verticalMode:S}=e,{fontColor:c}=e,{backgroundColor:k}=e,{hintFuriganaFontColor:d}=e,{hintFuriganaShadowColor:R}=e,{fontFamilyGroupOne:F}=e,{fontFamilyGroupTwo:y}=e,{fontSize:D}=e,{lineHeight:B}=e,{hideSpoilerImage:X}=e,{hideFurigana:I}=e,{furiganaStyle:A}=e,{loadingState:L}=e,{bookmarkData:T}=e,{pageManager:N}=e,{bookmarkManager:_}=e,{exploredCharCount:V}=e,{bookCharCount:b}=e,{isBookmarkScreen:O=!1}=e,{avoidPageBreak:Z=!0}=e,{pageColumns:ce}=e,{firstDimensionMargin:De}=e,{autoBookmark:Te=!1}=e,{customReadingPointRange:be}=e,{showCustomReadingPoint:Oe}=e;const Le=_n();let de,re,ae,Ie=[],Q,we,me,Be=!1,He="",ge=!0,C=0,z=!1,Fe,q,Se,Ve=!1;const $e=new nt,Ke=new nt,Ce=new dn(-1),_e=new nt,Ye=new dn(0),Ue=new nt,ke=new nt,ft=Ce.pipe(Xe(p=>{var J;return((J=Ie[p])==null?void 0:J.innerHTML)||""})),Ge=new nt;Gn(()=>{document.body.classList.remove(yo),Ge.next(),Ge.complete()}),Qt([$e,Ke]).pipe(mn(1),Vt(()=>ke.pipe(Gt(1))),ct(Ge)).subscribe(()=>{if(!ae||!Q)return;const p=ae.getScrollPosByCharCount(C);p<0||Q.scrollTo(p,!1)}),_e.pipe(ct(Ge)).subscribe(p=>{var J;!ae||(t(34,Oe=!1),qt((J=be==null?void 0:be.endContainer)==null?void 0:J.parentElement,"remove",1),t(29,be=void 0),t(32,V=ae.calcExploredCharCount(be)),p&&(C=V,u&&pi(window)),T.then(at))}),Te&&_e.pipe(Zt(3e3),ct(Ge)).subscribe(p=>{p&&Le("bookmark")}),ft.pipe(hi(),ct(Ge)).subscribe(()=>{t(19,Be=!1)}),ft.pipe(ct(Ge)).subscribe(p=>{const J=(he,ze)=>{if(ze===0){he();return}requestAnimationFrame(()=>J(he,ze-1))};J(()=>{t(20,He=p)},2)}),At(()=>ut(document.body,"wheel",{passive:!0})).pipe(xt(()=>!s&&!o),Oa(50),ct(Ge)).subscribe(p=>{if(!r){let J=(p.deltaX<0?-1:1)*(S?-1:1);p.deltaX||(J=p.deltaY<0?-1:1),Q==null||Q.flipPage(J)}});function mt(p){!ae||(t(32,V=ae.calcExploredCharCount(p)),C=V,We(p))}function We(p){!Q||!ae||Q.updateSectionDataByOffset(ae.getOffsetToRange(p,i))}function Je(){if(ge){ge=!1;return}if(!de)return;t(40,ae=new pl(de,Ie,Ye,()=>m,()=>v,()=>Lt,S,de,document)),t(32,V=0),C=0,t(33,b=ae.charCount);let p=!1;try{p=document.fonts.check(`${D}px ${F||"Noto Serif JP"}`)}catch(J){Ct.error(`Error checking Font Load: ${J.message}`),p=!0}p?(ae.updateCurrentSection(Ce.getValue()),Le("contentChange",de)):Ve||(Ve=!0,document.fonts.addEventListener("loadingdone",()=>{!ae||(ae.updateCurrentSection(Ce.getValue()),Le("contentChange",de))}))}function et(p){p.updateParagraphPos(),t(32,V=p.calcExploredCharCount(be)),ke.next(p),T.then(at),me&&(me=!1,T.then(J=>{!J||!_||(t(32,V=J.exploredCharCount||0),_.scrollToBookmark(J))})),t(19,Be=!0)}function at(p){const J=p==null?void 0:p.exploredCharCount;if(!ae||!J)return;const he=ae.checkBookmarkOnScreen(J);if(de&&he.isBookmarkScreen){const ze=Number(getComputedStyle(de)[S?"marginTop":"marginRight"].replace(/px$/,""));he.bookmarkPos?S?(t(21,Fe=ze?`${ze}px`:"0.5rem"),t(22,q=`${he.bookmarkPos.left}px`),t(23,Se=void 0)):(t(21,Fe=`${he.bookmarkPos.top}px`),t(23,Se=void 0),t(22,q=he.bookmarkPos.left>0?`calc(${he.bookmarkPos.left}px - ${l?"15":"20"}px)`:`calc(${Math.max(l?15:20,ze)}px)`)):Ae(ze)}else Ae(0);he.isBookmarkScreen&&p.exploredCharCount&&(he.node&&!z&&!he.isFirstNode?We(Jn(he.node)):he.isFirstNode&&We(void 0),t(32,V=z?V:p.exploredCharCount),C=V,z=!0),t(0,O=he.isBookmarkScreen)}function Ae(p){S?(t(21,Fe=p?`${p}px`:"0.5rem"),t(22,q=a?`${m-a}px`:void 0),t(23,Se=a?void 0:"0.75rem")):(t(21,Fe=a?`${a}px`:"0.5rem"),t(22,q=p?`calc(${p}px + 0.75rem)`:"0.75rem"),t(23,Se=void 0))}function bt(p){if(!Q||r||o||p.detail.direction!=="left"&&p.detail.direction!=="right")return;const J=p.detail.direction==="left",he=S?!J:J;Q.flipPage(he?1:-1)}function P(p){if(!(!Q||r||o))switch(p.code){case"ArrowLeft":Q[S?"nextPage":"prevPage"]();break;case"ArrowRight":Q[S?"prevPage":"nextPage"]();break;case"ArrowUp":Q.prevPage();break;case"ArrowDown":Q.nextPage();break}}on.pipe(ct(Ge)).subscribe(p=>{const J=Ie.findIndex(he=>he.id===p||he.querySelector(`[id="${p}"]`));J>-1&&(Ce.next(J),Q==null||Q.scrollTo(0,!0))});function se(p){ne[p?"unshift":"push"](()=>{re=p,t(18,re)})}function Qe(p){ne[p?"unshift":"push"](()=>{de=p,t(17,de)})}return n.$$set=p=>{"htmlContent"in p&&t(35,w=p.htmlContent),"width"in p&&t(1,m=p.width),"height"in p&&t(2,v=p.height),"verticalMode"in p&&t(3,S=p.verticalMode),"fontColor"in p&&t(4,c=p.fontColor),"backgroundColor"in p&&t(5,k=p.backgroundColor),"hintFuriganaFontColor"in p&&t(6,d=p.hintFuriganaFontColor),"hintFuriganaShadowColor"in p&&t(7,R=p.hintFuriganaShadowColor),"fontFamilyGroupOne"in p&&t(8,F=p.fontFamilyGroupOne),"fontFamilyGroupTwo"in p&&t(9,y=p.fontFamilyGroupTwo),"fontSize"in p&&t(10,D=p.fontSize),"lineHeight"in p&&t(11,B=p.lineHeight),"hideSpoilerImage"in p&&t(12,X=p.hideSpoilerImage),"hideFurigana"in p&&t(13,I=p.hideFurigana),"furiganaStyle"in p&&t(14,A=p.furiganaStyle),"loadingState"in p&&t(36,L=p.loadingState),"bookmarkData"in p&&t(37,T=p.bookmarkData),"pageManager"in p&&t(30,N=p.pageManager),"bookmarkManager"in p&&t(31,_=p.bookmarkManager),"exploredCharCount"in p&&t(32,V=p.exploredCharCount),"bookCharCount"in p&&t(33,b=p.bookCharCount),"isBookmarkScreen"in p&&t(0,O=p.isBookmarkScreen),"avoidPageBreak"in p&&t(15,Z=p.avoidPageBreak),"pageColumns"in p&&t(38,ce=p.pageColumns),"firstDimensionMargin"in p&&t(16,De=p.firstDimensionMargin),"autoBookmark"in p&&t(39,Te=p.autoBookmark),"customReadingPointRange"in p&&t(29,be=p.customReadingPointRange),"showCustomReadingPoint"in p&&t(34,Oe=p.showCustomReadingPoint)},n.$$.update=()=>{if(n.$$.dirty[1]&64&&T.then(p=>{z=!1,at(p)}),n.$$.dirty[0]&2&&m&&$e.next(m),n.$$.dirty[0]&4&&v&&Ke.next(v),n.$$.dirty[0]&10|n.$$.dirty[1]&128&&t(24,i=S?1:ce||Math.ceil(m/1e3)),n.$$.dirty[1]&16&&w&&(me=!0),n.$$.dirty[1]&16){const p=document.createElement("div");p.innerHTML=w,t(41,Ie=Array.from(p.children)),Ce.next(0)}if(n.$$.dirty[0]&393230|n.$$.dirty[1]&3072&&re&&de&&Ie&&(t(42,Q=new gl(re,de,Ie,Ce,Ye,m,v,Lt,S,_e,Ue)),t(30,N=Q)),n.$$.dirty[0]&6|n.$$.dirty[1]&544&&ae&&m&&v&&!L){const p=ae;requestAnimationFrame(()=>{et(p)})}n.$$.dirty[1]&544&&ae&&!L&&Ue.next(Ce.getValue()),n.$$.dirty[1]&6656&&ae&&Q&&(t(43,we=new ml(ae,Q,ke,Ce,p=>C=p)),t(31,_=we)),n.$$.dirty[0]&536870912&&mt(be)},document.body.classList.add(yo),[O,m,v,S,c,k,d,R,F,y,D,B,X,I,A,Z,De,de,re,Be,He,Fe,q,Se,i,h,Je,bt,P,be,N,_,V,b,Oe,w,L,T,ce,Te,ae,Ie,Q,we,se,Qe]}class _l extends Mt{constructor(e){super(),Et(this,e,Cl,bl,Dt,{htmlContent:35,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,fontSize:10,lineHeight:11,hideSpoilerImage:12,hideFurigana:13,furiganaStyle:14,loadingState:36,bookmarkData:37,pageManager:30,bookmarkManager:31,exploredCharCount:32,bookCharCount:33,isBookmarkScreen:0,avoidPageBreak:15,pageColumns:38,firstDimensionMargin:16,autoBookmark:39,customReadingPointRange:29,showCustomReadingPoint:34},null,[-1,-1,-1])}}function wl(n){let e,t,i,o,r,a,l,s,u,h;function w(y){n[59](y)}function m(y){n[60](y)}function v(y){n[61](y)}function S(y){n[62](y)}function c(y){n[63](y)}function k(y){n[64](y)}function d(y){n[65](y)}function R(y){n[66](y)}let F={htmlContent:n[13],width:n[35]??0,height:n[36]??0,verticalMode:n[14],fontColor:n[15],backgroundColor:n[16],hintFuriganaFontColor:n[17],hintFuriganaShadowColor:n[18],fontFamilyGroupOne:n[19],fontFamilyGroupTwo:n[20],fontSize:n[21],lineHeight:n[22],hideSpoilerImage:n[23],hideFurigana:n[24],furiganaStyle:n[25],loadingState:n[37]??!0,avoidPageBreak:n[29],pageColumns:n[30],autoBookmark:n[31],firstDimensionMargin:n[27]};return n[0]!==void 0&&(F.exploredCharCount=n[0]),n[1]!==void 0&&(F.bookCharCount=n[1]),n[6]!==void 0&&(F.isBookmarkScreen=n[6]),n[2]!==void 0&&(F.bookmarkData=n[2]),n[4]!==void 0&&(F.bookmarkManager=n[4]),n[5]!==void 0&&(F.pageManager=n[5]),n[11]!==void 0&&(F.customReadingPointRange=n[11]),n[12]!==void 0&&(F.showCustomReadingPoint=n[12]),e=new _l({props:F}),ne.push(()=>ue(e,"exploredCharCount",w)),ne.push(()=>ue(e,"bookCharCount",m)),ne.push(()=>ue(e,"isBookmarkScreen",v)),ne.push(()=>ue(e,"bookmarkData",S)),ne.push(()=>ue(e,"bookmarkManager",c)),ne.push(()=>ue(e,"pageManager",k)),ne.push(()=>ue(e,"customReadingPointRange",d)),ne.push(()=>ue(e,"showCustomReadingPoint",R)),e.$on("contentChange",n[67]),e.$on("bookmark",n[68]),{c(){ye(e.$$.fragment)},l(y){Re(e.$$.fragment,y)},m(y,D){Me(e,y,D),h=!0},p(y,D){const B={};D[0]&8192&&(B.htmlContent=y[13]),D[1]&16&&(B.width=y[35]??0),D[1]&32&&(B.height=y[36]??0),D[0]&16384&&(B.verticalMode=y[14]),D[0]&32768&&(B.fontColor=y[15]),D[0]&65536&&(B.backgroundColor=y[16]),D[0]&131072&&(B.hintFuriganaFontColor=y[17]),D[0]&262144&&(B.hintFuriganaShadowColor=y[18]),D[0]&524288&&(B.fontFamilyGroupOne=y[19]),D[0]&1048576&&(B.fontFamilyGroupTwo=y[20]),D[0]&2097152&&(B.fontSize=y[21]),D[0]&4194304&&(B.lineHeight=y[22]),D[0]&8388608&&(B.hideSpoilerImage=y[23]),D[0]&16777216&&(B.hideFurigana=y[24]),D[0]&33554432&&(B.furiganaStyle=y[25]),D[1]&64&&(B.loadingState=y[37]??!0),D[0]&536870912&&(B.avoidPageBreak=y[29]),D[0]&1073741824&&(B.pageColumns=y[30]),D[1]&1&&(B.autoBookmark=y[31]),D[0]&134217728&&(B.firstDimensionMargin=y[27]),!t&&D[0]&1&&(t=!0,B.exploredCharCount=y[0],fe(()=>t=!1)),!i&&D[0]&2&&(i=!0,B.bookCharCount=y[1],fe(()=>i=!1)),!o&&D[0]&64&&(o=!0,B.isBookmarkScreen=y[6],fe(()=>o=!1)),!r&&D[0]&4&&(r=!0,B.bookmarkData=y[2],fe(()=>r=!1)),!a&&D[0]&16&&(a=!0,B.bookmarkManager=y[4],fe(()=>a=!1)),!l&&D[0]&32&&(l=!0,B.pageManager=y[5],fe(()=>l=!1)),!s&&D[0]&2048&&(s=!0,B.customReadingPointRange=y[11],fe(()=>s=!1)),!u&&D[0]&4096&&(u=!0,B.showCustomReadingPoint=y[12],fe(()=>u=!1)),e.$set(B)},i(y){h||(W(e.$$.fragment,y),h=!0)},o(y){Y(e.$$.fragment,y),h=!1},d(y){Ee(e,y)}}}function Sl(n){let e,t,i,o,r,a,l,s,u,h,w,m;function v(I){n[47](I)}function S(I){n[48](I)}function c(I){n[49](I)}function k(I){n[50](I)}function d(I){n[51](I)}function R(I){n[52](I)}function F(I){n[53](I)}function y(I){n[54](I)}function D(I){n[55](I)}function B(I){n[56](I)}let X={htmlContent:n[13],width:n[35]??0,height:n[36]??0,verticalMode:n[14],fontColor:n[15],backgroundColor:n[16],hintFuriganaFontColor:n[17],hintFuriganaShadowColor:n[18],fontFamilyGroupOne:n[19],fontFamilyGroupTwo:n[20],fontSize:n[21],lineHeight:n[22],hideSpoilerImage:n[23],hideFurigana:n[24],furiganaStyle:n[25],secondDimensionMaxValue:n[26],firstDimensionMargin:n[27],autoPositionOnResize:n[28],autoBookmark:n[31],multiplier:n[33],loadingState:n[37]??!0};return n[0]!==void 0&&(X.exploredCharCount=n[0]),n[1]!==void 0&&(X.bookCharCount=n[1]),n[2]!==void 0&&(X.bookmarkData=n[2]),n[3]!==void 0&&(X.autoScroller=n[3]),n[4]!==void 0&&(X.bookmarkManager=n[4]),n[5]!==void 0&&(X.pageManager=n[5]),n[7]!==void 0&&(X.customReadingPoint=n[7]),n[8]!==void 0&&(X.customReadingPointTop=n[8]),n[9]!==void 0&&(X.customReadingPointLeft=n[9]),n[10]!==void 0&&(X.customReadingPointScrollOffset=n[10]),e=new tl({props:X}),ne.push(()=>ue(e,"exploredCharCount",v)),ne.push(()=>ue(e,"bookCharCount",S)),ne.push(()=>ue(e,"bookmarkData",c)),ne.push(()=>ue(e,"autoScroller",k)),ne.push(()=>ue(e,"bookmarkManager",d)),ne.push(()=>ue(e,"pageManager",R)),ne.push(()=>ue(e,"customReadingPoint",F)),ne.push(()=>ue(e,"customReadingPointTop",y)),ne.push(()=>ue(e,"customReadingPointLeft",D)),ne.push(()=>ue(e,"customReadingPointScrollOffset",B)),e.$on("contentChange",n[57]),e.$on("bookmark",n[58]),{c(){ye(e.$$.fragment)},l(I){Re(e.$$.fragment,I)},m(I,A){Me(e,I,A),m=!0},p(I,A){const L={};A[0]&8192&&(L.htmlContent=I[13]),A[1]&16&&(L.width=I[35]??0),A[1]&32&&(L.height=I[36]??0),A[0]&16384&&(L.verticalMode=I[14]),A[0]&32768&&(L.fontColor=I[15]),A[0]&65536&&(L.backgroundColor=I[16]),A[0]&131072&&(L.hintFuriganaFontColor=I[17]),A[0]&262144&&(L.hintFuriganaShadowColor=I[18]),A[0]&524288&&(L.fontFamilyGroupOne=I[19]),A[0]&1048576&&(L.fontFamilyGroupTwo=I[20]),A[0]&2097152&&(L.fontSize=I[21]),A[0]&4194304&&(L.lineHeight=I[22]),A[0]&8388608&&(L.hideSpoilerImage=I[23]),A[0]&16777216&&(L.hideFurigana=I[24]),A[0]&33554432&&(L.furiganaStyle=I[25]),A[0]&67108864&&(L.secondDimensionMaxValue=I[26]),A[0]&134217728&&(L.firstDimensionMargin=I[27]),A[0]&268435456&&(L.autoPositionOnResize=I[28]),A[1]&1&&(L.autoBookmark=I[31]),A[1]&4&&(L.multiplier=I[33]),A[1]&64&&(L.loadingState=I[37]??!0),!t&&A[0]&1&&(t=!0,L.exploredCharCount=I[0],fe(()=>t=!1)),!i&&A[0]&2&&(i=!0,L.bookCharCount=I[1],fe(()=>i=!1)),!o&&A[0]&4&&(o=!0,L.bookmarkData=I[2],fe(()=>o=!1)),!r&&A[0]&8&&(r=!0,L.autoScroller=I[3],fe(()=>r=!1)),!a&&A[0]&16&&(a=!0,L.bookmarkManager=I[4],fe(()=>a=!1)),!l&&A[0]&32&&(l=!0,L.pageManager=I[5],fe(()=>l=!1)),!s&&A[0]&128&&(s=!0,L.customReadingPoint=I[7],fe(()=>s=!1)),!u&&A[0]&256&&(u=!0,L.customReadingPointTop=I[8],fe(()=>u=!1)),!h&&A[0]&512&&(h=!0,L.customReadingPointLeft=I[9],fe(()=>h=!1)),!w&&A[0]&1024&&(w=!0,L.customReadingPointScrollOffset=I[10],fe(()=>w=!1)),e.$set(L)},i(I){m||(W(e.$$.fragment,I),m=!0)},o(I){Y(e.$$.fragment,I),m=!1},d(I){Ee(e,I)}}}function Pl(n){let e,t,i,o,r=(n[38]??"")+"",a,l;const s=[Sl,wl],u=[];function h(w,m){return w[32]===Bt.Continuous?0:1}return t=h(n),i=u[t]=s[t](n),{c(){e=x("div"),i.c(),o=oe(),a=Pe(r),this.h()},l(w){e=$(w,"DIV",{class:!0});var m=ee(e);i.l(m),m.forEach(M),o=ie(w),a=ve(w,r),this.h()},h(){U(e,"class",nl+" py-8")},m(w,m){H(w,e,m),u[t].m(e,null),n[69](e),H(w,o,m),H(w,a,m),l=!0},p(w,m){let v=t;t=h(w),t===v?u[t].p(w,m):(ot(),Y(u[v],1,1,()=>{u[v]=null}),it(),i=u[t],i?i.p(w,m):(i=u[t]=s[t](w),i.c()),W(i,1),i.m(e,null)),(!l||m[1]&128)&&r!==(r=(w[38]??"")+"")&&qe(a,r)},i(w){l||(W(i),l=!0)},o(w){Y(i),l=!1},d(w){w&&M(e),u[t].d(),n[69](null),w&&M(o),w&&M(a)}}}function un(n){return Number(n.replace(/px$/,""))}function vl(n,e,t){let i,o,r,a,l,s,{htmlContent:u}=e,{width:h}=e,{height:w}=e,{verticalMode:m}=e,{fontColor:v}=e,{backgroundColor:S}=e,{hintFuriganaFontColor:c}=e,{hintFuriganaShadowColor:k}=e,{fontFamilyGroupOne:d}=e,{fontFamilyGroupTwo:R}=e,{fontSize:F}=e,{lineHeight:y}=e,{hideSpoilerImage:D}=e,{hideFurigana:B}=e,{furiganaStyle:X}=e,{secondDimensionMaxValue:I}=e,{firstDimensionMargin:A}=e,{autoPositionOnResize:L}=e,{avoidPageBreak:T}=e,{pageColumns:N}=e,{autoBookmark:_}=e,{viewMode:V}=e,{exploredCharCount:b}=e,{bookCharCount:O}=e,{multiplier:Z}=e,{bookmarkData:ce}=e,{autoScroller:De}=e,{bookmarkManager:Te}=e,{pageManager:be}=e,{isBookmarkScreen:Oe}=e,{customReadingPoint:Le}=e,{customReadingPointTop:de}=e,{customReadingPointLeft:re}=e,{customReadingPointScrollOffset:ae}=e,{customReadingPointRange:Ie}=e,{showCustomReadingPoint:Q}=e;const we=new nt,me=new nt,Be=kr(null);j(n,Be,g=>t(34,o=g));const He=Qt([Be.pipe(xt(g=>!!g)),Qt([we,me]).pipe(Ln(0))]).pipe(Zt(0,Pn),Xe(([g])=>getComputedStyle(g)),Vn({refCount:!0,bufferSize:1})),ge=new br(1),C=He.pipe(Xe(g=>Se(h-un(g.paddingLeft)-un(g.paddingRight))));j(n,C,g=>t(35,r=g));const z=He.pipe(Xe(g=>Ve(w-un(g.paddingTop)-un(g.paddingBottom)-i)));j(n,z,g=>t(36,a=g));const Fe=At(()=>Yn(document)).pipe(cn(g=>{const rn=rl(g,X);return ge.pipe(cn(an=>rn(an)))}),yt());j(n,Fe,g=>t(38,s=g));const q=ge.pipe(cn(g=>ol(g)),zn());j(n,q,g=>t(37,l=g));function Se(g){return Bt.Paginated===V&&!m&&I?Math.min(I,g):g}function Ve(g){return Bt.Paginated===V&&m&&I?Math.min(I,g):g}function $e(g){b=g,t(0,b)}function Ke(g){O=g,t(1,O)}function Ce(g){ce=g,t(2,ce)}function _e(g){De=g,t(3,De)}function Ye(g){Te=g,t(4,Te)}function Ue(g){be=g,t(5,be)}function ke(g){Le=g,t(7,Le)}function ft(g){de=g,t(8,de)}function Ge(g){re=g,t(9,re)}function mt(g){ae=g,t(10,ae)}const We=g=>ge.next(g.detail);function Je(g){ro.call(this,n,g)}function et(g){b=g,t(0,b)}function at(g){O=g,t(1,O)}function Ae(g){Oe=g,t(6,Oe)}function bt(g){ce=g,t(2,ce)}function P(g){Te=g,t(4,Te)}function se(g){be=g,t(5,be)}function Qe(g){Ie=g,t(11,Ie)}function p(g){Q=g,t(12,Q)}const J=g=>ge.next(g.detail);function he(g){ro.call(this,n,g)}function ze(g){ne[g?"unshift":"push"](()=>{o=g,Be.set(o)})}return n.$$set=g=>{"htmlContent"in g&&t(13,u=g.htmlContent),"width"in g&&t(45,h=g.width),"height"in g&&t(46,w=g.height),"verticalMode"in g&&t(14,m=g.verticalMode),"fontColor"in g&&t(15,v=g.fontColor),"backgroundColor"in g&&t(16,S=g.backgroundColor),"hintFuriganaFontColor"in g&&t(17,c=g.hintFuriganaFontColor),"hintFuriganaShadowColor"in g&&t(18,k=g.hintFuriganaShadowColor),"fontFamilyGroupOne"in g&&t(19,d=g.fontFamilyGroupOne),"fontFamilyGroupTwo"in g&&t(20,R=g.fontFamilyGroupTwo),"fontSize"in g&&t(21,F=g.fontSize),"lineHeight"in g&&t(22,y=g.lineHeight),"hideSpoilerImage"in g&&t(23,D=g.hideSpoilerImage),"hideFurigana"in g&&t(24,B=g.hideFurigana),"furiganaStyle"in g&&t(25,X=g.furiganaStyle),"secondDimensionMaxValue"in g&&t(26,I=g.secondDimensionMaxValue),"firstDimensionMargin"in g&&t(27,A=g.firstDimensionMargin),"autoPositionOnResize"in g&&t(28,L=g.autoPositionOnResize),"avoidPageBreak"in g&&t(29,T=g.avoidPageBreak),"pageColumns"in g&&t(30,N=g.pageColumns),"autoBookmark"in g&&t(31,_=g.autoBookmark),"viewMode"in g&&t(32,V=g.viewMode),"exploredCharCount"in g&&t(0,b=g.exploredCharCount),"bookCharCount"in g&&t(1,O=g.bookCharCount),"multiplier"in g&&t(33,Z=g.multiplier),"bookmarkData"in g&&t(2,ce=g.bookmarkData),"autoScroller"in g&&t(3,De=g.autoScroller),"bookmarkManager"in g&&t(4,Te=g.bookmarkManager),"pageManager"in g&&t(5,be=g.pageManager),"isBookmarkScreen"in g&&t(6,Oe=g.isBookmarkScreen),"customReadingPoint"in g&&t(7,Le=g.customReadingPoint),"customReadingPointTop"in g&&t(8,de=g.customReadingPointTop),"customReadingPointLeft"in g&&t(9,re=g.customReadingPointLeft),"customReadingPointScrollOffset"in g&&t(10,ae=g.customReadingPointScrollOffset),"customReadingPointRange"in g&&t(11,Ie=g.customReadingPointRange),"showCustomReadingPoint"in g&&t(12,Q=g.showCustomReadingPoint)},n.$$.update=()=>{n.$$.dirty[0]&134234112|n.$$.dirty[1]&2&&(i=A&&Bt.Paginated===V&&!m?A*2:0),n.$$.dirty[1]&16384&&we.next(h),n.$$.dirty[1]&32768&&me.next(w)},[b,O,ce,De,Te,be,Oe,Le,de,re,ae,Ie,Q,u,m,v,S,c,k,d,R,F,y,D,B,X,I,A,L,T,N,_,V,Z,o,r,a,l,s,Be,ge,C,z,Fe,q,h,w,$e,Ke,Ce,_e,Ye,Ue,ke,ft,Ge,mt,We,Je,et,at,Ae,bt,P,se,Qe,p,J,he,ze]}class yl extends Mt{constructor(e){super(),Et(this,e,vl,Pl,Dt,{htmlContent:13,width:45,height:46,verticalMode:14,fontColor:15,backgroundColor:16,hintFuriganaFontColor:17,hintFuriganaShadowColor:18,fontFamilyGroupOne:19,fontFamilyGroupTwo:20,fontSize:21,lineHeight:22,hideSpoilerImage:23,hideFurigana:24,furiganaStyle:25,secondDimensionMaxValue:26,firstDimensionMargin:27,autoPositionOnResize:28,avoidPageBreak:29,pageColumns:30,autoBookmark:31,viewMode:32,exploredCharCount:0,bookCharCount:1,multiplier:33,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6,customReadingPoint:7,customReadingPointTop:8,customReadingPointLeft:9,customReadingPointScrollOffset:10,customReadingPointRange:11,showCustomReadingPoint:12},null,[-1,-1,-1])}}function Rl(n,e){const t=document.createTextNode(e);if(n.firstChild){n.replaceChild(t,n.firstChild);return}n.appendChild(t)}function Ml(n,e,t){let{styleSheet:i}=e,o;return Jo(()=>{t(1,o=document.createElement("style")),document.head.appendChild(o)}),Gn(()=>{o&&document.head.removeChild(o)}),n.$$set=r=>{"styleSheet"in r&&t(0,i=r.styleSheet)},n.$$.update=()=>{n.$$.dirty&3&&o&&Rl(o,i)},[i,o]}class El extends Mt{constructor(e){super(),Et(this,e,Ml,null,Dt,{styleSheet:0})}}function Ro(n,e,t){const i=n.slice();return i[19]=e[t],i}function Mo(n){let e,t,i,o,r;return t=new rt({props:{icon:Zr}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(a){e=$(a,"DIV",{role:!0,class:!0});var l=ee(e);Re(t.$$.fragment,l),l.forEach(M),this.h()},h(){U(e,"role","button"),U(e,"class",Sn)},m(a,l){H(a,e,l),Me(t,e,null),i=!0,o||(r=[pe(e,"click",n[13]),pe(e,"keyup",pt)],o=!0)},p:Rt,i(a){i||(W(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&M(e),Ee(t),o=!1,kt(r)}}}function Eo(n){let e,t,i;return{c(){e=x("div"),t=Pe(n[1]),i=Pe("x"),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);t=ve(r,n[1]),i=ve(r,"x"),r.forEach(M),this.h()},h(){U(e,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg")},m(o,r){H(o,e,r),te(e,t),te(e,i)},p(o,r){r&2&&qe(t,o[1])},d(o){o&&M(e)}}}function Do(n){let e,t,i,o={placement:"bottom",fallbackPlacements:["bottom-end","bottom-start"],yOffset:0,$$slots:{content:[Bl],icon:[Dl]},$$scope:{ctx:n}};return t=new ua({props:o}),n[16](t),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(r){e=$(r,"DIV",{class:!0});var a=ee(e);Re(t.$$.fragment,a),a.forEach(M),this.h()},h(){U(e,"class","flex")},m(r,a){H(r,e,a),Me(t,e,null),i=!0},p(r,a){const l={};a&4194304&&(l.$$scope={dirty:a,ctx:r}),t.$set(l)},i(r){i||(W(t.$$.fragment,r),i=!0)},o(r){Y(t.$$.fragment,r),i=!1},d(r){r&&M(e),n[16](null),Ee(t)}}}function Dl(n){let e,t,i;return t=new rt({props:{icon:$r}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{slot:!0,class:!0});var r=ee(e);Re(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"slot","icon"),U(e,"class",Sn)},m(o,r){H(o,e,r),Me(t,e,null),i=!0},p:Rt,i(o){i||(W(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),Ee(t)}}}function Bo(n,e){let t,i=e[19].label+"",o,r,a,l;function s(){return e[15](e[19])}return{key:n,first:null,c(){t=x("div"),o=Pe(i),r=oe(),this.h()},l(u){t=$(u,"DIV",{role:!0,class:!0});var h=ee(t);o=ve(h,i),r=ie(h),h.forEach(M),this.h()},h(){U(t,"role","button"),U(t,"class","px-4 py-2 text-sm hover:bg-white hover:text-gray-700"),this.first=t},m(u,h){H(u,t,h),te(t,o),te(t,r),a||(l=[pe(t,"click",s),pe(t,"keyup",pt)],a=!0)},p(u,h){e=u},d(u){u&&M(t),a=!1,kt(l)}}}function Bl(n){let e,t=[],i=new Map,o=n[10];const r=a=>a[19].label;for(let a=0;a<o.length;a+=1){let l=Ro(n,o,a),s=r(l);i.set(s,t[a]=Bo(s,l))}return{c(){e=x("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=$(a,"DIV",{class:!0,slot:!0});var l=ee(e);for(let s=0;s<t.length;s+=1)t[s].l(l);l.forEach(M),this.h()},h(){U(e,"class","w-40 bg-gray-700 md:w-32"),U(e,"slot","content")},m(a,l){H(a,e,l);for(let s=0;s<t.length;s+=1)t[s].m(e,null)},p(a,l){l&3072&&(o=a[10],t=Qo(t,l,r,1,a,o,i,e,Zo,Bo,null,Ro))},d(a){a&&M(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function Fo(n){let e,t,i,o,r;return t=new rt({props:{icon:xr}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(a){e=$(a,"DIV",{role:!0,class:!0});var l=ee(e);Re(t.$$.fragment,l),l.forEach(M),this.h()},h(){U(e,"role","button"),U(e,"class",Sn)},m(a,l){H(a,e,l),Me(t,e,null),i=!0,o||(r=[pe(e,"click",n[17]),pe(e,"keyup",pt)],o=!0)},p:Rt,i(a){i||(W(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&M(e),Ee(t),o=!1,kt(r)}}}function Fl(n){let e,t,i,o,r,a,l,s,u,h,w,m,v,S,c=n[0]&&Mo(n);r=new rt({props:{icon:n[3]?Ut:mo}});let k=!n[6]&&Eo(n),d=(n[7]||n[8]===Bt.Paginated)&&Do(n),R=n[2]&&Fo(n);return w=new sa({props:{disableRouteNavigation:!0,items:n[5]?[je.SETTINGS,je.DOMAIN_HINT,je.MANAGE]:[je.SETTINGS,je.MANAGE]}}),w.$on("action",n[18]),{c(){e=x("div"),t=x("div"),c&&c.c(),i=oe(),o=x("div"),ye(r.$$.fragment),a=oe(),k&&k.c(),l=oe(),s=x("div"),d&&d.c(),u=oe(),R&&R.c(),h=oe(),ye(w.$$.fragment),this.h()},l(F){e=$(F,"DIV",{class:!0});var y=ee(e);t=$(y,"DIV",{class:!0});var D=ee(t);c&&c.l(D),i=ie(D),o=$(D,"DIV",{role:!0,class:!0});var B=ee(o);Re(r.$$.fragment,B),B.forEach(M),a=ie(D),k&&k.l(D),D.forEach(M),l=ie(y),s=$(y,"DIV",{class:!0});var X=ee(s);d&&d.l(X),u=ie(X),R&&R.l(X),h=ie(X),Re(w.$$.fragment,X),X.forEach(M),y.forEach(M),this.h()},h(){U(o,"role","button"),U(o,"class",Sn),U(t,"class","flex transform-gpu "+Cr),U(s,"class","flex transform-gpu "+_r),U(e,"class","flex justify-between bg-gray-700 px-4 md:px-8 "+wr)},m(F,y){H(F,e,y),te(e,t),c&&c.m(t,null),te(t,i),te(t,o),Me(r,o,null),te(t,a),k&&k.m(t,null),te(e,l),te(e,s),d&&d.m(s,null),te(s,u),R&&R.m(s,null),te(s,h),Me(w,s,null),m=!0,v||(S=[pe(o,"click",n[14]),pe(o,"keyup",pt)],v=!0)},p(F,[y]){F[0]?c?(c.p(F,y),y&1&&W(c,1)):(c=Mo(F),c.c(),W(c,1),c.m(t,i)):c&&(ot(),Y(c,1,1,()=>{c=null}),it());const D={};y&8&&(D.icon=F[3]?Ut:mo),r.$set(D),F[6]?k&&(k.d(1),k=null):k?k.p(F,y):(k=Eo(F),k.c(),k.m(t,null)),F[7]||F[8]===Bt.Paginated?d?(d.p(F,y),y&384&&W(d,1)):(d=Do(F),d.c(),W(d,1),d.m(s,u)):d&&(ot(),Y(d,1,1,()=>{d=null}),it()),F[2]?R?(R.p(F,y),y&4&&W(R,1)):(R=Fo(F),R.c(),W(R,1),R.m(s,h)):R&&(ot(),Y(R,1,1,()=>{R=null}),it());const B={};y&32&&(B.items=F[5]?[je.SETTINGS,je.DOMAIN_HINT,je.MANAGE]:[je.SETTINGS,je.MANAGE]),w.$set(B)},i(F){m||(W(c),W(r.$$.fragment,F),W(d),W(R),W(w.$$.fragment,F),m=!0)},o(F){Y(c),Y(r.$$.fragment,F),Y(d),Y(R),Y(w.$$.fragment,F),m=!1},d(F){F&&M(e),c&&c.d(),Ee(r),k&&k.d(),d&&d.d(),R&&R.d(),Ee(w),v=!1,kt(S)}}}function Tl(n,e,t){let i,o,r,a;j(n,qn,B=>t(6,o=B)),j(n,Xn,B=>t(7,r=B)),j(n,ai,B=>t(8,a=B));let{hasChapterData:l}=e,{autoScrollMultiplier:s}=e,{hasCustomReadingPoint:u}=e,{showFullscreenButton:h}=e,{isBookmarkScreen:w}=e;const m=_n(),v=[...u?[{label:"Show Point",action:"showCustomReadingPoint"}]:[],{label:"Set Point",action:"setCustomReadingPoint"},...u?[{label:"Reset Point",action:"resetCustomReadingPoint"}]:[]];let S;function c(B){m(B),S.toggleOpen()}const k=()=>m("tocClick"),d=()=>m("bookmarkClick"),R=B=>c(B.action);function F(B){ne[B?"unshift":"push"](()=>{S=B,t(4,S)})}const y=()=>m("fullscreenClick"),D=({detail:B})=>{B===je.SETTINGS.label?m("settingsClick"):B===je.DOMAIN_HINT.label?m("domainHintClick"):B===je.MANAGE.label&&m("bookManagerClick")};return n.$$set=B=>{"hasChapterData"in B&&t(0,l=B.hasChapterData),"autoScrollMultiplier"in B&&t(1,s=B.autoScrollMultiplier),"hasCustomReadingPoint"in B&&t(12,u=B.hasCustomReadingPoint),"showFullscreenButton"in B&&t(2,h=B.showFullscreenButton),"isBookmarkScreen"in B&&t(3,w=B.isBookmarkScreen)},t(5,i=Sr(window)),[l,s,h,w,S,i,o,r,a,m,v,c,u,k,d,R,F,y,D]}class Il extends Mt{constructor(e){super(),Et(this,e,Tl,Fl,Dt,{hasChapterData:0,autoScrollMultiplier:1,hasCustomReadingPoint:12,showFullscreenButton:2,isBookmarkScreen:3})}}function To(n,e,t){const i=n.slice();return i[16]=e[t],i}function Io(n,e){let t,i,o=e[16].label+"",r,a,l,s,u=e[16].startCharacter+"",h,w,m,v;function S(){return e[13](e[16])}return{key:n,first:null,c(){t=x("div"),i=x("div"),r=Pe(o),l=oe(),s=x("div"),h=Pe(u),w=oe(),this.h()},l(c){t=$(c,"DIV",{class:!0});var k=ee(t);i=$(k,"DIV",{id:!0,class:!0});var d=ee(i);r=ve(d,o),d.forEach(M),l=ie(k),s=$(k,"DIV",{});var R=ee(s);h=ve(R,u),R.forEach(M),w=ie(k),k.forEach(M),this.h()},h(){U(i,"id",a=`for${e[16].reference}`),U(i,"class","mr-4 cursor-pointer"),K(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),K(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),K(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),K(s,"opacity-30",e[16].progress===100&&e[16]!==e[2]),U(t,"class","my-6 flex justify-between"),this.first=t},m(c,k){H(c,t,k),te(t,i),te(i,r),te(t,l),te(t,s),te(s,h),te(t,w),m||(v=[pe(i,"click",S),pe(i,"keydown",pt)],m=!0)},p(c,k){e=c,k&2&&o!==(o=e[16].label+"")&&qe(r,o),k&2&&a!==(a=`for${e[16].reference}`)&&U(i,"id",a),k&6&&K(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),k&6&&K(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),k&6&&K(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),k&2&&u!==(u=e[16].startCharacter+"")&&qe(h,u),k&6&&K(s,"opacity-30",e[16].progress===100&&e[16]!==e[2])},d(c){c&&M(t),m=!1,kt(v)}}}function Al(n){let e,t,i,o,r,a,l,s,u,h,w,m,v=[],S=new Map,c,k,d,R,F,y,D,B,X,I;h=new rt({props:{icon:ea}});let A=n[1];const L=T=>T[16].reference;for(let T=0;T<A.length;T+=1){let N=To(n,A,T),_=L(N);S.set(_,v[T]=Io(_,N))}return R=new rt({props:{icon:ta}}),D=new rt({props:{icon:na}}),{c(){e=x("div"),t=x("div"),i=Pe("Chapter Progress: "),o=Pe(n[3]),r=Pe(" ("),a=Pe(n[4]),l=Pe("%)"),s=oe(),u=x("div"),ye(h.$$.fragment),w=oe(),m=x("div");for(let T=0;T<v.length;T+=1)v[T].c();c=oe(),k=x("div"),d=x("div"),ye(R.$$.fragment),F=oe(),y=x("div"),ye(D.$$.fragment),this.h()},l(T){e=$(T,"DIV",{class:!0});var N=ee(e);t=$(N,"DIV",{});var _=ee(t);i=ve(_,"Chapter Progress: "),o=ve(_,n[3]),r=ve(_," ("),a=ve(_,n[4]),l=ve(_,"%)"),_.forEach(M),s=ie(N),u=$(N,"DIV",{class:!0});var V=ee(u);Re(h.$$.fragment,V),V.forEach(M),N.forEach(M),w=ie(T),m=$(T,"DIV",{class:!0});var b=ee(m);for(let De=0;De<v.length;De+=1)v[De].l(b);b.forEach(M),c=ie(T),k=$(T,"DIV",{class:!0});var O=ee(k);d=$(O,"DIV",{class:!0});var Z=ee(d);Re(R.$$.fragment,Z),Z.forEach(M),F=ie(O),y=$(O,"DIV",{class:!0});var ce=ee(y);Re(D.$$.fragment,ce),ce.forEach(M),O.forEach(M),this.h()},h(){U(u,"class","flex cursor-pointer items-end md:items-center"),U(e,"class","flex justify-between p-4"),U(m,"class","flex-1 overflow-auto p-4"),U(d,"class","cursor-pointer"),K(d,"opacity-30",!n[6]),U(y,"class","cursor-pointer"),K(y,"opacity-30",!n[5]),U(k,"class","flex justify-between px-4 py-6")},m(T,N){H(T,e,N),te(e,t),te(t,i),te(t,o),te(t,r),te(t,a),te(t,l),te(e,s),te(e,u),Me(h,u,null),H(T,w,N),H(T,m,N);for(let _=0;_<v.length;_+=1)v[_].m(m,null);H(T,c,N),H(T,k,N),te(k,d),Me(R,d,null),te(k,F),te(k,y),Me(D,y,null),B=!0,X||(I=[pe(u,"click",n[9]),pe(u,"keydown",pt),pe(d,"click",n[14]),pe(d,"keydown",pt),pe(y,"click",n[15]),pe(y,"keydown",pt)],X=!0)},p(T,[N]){(!B||N&8)&&qe(o,T[3]),(!B||N&16)&&qe(a,T[4]),N&262&&(A=T[1],v=Qo(v,N,L,1,T,A,S,m,Zo,Io,null,To)),(!B||N&64)&&K(d,"opacity-30",!T[6]),(!B||N&32)&&K(y,"opacity-30",!T[5])},i(T){B||(W(h.$$.fragment,T),W(R.$$.fragment,T),W(D.$$.fragment,T),B=!0)},o(T){Y(h.$$.fragment,T),Y(R.$$.fragment,T),Y(D.$$.fragment,T),B=!1},d(T){T&&M(e),Ee(h),T&&M(w),T&&M(m);for(let N=0;N<v.length;N+=1)v[N].d();T&&M(c),T&&M(k),Ee(R),Ee(D),X=!1,kt(I)}}}function Ol(n,e){const[t,i]=e.reduce((o,r,a)=>(o[0]+=n[a]*r,o[1]+=r,o),[0,0]);return t/i}function Ao(n){!n||(n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView())}function Ll(n,e,t){let i,o,{sectionData:r=[]}=e,{exploredCharCount:a=0}=e,{verticalMode:l}=e,s=[],u,h=-1,w="0/0",m="0.00";Jo(()=>{dt.dialogs$.next([{component:"<div/>"}]),u&&Ao(document.getElementById(`for${u.reference}`))});function v(F,y){if(F){const D=s[h+y];S(D.reference,!1)}}function S(F,y=!1){on.next(F),y&&c()}function c(){zt.next(!1),dt.dialogs$.next([])}const k=F=>S(F.reference,!0),d=()=>v(i,l?1:-1),R=()=>v(o,l?-1:1);return n.$$set=F=>{"sectionData"in F&&t(10,r=F.sectionData),"exploredCharCount"in F&&t(11,a=F.exploredCharCount),"verticalMode"in F&&t(0,l=F.verticalMode)},n.$$.update=()=>{if(n.$$.dirty&5120&&r){const[F,y,D]=mi(r),B=r.filter(X=>X.reference===D||X.parentChapter===D);t(4,m=Ol(B.map(X=>X.progress),B.map(X=>X.charactersWeight)).toFixed(2)),t(1,s=F),t(12,h=y),t(2,u=F[h])}if(n.$$.dirty&4099&&t(6,i=l?h<s.length-1:!!h),n.$$.dirty&4099&&t(5,o=l?!!h:h<s.length-1),n.$$.dirty&2052&&u){Ao(document.getElementById(`for${u.reference}`));const F=u.characters;t(3,w=`${Math.min(Math.max(a-u.startCharacter,0),F)} / ${F}`)}},[l,s,u,w,m,o,i,v,S,c,r,a,h,k,d,R]}class Vl extends Mt{constructor(e){super(),Et(this,e,Ll,Al,Dt,{sectionData:10,exploredCharCount:11,verticalMode:0})}}class zl{constructor(e){xe(this,"fallbackSpec");this.fallbackSpec=Oo(e)}get fullscreenEnabled(){return this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled")??!1}get fullscreenElement(){return this.fallbackSpec("fullscreenElement","webkitFullscreenElement")??null}async requestFullscreen(e,t){const i=Oo(e)("requestFullscreen","webkitRequestFullscreen");!i||await i(t)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function Oo(n){return(e,t)=>Lo(n,e)??Lo(n,t)}function Lo(n,e){const t=n[e];return typeof t=="function"?t.bind(n):t}const hn=new zl(document);function Nl(n,e){return Hl(n).pipe(Xe(t=>{const i=e.createElement("div");return i.innerHTML=t,Gl(i),Wl(i),jl(i,e),Xl(i),i.innerHTML}))}function Hl(n){return new St(e=>{const{blobs:t}=n;let{elementHtml:i}=n;const o=[];return Object.entries(t).forEach(([r,a])=>{const l=URL.createObjectURL(a);o.push(l),i=i.replaceAll(Pr(r),l).replaceAll(`ttu:${r}`,l)}),e.next(i),()=>{o.forEach(r=>URL.revokeObjectURL(r))}})}function Gl(n){Array.from(n.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:li(e)})).forEach(({parentEl:e,isGaiji:t})=>{e==null||e.classList.add("ttu-img-container"),t||e==null||e.classList.add("ttu-illustration-container")})}function Wl(n){Array.from(n.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function jl(n,e){const t=()=>{let o=[...n.children];const r=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return r>0&&r<o.length&&(o=o.slice(r)),o},i=(o,r)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||r).insertBefore(a,o),a.appendChild(o)};t().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(r=>!li(r)).forEach(r=>i(r,o)),Array.from(o.getElementsByTagName("svg")).filter(r=>r.getElementsByTagName("image").length).forEach(r=>i(r,o))})}function Xl(n){n.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var ql=wi;function wi(n,e,t){n instanceof RegExp&&(n=Vo(n,t)),e instanceof RegExp&&(e=Vo(e,t));const i=Si(n,e,t);return i&&{start:i[0],end:i[1],pre:t.slice(0,i[0]),body:t.slice(i[0]+n.length,i[1]),post:t.slice(i[1]+e.length)}}function Vo(n,e){const t=e.match(n);return t?t[0]:null}wi.range=Si;function Si(n,e,t){let i,o,r,a,l,s=t.indexOf(n),u=t.indexOf(e,s+1),h=s;if(s>=0&&u>0){if(n===e)return[s,u];for(i=[],r=t.length;h>=0&&!l;)h===s?(i.push(h),s=t.indexOf(n,h+1)):i.length===1?l=[i.pop(),u]:(o=i.pop(),o<r&&(r=o,a=u),u=t.indexOf(e,h+1)),h=s<u&&s>=0?s:u;i.length&&(l=[r,a])}return l}function Kl(n,e={}){const i=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function r(_){throw new Error(`CSS parse error: ${_}`)}function a(_){const V=_.exec(n);if(V)return n=n.slice(V[0].length),V}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function u(){a(/^\s*/)}function h(){if(u(),n[0]!=="/"||n[1]!=="*")return;let _=2;for(;n[_]&&(n[_]!=="*"||n[_+1]!=="/");)_++;if(!n[_])return r("end of comment is missing");const V=n.slice(2,_);return n=n.slice(_+2),{type:"comment",comment:V}}function w(){const _=[];let V;for(;V=h();)_.push(V);return i.removeComments?[]:_}function m(){for(u();n[0]==="}";)r("extra closing bracket");const _=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(_)return _[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(V){return V.replace(/,/g,"‌")}).split(/\s*(?![^(]*\)),\s*/).map(function(V){return V.replace(/\u200C/g,",")})}function v(){if(n[0]==="@")return L();a(/^([;\s]*)+/);const _=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let V=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!V)return;if(V=V[0].trim(),!a(/^:\s*/))return r("property missing ':'");const b=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),O={type:"declaration",property:V.replace(_,""),value:b?b[0].replace(_,"").trim():""};return a(/^[;\s]*/),O}function S(){if(!l())return r("missing '{'");let _,V=w();for(;_=v();)V.push(_),V=V.concat(w());return s()?V:r("missing '}'")}function c(){u();const _=[];let V;for(;V=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)_.push(V[1]),a(/^,\s*/);if(_.length)return{type:"keyframe",values:_,declarations:S()}}function k(){let _=a(/^@([-\w]+)?keyframes\s*/);if(!_)return;const V=_[1];if(_=a(/^([-\w]+)\s*/),!_)return r("@keyframes missing name");const b=_[1];if(!l())return r("@keyframes missing '{'");let O,Z=w();for(;O=c();)Z.push(O),Z=Z.concat(w());return s()?{type:"keyframes",name:b,vendor:V,keyframes:Z}:r("@keyframes missing '}'")}function d(){if(a(/^@page */))return{type:"page",selectors:m()||[],declarations:S()}}function R(){const _=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(_)return{type:"page-margin-box",name:`${_[1]}-${_[2]}`+(_[3]?`-${_[3]}`:""),declarations:S()}}function F(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:S()}}function y(){const _=a(/^@supports *([^{]+)/);if(_)return{type:"supports",supports:_[1].trim(),rules:N()}}function D(){if(a(/^@host\s*/))return{type:"host",rules:N()}}function B(){const _=a(/^@media([^{]+)*/);if(_)return{type:"media",media:(_[1]||"").trim(),rules:N()}}function X(){const _=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(_)return{type:"custom-media",name:_[1].trim(),media:_[2].trim()}}function I(){const _=a(/^@([-\w]+)?document *([^{]+)/);if(_)return{type:"document",document:_[2].trim(),vendor:_[1]?_[1].trim():null,rules:N()}}function A(){const _=a(/^@(import|charset|namespace)\s*([^;]+);/);if(_)return{type:_[1],name:_[2].trim()}}function L(){if(u(),n[0]==="@"){const _=A()||F()||B()||k()||y()||I()||X()||D()||d()||R();if(_&&!i.preserveStatic){let V=!1;return _.declarations?V=_.declarations.some(b=>/var\(/.test(b.value)):V=(_.keyframes||_.rules||[]).some(O=>(O.declarations||[]).some(Z=>/var\(/.test(Z.value))),V?_:{}}return _}}function T(){if(!i.preserveStatic){const b=ql("{","}",n);if(b){const O=/:(?:root|host)(?![.:#(])/.test(b.pre)&&/--\S*\s*:/.test(b.body),Z=/var\(/.test(b.body);if(!O&&!Z)return n=n.slice(b.end+1),{}}}const _=m()||[],V=i.preserveStatic?S():S().filter(b=>{const O=_.some(ce=>/:(?:root|host)(?![.:#(])/.test(ce))&&/^--\S/.test(b.property),Z=/var\(/.test(b.value);return O||Z});return _.length||r("selector missing"),{type:"rule",selectors:_,declarations:V}}function N(_){if(!_&&!l())return r("missing '{'");let V,b=w();for(;n.length&&(_||n[0]!=="}")&&(V=L()||T());)V.type&&b.push(V),b=b.concat(w());return!_&&!s()?r("missing '}'"):b}return{type:"stylesheet",stylesheet:{rules:N(!0),errors:o}}}function Yl(n,e="",t){const i={charset(r){return"@charset "+r.name+";"},comment(r){return r.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+r.comment+"*/":""},"custom-media"(r){return"@custom-media "+r.name+" "+r.media+";"},declaration(r){return r.property+":"+r.value+";"},document(r){return"@"+(r.vendor||"")+"document "+r.document+"{"+o(r.rules)+"}"},"font-face"(r){return"@font-face{"+o(r.declarations)+"}"},host(r){return"@host{"+o(r.rules)+"}"},import(r){return"@import "+r.name+";"},keyframe(r){return r.values.join(",")+"{"+o(r.declarations)+"}"},keyframes(r){return"@"+(r.vendor||"")+"keyframes "+r.name+"{"+o(r.keyframes)+"}"},media(r){return"@media "+r.media+"{"+o(r.rules)+"}"},namespace(r){return"@namespace "+r.name+";"},page(r){return"@page "+(r.selectors.length?r.selectors.join(", "):"")+"{"+o(r.declarations)+"}"},"page-margin-box"(r){return"@"+r.name+"{"+o(r.declarations)+"}"},rule(r){const a=r.declarations;if(a.length)return r.selectors.join(",")+"{"+o(a)+"}"},supports(r){return"@supports "+r.supports+"{"+o(r.rules)+"}"}};function o(r){let a="";for(let l=0;l<r.length;l++){const s=r[l];t&&t(s);const u=i[s.type](s);u&&(a+=u,u.length&&s.selectors&&(a+=e))}return a}return o(n.stylesheet.rules)}const Ul=/\s?html\s?/gi,Jl=/\s?body\s?/gi;function Ql(n,e){const i=Kl(n.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(r=>Ul.test(r)||Jl.test(r)));return i.forEach(o=>{const r={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new es(o.declarations,r);o.declarations.forEach(l=>{An(r,xl(l)),An(r,$l(l)),An(r,a.convert(l))}),Object.entries(r).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),i.push(ts()),i.forEach(o=>{o.selectors=Zl(o.selectors,e)}),Yl({stylesheet:{rules:i},type:"stylesheet"})}function Zl(n,e){return n.map(t=>`${e} ${t}`)}function An(n,e){return e&&(n[e.key]=e.value),n}function xl(n){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(n.property);if(e)return{key:e[1],value:n.value}}function $l(n){if(n.property==="font-family"){let e=n.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:n.property,value:e}}}class es{constructor(e,t){xe(this,"hasLineBreakDefined");this.ruleDeclarations=e,this.newDeclarations=t}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(t=>t.type==="declaration"&&t.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function ts(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}function ns(n,e,t){return Nl(n,t).pipe(Xe(i=>({htmlContent:i,styleSheet:Ql(n,e)})))}function os(n){return new St(e=>n.subscribe(t=>{e.next(t)}))}function fn(n=yr){return e=>n?e:vr}function zo(n,e,t){return i=>new St(o=>{const r=n();return i.pipe(oi(Pn),Fa(()=>t(r))).subscribe({next:a=>{e(a,r),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}function is(n,e,t,i,o,r,a,l,s,u){switch(e[n.code]){case gt.BOOKMARK:return t(!0),!0;case gt.JUMP_TO_BOOKMARK:return i(),!0;case gt.AUTO_SCROLL_TOGGLE:return r==null||r.toggle(),!0;case gt.AUTO_SCROLL_INCREASE:return o(1),!0;case gt.AUTO_SCROLL_DECREASE:return o(-1),!0;case gt.NEXT_PAGE:return a==null||a.nextPage(),!0;case gt.PREV_PAGE:return a==null||a.prevPage(),!0;case gt.PREV_CHAPTER:return s(l?1:-1),!0;case gt.NEXT_CHAPTER:return s(l?-1:1),!0;case gt.SET_READING_POINT:return u(),!0;default:return!1}}const{document:On,window:No}=Wn;function Ho(n){var w;let e,t,i,o,r,a,l,s;function u(m){n[79](m)}let h={hasChapterData:!!((w=n[26])!=null&&w.length),hasCustomReadingPoint:!!(n[28]&&(n[22]&&n[4]||!n[22]&&n[15]>-1&&n[14]>-1)),showFullscreenButton:hn.fullscreenEnabled,autoScrollMultiplier:n[29]};return n[10]!==void 0&&(h.isBookmarkScreen=n[10]),t=new Il({props:h}),ne.push(()=>ue(t,"isBookmarkScreen",u)),t.$on("tocClick",n[80]),t.$on("setCustomReadingPoint",n[75]),t.$on("showCustomReadingPoint",n[81]),t.$on("resetCustomReadingPoint",n[82]),t.$on("fullscreenClick",n[71]),t.$on("bookmarkClick",n[70]),t.$on("settingsClick",n[83]),t.$on("domainHintClick",n[72]),t.$on("bookManagerClick",n[84]),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(m){e=$(m,"DIV",{class:!0});var v=ee(e);Re(t.$$.fragment,v),v.forEach(M),this.h()},h(){U(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(m,v){H(m,e,v),Me(t,e,null),a=!0,l||(s=jn(o=ui.call(null,e,n[85])),l=!0)},p(m,v){var c;n=m;const S={};v[0]&67108864&&(S.hasChapterData=!!((c=n[26])!=null&&c.length)),v[0]&272678928&&(S.hasCustomReadingPoint=!!(n[28]&&(n[22]&&n[4]||!n[22]&&n[15]>-1&&n[14]>-1))),v[0]&536870912&&(S.autoScrollMultiplier=n[29]),!i&&v[0]&1024&&(i=!0,S.isBookmarkScreen=n[10],fe(()=>i=!1)),t.$set(S),o&&Uo(o.update)&&v[0]&512&&o.update.call(null,n[85])},i(m){a||(W(t.$$.fragment,m),m&&xo(()=>{r||(r=ao(e,Hn,{y:-300,easing:Nn},!0)),r.run(1)}),a=!0)},o(m){Y(t.$$.fragment,m),m&&(r||(r=ao(e,Hn,{y:-300,easing:Nn},!1)),r.run(0)),a=!1},d(m){m&&M(e),Ee(t),m&&r&&r.end(),l=!1,s()}}}function rs(n){let e=(n[52]??"")+"",t;return{c(){t=Pe(e)},l(i){t=ve(i,e)},m(i,o){H(i,t,o)},p(i,o){o[1]&2097152&&e!==(e=(i[52]??"")+"")&&qe(t,e)},i:Rt,o:Rt,d(i){i&&M(t)}}}function as(n){var Be,He,ge;let e,t,i,o,r,a,l,s,u,h,w,m,v,S,c,k,d,R=(n[47]??"")+"",F,y,D=(n[48]??"")+"",B,X,I=(n[49]??"")+"",A,L,T=(n[50]??"")+"",N,_,V=(n[51]??"")+"",b,O;e=new El({props:{styleSheet:n[30].styleSheet}});function Z(C){n[86](C)}function ce(C){n[87](C)}function De(C){n[88](C)}function Te(C){n[89](C)}function be(C){n[90](C)}function Oe(C){n[91](C)}function Le(C){n[92](C)}function de(C){n[93](C)}function re(C){n[94](C)}function ae(C){n[95](C)}function Ie(C){n[96](C)}function Q(C){n[97](C)}function we(C){n[98](C)}let me={htmlContent:n[30].htmlContent,width:n[31]??0,height:n[32]??0,verticalMode:n[23],fontColor:(Be=n[33])==null?void 0:Be.fontColor,backgroundColor:n[34],hintFuriganaFontColor:(He=n[33])==null?void 0:He.hintFuriganaFontColor,hintFuriganaShadowColor:(ge=n[33])==null?void 0:ge.hintFuriganaShadowColor,fontFamilyGroupOne:n[35],fontFamilyGroupTwo:n[36],fontSize:n[37],lineHeight:n[38],hideSpoilerImage:n[39],hideFurigana:n[40],furiganaStyle:n[41],viewMode:n[6],secondDimensionMaxValue:n[42],firstDimensionMargin:n[24],autoPositionOnResize:n[43],avoidPageBreak:n[44],pageColumns:n[45],autoBookmark:n[46],multiplier:n[29]};return n[0]!==void 0&&(me.exploredCharCount=n[0]),n[1]!==void 0&&(me.bookCharCount=n[1]),n[10]!==void 0&&(me.isBookmarkScreen=n[10]),n[3]!==void 0&&(me.bookmarkData=n[3]),n[2]!==void 0&&(me.autoScroller=n[2]),n[12]!==void 0&&(me.bookmarkManager=n[12]),n[13]!==void 0&&(me.pageManager=n[13]),n[16]!==void 0&&(me.customReadingPoint=n[16]),n[14]!==void 0&&(me.customReadingPointTop=n[14]),n[15]!==void 0&&(me.customReadingPointLeft=n[15]),n[17]!==void 0&&(me.customReadingPointScrollOffset=n[17]),n[4]!==void 0&&(me.customReadingPointRange=n[4]),n[5]!==void 0&&(me.showCustomReadingPoint=n[5]),i=new yl({props:me}),ne.push(()=>ue(i,"exploredCharCount",Z)),ne.push(()=>ue(i,"bookCharCount",ce)),ne.push(()=>ue(i,"isBookmarkScreen",De)),ne.push(()=>ue(i,"bookmarkData",Te)),ne.push(()=>ue(i,"autoScroller",be)),ne.push(()=>ue(i,"bookmarkManager",Oe)),ne.push(()=>ue(i,"pageManager",Le)),ne.push(()=>ue(i,"customReadingPoint",de)),ne.push(()=>ue(i,"customReadingPointTop",re)),ne.push(()=>ue(i,"customReadingPointLeft",ae)),ne.push(()=>ue(i,"customReadingPointScrollOffset",Ie)),ne.push(()=>ue(i,"customReadingPointRange",Q)),ne.push(()=>ue(i,"showCustomReadingPoint",we)),i.$on("bookmark",n[70]),{c(){ye(e.$$.fragment),t=oe(),ye(i.$$.fragment),d=oe(),F=Pe(R),y=oe(),B=Pe(D),X=oe(),A=Pe(I),L=oe(),N=Pe(T),_=oe(),b=Pe(V)},l(C){Re(e.$$.fragment,C),t=ie(C),Re(i.$$.fragment,C),d=ie(C),F=ve(C,R),y=ie(C),B=ve(C,D),X=ie(C),A=ve(C,I),L=ie(C),N=ve(C,T),_=ie(C),b=ve(C,V)},m(C,z){Me(e,C,z),H(C,t,z),Me(i,C,z),H(C,d,z),H(C,F,z),H(C,y,z),H(C,B,z),H(C,X,z),H(C,A,z),H(C,L,z),H(C,N,z),H(C,_,z),H(C,b,z),O=!0},p(C,z){var Se,Ve,$e;const Fe={};z[0]&1073741824&&(Fe.styleSheet=C[30].styleSheet),e.$set(Fe);const q={};z[0]&1073741824&&(q.htmlContent=C[30].htmlContent),z[1]&1&&(q.width=C[31]??0),z[1]&2&&(q.height=C[32]??0),z[0]&8388608&&(q.verticalMode=C[23]),z[1]&4&&(q.fontColor=(Se=C[33])==null?void 0:Se.fontColor),z[1]&8&&(q.backgroundColor=C[34]),z[1]&4&&(q.hintFuriganaFontColor=(Ve=C[33])==null?void 0:Ve.hintFuriganaFontColor),z[1]&4&&(q.hintFuriganaShadowColor=($e=C[33])==null?void 0:$e.hintFuriganaShadowColor),z[1]&16&&(q.fontFamilyGroupOne=C[35]),z[1]&32&&(q.fontFamilyGroupTwo=C[36]),z[1]&64&&(q.fontSize=C[37]),z[1]&128&&(q.lineHeight=C[38]),z[1]&256&&(q.hideSpoilerImage=C[39]),z[1]&512&&(q.hideFurigana=C[40]),z[1]&1024&&(q.furiganaStyle=C[41]),z[0]&64&&(q.viewMode=C[6]),z[1]&2048&&(q.secondDimensionMaxValue=C[42]),z[0]&16777216&&(q.firstDimensionMargin=C[24]),z[1]&4096&&(q.autoPositionOnResize=C[43]),z[1]&8192&&(q.avoidPageBreak=C[44]),z[1]&16384&&(q.pageColumns=C[45]),z[1]&32768&&(q.autoBookmark=C[46]),z[0]&536870912&&(q.multiplier=C[29]),!o&&z[0]&1&&(o=!0,q.exploredCharCount=C[0],fe(()=>o=!1)),!r&&z[0]&2&&(r=!0,q.bookCharCount=C[1],fe(()=>r=!1)),!a&&z[0]&1024&&(a=!0,q.isBookmarkScreen=C[10],fe(()=>a=!1)),!l&&z[0]&8&&(l=!0,q.bookmarkData=C[3],fe(()=>l=!1)),!s&&z[0]&4&&(s=!0,q.autoScroller=C[2],fe(()=>s=!1)),!u&&z[0]&4096&&(u=!0,q.bookmarkManager=C[12],fe(()=>u=!1)),!h&&z[0]&8192&&(h=!0,q.pageManager=C[13],fe(()=>h=!1)),!w&&z[0]&65536&&(w=!0,q.customReadingPoint=C[16],fe(()=>w=!1)),!m&&z[0]&16384&&(m=!0,q.customReadingPointTop=C[14],fe(()=>m=!1)),!v&&z[0]&32768&&(v=!0,q.customReadingPointLeft=C[15],fe(()=>v=!1)),!S&&z[0]&131072&&(S=!0,q.customReadingPointScrollOffset=C[17],fe(()=>S=!1)),!c&&z[0]&16&&(c=!0,q.customReadingPointRange=C[4],fe(()=>c=!1)),!k&&z[0]&32&&(k=!0,q.showCustomReadingPoint=C[5],fe(()=>k=!1)),i.$set(q),(!O||z[1]&65536)&&R!==(R=(C[47]??"")+"")&&qe(F,R),(!O||z[1]&131072)&&D!==(D=(C[48]??"")+"")&&qe(B,D),(!O||z[1]&262144)&&I!==(I=(C[49]??"")+"")&&qe(A,I),(!O||z[1]&524288)&&T!==(T=(C[50]??"")+"")&&qe(N,T),(!O||z[1]&1048576)&&V!==(V=(C[51]??"")+"")&&qe(b,V)},i(C){O||(W(e.$$.fragment,C),W(i.$$.fragment,C),O=!0)},o(C){Y(e.$$.fragment,C),Y(i.$$.fragment,C),O=!1},d(C){Ee(e,C),C&&M(t),Ee(i,C),C&&M(d),C&&M(F),C&&M(y),C&&M(B),C&&M(X),C&&M(A),C&&M(L),C&&M(N),C&&M(_),C&&M(b)}}}function Go(n){let e,t,i,o,r,a;return t=new Vl({props:{sectionData:n[26],verticalMode:n[23],exploredCharCount:n[0]}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(l){e=$(l,"DIV",{class:!0});var s=ee(e);Re(t.$$.fragment,s),s.forEach(M),this.h()},h(){var l;U(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),E(e,"color",(l=n[33])==null?void 0:l.fontColor),E(e,"background-color",n[34])},m(l,s){H(l,e,s),Me(t,e,null),o=!0,r||(a=jn(ui.call(null,e,n[99])),r=!0)},p(l,s){var h;n=l;const u={};s[0]&67108864&&(u.sectionData=n[26]),s[0]&8388608&&(u.verticalMode=n[23]),s[0]&1&&(u.exploredCharCount=n[0]),t.$set(u),s[1]&4&&E(e,"color",(h=n[33])==null?void 0:h.fontColor),s[1]&8&&E(e,"background-color",n[34])},i(l){o||(W(t.$$.fragment,l),l&&(i||xo(()=>{i=sr(e,Hn,{x:-100,duration:100,easing:Nn}),i.start()})),o=!0)},o(l){Y(t.$$.fragment,l),o=!1},d(l){l&&M(e),Ee(t),r=!1,a()}}}function Wo(n){let e,t,i;return{c(){e=x("div"),t=oe(),i=x("div"),this.h()},l(o){e=$(o,"DIV",{class:!0}),ee(e).forEach(M),t=ie(o),i=$(o,"DIV",{class:!0}),ee(i).forEach(M),this.h()},h(){U(e,"class","fixed left-0 z-20 h-[1px] w-full border border-red-500"),E(e,"top",`${n[14]}px`),U(i,"class","fixed top-0 z-20 h-full w-[1px] border border-red-500"),E(i,"left",`${n[15]}px`)},m(o,r){H(o,e,r),H(o,t,r),H(o,i,r)},p(o,r){r[0]&16384&&E(e,"top",`${o[14]}px`),r[0]&32768&&E(i,"left",`${o[15]}px`)},d(o){o&&M(e),o&&M(t),o&&M(i)}}}function jo(n){let e,t,i;return t=new rt({props:{icon:Kn,spin:!0}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Re(t.$$.fragment,r),r.forEach(M),this.h()},h(){U(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl")},m(o,r){H(o,e,r),Me(t,e,null),i=!0},p:Rt,i(o){i||(W(t.$$.fragment,o),i=!0)},o(o){Y(t.$$.fragment,o),i=!1},d(o){o&&M(e),Ee(t)}}}function Xo(n){let e,t,i,o,r;return t=new rt({props:{icon:oa}}),{c(){e=x("div"),ye(t.$$.fragment),this.h()},l(a){e=$(a,"DIV",{class:!0});var l=ee(e);Re(t.$$.fragment,l),l.forEach(M),this.h()},h(){U(e,"class","flex h-full w-8 items-center justify-center text-lg"),K(e,"text-red-500",n[20]>1),K(e,"animate-pulse",n[20]>1||n[21])},m(a,l){H(a,e,l),Me(t,e,null),i=!0,o||(r=[pe(e,"click",ur(n[100])),pe(e,"keyup",pt)],o=!0)},p(a,l){(!i||l[0]&1048576)&&K(e,"text-red-500",a[20]>1),(!i||l[0]&3145728)&&K(e,"animate-pulse",a[20]>1||a[21])},i(a){i||(W(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){a&&M(e),Ee(t),o=!1,kt(r)}}}function qo(n){let e,t,i,o,r,a=(n[0]/n[1]*100).toFixed(2)+"",l,s;return{c(){e=x("div"),t=Pe(n[0]),i=Pe(" / "),o=Pe(n[1]),r=Pe(" ("),l=Pe(a),s=Pe("%)"),this.h()},l(u){e=$(u,"DIV",{class:!0});var h=ee(e);t=ve(h,n[0]),i=ve(h," / "),o=ve(h,n[1]),r=ve(h," ("),l=ve(h,a),s=ve(h,"%)"),h.forEach(M),this.h()},h(){var u;U(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),E(e,"color",(u=n[33])==null?void 0:u.tooltipTextFontColor)},m(u,h){H(u,e,h),te(e,t),te(e,i),te(e,o),te(e,r),te(e,l),te(e,s)},p(u,h){var w;h[0]&1&&qe(t,u[0]),h[0]&2&&qe(o,u[1]),h[0]&3&&a!==(a=(u[0]/u[1]*100).toFixed(2)+"")&&qe(l,a),h[1]&4&&E(e,"color",(w=u[33])==null?void 0:w.tooltipTextFontColor)},d(u){u&&M(e)}}}function ls(n){var V;let e,t,i=(n[27]??"")+"",o,r,a,l,s,u,h,w,m,v,S,c,k,d,R,F,y;On.title=e=co(((V=n[25])==null?void 0:V.title)??"");let D=n[9]&&Ho(n);const B=[as,rs],X=[];function I(b,O){return b[30]?0:1}u=I(n),h=X[u]=B[u](n);let A=n[7]&&Go(n),L=(n[18]&&!n[53]||!n[22]&&n[5])&&Wo(n),T=n[8]&&jo(),N=n[19].length&&Xo(n),_=n[11]&&n[1]&&qo(n);return{c(){t=oe(),o=Pe(i),r=oe(),a=x("button"),l=oe(),D&&D.c(),s=oe(),h.c(),w=oe(),A&&A.c(),m=oe(),L&&L.c(),v=oe(),T&&T.c(),S=oe(),c=x("div"),k=x("div"),N&&N.c(),d=oe(),_&&_.c(),this.h()},l(b){lr("svelte-rnuhm6",On.head).forEach(M),t=ie(b),o=ve(b,i),r=ie(b),a=$(b,"BUTTON",{class:!0}),ee(a).forEach(M),l=ie(b),D&&D.l(b),s=ie(b),h.l(b),w=ie(b),A&&A.l(b),m=ie(b),L&&L.l(b),v=ie(b),T&&T.l(b),S=ie(b),c=$(b,"DIV",{class:!0});var Z=ee(c);k=$(Z,"DIV",{class:!0});var ce=ee(k);N&&N.l(ce),ce.forEach(M),d=ie(Z),_&&_.l(Z),Z.forEach(M),this.h()},h(){var b;U(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),U(k,"class","h-full"),U(c,"class","writing-horizontal-tb fixed bottom-0 left-0 z-10 flex h-8 w-full cursor-pointer items-center justify-between text-xs leading-none"),E(c,"color",(b=n[33])==null?void 0:b.tooltipTextFontColor)},m(b,O){H(b,t,O),H(b,o,O),H(b,r,O),H(b,a,O),H(b,l,O),D&&D.m(b,O),H(b,s,O),X[u].m(b,O),H(b,w,O),A&&A.m(b,O),H(b,m,O),L&&L.m(b,O),H(b,v,O),T&&T.m(b,O),H(b,S,O),H(b,c,O),te(c,k),N&&N.m(k,null),te(c,d),_&&_.m(c,null),R=!0,F||(y=[pe(No,"keydown",n[69]),pe(No,"beforeunload",n[68]),pe(a,"click",n[78]),pe(c,"click",n[101]),pe(c,"keyup",pt)],F=!0)},p(b,O){var ce,De;(!R||O[0]&33554432)&&e!==(e=co(((ce=b[25])==null?void 0:ce.title)??""))&&(On.title=e),(!R||O[0]&134217728)&&i!==(i=(b[27]??"")+"")&&qe(o,i),b[9]?D?(D.p(b,O),O[0]&512&&W(D,1)):(D=Ho(b),D.c(),W(D,1),D.m(s.parentNode,s)):D&&(ot(),Y(D,1,1,()=>{D=null}),it());let Z=u;u=I(b),u===Z?X[u].p(b,O):(ot(),Y(X[Z],1,1,()=>{X[Z]=null}),it(),h=X[u],h?h.p(b,O):(h=X[u]=B[u](b),h.c()),W(h,1),h.m(w.parentNode,w)),b[7]?A?(A.p(b,O),O[0]&128&&W(A,1)):(A=Go(b),A.c(),W(A,1),A.m(m.parentNode,m)):A&&(ot(),Y(A,1,1,()=>{A=null}),it()),b[18]&&!b[53]||!b[22]&&b[5]?L?L.p(b,O):(L=Wo(b),L.c(),L.m(v.parentNode,v)):L&&(L.d(1),L=null),b[8]?T?(T.p(b,O),O[0]&256&&W(T,1)):(T=jo(),T.c(),W(T,1),T.m(S.parentNode,S)):T&&(ot(),Y(T,1,1,()=>{T=null}),it()),b[19].length?N?(N.p(b,O),O[0]&524288&&W(N,1)):(N=Xo(b),N.c(),W(N,1),N.m(k,null)):N&&(ot(),Y(N,1,1,()=>{N=null}),it()),b[11]&&b[1]?_?_.p(b,O):(_=qo(b),_.c(),_.m(c,null)):_&&(_.d(1),_=null),O[1]&4&&E(c,"color",(De=b[33])==null?void 0:De.tooltipTextFontColor)},i(b){R||(W(D),W(h),W(A),W(T),W(N),R=!0)},o(b){Y(D),Y(h),Y(A),Y(T),Y(N),R=!1},d(b){b&&M(t),b&&M(o),b&&M(r),b&&M(a),b&&M(l),D&&D.d(b),b&&M(s),X[u].d(b),b&&M(w),A&&A.d(b),b&&M(m),L&&L.d(b),b&&M(v),T&&T.d(b),b&&M(S),b&&M(c),N&&N.d(),_&&_.d(),F=!1,kt(y)}}}const Ko="background-color",Yo="writing-mode";function ss(n,e,t){let i,o,r,a,l,s,u,h,w,m,v,S,c,k,d,R,F,y,D,B,X,I,A,L,T,N,_,V,b,O,Z,ce,De,Te,be,Oe,Le,de,re,ae,Ie,Q,we,me,Be;j(n,Fr,f=>t(23,r=f)),j(n,ii,f=>t(24,a=f)),j(n,Tr,f=>t(108,l=f)),j(n,Ir,f=>t(109,s=f)),j(n,Ar,f=>t(110,h=f)),j(n,Or,f=>t(111,w=f)),j(n,ri,f=>t(112,v=f)),j(n,Kt,f=>t(113,S=f)),j(n,Lr,f=>t(77,c=f)),j(n,Vr,f=>t(114,k=f)),j(n,ai,f=>t(6,d=f)),j(n,zt,f=>t(7,R=f)),j(n,Bn,f=>t(115,F=f)),j(n,Fn,f=>t(116,y=f)),j(n,Xn,f=>t(28,B=f)),j(n,Tn,f=>t(29,X=f)),j(n,zr,f=>t(35,_=f)),j(n,Nr,f=>t(36,V=f)),j(n,Hr,f=>t(37,b=f)),j(n,Gr,f=>t(38,O=f)),j(n,Wr,f=>t(39,Z=f)),j(n,jr,f=>t(40,ce=f)),j(n,Xr,f=>t(41,De=f)),j(n,qr,f=>t(42,Te=f)),j(n,Kr,f=>t(43,be=f)),j(n,Yr,f=>t(44,Oe=f)),j(n,Ur,f=>t(45,Le=f)),j(n,Jr,f=>t(46,de=f)),j(n,qn,f=>t(53,Be=f));let He=!0,ge=!0,C=!1,z=!0,Fe=0,q=0,Se,Ve,$e,Ke=Promise.resolve(void 0),Ce=-2,_e=-2,Ye=r?y:F,Ue=0,ke,ft,Ge=!0,mt=!1,We=!1,Je,et=[],at=[],Ae,bt=0,P=!1,se=0;const Qe=tn(2500).pipe(_t(()=>t(9,ge=!1)),yt());j(n,Qe,f=>t(27,D=f));const p=At(()=>os(Qr)).pipe(Xe(f=>Number(f.url.searchParams.get("id"))),Vn({refCount:!0,bufferSize:1})),J=p.pipe(Vt(async f=>{let G;try{if(Je=ln(window,En.BROWSER,void 0,!0,l,s),Je.startContext({id:f,title:""}),G=await Je.getBook(),!G)return G;Je.startContext({id:G.id,title:G.title,imagePath:G.coverImage}),G.storageSource?t(76,Ae=await no(G.storageSource,!0)):c!==jt.Off&&t(76,Ae=await no(w)),G.lastBookOpen=new Date().getTime(),await Je.updateLastRead(G),G=await vi(Ae,G),await yi(Ae)}catch(le){const Ne=`Error loading book: ${le.message}`;Ct.warn(Ne),dt.dialogs$.next([{component:It,props:{title:"Load Error",message:Ne}}]);return}finally{t(8,He=!1)}return Ae&&Ae.updateSettings(window,!0,s,l,!1,G.storageSource||w),G}),zn());j(n,J,f=>t(25,u=f));const he=J.pipe(_t(f=>{f||ho(`${uo}${je.MANAGE.routeId}`)}),yt());j(n,he,f=>t(52,me=f));const ze=J.pipe(_t(f=>{!f||t(3,Ke=Dn.getBookmark(f.id))}),yt());j(n,ze,f=>t(47,re=f));const g=J.pipe(Vt(f=>f?(Un.next(f.sections||[]),ns(f,".book-content",document)):Ht),Vn({refCount:!0,bufferSize:1}));j(n,g,f=>t(30,I=f));const rn=At(()=>visualViewport?ut(visualViewport,"resize"):Yn()).pipe(zn()),an=rn.pipe(Ln(0),Xe(()=>(visualViewport==null?void 0:visualViewport.width)||0),fn());j(n,an,f=>t(31,A=f));const Qn=rn.pipe(Ln(0),Xe(()=>(visualViewport==null?void 0:visualViewport.height)||0),fn());j(n,Qn,f=>t(32,L=f));const vn=Rr.pipe(Xe(f=>fa.get(f)),xt(f=>!!f));j(n,vn,f=>t(33,T=f));const yn=vn.pipe(Xe(f=>f.backgroundColor));j(n,yn,f=>t(34,N=f));const Zn=yn.pipe(zo(()=>document.body,(f,G)=>G.style.setProperty(Ko,f),f=>f.style.removeProperty(Ko)),yt(),fn());j(n,Zn,f=>t(48,ae=f));const xn=Mr.pipe(zo(()=>document.documentElement,(f,G)=>G.style.setProperty(Yo,f),f=>f.style.removeProperty(Yo)),yt(),fn());j(n,xn,f=>t(49,Ie=f));const $n=At(()=>kn).pipe(Xe(f=>[...f.values()]));j(n,$n,f=>t(26,m=f));const eo=At(()=>ut(document,"selectionchange")).pipe(Zt(200),_t(()=>{var G,le;const f=((G=window.getSelection())==null?void 0:G.toString())||"";!f&&Ge?ft=void 0:f?(ft=(le=window.getSelection())==null?void 0:le.getRangeAt(0),Ge=!1):Ge=!0}),yt());j(n,eo,f=>t(50,Q=f));const to=In.pipe(Ea(6e4),Vt(()=>Wt()),yt());j(n,to,f=>t(51,we=f));function Pi(f){return k&&(P||se!==Fe||o&&et.length||o&&at.length)?(f.preventDefault(),f.returnValue="Are you sure you want to exit?"):f}async function no(f,G=!1){if(!f){if(G)throw new Error("No storage source found");return}if(f===so.GDRIVE_DEFAULT)return ln(window,En.GDRIVE,f,!0,l,s);if(f===so.ONEDRIVE_DEFAULT)return ln(window,En.ONEDRIVE,f,!0,l,s);if(f){const tt=await(await Dn.db).get("storageSource",f);if(tt)return ln(window,tt.type,f,!0,l,s);if(G)throw new Error(`No storage source with name ${f} found`)}const le=`No storage source with name ${f} found - skipping auto import/export`;Ct.warn(le),dt.dialogs$.next([{component:It,props:{title:"Configuration Error",message:le}}])}async function vi(f,G){if(!f)return G;l||f.clearData(!1),f.startContext({id:G.id,title:G.title,imagePath:G.coverImage||""});let{id:le,...Ne}=G;if(G.storageSource){const lt=await f.getBook();lt&&!(lt instanceof File)&&(Ne={...lt,id:G.id,lastBookOpen:G.lastBookOpen,storageSource:G.storageSource})}else if(!G.elementHtml)throw new Error("Book has no data stored");const tt={id:le,...Ne};return await f.updateLastRead(tt).catch(lt=>{const Ze=`Failed to update last read on external storage: ${lt.message}`;Ct.warn(Ze),dt.dialogs$.next([{component:It,props:{title:"Update Error",message:Ze}}])}),tt}async function yi(f){if(Je&&f&&(c===jt.Down||c===jt.All)){const G=await f.getProgress();G&&!(G instanceof File)&&(await Je.saveProgress(G),se=G.exploredCharCount||0)}}function Ri(f){S||!is(f,Br.getValue(),Rn,Ei,le=>Tn.next(Tn.getValue()+le),Se,$e,r,Fi,io)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),f.preventDefault())}function Mi(){let f;return p.subscribe(G=>f=G).unsubscribe(),f}async function Rn(f){var Ne;const G=Mi();if(!G||!Ve)return;let le;if(t(9,ge=!1),i){const tt=v?Na(window,ft):void 0,lt=tt||ke;qt((Ne=lt==null?void 0:lt.endContainer)==null?void 0:Ne.parentElement,"add",.5,500),le=Ve.formatBookmarkDataByRange(G,lt),tt&&pi(window)}else le=Ve.formatBookmarkData(G,Ue);if(await Je.saveProgress(le),o){const tt=P?at:et;tt.includes(fo.PROGRESS)||tt.push(fo.PROGRESS),f&&In.next()}t(3,Ke=Promise.resolve(le))}async function Ei(){const f=await Ke;!f||!Ve||Ve.scrollToBookmark(f,Ue)}function Di(){if(t(9,ge=!1),!hn.fullscreenElement){hn.requestFullscreen(document.documentElement);return}hn.exitFullscreen()}function Bi(){dt.dialogs$.next([{component:It,props:{title:"Old Domain",message:"You are currently using the old domain of ッツ Reader - consider switching to https://reader.ttsu.app to prevent issues and to ensure full features"},disableCloseOnClick:!0}])}function Fi(f){if(!(m!=null&&m.length))return;const[G,le]=mi(m);!le&&f===-1||f===1&&le===G.length-1||on.next(G[le+f].reference)}async function Wt(f=!0){if(P||!et.length||!u||!Ae)return;t(21,P=!0),f||(Kt.next(!0),Ct.clearHistory(),oo());const G=u.storageSource||w;Ae.updateSettings(window,!1,s,l,!f,G);const le=await Er(Je,Ae,!f&&h===Ae.storageType,[{id:u.id,title:u.title,imagePath:u.coverImage}],et).catch(Ne=>Ne.message);if(Ae.updateSettings(window,!0,s,l,!1,G),t(21,P=!1),le){if(!f){const Ne=Ct.errorCount>1;Ct.warn(le),dt.dialogs$.next([{component:Ne?Dr:It,props:{title:"Error Processing Data",message:Ne?"Some or all data could not be stored on an external storage":le}}])}t(20,bt+=1)}else t(20,bt=0),f||dt.dialogs$.next([]),at.length?(t(19,et=JSON.parse(JSON.stringify(at))),at=[],f?In.next():await Wt(!1)):t(19,et=[]);f||Kt.next(!1)}function oo(){dt.dialogs$.next([{component:"<div/>",disableCloseOnClick:!0}])}async function Mn(f,G=!0){oo();let le;try{G&&await Dn.deleteLastItem(),await Rn(!1),dt.dialogs$.next([]),o&&await Wt(!1)}catch(Ne){le=Ne.message}le&&(Ct.warn(le),dt.dialogs$.next([{component:It,props:{title:"Error",message:le},disableCloseOnClick:!0}])),ho(`${uo}${f}`)}function io(){const f=document.querySelector(".book-content");if(!f)return;i&&(t(14,Ce=window.innerHeight/2-2),t(15,_e=window.innerWidth/2-2)),t(9,ge=!1),t(18,mt=!0),document.body.classList.add("cursor-crosshair");const{elLeftReferencePoint:G,elTopReferencePoint:le,elRightReferencePoint:Ne,elBottomReferencePoint:tt,pointGap:lt}=ki(window,f,r,a);nn(ut(document,"pointerup"),ut(document,"pointermove")).pipe(Ia(()=>mt)).subscribe(Ze=>{if(Ze instanceof PointerEvent)if(Ze.type==="pointerup")document.body.classList.remove("cursor-crosshair"),t(18,mt=!1),fr().then(()=>{t(15,_e=r?Ze.x:_e),t(14,Ce=r?Ce:Ze.y);const Pt=za(_e,Ce);if(Pt&&qt(Pt.parent,"add",.5,500),i)t(4,ke=Pt==null?void 0:Pt.range);else{let vt=0;r?(vt=Math.ceil(Math.max(0,_e-G)/(Ne-G)*100),Fn.next(vt)):(vt=Math.ceil(Math.max(0,Ce-le)/(tt-le)*100),Bn.next(vt)),t(16,Ye=vt)}});else{const Pt=Ze.x>=G+lt&&Ze.x<=Ne,vt=Ze.y>=le&&Ze.y<=tt-lt;i?(t(14,Ce=vt?Ze.y:Ce),t(15,_e=Pt?Ze.x:_e)):r&&Pt?t(15,_e=Ze.x):!r&&vt&&t(14,Ce=Ze.y)}})}const Ti=()=>t(9,ge=!0);function Ii(f){C=f,t(10,C)}const Ai=()=>{t(9,ge=!1),zt.next(!0)},Oi=()=>{t(9,ge=!1),t(5,We=!0)},Li=()=>{t(9,ge=!1),i?t(4,ke=void 0):r?(Fn.next(100),t(16,Ye=100)):(Bn.next(0),t(16,Ye=0))},Vi=()=>Mn(je.SETTINGS.routeId,!1),zi=()=>Mn(je.MANAGE.routeId),Ni=()=>t(9,ge=!1);function Hi(f){Fe=f,t(0,Fe)}function Gi(f){q=f,t(1,q)}function Wi(f){C=f,t(10,C)}function ji(f){Ke=f,t(3,Ke)}function Xi(f){Se=f,t(2,Se)}function qi(f){Ve=f,t(12,Ve)}function Ki(f){$e=f,t(13,$e)}function Yi(f){Ye=f,t(16,Ye)}function Ui(f){Ce=f,t(14,Ce)}function Ji(f){_e=f,t(15,_e)}function Qi(f){Ue=f,t(17,Ue)}function Zi(f){ke=f,t(4,ke)}function xi(f){We=f,t(5,We),t(4,ke)}const $i=()=>zt.next(!1),er=()=>Wt(!1),tr=()=>t(11,z=!z);return n.$$.update=()=>{var f;n.$$.dirty[0]&132&&R&&(Se==null||Se.off()),n.$$.dirty[0]&3&&q&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{exploredCharCount:Fe}})),n.$$.dirty[0]&2&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{bookCharCount:q}})),n.$$.dirty[0]&48&&We&&(qt((f=ke==null?void 0:ke.endContainer)==null?void 0:f.parentElement,"add",1),ut(document,"click").pipe(mn(1),Gt(1)).subscribe(()=>{var G;t(5,We=!1),qt((G=ke==null?void 0:ke.endContainer)==null?void 0:G.parentElement,"remove",1)})),n.$$.dirty[0]&64&&t(22,i=d===Bt.Paginated),n.$$.dirty[2]&49152&&(o=Ae&&(c===jt.Up||c===jt.All)),n.$$.dirty[0]&8&&Ke.then(G=>se=(G==null?void 0:G.exploredCharCount)||0)},[Fe,q,Se,Ke,ke,We,d,R,He,ge,C,z,Ve,$e,Ce,_e,Ye,Ue,mt,et,bt,P,i,r,a,u,m,D,B,X,I,A,L,T,N,_,V,b,O,Z,ce,De,Te,be,Oe,Le,de,re,ae,Ie,Q,we,me,Be,Qe,J,he,ze,g,an,Qn,vn,yn,Zn,xn,$n,eo,to,Pi,Ri,Rn,Di,Bi,Wt,Mn,io,Ae,c,Ti,Ii,Ai,Oi,Li,Vi,zi,Ni,Hi,Gi,Wi,ji,Xi,qi,Ki,Yi,Ui,Ji,Qi,Zi,xi,$i,er,tr]}class Cs extends Mt{constructor(e){super(),Et(this,e,ss,ls,Dt,{},null,[-1,-1,-1,-1,-1])}}export{Cs as default};
