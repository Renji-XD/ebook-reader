var go=Object.defineProperty,ko=Object.defineProperties;var po=Object.getOwnPropertyDescriptors;var fn=Object.getOwnPropertySymbols;var bo=Object.prototype.hasOwnProperty,Co=Object.prototype.propertyIsEnumerable;var cn=(t,e,n)=>e in t?go(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Kt=(t,e)=>{for(var n in e||(e={}))bo.call(e,n)&&cn(t,n,e[n]);if(fn)for(var n of fn(e))Co.call(e,n)&&cn(t,n,e[n]);return t},Ut=(t,e)=>ko(t,po(e));import{S as Qe,i as Ze,n as xe,Q as _o,k as at,R as vo,f as H,E as lt,d as E,T as Lt,u as wo,e as J,j as ne,c as Q,a as Z,l as oe,b as j,s as D,w as ke,x as pe,U as W,y as be,L as ve,q as K,o as $,B as Ce,V as pt,W as x,X as an,Y as Gn,Z as ie,J as Y,_ as ln,m as Ye,p as Ke,t as se,g as ue,h as Fe,$ as hn,a0 as he,a1 as de,v as Nn,a2 as So,a3 as yo,a4 as Hn,a5 as qn,a6 as dn,a7 as Mo,I as Po,a8 as Fo}from"../../chunks/index-08ff816e.js";import{F as Ge,f as Eo,a as xt,p as Pt,o as Ft,b as Bo,c as Do,n as Io,t as To,d as Ao,e as Vo,g as Oo,h as Ro,q as $t,i as en,j as zo}from"../../chunks/css-classes-fba0ac4f.js";import{p as Lo}from"../../chunks/stores-ab7adcce.js";import{d as Go,i as No,m as Et,a as nt,b as Ho,E as dt,c as qo,f as Xo,p as Wo,e as jo,g as Xe,o as st,s as mt,h as _e,j as Gt,F as Be,k as tn,l as Xn,t as bt,n as nn,q as on,R as Yo,r as rn,V as Bt,B as qe,u as mn,v as wt,w as Ko,x as Uo,y as Jo,z as Qo,A as Zo,C as Jt,D as xo,G as $o,H as er,I as tr,J as nr,K as or,L as rr,M as ir,N as ar,O as lr,P as sr,Q as ur,S as fr}from"../../chunks/format-page-title-88a0fb5c.js";import{S as Wn,_ as It,a as gt,b as Ct,c as cr,i as tt,O as je,n as sn,d as hr,B as Tt,e as Pe,w as dr}from"../../chunks/store-9e108e48.js";import{m as mr,g as jn,a as Yn,c as kt,p as gn,o as Kn,b as gr,i as Un,f as kr,d as kn}from"../../chunks/index.es-5b2850fa.js";import{r as ot,c as Jn,a as pr}from"../../chunks/use-click-outside-238ce997.js";import{t as Ue}from"../../chunks/tap-05f0a3d8.js";import"../../chunks/singletons-d1fb5791.js";const Qn=!0;var ct={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,r=ct.delegate;r&&(e=r.requestAnimationFrame,n=r.cancelAnimationFrame);var o=e(function(i){n=void 0,t(i)});return new Wn(function(){return n==null?void 0:n(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ct.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,It([],gt(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ct.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,It([],gt(t)))},delegate:void 0},br=function(t){Ct(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Wn),At={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=At.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,It([t,e],gt(n))):setInterval.apply(void 0,It([t,e],gt(n)))},clearInterval:function(t){var e=At.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Zn=function(t){Ct(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(i,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),At.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;At.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,cr(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(br),pn=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=Go.now,t}(),xn=function(t){Ct(e,t);function e(n,r){r===void 0&&(r=pn.now);var o=t.call(this,n,r)||this;return o.actions=[],o._active=!1,o._scheduled=void 0,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(pn),Nt=new xn(Zn),Cr=Nt,_r=function(t){Ct(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o}return e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),o!==null&&o>0?t.prototype.requestAsyncId.call(this,n,r,o):(n.actions.push(this),n._scheduled||(n._scheduled=ct.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&o>0||o==null&&this.delay>0)return t.prototype.recycleAsyncId.call(this,n,r,o);n.actions.some(function(i){return i.id===r})||(ct.cancelAnimationFrame(r),n._scheduled=void 0)},e}(Zn),vr=function(t){Ct(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var o=this.actions,i;n=n||o.shift();do if(i=n.execute(n.state,n.delay))break;while((n=o[0])&&n.id===r&&o.shift());if(this._active=!1,i){for(;(n=o[0])&&n.id===r&&o.shift();)n.unsubscribe();throw i}},e}(xn),Ht=new vr(_r);function wr(t){return t instanceof Date&&!isNaN(t)}var Sr=["addListener","removeListener"],yr=["addEventListener","removeEventListener"],Mr=["on","off"];function We(t,e,n,r){if(tt(n)&&(r=n,n=void 0),r)return We(t,e,n).pipe(mr(r));var o=gt(Er(t)?yr.map(function(l){return function(s){return t[l](e,s,n)}}):Pr(t)?Sr.map(bn(t,e)):Fr(t)?Mr.map(bn(t,e)):[],2),i=o[0],a=o[1];if(!i&&No(t))return Et(function(l){return We(l,e,n)})(nt(t));if(!i)throw new TypeError("Invalid event target");return new je(function(l){var s=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];return l.next(1<f.length?f:f[0])};return i(s),function(){return a(s)}})}function bn(t,e){return function(n){return function(r){return t[n](e,r)}}}function Pr(t){return tt(t.addListener)&&tt(t.removeListener)}function Fr(t){return tt(t.on)&&tt(t.off)}function Er(t){return tt(t.addEventListener)&&tt(t.removeEventListener)}function qt(t,e,n){t===void 0&&(t=0),n===void 0&&(n=Cr);var r=-1;return e!=null&&(Ho(e)?n=e:r=e),new je(function(o){var i=wr(t)?+t-n.now():t;i<0&&(i=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function Br(t,e){return t===void 0&&(t=0),e===void 0&&(e=Nt),t<0&&(t=0),qt(t,t,e)}function Xt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Wo(t),r=jo(t,1/0),o=t;return o.length?o.length===1?nt(o[0]):qo(r)(Xo(o,n)):dt}var $n=new je(sn),Dr=Array.isArray;function Ir(t){return t.length===1&&Dr(t[0])?t[0]:t}function Tr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=Ir(t),t.length===1?nt(t[0]):new je(Ar(t))}function Ar(t){return function(e){for(var n=[],r=function(i){n.push(nt(t[i]).subscribe(Xe(e,function(a){if(n){for(var l=0;l<n.length;l++)l!==i&&n[l].unsubscribe();n=null}e.next(a)})))},o=0;n&&!e.closed&&o<t.length;o++)r(o)}}function Vr(t){return st(function(e,n){var r=!1,o=null,i=null,a=function(){if(i==null||i.unsubscribe(),i=null,r){r=!1;var l=o;o=null,n.next(l)}};e.subscribe(Xe(n,function(l){i==null||i.unsubscribe(),r=!0,o=l,i=Xe(n,a,sn),nt(t(l)).subscribe(i)},function(){a(),n.complete()},void 0,function(){o=i=null}))})}function Vt(t,e){return e===void 0&&(e=Nt),st(function(n,r){var o=null,i=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var f=i;i=null,r.next(f)}};function s(){var f=a+t,d=e.now();if(d<f){o=this.schedule(void 0,f-d),r.add(o);return}l()}n.subscribe(Xe(r,function(f){i=f,a=e.now(),o||(o=e.schedule(s,t),r.add(o))},function(){l(),r.complete()},void 0,function(){i=o=null}))})}function eo(t,e){return e===void 0&&(e=hr),t=t!=null?t:Or,st(function(n,r){var o,i=!0;n.subscribe(Xe(r,function(a){var l=e(a);(i||!t(o,l))&&(i=!1,o=l,r.next(a))}))})}function Or(t,e){return t===e}function Rr(){return st(function(t,e){var n,r=!1;t.subscribe(Xe(e,function(o){var i=n;n=o,r&&e.next([i,o]),r=!0}))})}function Ae(t){return st(function(e,n){nt(t).subscribe(Xe(n,function(){return n.complete()},sn)),!n.closed&&e.subscribe(n)})}var to={leading:!0,trailing:!1};function zr(t,e){return e===void 0&&(e=to),st(function(n,r){var o=e.leading,i=e.trailing,a=!1,l=null,s=null,f=!1,d=function(){s==null||s.unsubscribe(),s=null,i&&(u(),f&&r.complete())},m=function(){s=null,f&&r.complete()},g=function(p){return s=nt(t(p)).subscribe(Xe(r,d,m))},u=function(){if(a){a=!1;var p=l;l=null,r.next(p),!f&&g(p)}};n.subscribe(Xe(r,function(p){a=!0,l=p,!(s&&!s.closed)&&(o?u():g(p))},function(){f=!0,!(i&&a&&s&&!s.closed)&&r.complete()}))})}function Lr(t,e,n){e===void 0&&(e=Nt),n===void 0&&(n=to);var r=qt(t,e);return zr(function(){return r},n)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const un=new Tt([]),Ot=new Pe,_t=new Pe,Je=new Pe;function no(t){const e=t.filter(i=>!i.parentChapter);let n=t.find(i=>i.progress<100);n||(n=t[t.length-1]);const r=n.parentChapter||n.reference,o=e.findIndex(i=>i.reference===r);return[e,o,r]}function Gr(t){let e,n;return{c(){e=new _o,n=at(),this.h()},l(r){e=vo(r),n=at(),this.h()},h(){e.a=n},m(r,o){e.m(t[0],r,o),H(r,n,o)},p(r,[o]){o&1&&e.p(r[0])},i:lt,o:lt,d(r){r&&E(n),r&&e.d()}}}function Nr(t,e,n){let{html:r}=e;const o=Lt();return wo(()=>{o("load")}),t.$$set=i=>{"html"in i&&n(0,r=i.html)},[r]}class oo extends Qe{constructor(e){super();Ze(this,e,Nr,Gr,xe,{html:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function rt(t,e){return e==="rtl"?-t:t}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Hr{constructor(e,n,r){this.calculator=e,this.window=n,this.firstDimensionMargin=r}scrollToBookmark(e){const n=this.getBookmarkPosition(e);if(!n)return;const{scrollToData:r}=Cn(n,this.firstDimensionMargin);this.window.scrollTo(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount,{verticalMode:o}=this.calculator,i=o?"scrollX":"scrollY";return{dataId:e,exploredCharCount:n,progress:n/r,[i]:this.window[i]}}getBookmarkBarPosition(e){const n=this.getBookmarkPosition(e);if(!!n)return Cn(n,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:n}=this.calculator,r=this.getBookmarkTargetPosByScrollValue(e);if(r)return r;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return n?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:n}=e,r=o=>{const i=e[o];if(!i)return;const a=rt(i,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===n)return{[o]:i}};return this.calculator.verticalMode?r("scrollX"):r("scrollY")}}function Cn(t,e){return"scrollX"in t?{scrollToData:{left:t.scrollX},bookmarkPosData:{right:`${-t.scrollX+e}px`}}:{scrollToData:{top:t.scrollY},bookmarkPosData:{top:`${t.scrollY+e}px`}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function qr(t){const e=(n,r,o,i)=>{if(o<r)return t!=null?t:o;const a=Math.floor((r+o)/2);return n[a]===i?a:n[a]>i?e(n,r,a-1,i):e(n,a+1,o,i)};return(n,r)=>e(n,0,n.length-1,r)}const Rt=qr(void 0);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class ro{constructor(e,n,r,o,i){this.containerEl=e,this.axis=n,this.direction=r,this.scrollEl=o,this.document=i,this.paragraphPosToAccCharCount=new Map,this.paragraphs=jn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=Yn(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const n=this.scrollEl.getBoundingClientRect(),r=rt(this.verticalMode?n.right:n.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),i=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=this.getNodeBoundingRect(l),d=rt(this.verticalMode?s.left:s.bottom,this.direction)-r-o+e;this.paragraphPos[a]=d;const m=i.get(d)||[];i.set(d,m),m.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(i.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(){return this.getCharCountByScrollPos(this.scrollPos)}getCharCountByScrollPos(e){const n=Rt(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[n])||0}getScrollPosByCharCount(e){const n=Rt(this.accumulatedCharCount,e);return rt(this.paragraphPos[n],this.direction)}getNodeBoundingRect(e){const n=this.document.createRange();return n.selectNode(e),n.getBoundingClientRect()}get scrollPos(){return rt(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Xr(t,e,n){const r=Yr(e,n)(t,"scrollLeft");return(o,i,a)=>{if(!Wr(o))return;const l=jr(o,i,a);r(-l),o.preventDefault()}}function Wr(t){return!(!t.deltaY||t.deltaX||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)}function jr(t,e,n){switch(t.deltaMode){case 0:return t.deltaY;case 1:return t.deltaY*e*1.75;default:return t.deltaY*n}}function Yr(t,e){return(n,r)=>{let o=!1,i=t[r],a=t[r];const l=()=>{o=!0;const s=Math.trunc((i-t[r])/n);if(t[r]!==a){o=!1;return}if(a+=s,t.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(i=t[r],a=t[r]),i+=s,o||e(l)}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Kr{constructor(e,n,r){this.verticalMode=e,this.firstDimensionMargin=n,this.window=r}nextPage(){this.scrollByPercent(.9)}prevPage(){this.scrollByPercent(-.9)}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let n=this.window.innerHeight,r="top",o=1;this.verticalMode&&(n=this.window.innerWidth,r="left",o=-1);const i=n-this.firstDimensionMargin*2;this.window.scrollBy({[r]:i*e*o,behavior:"smooth"})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Ur{constructor(e,n,r,o,i=Ht){this.multiplier=e,this.verticalMode=n,this.enabled$=new Tt(!1),this.enabled$.pipe(mt(a=>{if(!a)return dt;let l=0;return Br(0,i).pipe(_e(()=>Date.now()),Rr(),_e(s=>this.calcNewPos(s)),_e(s=>{l+=s;const f=Math.trunc(l);return l-=f,f}),Gt(s=>s!==0))}),Ae(r)).subscribe(a=>{let l="top";n&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,n]){let r=.00365956;return this.verticalMode&&(r=-91489e-8),r*this.multiplier*(n-e)}}const{document:Jr,window:Qr}=Gn;function _n(t){let e,n,r,o,i;return{c(){e=J("div"),r=ne(),o=J("div"),this.h()},l(a){e=Q(a,"DIV",{class:!0,style:!0}),Z(e).forEach(E),r=oe(a),o=Q(a,"DIV",{class:!0,style:!0}),Z(o).forEach(E),this.h()},h(){j(e,"class","fixed z-[5]"),j(e,"style",n=t[21]+": 100%; "+t[20]+": "+t[15]+"px; "+t[19][0]+": 0"),D(e,"background-color",t[5],!1),j(o,"class","fixed z-[5]"),j(o,"style",i=t[21]+": 100%; "+t[20]+": "+t[15]+"px; "+t[19][1]+": 0"),D(o,"background-color",t[5],!1)},m(a,l){H(a,e,l),H(a,r,l),H(a,o,l)},p(a,l){l[0]&3702784&&n!==(n=a[21]+": 100%; "+a[20]+": "+a[15]+"px; "+a[19][0]+": 0")&&j(e,"style",n),l[0]&32&&D(e,"background-color",a[5],!1),l[0]&3702784&&i!==(i=a[21]+": 100%; "+a[20]+": "+a[15]+"px; "+a[19][1]+": 0")&&j(o,"style",i),l[0]&32&&D(o,"background-color",a[5],!1)},d(a){a&&E(e),a&&E(r),a&&E(o)}}}function vn(t){let e;function n(i,a){return i[3]?xr:Zr}let r=n(t),o=r(t);return{c(){o.c(),e=at()},l(i){o.l(i),e=at()},m(i,a){o.m(i,a),H(i,e,a)},p(i,a){r===(r=n(i))&&o?o.p(i,a):(o.d(1),o=r(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){o.d(i),i&&E(e)}}}function Zr(t){let e;return{c(){e=J("div"),this.h()},l(n){e=Q(n,"DIV",{class:!0}),Z(e).forEach(E),this.h()},h(){j(e,"class","absolute inset-x-0 h-12 bg-yellow-600 bg-opacity-10 pointer-events-none m-auto"),D(e,"width",`${t[14]||t[1]}px`,!1),D(e,"top",t[17].top,!1)},m(n,r){H(n,e,r)},p(n,r){r[0]&16386&&D(e,"width",`${n[14]||n[1]}px`,!1),r[0]&131072&&D(e,"top",n[17].top,!1)},d(n){n&&E(e)}}}function xr(t){let e;return{c(){e=J("div"),this.h()},l(n){e=Q(n,"DIV",{class:!0}),Z(e).forEach(E),this.h()},h(){j(e,"class","pointer-events-none absolute inset-y-0 m-auto w-12 bg-yellow-600 bg-opacity-10"),D(e,"height",`${t[18]||t[2]}px`,!1),D(e,"right",t[17].right,!1)},m(n,r){H(n,e,r)},p(n,r){r[0]&262148&&D(e,"height",`${n[18]||n[2]}px`,!1),r[0]&131072&&D(e,"right",n[17].right,!1)},d(n){n&&E(e)}}}function $r(t){let e,n,r=`${t[8]}px`,o=`${t[18]||t[2]}px`,i,a,l,s,f,d;n=new oo({props:{html:t[0]}}),n.$on("load",t[24]);let m=t[15]&&_n(t),g=t[17]&&vn(t);return{c(){e=J("div"),ke(n.$$.fragment),i=ne(),m&&m.c(),a=ne(),g&&g.c(),l=ne(),this.h()},l(u){e=Q(u,"DIV",{class:!0});var p=Z(e);pe(n.$$.fragment,p),p.forEach(E),i=oe(u),m&&m.l(u),a=oe(u),g&&g.l(u),l=oe(u),this.h()},h(){j(e,"class","book-content m-auto svelte-1tqbqao"),W(e,"book-content--writing-vertical-rl",t[3]),W(e,"book-content--writing-horizontal-rl",!t[3]),W(e,"book-content--hide-furigana",t[12]),W(e,"book-content--hide-spoiler-image",t[11]),W(e,"book-content--furigana-style-partial",t[13]===Be.Partial),W(e,"book-content--furigana-style-full",t[13]===Be.Full),W(e,"book-content--furigana-style-toggle",t[13]===Be.Toggle),D(e,"color",t[4],!1),D(e,"font-size",r,!1),D(e,"max-width",!t[3]&&t[14]?`${t[14]}px`:void 0,!1),D(e,"max-height",t[18]?`${t[18]}px`:void 0,!1),D(e,"padding-left",t[3]&&t[15]?`${t[15]}px`:void 0,!1),D(e,"padding-right",t[3]&&t[15]?`${t[15]}px`:void 0,!1),D(e,"padding-top",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),D(e,"padding-bottom",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),D(e,"--font-family-serif",t[9],!1),D(e,"--font-family-sans-serif",t[10],!1),D(e,"--book-content-hint-furigana-font-color",t[6],!1),D(e,"--book-content-hint-furigana-shadow-color",t[7],!1),D(e,"--book-content-child-height",o,!1)},m(u,p){H(u,e,p),be(n,e,null),t[40](e),H(u,i,p),m&&m.m(u,p),H(u,a,p),g&&g.m(u,p),H(u,l,p),s=!0,f||(d=[ve(Qr,"scroll",t[23]),ve(Jr.body,"wheel",t[22],{passive:!1})],f=!0)},p(u,p){const P={};p[0]&1&&(P.html=u[0]),n.$set(P),p[0]&8&&W(e,"book-content--writing-vertical-rl",u[3]),p[0]&8&&W(e,"book-content--writing-horizontal-rl",!u[3]),p[0]&4096&&W(e,"book-content--hide-furigana",u[12]),p[0]&2048&&W(e,"book-content--hide-spoiler-image",u[11]),p[0]&8192&&W(e,"book-content--furigana-style-partial",u[13]===Be.Partial),p[0]&8192&&W(e,"book-content--furigana-style-full",u[13]===Be.Full),p[0]&8192&&W(e,"book-content--furigana-style-toggle",u[13]===Be.Toggle),p[0]&16&&D(e,"color",u[4],!1),p[0]&256&&r!==(r=`${u[8]}px`)&&D(e,"font-size",r,!1),p[0]&16392&&D(e,"max-width",!u[3]&&u[14]?`${u[14]}px`:void 0,!1),p[0]&262144&&D(e,"max-height",u[18]?`${u[18]}px`:void 0,!1),p[0]&32776&&D(e,"padding-left",u[3]&&u[15]?`${u[15]}px`:void 0,!1),p[0]&32776&&D(e,"padding-right",u[3]&&u[15]?`${u[15]}px`:void 0,!1),p[0]&32776&&D(e,"padding-top",!u[3]&&u[15]?`${u[15]}px`:void 0,!1),p[0]&32776&&D(e,"padding-bottom",!u[3]&&u[15]?`${u[15]}px`:void 0,!1),p[0]&512&&D(e,"--font-family-serif",u[9],!1),p[0]&1024&&D(e,"--font-family-sans-serif",u[10],!1),p[0]&64&&D(e,"--book-content-hint-furigana-font-color",u[6],!1),p[0]&128&&D(e,"--book-content-hint-furigana-shadow-color",u[7],!1),p[0]&262148&&o!==(o=`${u[18]||u[2]}px`)&&D(e,"--book-content-child-height",o,!1),u[15]?m?m.p(u,p):(m=_n(u),m.c(),m.m(a.parentNode,a)):m&&(m.d(1),m=null),u[17]?g?g.p(u,p):(g=vn(u),g.c(),g.m(l.parentNode,l)):g&&(g.d(1),g=null)},i(u){s||(K(n.$$.fragment,u),s=!0)},o(u){$(n.$$.fragment,u),s=!1},d(u){u&&E(e),Ce(n),t[40](null),u&&E(i),m&&m.d(u),u&&E(a),g&&g.d(u),u&&E(l),f=!1,pt(d)}}}function ei(t,e,n){let r,o,i,a,l;x(t,Je,M=>n(46,l=M));let{htmlContent:s}=e,{width:f}=e,{height:d}=e,{verticalMode:m}=e,{fontColor:g}=e,{backgroundColor:u}=e,{hintFuriganaFontColor:p}=e,{hintFuriganaShadowColor:P}=e,{fontSize:h}=e,{fontFamilyGroupOne:w}=e,{fontFamilyGroupTwo:T}=e,{hideSpoilerImage:c}=e,{hideFurigana:S}=e,{furiganaStyle:F}=e,{secondDimensionMaxValue:O}=e,{firstDimensionMargin:I}=e,{autoPositionOnResize:R}=e,{autoBookmark:G}=e,{loadingState:re}=e,{multiplier:A}=e,{bookmarkData:z}=e,{exploredCharCount:_}=e,{bookCharCount:k}=e,{autoScroller:B}=e,{bookmarkManager:L}=e,{pageManager:N}=e;const ee=Lt();let X,U,v={},V,ae,q,me,we,le=0,fe=!1;const Se=Xr(4,document.documentElement,requestAnimationFrame),ye=new Pe,Me=new Pe,ge=new Pe,Ve=new Map,ce=new Map;let De=0,Oe=!1;an(()=>{ge.next(),ge.complete()}),V=new Ur(A,m,ge,document),B=V,kt([ye,Me]).pipe(Gt(()=>R),tn(1),_e(([M,te])=>m?te:M),eo(),Vt(10),Xn(Ht),Ae(ge)).subscribe(()=>{if(!U||!q)return;const M=U.getScrollPosByCharCount(le);fe=!0,q.scrollTo(M)});function Re(M){M.updateParagraphPos(),n(25,_=M.calcExploredCharCount()),we&&(we=!1,z.then(te=>{!te||!L||L.scrollToBookmark(te)}).finally(()=>{G&&We(window,"scroll").pipe(tn(1),Vt(3e3),Ae(ge)).subscribe(()=>{ee("bookmark")}),un.pipe(bt(1),mt(te=>te.length?(te.forEach(Ie=>{const Ee=Ie.reference,ze=document.getElementById(Ee);ze&&(De||(De=Number(getComputedStyle(ze)[m?"marginLeft":"marginBottom"].replace(/px$/,""))/2),ce.set(Ee,Ut(Kt({},Ie),{progress:0})),Ve.set(Ee,ze))}),Ve.size?(Ne(),We(window,"scroll")):dt):dt),Vr(()=>qt(Oe?100:500)),Ae(ge)).subscribe(Ne)})),n(36,v={})}function Ne(){const M=[...ce.entries()];for(let te=0,{length:Ie}=M;te<Ie;te+=1){const[Ee,ze]=M[te],Le=Ve.get(Ee).getBoundingClientRect();ze.progress=m?Math.min(Math.max(Le.right+(I||0)-window.innerWidth,0),Le.width)/(Le.width||1)*100:Math.abs(Math.min(Math.max(Le.top-(I||0),-Le.height),0))/(Le.height||1)*100,ce.set(Ee,ze)}Oe=!1,Ot.next(ce)}function $e(M){m&&!l&&Se(M,h,window.innerWidth)}function et(){requestAnimationFrame(()=>{!U||(n(25,_=U.calcExploredCharCount()),fe||(le=_),fe=!1)})}function He(){!X||(n(35,U=new ro(X,m?"vertical":"horizontal",m?"rtl":"ltr",document.documentElement,document)),n(25,_=0),le=_,n(26,k=U.charCount),ee("contentChange",X))}_t.pipe(Ae(ge)).subscribe(M=>{let te=document.getElementById(M);if(!te)return;te=!M.startsWith(gn)&&te.closest(`div[id^="${gn}"]`)||te,Oe=!0;const Ee=te.getBoundingClientRect();m?window.scrollBy(-(window.innerWidth-Ee.right-(I||0)-De),0):window.scrollBy(0,Ee.top-(I||0)-De)});function y(M){ie[M?"unshift":"push"](()=>{X=M,n(16,X)})}return t.$$set=M=>{"htmlContent"in M&&n(0,s=M.htmlContent),"width"in M&&n(1,f=M.width),"height"in M&&n(2,d=M.height),"verticalMode"in M&&n(3,m=M.verticalMode),"fontColor"in M&&n(4,g=M.fontColor),"backgroundColor"in M&&n(5,u=M.backgroundColor),"hintFuriganaFontColor"in M&&n(6,p=M.hintFuriganaFontColor),"hintFuriganaShadowColor"in M&&n(7,P=M.hintFuriganaShadowColor),"fontSize"in M&&n(8,h=M.fontSize),"fontFamilyGroupOne"in M&&n(9,w=M.fontFamilyGroupOne),"fontFamilyGroupTwo"in M&&n(10,T=M.fontFamilyGroupTwo),"hideSpoilerImage"in M&&n(11,c=M.hideSpoilerImage),"hideFurigana"in M&&n(12,S=M.hideFurigana),"furiganaStyle"in M&&n(13,F=M.furiganaStyle),"secondDimensionMaxValue"in M&&n(14,O=M.secondDimensionMaxValue),"firstDimensionMargin"in M&&n(15,I=M.firstDimensionMargin),"autoPositionOnResize"in M&&n(30,R=M.autoPositionOnResize),"autoBookmark"in M&&n(31,G=M.autoBookmark),"loadingState"in M&&n(32,re=M.loadingState),"multiplier"in M&&n(33,A=M.multiplier),"bookmarkData"in M&&n(34,z=M.bookmarkData),"exploredCharCount"in M&&n(25,_=M.exploredCharCount),"bookCharCount"in M&&n(26,k=M.bookCharCount),"autoScroller"in M&&n(27,B=M.autoScroller),"bookmarkManager"in M&&n(28,L=M.bookmarkManager),"pageManager"in M&&n(29,N=M.pageManager)},t.$$.update=()=>{if(t.$$.dirty[0]&8&&n(21,r=m?"height":"width"),t.$$.dirty[0]&8&&n(20,o=m?"width":"height"),t.$$.dirty[0]&8&&n(19,i=m?["left","right"]:["top","bottom"]),t.$$.dirty[0]&2&&ye.next(f),t.$$.dirty[0]&4&&Me.next(d),t.$$.dirty[0]&16392&&n(18,a=m&&O?O:void 0),t.$$.dirty[0]&1&&s&&(we=!0),t.$$.dirty[0]&6|t.$$.dirty[1]&18&&U&&f&&d&&!re){const M=U;requestAnimationFrame(()=>{Re(M)})}t.$$.dirty[0]&8|t.$$.dirty[1]&68&&V&&(n(37,V.multiplier=A,V),n(37,V.verticalMode=m,V)),t.$$.dirty[0]&32768|t.$$.dirty[1]&144&&U&&(n(38,ae=U&&new Hr(U,window,I||0)),n(28,L=ae)),t.$$.dirty[1]&168&&v&&(n(17,me=void 0),z.then(M=>{!M||n(17,me=ae==null?void 0:ae.getBookmarkBarPosition(M))})),t.$$.dirty[0]&32776|t.$$.dirty[1]&256&&(n(39,q=new Kr(m,I,window)),n(29,N=q))},[s,f,d,m,g,u,p,P,h,w,T,c,S,F,O,I,X,me,a,i,o,r,$e,et,He,_,k,B,L,N,R,G,re,A,z,U,v,V,ae,q,y]}class ti extends Qe{constructor(e){super();Ze(this,e,ei,$r,xe,{htmlContent:0,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,secondDimensionMaxValue:14,firstDimensionMargin:15,autoPositionOnResize:30,autoBookmark:31,loadingState:32,multiplier:33,bookmarkData:34,exploredCharCount:25,bookCharCount:26,autoScroller:27,bookmarkManager:28,pageManager:29},null,[-1,-1])}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const ni="px-4 md:px-8";/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ht(t,e=Qn){return e?t():$n}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function oi(t){const e=Array.from(t.getElementsByTagName("img"));return new je(n=>{const r=e.filter(i=>i.src).map(ri);if(r.length<=0){n.next(!1),n.complete();return}const o=kt(r).subscribe(()=>{n.next(!1),n.complete()});return n.next(!0),o})}function ri(t){return t.complete?Kn(1):Tr(We(t,"load"),We(t,"error"))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ii(t,e){const n=ai(t),r=si(t);return o=>Xt(n(o),li(o,e),r(o))}function ai(t){return e=>{const n=Array.from(e.getElementsByTagName("a"));n.forEach(o=>{o.href=t.location.pathname+o.hash});const r=n.map(o=>zt(o).pipe(Ue(()=>_t.next(o.hash.substring(1)))));return Xt(...r)}}function li(t,e){const n=e===Be.Toggle,o=Array.from(t.getElementsByTagName("ruby")).map(i=>n?zt(i).pipe(Ue(()=>{i.classList.toggle("reveal-rt")})):zt(i).pipe(bt(1),Ue(()=>{i.classList.add("reveal-rt")})));return Xt(...o)}function si(t){return e=>{const r=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const i=t.createElement("span");return i.classList.add("spoiler-label"),i.setAttribute("aria-hidden","true"),i.innerText="\u30CD\u30BF\u30D0\u30EC",o.appendChild(i),zt(o).pipe(bt(1),Ue(()=>{o.removeChild(i),o.removeAttribute("data-ttu-spoiler-img")}))});return Xt(...r)}}function zt(t){return We(t,"click").pipe(Ue(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const ui=300,fi=60,io="none";function ft(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function ci(t,e){return e.filter(n=>t.pointerId!==n.pointerId)}function St(t,e,n,r,o){t.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:n,pointersCount:r.length}}))}function hi(t,e,n,r,o,i=io){e.style.touchAction=i;let a=[];function l(f){a.push(f),St(e,t,f,a,"down"),r==null||r(a,f);const d=f.pointerId;function m(w){d===w.pointerId&&(a=ci(w,a),a.length||g(),St(e,t,w,a,"up"),o==null||o(a,w))}function g(){u(),p(),P(),h()}const u=ft(e,"pointermove",w=>{a=a.map(T=>w.pointerId===T.pointerId?w:T),St(e,t,w,a,"move"),n==null||n(a,w)}),p=ft(e,"lostpointercapture",w=>{m(w)}),P=ft(e,"pointerup",w=>{m(w)}),h=ft(e,"pointerleave",w=>{a=[],g(),St(e,t,w,a,"up"),o==null||o(a,w)})}const s=ft(e,"pointerdown",l);return{destroy:()=>{s()}}}function di(t,e={timeframe:ui,minSwipeDistance:fi,touchAction:io}){const n="swipe";let r,o,i,a;function l(f,d){o=d.clientX,i=d.clientY,r=Date.now(),f.length===1&&(a=d.target)}function s(f,d){if(d.type==="pointerup"&&f.length===0&&Date.now()-r<e.timeframe){const m=d.clientX-o,g=d.clientY-i,u=Math.abs(m),p=Math.abs(g);let P=null;u>=2*p&&u>e.minSwipeDistance?P=m>0?"right":"left":p>=2*u&&p>e.minSwipeDistance&&(P=g>0?"bottom":"top"),P&&t.dispatchEvent(new CustomEvent(n,{detail:{direction:P,target:a}}))}}return hi(n,t,null,l,s,e.touchAction)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class mi{constructor(e,n,r,o,i,a,l,s,f,d,m){this.contentEl=e,this.scrollEl=n,this.sections=r,this.sectionIndex$=o,this.virtualScrollPos$=i,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=f,this.pageChange$=d,this.sectionRenderComplete$=m,this.translateX=0,this.sectionData=new Map,un.pipe(bt(1)).subscribe(g=>{!g.length||(g.forEach(u=>{this.sectionData.set(u.reference,Ut(Kt({},u),{progress:0}))}),Ot.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}flipPage(e){const n=this.verticalMode?"scrollHeight":"scrollWidth",r=this.verticalMode?this.height:this.width,o=r+this.pageGap,i=!0;if(this.translateX){const m=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const g=this.translateX;m(),this.scrollToPos(-g-o,i);return}if(this.nextSection(i)){m();return}return}const a=0,l=this.scrollEl[n],s=this.virtualScrollPos$.getValue(),f=s+o*e,d=Math.ceil(f);if(d<a){if(s!==a){this.scrollToPos(a,i);return}this.prevSection(o,n,r,i);return}if(d>=l){this.nextSection(i);return}this.scrollOrTranslateToPos(f,l,r,i)}scrollTo(e,n){const r=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[r],o,n)}prevSection(e,n,r,o){const i=this.sectionIndex$.getValue()-1;return i<0?!1:(this.updateSectionIndex(i).subscribe(()=>{const a=this.scrollEl[n];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,r,o)}),!0)}nextSection(e){const n=this.sectionIndex$.getValue()+1;return n>=this.sections.length?!1:(this.updateSectionIndex(n).subscribe(()=>{var r,o;this.scrollToPos(0,e),this.updateSectionData((r=this.sections[n-1])==null?void 0:r.id,100,!1),this.updateSectionData((o=this.sections[n])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,n,r,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/n*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+r<=n){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,n){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(n)}translateXToPos(e,n){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(n)}updateSectionIndex(e){return new je(n=>{if(this.sectionIndex$.getValue()===e){n.next(),n.complete();return}const r=this.sectionRenderComplete$.subscribe(o=>{o===e&&n.next(),n.complete(),r.unsubscribe()});return this.sectionIndex$.next(e),r})}updateSectionData(e,n,r=!0){if(e&&this.sectionData.has(e)){const o=[...this.sectionData.values()];let i=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=n:i?l.progress=0:l.progress=100,!i&&s&&(i=!0),this.sectionData.set(a.reference,l)}),r&&Ot.next(this.sectionData)}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class gi{constructor(e,n,r,o,i,a,l,s,f){this.containerEl=e,this.sections=n,this.virtualScrollPos$=r,this.getWidth=o,this.getHeight=i,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=f,this.sectionIndex=-1;const d=g=>jn(g).reduce((p,P)=>p+Yn(P),0);let m=0;this.sectionAccCharCounts=n.map(g=>(m+=d(g),m)),this.charCount=m}updateCurrentSection(e){this.calculator=new ro(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(){const e=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+e)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const n=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+n}getSectionIndexByCharCount(e){return Rt(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const n=this.getSectionStartCount(),r=this.sectionAccCharCounts[this.sectionIndex],o=e-n,i=e===r&&r-n>0;if(o<0||e>r||i)return-1;if(o===0)return 0;const a=Rt(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,f=l[a];if(Number.isNaN(Number(s[a])))return-1;const d=(P,h)=>P>=h?h:l[P]>f?P:d(P+1,h),m=s[d(a+1,l.length-1)],{screenSize:g}=this,u=this.verticalMode?-1:0,p=g*(Math.ceil(m/g)+u);return rt(p,this.calculator.direction)}isCharOnScreen(e){const n=this.getScrollPosByCharCount(e),r=this.virtualScrollPos$.getValue();return n===r}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class ki{constructor(e,n,r,o,i){this.calculator=e,this.pageManager=n,this.sectionReady$=r,this.sectionIndex$=o,this.setIntendedCharCount=i}scrollToBookmark(e){const n=e.exploredCharCount;if(!n)return;const r=this.calculator.getSectionIndexByCharCount(n),o=l=>{const s=l.getScrollPosByCharCount(n);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(n)};if(this.sectionIndex$.getValue()===r){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount;return{dataId:e,exploredCharCount:n,progress:n/r}}}function wn(t){let e,n,r;return n=new Ge({props:{icon:Eo,spin:!0}}),{c(){e=J("div"),ke(n.$$.fragment),this.h()},l(o){e=Q(o,"DIV",{class:!0});var i=Z(e);pe(n.$$.fragment,i),i.forEach(E),this.h()},h(){j(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),D(e,"color",t[4],!1),D(e,"background-color",t[5],!1)},m(o,i){H(o,e,i),be(n,e,null),r=!0},p(o,i){i[0]&16&&D(e,"color",o[4],!1),i[0]&32&&D(e,"background-color",o[5],!1)},i(o){r||(K(n.$$.fragment,o),r=!0)},o(o){$(n.$$.fragment,o),r=!1},d(o){o&&E(e),Ce(n)}}}function Sn(t){let e,n,r;return n=new Ge({props:{icon:xt}}),{c(){e=J("div"),ke(n.$$.fragment),this.h()},l(o){e=Q(o,"DIV",{class:!0});var i=Z(e);pe(n.$$.fragment,i),i.forEach(E),this.h()},h(){j(e,"class","fixed top-3 right-3 text-xl opacity-25"),D(e,"color",t[4],!1)},m(o,i){H(o,e,i),be(n,e,null),r=!0},p(o,i){i[0]&16&&D(e,"color",o[4],!1)},i(o){r||(K(n.$$.fragment,o),r=!0)},o(o){$(n.$$.fragment,o),r=!1},d(o){o&&E(e),Ce(n)}}}function pi(t){let e,n,r,o=`${t[8]}px`,i=`${t[1]}px`,a=`${t[2]}px`,l=`${t[3]?t[1]:(t[1]+it)/t[20]-it}px`,s,f,d,m,g,u;r=new oo({props:{html:t[19]}}),r.$on("load",t[21]);let p=!t[18]&&wn(t),P=t[0]&&Sn(t);return{c(){e=J("div"),n=J("div"),ke(r.$$.fragment),s=ne(),p&&p.c(),f=ne(),P&&P.c(),d=at(),this.h()},l(h){e=Q(h,"DIV",{class:!0});var w=Z(e);n=Q(w,"DIV",{class:!0});var T=Z(n);pe(r.$$.fragment,T),T.forEach(E),w.forEach(E),s=oe(h),p&&p.l(h),f=oe(h),P&&P.l(h),d=at(),this.h()},h(){j(n,"class","book-content-container svelte-np4m3j"),j(e,"class","book-content m-auto svelte-np4m3j"),W(e,"book-content--avoid-page-break",t[14]),W(e,"book-content--writing-vertical-rl",t[3]),W(e,"book-content--writing-horizontal-rl",!t[3]),W(e,"book-content--hide-furigana",t[12]),W(e,"book-content--hide-spoiler-image",t[11]),W(e,"book-content--furigana-style-partial",t[13]===Be.Partial),W(e,"book-content--furigana-style-full",t[13]===Be.Full),W(e,"book-content--furigana-style-toggle",t[13]===Be.Toggle),D(e,"color",t[4],!1),D(e,"font-size",o,!1),D(e,"padding-top",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),D(e,"padding-bottom",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),D(e,"padding-left",t[3]&&t[15]?`${t[15]}px`:void 0,!1),D(e,"padding-right",t[3]&&t[15]?`${t[15]}px`:void 0,!1),D(e,"max-width",t[1]?`${t[1]}px`:void 0,!1),D(e,"max-height",t[3]&&t[2]?`${t[2]}px`:void 0,!1),D(e,"--font-family-serif",t[9],!1),D(e,"--font-family-sans-serif",t[10],!1),D(e,"--book-content-hint-furigana-font-color",t[6],!1),D(e,"--book-content-hint-furigana-shadow-color",t[7],!1),D(e,"--book-content-child-width",i,!1),D(e,"--book-content-child-height",a,!1),D(e,"--book-content-column-count",t[20],!1),D(e,"--book-content-image-max-width",l,!1)},m(h,w){H(h,e,w),Y(e,n),be(r,n,null),t[37](n),t[38](e),H(h,s,w),p&&p.m(h,w),H(h,f,w),P&&P.m(h,w),H(h,d,w),m=!0,g||(u=[ve(window,"keydown",t[23]),ln(di.call(null,e,{timeframe:500,minSwipeDistance:10,touchAction:"pan-y"})),ve(e,"swipe",t[22])],g=!0)},p(h,w){const T={};w[0]&524288&&(T.html=h[19]),r.$set(T),w[0]&16384&&W(e,"book-content--avoid-page-break",h[14]),w[0]&8&&W(e,"book-content--writing-vertical-rl",h[3]),w[0]&8&&W(e,"book-content--writing-horizontal-rl",!h[3]),w[0]&4096&&W(e,"book-content--hide-furigana",h[12]),w[0]&2048&&W(e,"book-content--hide-spoiler-image",h[11]),w[0]&8192&&W(e,"book-content--furigana-style-partial",h[13]===Be.Partial),w[0]&8192&&W(e,"book-content--furigana-style-full",h[13]===Be.Full),w[0]&8192&&W(e,"book-content--furigana-style-toggle",h[13]===Be.Toggle),w[0]&16&&D(e,"color",h[4],!1),w[0]&256&&o!==(o=`${h[8]}px`)&&D(e,"font-size",o,!1),w[0]&32776&&D(e,"padding-top",!h[3]&&h[15]?`${h[15]}px`:void 0,!1),w[0]&32776&&D(e,"padding-bottom",!h[3]&&h[15]?`${h[15]}px`:void 0,!1),w[0]&32776&&D(e,"padding-left",h[3]&&h[15]?`${h[15]}px`:void 0,!1),w[0]&32776&&D(e,"padding-right",h[3]&&h[15]?`${h[15]}px`:void 0,!1),w[0]&2&&D(e,"max-width",h[1]?`${h[1]}px`:void 0,!1),w[0]&12&&D(e,"max-height",h[3]&&h[2]?`${h[2]}px`:void 0,!1),w[0]&512&&D(e,"--font-family-serif",h[9],!1),w[0]&1024&&D(e,"--font-family-sans-serif",h[10],!1),w[0]&64&&D(e,"--book-content-hint-furigana-font-color",h[6],!1),w[0]&128&&D(e,"--book-content-hint-furigana-shadow-color",h[7],!1),w[0]&2&&i!==(i=`${h[1]}px`)&&D(e,"--book-content-child-width",i,!1),w[0]&4&&a!==(a=`${h[2]}px`)&&D(e,"--book-content-child-height",a,!1),w[0]&1048576&&D(e,"--book-content-column-count",h[20],!1),w[0]&1048586&&l!==(l=`${h[3]?h[1]:(h[1]+it)/h[20]-it}px`)&&D(e,"--book-content-image-max-width",l,!1),h[18]?p&&(Ye(),$(p,1,1,()=>{p=null}),Ke()):p?(p.p(h,w),w[0]&262144&&K(p,1)):(p=wn(h),p.c(),K(p,1),p.m(f.parentNode,f)),h[0]?P?(P.p(h,w),w[0]&1&&K(P,1)):(P=Sn(h),P.c(),K(P,1),P.m(d.parentNode,d)):P&&(Ye(),$(P,1,1,()=>{P=null}),Ke())},i(h){m||(K(r.$$.fragment,h),K(p),K(P),m=!0)},o(h){$(r.$$.fragment,h),$(p),$(P),m=!1},d(h){h&&E(e),Ce(r),t[37](null),t[38](null),h&&E(s),p&&p.d(h),h&&E(f),P&&P.d(h),h&&E(d),g=!1,pt(u)}}}const yn="overflow-hidden",it=20;function bi(t,e,n){let r,o;x(t,Je,y=>n(42,o=y));let{htmlContent:i}=e,{width:a}=e,{height:l}=e,{verticalMode:s}=e,{fontColor:f}=e,{backgroundColor:d}=e,{hintFuriganaFontColor:m}=e,{hintFuriganaShadowColor:g}=e,{fontSize:u}=e,{fontFamilyGroupOne:p}=e,{fontFamilyGroupTwo:P}=e,{hideSpoilerImage:h}=e,{hideFurigana:w}=e,{furiganaStyle:T}=e,{loadingState:c}=e,{bookmarkData:S}=e,{pageManager:F}=e,{bookmarkManager:O}=e,{exploredCharCount:I}=e,{bookCharCount:R}=e,{isBookmarkScreen:G=!1}=e,{avoidPageBreak:re=!0}=e,{pageColumns:A}=e,{firstDimensionMargin:z}=e,{autoBookmark:_=!1}=e;const k=Lt();let B,L,N,ee=[],X,U,v,V=!1,ae="",q=!0,me=0;const we=new Pe,le=new Pe,fe=new Tt(-1),Se=new Pe,ye=new Tt(0),Me=new Pe,ge=new Pe,Ve=fe.pipe(_e(y=>{var M;return((M=ee[y])==null?void 0:M.innerHTML)||""})),ce=new Pe;an(()=>{document.body.classList.remove(yn),ce.next(),ce.complete()}),kt([we,le]).pipe(tn(1),mt(()=>ge.pipe(bt(1))),Ae(ce)).subscribe(()=>{if(!N||!X)return;const y=N.getScrollPosByCharCount(me);y<0||X.scrollTo(y,!1)}),Se.pipe(Ae(ce)).subscribe(y=>{!N||(n(26,I=N.calcExploredCharCount()),y&&(me=I),S.then(Re))}),_&&Se.pipe(Vt(3e3),Ae(ce)).subscribe(y=>{y&&k("bookmark")}),Ve.pipe(eo(),Ae(ce)).subscribe(()=>{n(18,V=!1)}),Ve.pipe(Ae(ce)).subscribe(y=>{const M=(te,Ie)=>{if(Ie===0){te();return}requestAnimationFrame(()=>M(te,Ie-1))};M(()=>{n(19,ae=y)},2)}),ht(()=>We(document.body,"wheel",{passive:!0})).pipe(Lr(50),Ae(ce)).subscribe(y=>{if(!o){let M=(y.deltaX<0?-1:1)*(s?-1:1);y.deltaX||(M=y.deltaY<0?-1:1),X==null||X.flipPage(M)}});function De(){if(q){q=!1;return}!B||(n(33,N=new gi(B,ee,ye,()=>a,()=>l,()=>it,s,B,document)),n(26,I=0),me=0,n(27,R=N.charCount),N.updateCurrentSection(fe.getValue()),k("contentChange",B))}function Oe(y){y.updateParagraphPos(),n(26,I=y.calcExploredCharCount()),ge.next(y),S.then(Re),v&&(v=!1,S.then(M=>{!M||!O||O.scrollToBookmark(M)})),n(18,V=!0)}function Re(y){const M=y==null?void 0:y.exploredCharCount;!N||!M||n(0,G=N.isCharOnScreen(M))}function Ne(y){if(!X||o||y.detail.direction!=="left"&&y.detail.direction!=="right")return;const M=y.detail.direction==="left",te=s?!M:M;X.flipPage(te?1:-1)}function $e(y){if(!(!X||o))switch(y.code){case"ArrowLeft":X[s?"nextPage":"prevPage"]();break;case"ArrowRight":X[s?"prevPage":"nextPage"]();break;case"ArrowUp":X.prevPage();break;case"ArrowDown":X.nextPage();break}}_t.pipe(Ae(ce)).subscribe(y=>{const M=ee.findIndex(te=>te.id===y||te.querySelector(`[id="${y}"]`));M>-1&&(fe.next(M),X==null||X.scrollTo(0,!0))});function et(y){ie[y?"unshift":"push"](()=>{L=y,n(17,L)})}function He(y){ie[y?"unshift":"push"](()=>{B=y,n(16,B)})}return t.$$set=y=>{"htmlContent"in y&&n(28,i=y.htmlContent),"width"in y&&n(1,a=y.width),"height"in y&&n(2,l=y.height),"verticalMode"in y&&n(3,s=y.verticalMode),"fontColor"in y&&n(4,f=y.fontColor),"backgroundColor"in y&&n(5,d=y.backgroundColor),"hintFuriganaFontColor"in y&&n(6,m=y.hintFuriganaFontColor),"hintFuriganaShadowColor"in y&&n(7,g=y.hintFuriganaShadowColor),"fontSize"in y&&n(8,u=y.fontSize),"fontFamilyGroupOne"in y&&n(9,p=y.fontFamilyGroupOne),"fontFamilyGroupTwo"in y&&n(10,P=y.fontFamilyGroupTwo),"hideSpoilerImage"in y&&n(11,h=y.hideSpoilerImage),"hideFurigana"in y&&n(12,w=y.hideFurigana),"furiganaStyle"in y&&n(13,T=y.furiganaStyle),"loadingState"in y&&n(29,c=y.loadingState),"bookmarkData"in y&&n(30,S=y.bookmarkData),"pageManager"in y&&n(24,F=y.pageManager),"bookmarkManager"in y&&n(25,O=y.bookmarkManager),"exploredCharCount"in y&&n(26,I=y.exploredCharCount),"bookCharCount"in y&&n(27,R=y.bookCharCount),"isBookmarkScreen"in y&&n(0,G=y.isBookmarkScreen),"avoidPageBreak"in y&&n(14,re=y.avoidPageBreak),"pageColumns"in y&&n(31,A=y.pageColumns),"firstDimensionMargin"in y&&n(15,z=y.firstDimensionMargin),"autoBookmark"in y&&n(32,_=y.autoBookmark)},t.$$.update=()=>{if(t.$$.dirty[0]&1073741824&&S.then(Re),t.$$.dirty[0]&2&&a&&we.next(a),t.$$.dirty[0]&4&&l&&le.next(l),t.$$.dirty[0]&10|t.$$.dirty[1]&1&&n(20,r=s?1:A||Math.ceil(a/1e3)),t.$$.dirty[0]&268435456&&i&&(v=!0),t.$$.dirty[0]&268435456){const y=document.createElement("div");y.innerHTML=i,n(34,ee=Array.from(y.children)),fe.next(0)}if(t.$$.dirty[0]&196622|t.$$.dirty[1]&24&&L&&B&&ee&&(n(35,X=new mi(L,B,ee,fe,ye,a,l,it,s,Se,Me)),n(24,F=X)),t.$$.dirty[0]&536870918|t.$$.dirty[1]&4&&N&&a&&l&&!c){const y=N;requestAnimationFrame(()=>{Oe(y)})}t.$$.dirty[0]&536870912|t.$$.dirty[1]&4&&N&&!c&&Me.next(fe.getValue()),t.$$.dirty[1]&52&&N&&X&&(n(36,U=new ki(N,X,ge,fe,y=>me=y)),n(25,O=U))},document.body.classList.add(yn),[G,a,l,s,f,d,m,g,u,p,P,h,w,T,re,z,B,L,V,ae,r,De,Ne,$e,F,O,I,R,i,c,S,A,_,N,ee,X,U,et,He]}class Ci extends Qe{constructor(e){super();Ze(this,e,bi,pi,xe,{htmlContent:28,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,loadingState:29,bookmarkData:30,pageManager:24,bookmarkManager:25,exploredCharCount:26,bookCharCount:27,isBookmarkScreen:0,avoidPageBreak:14,pageColumns:31,firstDimensionMargin:15,autoBookmark:32},null,[-1,-1])}}function _i(t){var h,w,T;let e,n,r,o,i,a,l,s;function f(c){t[49](c)}function d(c){t[50](c)}function m(c){t[51](c)}function g(c){t[52](c)}function u(c){t[53](c)}function p(c){t[54](c)}let P={htmlContent:t[7],width:(h=t[29])!=null?h:0,height:(w=t[30])!=null?w:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],loadingState:(T=t[31])!=null?T:!0,avoidPageBreak:t[22],pageColumns:t[23],autoBookmark:t[24],firstDimensionMargin:t[20]};return t[0]!==void 0&&(P.exploredCharCount=t[0]),t[1]!==void 0&&(P.bookCharCount=t[1]),t[6]!==void 0&&(P.isBookmarkScreen=t[6]),t[2]!==void 0&&(P.bookmarkData=t[2]),t[4]!==void 0&&(P.bookmarkManager=t[4]),t[5]!==void 0&&(P.pageManager=t[5]),e=new Ci({props:P}),ie.push(()=>he(e,"exploredCharCount",f)),ie.push(()=>he(e,"bookCharCount",d)),ie.push(()=>he(e,"isBookmarkScreen",m)),ie.push(()=>he(e,"bookmarkData",g)),ie.push(()=>he(e,"bookmarkManager",u)),ie.push(()=>he(e,"pageManager",p)),e.$on("contentChange",t[55]),e.$on("bookmark",t[56]),{c(){ke(e.$$.fragment)},l(c){pe(e.$$.fragment,c)},m(c,S){be(e,c,S),s=!0},p(c,S){var O,I,R;const F={};S[0]&128&&(F.htmlContent=c[7]),S[0]&536870912&&(F.width=(O=c[29])!=null?O:0),S[0]&1073741824&&(F.height=(I=c[30])!=null?I:0),S[0]&256&&(F.verticalMode=c[8]),S[0]&512&&(F.fontColor=c[9]),S[0]&1024&&(F.backgroundColor=c[10]),S[0]&2048&&(F.hintFuriganaFontColor=c[11]),S[0]&4096&&(F.hintFuriganaShadowColor=c[12]),S[0]&8192&&(F.fontSize=c[13]),S[0]&16384&&(F.fontFamilyGroupOne=c[14]),S[0]&32768&&(F.fontFamilyGroupTwo=c[15]),S[0]&65536&&(F.hideSpoilerImage=c[16]),S[0]&131072&&(F.hideFurigana=c[17]),S[0]&262144&&(F.furiganaStyle=c[18]),S[1]&1&&(F.loadingState=(R=c[31])!=null?R:!0),S[0]&4194304&&(F.avoidPageBreak=c[22]),S[0]&8388608&&(F.pageColumns=c[23]),S[0]&16777216&&(F.autoBookmark=c[24]),S[0]&1048576&&(F.firstDimensionMargin=c[20]),!n&&S[0]&1&&(n=!0,F.exploredCharCount=c[0],de(()=>n=!1)),!r&&S[0]&2&&(r=!0,F.bookCharCount=c[1],de(()=>r=!1)),!o&&S[0]&64&&(o=!0,F.isBookmarkScreen=c[6],de(()=>o=!1)),!i&&S[0]&4&&(i=!0,F.bookmarkData=c[2],de(()=>i=!1)),!a&&S[0]&16&&(a=!0,F.bookmarkManager=c[4],de(()=>a=!1)),!l&&S[0]&32&&(l=!0,F.pageManager=c[5],de(()=>l=!1)),e.$set(F)},i(c){s||(K(e.$$.fragment,c),s=!0)},o(c){$(e.$$.fragment,c),s=!1},d(c){Ce(e,c)}}}function vi(t){var h,w,T;let e,n,r,o,i,a,l,s;function f(c){t[41](c)}function d(c){t[42](c)}function m(c){t[43](c)}function g(c){t[44](c)}function u(c){t[45](c)}function p(c){t[46](c)}let P={htmlContent:t[7],width:(h=t[29])!=null?h:0,height:(w=t[30])!=null?w:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],secondDimensionMaxValue:t[19],firstDimensionMargin:t[20],autoPositionOnResize:t[21],autoBookmark:t[24],multiplier:t[26],loadingState:(T=t[31])!=null?T:!0};return t[0]!==void 0&&(P.exploredCharCount=t[0]),t[1]!==void 0&&(P.bookCharCount=t[1]),t[2]!==void 0&&(P.bookmarkData=t[2]),t[3]!==void 0&&(P.autoScroller=t[3]),t[4]!==void 0&&(P.bookmarkManager=t[4]),t[5]!==void 0&&(P.pageManager=t[5]),e=new ti({props:P}),ie.push(()=>he(e,"exploredCharCount",f)),ie.push(()=>he(e,"bookCharCount",d)),ie.push(()=>he(e,"bookmarkData",m)),ie.push(()=>he(e,"autoScroller",g)),ie.push(()=>he(e,"bookmarkManager",u)),ie.push(()=>he(e,"pageManager",p)),e.$on("contentChange",t[47]),e.$on("bookmark",t[48]),{c(){ke(e.$$.fragment)},l(c){pe(e.$$.fragment,c)},m(c,S){be(e,c,S),s=!0},p(c,S){var O,I,R;const F={};S[0]&128&&(F.htmlContent=c[7]),S[0]&536870912&&(F.width=(O=c[29])!=null?O:0),S[0]&1073741824&&(F.height=(I=c[30])!=null?I:0),S[0]&256&&(F.verticalMode=c[8]),S[0]&512&&(F.fontColor=c[9]),S[0]&1024&&(F.backgroundColor=c[10]),S[0]&2048&&(F.hintFuriganaFontColor=c[11]),S[0]&4096&&(F.hintFuriganaShadowColor=c[12]),S[0]&8192&&(F.fontSize=c[13]),S[0]&16384&&(F.fontFamilyGroupOne=c[14]),S[0]&32768&&(F.fontFamilyGroupTwo=c[15]),S[0]&65536&&(F.hideSpoilerImage=c[16]),S[0]&131072&&(F.hideFurigana=c[17]),S[0]&262144&&(F.furiganaStyle=c[18]),S[0]&524288&&(F.secondDimensionMaxValue=c[19]),S[0]&1048576&&(F.firstDimensionMargin=c[20]),S[0]&2097152&&(F.autoPositionOnResize=c[21]),S[0]&16777216&&(F.autoBookmark=c[24]),S[0]&67108864&&(F.multiplier=c[26]),S[1]&1&&(F.loadingState=(R=c[31])!=null?R:!0),!n&&S[0]&1&&(n=!0,F.exploredCharCount=c[0],de(()=>n=!1)),!r&&S[0]&2&&(r=!0,F.bookCharCount=c[1],de(()=>r=!1)),!o&&S[0]&4&&(o=!0,F.bookmarkData=c[2],de(()=>o=!1)),!i&&S[0]&8&&(i=!0,F.autoScroller=c[3],de(()=>i=!1)),!a&&S[0]&16&&(a=!0,F.bookmarkManager=c[4],de(()=>a=!1)),!l&&S[0]&32&&(l=!0,F.pageManager=c[5],de(()=>l=!1)),e.$set(F)},i(c){s||(K(e.$$.fragment,c),s=!0)},o(c){$(e.$$.fragment,c),s=!1},d(c){Ce(e,c)}}}function wi(t){var m;let e,n,r,o,i=((m=t[32])!=null?m:"")+"",a,l;const s=[vi,_i],f=[];function d(g,u){return g[25]===Bt.Continuous?0:1}return n=d(t),r=f[n]=s[n](t),{c(){e=J("div"),r.c(),o=ne(),a=se(i),this.h()},l(g){e=Q(g,"DIV",{class:!0});var u=Z(e);r.l(u),u.forEach(E),o=oe(g),a=ue(g,i),this.h()},h(){j(e,"class",ni+" py-8"),W(e,"opacity-20",t[27])},m(g,u){H(g,e,u),f[n].m(e,null),t[57](e),H(g,o,u),H(g,a,u),l=!0},p(g,u){var P;let p=n;n=d(g),n===p?f[n].p(g,u):(Ye(),$(f[p],1,1,()=>{f[p]=null}),Ke(),r=f[n],r?r.p(g,u):(r=f[n]=s[n](g),r.c()),K(r,1),r.m(e,null)),u[0]&134217728&&W(e,"opacity-20",g[27]),(!l||u[1]&2)&&i!==(i=((P=g[32])!=null?P:"")+"")&&Fe(a,i)},i(g){l||(K(r),l=!0)},o(g){$(r),l=!1},d(g){g&&E(e),f[n].d(),t[57](null),g&&E(o),g&&E(a)}}}function yt(t){return Number(t.replace(/px$/,""))}function Si(t,e,n){let r,o,i,a,l,s,f;x(t,Je,b=>n(27,o=b));let{htmlContent:d}=e,{width:m}=e,{height:g}=e,{verticalMode:u}=e,{fontColor:p}=e,{backgroundColor:P}=e,{hintFuriganaFontColor:h}=e,{hintFuriganaShadowColor:w}=e,{fontSize:T}=e,{fontFamilyGroupOne:c}=e,{fontFamilyGroupTwo:S}=e,{hideSpoilerImage:F}=e,{hideFurigana:O}=e,{furiganaStyle:I}=e,{secondDimensionMaxValue:R}=e,{firstDimensionMargin:G}=e,{autoPositionOnResize:re}=e,{avoidPageBreak:A}=e,{pageColumns:z}=e,{autoBookmark:_}=e,{viewMode:k}=e,{exploredCharCount:B}=e,{bookCharCount:L}=e,{multiplier:N}=e,{bookmarkData:ee}=e,{autoScroller:X}=e,{bookmarkManager:U}=e,{pageManager:v}=e,{isBookmarkScreen:V}=e;const ae=new Pe,q=new Pe,me=dr(null);x(t,me,b=>n(28,i=b));const we=kt([me.pipe(Gt(b=>!!b)),kt([ae,q]).pipe(nn(0))]).pipe(Vt(0,Ht),_e(([b])=>getComputedStyle(b)),on({refCount:!0,bufferSize:1})),le=new Yo(1),fe=we.pipe(_e(b=>ge(m-yt(b.paddingLeft)-yt(b.paddingRight))));x(t,fe,b=>n(29,a=b));const Se=we.pipe(_e(b=>Ve(g-yt(b.paddingTop)-yt(b.paddingBottom)-r)));x(t,Se,b=>n(30,l=b));const ye=ht(()=>Kn(document)).pipe(Et(b=>{const jt=ii(b,I);return le.pipe(Et(Yt=>jt(Yt)))}),ot());x(t,ye,b=>n(32,f=b));const Me=le.pipe(Et(b=>oi(b)),rn());x(t,Me,b=>n(31,s=b));function ge(b){return Bt.Paginated===k&&!u&&R?Math.min(R,b):b}function Ve(b){return Bt.Paginated===k&&u&&R?Math.min(R,b):b}function ce(b){B=b,n(0,B)}function De(b){L=b,n(1,L)}function Oe(b){ee=b,n(2,ee)}function Re(b){X=b,n(3,X)}function Ne(b){U=b,n(4,U)}function $e(b){v=b,n(5,v)}const et=b=>le.next(b.detail);function He(b){hn.call(this,t,b)}function y(b){B=b,n(0,B)}function M(b){L=b,n(1,L)}function te(b){V=b,n(6,V)}function Ie(b){ee=b,n(2,ee)}function Ee(b){U=b,n(4,U)}function ze(b){v=b,n(5,v)}const vt=b=>le.next(b.detail);function Le(b){hn.call(this,t,b)}function Wt(b){ie[b?"unshift":"push"](()=>{i=b,me.set(i)})}return t.$$set=b=>{"htmlContent"in b&&n(7,d=b.htmlContent),"width"in b&&n(39,m=b.width),"height"in b&&n(40,g=b.height),"verticalMode"in b&&n(8,u=b.verticalMode),"fontColor"in b&&n(9,p=b.fontColor),"backgroundColor"in b&&n(10,P=b.backgroundColor),"hintFuriganaFontColor"in b&&n(11,h=b.hintFuriganaFontColor),"hintFuriganaShadowColor"in b&&n(12,w=b.hintFuriganaShadowColor),"fontSize"in b&&n(13,T=b.fontSize),"fontFamilyGroupOne"in b&&n(14,c=b.fontFamilyGroupOne),"fontFamilyGroupTwo"in b&&n(15,S=b.fontFamilyGroupTwo),"hideSpoilerImage"in b&&n(16,F=b.hideSpoilerImage),"hideFurigana"in b&&n(17,O=b.hideFurigana),"furiganaStyle"in b&&n(18,I=b.furiganaStyle),"secondDimensionMaxValue"in b&&n(19,R=b.secondDimensionMaxValue),"firstDimensionMargin"in b&&n(20,G=b.firstDimensionMargin),"autoPositionOnResize"in b&&n(21,re=b.autoPositionOnResize),"avoidPageBreak"in b&&n(22,A=b.avoidPageBreak),"pageColumns"in b&&n(23,z=b.pageColumns),"autoBookmark"in b&&n(24,_=b.autoBookmark),"viewMode"in b&&n(25,k=b.viewMode),"exploredCharCount"in b&&n(0,B=b.exploredCharCount),"bookCharCount"in b&&n(1,L=b.bookCharCount),"multiplier"in b&&n(26,N=b.multiplier),"bookmarkData"in b&&n(2,ee=b.bookmarkData),"autoScroller"in b&&n(3,X=b.autoScroller),"bookmarkManager"in b&&n(4,U=b.bookmarkManager),"pageManager"in b&&n(5,v=b.pageManager),"isBookmarkScreen"in b&&n(6,V=b.isBookmarkScreen)},t.$$.update=()=>{t.$$.dirty[0]&34603264&&(r=G&&Bt.Paginated===k&&!u?G*2:0),t.$$.dirty[1]&256&&ae.next(m),t.$$.dirty[1]&512&&q.next(g)},[B,L,ee,X,U,v,V,d,u,p,P,h,w,T,c,S,F,O,I,R,G,re,A,z,_,k,N,o,i,a,l,s,f,me,le,fe,Se,ye,Me,m,g,ce,De,Oe,Re,Ne,$e,et,He,y,M,te,Ie,Ee,ze,vt,Le,Wt]}class yi extends Qe{constructor(e){super();Ze(this,e,Si,wi,xe,{htmlContent:7,width:39,height:40,verticalMode:8,fontColor:9,backgroundColor:10,hintFuriganaFontColor:11,hintFuriganaShadowColor:12,fontSize:13,fontFamilyGroupOne:14,fontFamilyGroupTwo:15,hideSpoilerImage:16,hideFurigana:17,furiganaStyle:18,secondDimensionMaxValue:19,firstDimensionMargin:20,autoPositionOnResize:21,avoidPageBreak:22,pageColumns:23,autoBookmark:24,viewMode:25,exploredCharCount:0,bookCharCount:1,multiplier:26,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6},null,[-1,-1,-1])}}function Mi(t,e){const n=document.createTextNode(e);if(t.firstChild){t.replaceChild(n,t.firstChild);return}t.appendChild(n)}function Pi(t,e,n){let{styleSheet:r}=e,o;return Nn(()=>{n(1,o=document.createElement("style")),document.head.appendChild(o)}),an(()=>{o&&document.head.removeChild(o)}),t.$$set=i=>{"styleSheet"in i&&n(0,r=i.styleSheet)},t.$$.update=()=>{t.$$.dirty&3&&o&&Mi(o,r)},[r,o]}class Fi extends Qe{constructor(e){super();Ze(this,e,Pi,null,xe,{styleSheet:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Ei{constructor(e){this.document=e,this.fallbackSpec=Mn(this.document)}get fullscreenEnabled(){var e;return(e=this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled"))!=null?e:!1}get fullscreenElement(){var e;return(e=this.fallbackSpec("fullscreenElement","webkitFullscreenElement"))!=null?e:null}async requestFullscreen(e,n){const r=Mn(e)("requestFullscreen","webkitRequestFullscreen");!r||await r(n)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function Mn(t){return(e,n)=>{var r;return(r=Pn(t,e))!=null?r:Pn(t,n)}}function Pn(t,e){const n=t[e];return typeof n=="function"?n.bind(t):n}const Dt=new Ei(document);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Bi(t,e){return Di(t).pipe(_e(n=>{const r=e.createElement("div");return r.innerHTML=n,Ii(r),Ti(r),Ai(r,e),Vi(r),r.innerHTML}))}function Di(t){return new je(e=>{const{blobs:n}=t;let{elementHtml:r}=t;const o=[];return Object.entries(n).forEach(([i,a])=>{const l=URL.createObjectURL(a);o.push(l),r=r.replaceAll(gr(i),l).replaceAll(`ttu:${i}`,l)}),e.next(r),()=>{o.forEach(i=>URL.revokeObjectURL(i))}})}function Ii(t){Array.from(t.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:Un(e)})).forEach(({parentEl:e,isGaiji:n})=>{e==null||e.classList.add("ttu-img-container"),n||e==null||e.classList.add("ttu-illustration-container")})}function Ti(t){Array.from(t.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function Ai(t,e){const n=()=>{let o=[...t.children];const i=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return i>0&&i<o.length&&(o=o.slice(i)),o},r=(o,i)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||i).insertBefore(a,o),a.appendChild(o)};n().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(i=>!Un(i)).forEach(i=>r(i,o)),Array.from(o.getElementsByTagName("svg")).filter(i=>i.getElementsByTagName("image").length).forEach(i=>r(i,o))})}function Vi(t){t.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Oi=ao;function ao(t,e,n){t instanceof RegExp&&(t=Fn(t,n)),e instanceof RegExp&&(e=Fn(e,n));const r=lo(t,e,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+t.length,r[1]),post:n.slice(r[1]+e.length)}}function Fn(t,e){const n=e.match(t);return n?n[0]:null}ao.range=lo;function lo(t,e,n){let r,o,i,a,l,s=n.indexOf(t),f=n.indexOf(e,s+1),d=s;if(s>=0&&f>0){if(t===e)return[s,f];for(r=[],i=n.length;d>=0&&!l;)d===s?(r.push(d),s=n.indexOf(t,d+1)):r.length===1?l=[r.pop(),f]:(o=r.pop(),o<i&&(i=o,a=f),f=n.indexOf(e,d+1)),d=s<f&&s>=0?s:f;r.length&&(l=[i,a])}return l}function Ri(t,e={}){const r=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function i(_){throw new Error(`CSS parse error: ${_}`)}function a(_){const k=_.exec(t);if(k)return t=t.slice(k[0].length),k}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function f(){a(/^\s*/)}function d(){if(f(),t[0]!=="/"||t[1]!=="*")return;let _=2;for(;t[_]&&(t[_]!=="*"||t[_+1]!=="/");)_++;if(!t[_])return i("end of comment is missing");const k=t.slice(2,_);return t=t.slice(_+2),{type:"comment",comment:k}}function m(){const _=[];let k;for(;k=d();)_.push(k);return r.removeComments?[]:_}function g(){for(f();t[0]==="}";)i("extra closing bracket");const _=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(_)return _[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(k){return k.replace(/,/g,"\u200C")}).split(/\s*(?![^(]*\)),\s*/).map(function(k){return k.replace(/\u200C/g,",")})}function u(){if(t[0]==="@")return re();a(/^([;\s]*)+/);const _=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let k=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!k)return;if(k=k[0].trim(),!a(/^:\s*/))return i("property missing ':'");const B=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),L={type:"declaration",property:k.replace(_,""),value:B?B[0].replace(_,"").trim():""};return a(/^[;\s]*/),L}function p(){if(!l())return i("missing '{'");let _,k=m();for(;_=u();)k.push(_),k=k.concat(m());return s()?k:i("missing '}'")}function P(){f();const _=[];let k;for(;k=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)_.push(k[1]),a(/^,\s*/);if(_.length)return{type:"keyframe",values:_,declarations:p()}}function h(){let _=a(/^@([-\w]+)?keyframes\s*/);if(!_)return;const k=_[1];if(_=a(/^([-\w]+)\s*/),!_)return i("@keyframes missing name");const B=_[1];if(!l())return i("@keyframes missing '{'");let L,N=m();for(;L=P();)N.push(L),N=N.concat(m());return s()?{type:"keyframes",name:B,vendor:k,keyframes:N}:i("@keyframes missing '}'")}function w(){if(a(/^@page */)){const k=g()||[];return{type:"page",selectors:k,declarations:p()}}}function T(){const _=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(_){const k=`${_[1]}-${_[2]}`+(_[3]?`-${_[3]}`:"");return{type:"page-margin-box",name:k,declarations:p()}}}function c(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:p()}}function S(){const _=a(/^@supports *([^{]+)/);if(_)return{type:"supports",supports:_[1].trim(),rules:z()}}function F(){if(a(/^@host\s*/))return{type:"host",rules:z()}}function O(){const _=a(/^@media([^{]+)*/);if(_)return{type:"media",media:(_[1]||"").trim(),rules:z()}}function I(){const _=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(_)return{type:"custom-media",name:_[1].trim(),media:_[2].trim()}}function R(){const _=a(/^@([-\w]+)?document *([^{]+)/);if(_)return{type:"document",document:_[2].trim(),vendor:_[1]?_[1].trim():null,rules:z()}}function G(){const _=a(/^@(import|charset|namespace)\s*([^;]+);/);if(_)return{type:_[1],name:_[2].trim()}}function re(){if(f(),t[0]==="@"){const _=G()||c()||O()||h()||S()||R()||I()||F()||w()||T();if(_&&!r.preserveStatic){let k=!1;return _.declarations?k=_.declarations.some(B=>/var\(/.test(B.value)):k=(_.keyframes||_.rules||[]).some(L=>(L.declarations||[]).some(N=>/var\(/.test(N.value))),k?_:{}}return _}}function A(){if(!r.preserveStatic){const B=Oi("{","}",t);if(B){const L=/:(?:root|host)(?![.:#(])/.test(B.pre)&&/--\S*\s*:/.test(B.body),N=/var\(/.test(B.body);if(!L&&!N)return t=t.slice(B.end+1),{}}}const _=g()||[],k=r.preserveStatic?p():p().filter(B=>{const L=_.some(ee=>/:(?:root|host)(?![.:#(])/.test(ee))&&/^--\S/.test(B.property),N=/var\(/.test(B.value);return L||N});return _.length||i("selector missing"),{type:"rule",selectors:_,declarations:k}}function z(_){if(!_&&!l())return i("missing '{'");let k,B=m();for(;t.length&&(_||t[0]!=="}")&&(k=re()||A());)k.type&&B.push(k),B=B.concat(m());return!_&&!s()?i("missing '}'"):B}return{type:"stylesheet",stylesheet:{rules:z(!0),errors:o}}}function zi(t,e="",n){const r={charset(i){return"@charset "+i.name+";"},comment(i){return i.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+i.comment+"*/":""},"custom-media"(i){return"@custom-media "+i.name+" "+i.media+";"},declaration(i){return i.property+":"+i.value+";"},document(i){return"@"+(i.vendor||"")+"document "+i.document+"{"+o(i.rules)+"}"},"font-face"(i){return"@font-face{"+o(i.declarations)+"}"},host(i){return"@host{"+o(i.rules)+"}"},import(i){return"@import "+i.name+";"},keyframe(i){return i.values.join(",")+"{"+o(i.declarations)+"}"},keyframes(i){return"@"+(i.vendor||"")+"keyframes "+i.name+"{"+o(i.keyframes)+"}"},media(i){return"@media "+i.media+"{"+o(i.rules)+"}"},namespace(i){return"@namespace "+i.name+";"},page(i){return"@page "+(i.selectors.length?i.selectors.join(", "):"")+"{"+o(i.declarations)+"}"},"page-margin-box"(i){return"@"+i.name+"{"+o(i.declarations)+"}"},rule(i){const a=i.declarations;if(a.length)return i.selectors.join(",")+"{"+o(a)+"}"},supports(i){return"@supports "+i.supports+"{"+o(i.rules)+"}"}};function o(i){let a="";for(let l=0;l<i.length;l++){const s=i[l];n&&n(s);const f=r[s.type](s);f&&(a+=f,f.length&&s.selectors&&(a+=e))}return a}return o(t.stylesheet.rules)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const Li=/\s?html\s?/gi,Gi=/\s?body\s?/gi;function Ni(t,e){const r=Ri(t.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(i=>Li.test(i)||Gi.test(i)));return r.forEach(o=>{const i={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new Wi(o.declarations,i);o.declarations.forEach(l=>{Qt(i,qi(l)),Qt(i,Xi(l)),Qt(i,a.convert(l))}),Object.entries(i).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),r.push(ji()),r.forEach(o=>{o.selectors=Hi(o.selectors,e)}),zi({stylesheet:{rules:r},type:"stylesheet"})}function Hi(t,e){return t.map(n=>`${e} ${n}`)}function Qt(t,e){return e&&(t[e.key]=e.value),t}function qi(t){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(t.property);if(e)return{key:e[1],value:t.value}}function Xi(t){if(t.property==="font-family"){let e=t.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:t.property,value:e}}}class Wi{constructor(e,n){this.ruleDeclarations=e,this.newDeclarations=n}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(n=>n.type==="declaration"&&n.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function ji(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Yi(t,e,n){return Bi(t,n).pipe(_e(r=>({htmlContent:r,styleSheet:Ni(t,e)})))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Ki(t){return new je(e=>t.subscribe(n=>{e.next(n)}))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Mt(t=Qn){return e=>t?e:$n}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function En(t,e,n){return r=>new je(o=>{const i=t();return r.pipe(Xn(Ht),kr(()=>n(i))).subscribe({next:a=>{e(a,i),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Ui(t,e,n,r,o,i,a,l,s){switch(e[t.code]){case qe.BOOKMARK:return n(),!0;case qe.JUMP_TO_BOOKMARK:return r(),!0;case qe.AUTO_SCROLL_TOGGLE:return i==null||i.toggle(),!0;case qe.AUTO_SCROLL_INCREASE:return o(1),!0;case qe.AUTO_SCROLL_DECREASE:return o(-1),!0;case qe.NEXT_PAGE:return a==null||a.nextPage(),!0;case qe.PREV_PAGE:return a==null||a.prevPage(),!0;case qe.PREV_CHAPTER:return s(l?1:-1),!0;case qe.NEXT_CHAPTER:return s(l?-1:1),!0;default:return!1}}function Bn(t){let e,n,r,o,i,a;return n=new Ge({props:{icon:Ao}}),{c(){e=J("div"),ke(n.$$.fragment),this.h()},l(l){e=Q(l,"DIV",{role:!0,class:!0});var s=Z(e);pe(n.$$.fragment,s),s.forEach(E),this.h()},h(){j(e,"role","button"),j(e,"class",r="flex h-full items-center text-xl xl:text-lg "+Pt+" "+Ft+" cursor-pointer")},m(l,s){H(l,e,s),be(n,e,null),o=!0,i||(a=ve(e,"click",t[5]),i=!0)},p:lt,i(l){o||(K(n.$$.fragment,l),o=!0)},o(l){$(n.$$.fragment,l),o=!1},d(l){l&&E(e),Ce(n),i=!1,a()}}}function Ji(t){let e,n,r,o,i,a,l,s,f,d,m,g,u,p,P,h,w,T,c,S,F;o=new Ge({props:{icon:t[2]?xt:kn}});let O=t[1]&&Bn(t);return p=new Ge({props:{icon:Bo}}),T=new Ge({props:{icon:Do}}),{c(){e=J("div"),n=J("div"),r=J("div"),ke(o.$$.fragment),i=ne(),a=J("div"),l=se(t[0]),s=se("x"),f=ne(),d=J("div"),O&&O.c(),m=ne(),g=J("a"),u=J("span"),ke(p.$$.fragment),P=ne(),h=J("a"),w=J("span"),ke(T.$$.fragment),this.h()},l(I){e=Q(I,"DIV",{class:!0});var R=Z(e);n=Q(R,"DIV",{class:!0});var G=Z(n);r=Q(G,"DIV",{class:!0,role:!0});var re=Z(r);pe(o.$$.fragment,re),re.forEach(E),i=oe(G),a=Q(G,"DIV",{class:!0});var A=Z(a);l=ue(A,t[0]),s=ue(A,"x"),A.forEach(E),G.forEach(E),f=oe(R),d=Q(R,"DIV",{class:!0});var z=Z(d);O&&O.l(z),m=oe(z),g=Q(z,"A",{href:!0});var _=Z(g);u=Q(_,"SPAN",{class:!0});var k=Z(u);pe(p.$$.fragment,k),k.forEach(E),_.forEach(E),P=oe(z),h=Q(z,"A",{href:!0});var B=Z(h);w=Q(B,"SPAN",{class:!0});var L=Z(w);pe(T.$$.fragment,L),L.forEach(E),B.forEach(E),z.forEach(E),R.forEach(E),this.h()},h(){j(r,"class","flex h-full items-center text-xl xl:text-lg "+Pt+" "+Ft+" cursor-pointer"),j(r,"role","button"),j(a,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg"),j(n,"class","flex transform-gpu "+Io),j(u,"class","flex h-full items-center text-xl xl:text-lg "+Pt+" "+Ft+" cursor-pointer"),j(g,"href","/ebook-reader/settings"),j(w,"class","flex h-full items-center text-xl xl:text-lg "+Pt+" "+Ft+" cursor-pointer"),j(h,"href","/ebook-reader/manage"),j(d,"class","flex transform-gpu "+To),j(e,"class","flex h-12 justify-between bg-gray-700 px-4 text-white md:px-8 xl:h-10")},m(I,R){H(I,e,R),Y(e,n),Y(n,r),be(o,r,null),Y(n,i),Y(n,a),Y(a,l),Y(a,s),Y(e,f),Y(e,d),O&&O.m(d,null),Y(d,m),Y(d,g),Y(g,u),be(p,u,null),Y(d,P),Y(d,h),Y(h,w),be(T,w,null),c=!0,S||(F=[ve(r,"click",t[4]),ve(g,"click",t[6]),ve(h,"click",t[7])],S=!0)},p(I,[R]){const G={};R&4&&(G.icon=I[2]?xt:kn),o.$set(G),(!c||R&1)&&Fe(l,I[0]),I[1]?O?(O.p(I,R),R&2&&K(O,1)):(O=Bn(I),O.c(),K(O,1),O.m(d,m)):O&&(Ye(),$(O,1,1,()=>{O=null}),Ke())},i(I){c||(K(o.$$.fragment,I),K(O),K(p.$$.fragment,I),K(T.$$.fragment,I),c=!0)},o(I){$(o.$$.fragment,I),$(O),$(p.$$.fragment,I),$(T.$$.fragment,I),c=!1},d(I){I&&E(e),Ce(o),O&&O.d(),Ce(p),Ce(T),S=!1,pt(F)}}}function Qi(t,e,n){let{autoScrollMultiplier:r}=e,{showFullscreenButton:o}=e,{isBookmarkScreen:i}=e;const a=Lt(),l=()=>a("bookmarkClick"),s=()=>a("fullscreenClick"),f=()=>a("settingsClick"),d=()=>a("bookManagerClick");return t.$$set=m=>{"autoScrollMultiplier"in m&&n(0,r=m.autoScrollMultiplier),"showFullscreenButton"in m&&n(1,o=m.showFullscreenButton),"isBookmarkScreen"in m&&n(2,i=m.isBookmarkScreen)},[r,o,i,a,l,s,f,d]}class Zi extends Qe{constructor(e){super();Ze(this,e,Qi,Ji,xe,{autoScrollMultiplier:0,showFullscreenButton:1,isBookmarkScreen:2})}}function Dn(t,e,n){const r=t.slice();return r[15]=e[n],r}function In(t,e){let n,r,o=e[15].label+"",i,a,l,s,f=e[15].startCharacter+"",d,m,g,u;function p(){return e[12](e[15])}return{key:t,first:null,c(){n=J("div"),r=J("div"),i=se(o),l=ne(),s=J("div"),d=se(f),m=ne(),this.h()},l(P){n=Q(P,"DIV",{class:!0});var h=Z(n);r=Q(h,"DIV",{id:!0,class:!0});var w=Z(r);i=ue(w,o),w.forEach(E),l=oe(h),s=Q(h,"DIV",{});var T=Z(s);d=ue(T,f),T.forEach(E),m=oe(h),h.forEach(E),this.h()},h(){j(r,"id",a=`for${e[15].reference}`),j(r,"class","mr-4 cursor-pointer"),W(r,"opacity-30",e[15].progress===100&&e[15]!==e[1]),W(r,"hover:opacity-100",e[15].progress===100&&e[15]!==e[1]),W(r,"hover:opacity-60",e[15].progress<100||e[15]===e[1]),W(s,"opacity-30",e[15].progress===100&&e[15]!==e[1]),j(n,"class","my-6 flex justify-between"),this.first=n},m(P,h){H(P,n,h),Y(n,r),Y(r,i),Y(n,l),Y(n,s),Y(s,d),Y(n,m),g||(u=ve(r,"click",p),g=!0)},p(P,h){e=P,h&1&&o!==(o=e[15].label+"")&&Fe(i,o),h&1&&a!==(a=`for${e[15].reference}`)&&j(r,"id",a),h&3&&W(r,"opacity-30",e[15].progress===100&&e[15]!==e[1]),h&3&&W(r,"hover:opacity-100",e[15].progress===100&&e[15]!==e[1]),h&3&&W(r,"hover:opacity-60",e[15].progress<100||e[15]===e[1]),h&1&&f!==(f=e[15].startCharacter+"")&&Fe(d,f),h&3&&W(s,"opacity-30",e[15].progress===100&&e[15]!==e[1])},d(P){P&&E(n),g=!1,u()}}}function xi(t){let e,n,r,o,i,a,l,s,f,d,m,g,u=[],p=new Map,P,h,w,T,c,S,F,O,I,R;d=new Ge({props:{icon:Vo}});let G=t[0];const re=A=>A[15].reference;for(let A=0;A<G.length;A+=1){let z=Dn(t,G,A),_=re(z);p.set(_,u[A]=In(_,z))}return T=new Ge({props:{icon:Oo}}),F=new Ge({props:{icon:Ro}}),{c(){e=J("div"),n=J("div"),r=se("Chapter Progress: "),o=se(t[2]),i=se(" ("),a=se(t[3]),l=se("%)"),s=ne(),f=J("div"),ke(d.$$.fragment),m=ne(),g=J("div");for(let A=0;A<u.length;A+=1)u[A].c();P=ne(),h=J("div"),w=J("div"),ke(T.$$.fragment),c=ne(),S=J("div"),ke(F.$$.fragment),this.h()},l(A){e=Q(A,"DIV",{class:!0});var z=Z(e);n=Q(z,"DIV",{});var _=Z(n);r=ue(_,"Chapter Progress: "),o=ue(_,t[2]),i=ue(_," ("),a=ue(_,t[3]),l=ue(_,"%)"),_.forEach(E),s=oe(z),f=Q(z,"DIV",{class:!0});var k=Z(f);pe(d.$$.fragment,k),k.forEach(E),z.forEach(E),m=oe(A),g=Q(A,"DIV",{class:!0});var B=Z(g);for(let X=0;X<u.length;X+=1)u[X].l(B);B.forEach(E),P=oe(A),h=Q(A,"DIV",{class:!0});var L=Z(h);w=Q(L,"DIV",{class:!0});var N=Z(w);pe(T.$$.fragment,N),N.forEach(E),c=oe(L),S=Q(L,"DIV",{class:!0});var ee=Z(S);pe(F.$$.fragment,ee),ee.forEach(E),L.forEach(E),this.h()},h(){j(f,"class","cursor-pointer"),j(e,"class","flex justify-between p-4"),j(g,"class","flex-1 overflow-auto p-4"),j(w,"class","cursor-pointer"),W(w,"opacity-30",!t[5]),j(S,"class","cursor-pointer"),W(S,"opacity-30",!t[4]),j(h,"class","flex justify-between px-4 py-6")},m(A,z){H(A,e,z),Y(e,n),Y(n,r),Y(n,o),Y(n,i),Y(n,a),Y(n,l),Y(e,s),Y(e,f),be(d,f,null),H(A,m,z),H(A,g,z);for(let _=0;_<u.length;_+=1)u[_].m(g,null);H(A,P,z),H(A,h,z),Y(h,w),be(T,w,null),Y(h,c),Y(h,S),be(F,S,null),O=!0,I||(R=[ve(f,"click",t[11]),ve(w,"click",t[13]),ve(S,"click",t[14])],I=!0)},p(A,[z]){(!O||z&4)&&Fe(o,A[2]),(!O||z&8)&&Fe(a,A[3]),z&131&&(G=A[0],u=So(u,z,re,1,A,G,p,g,yo,In,null,Dn)),z&32&&W(w,"opacity-30",!A[5]),z&16&&W(S,"opacity-30",!A[4])},i(A){O||(K(d.$$.fragment,A),K(T.$$.fragment,A),K(F.$$.fragment,A),O=!0)},o(A){$(d.$$.fragment,A),$(T.$$.fragment,A),$(F.$$.fragment,A),O=!1},d(A){A&&E(e),Ce(d),A&&E(m),A&&E(g);for(let z=0;z<u.length;z+=1)u[z].d();A&&E(P),A&&E(h),Ce(T),Ce(F),I=!1,pt(R)}}}function $i(t,e){const[n,r]=e.reduce((o,i,a)=>(o[0]+=t[a]*i,o[1]+=i,o),[0,0]);return n/r}function Tn(t){!t||(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView())}function ea(t,e,n){let r,o,{sectionData:i=[]}=e,{exploredCharCount:a=0}=e,l=[],s,f=-1,d="0/0",m="0.00";Nn(()=>{s&&Tn(document.getElementById(`for${s.reference}`))});function g(T,c){if(T){const S=l[f+c];u(S.reference,!1)}}function u(T,c=!1){_t.next(T),c&&Je.next(!1)}const p=()=>Je.next(!1),P=T=>u(T.reference,!0),h=()=>g(r,-1),w=()=>g(o,1);return t.$$set=T=>{"sectionData"in T&&n(8,i=T.sectionData),"exploredCharCount"in T&&n(9,a=T.exploredCharCount)},t.$$.update=()=>{if(t.$$.dirty&1280&&i){const[T,c,S]=no(i),F=i.filter(O=>O.reference===S||O.parentChapter===S);n(3,m=$i(F.map(O=>O.progress),F.map(O=>O.charactersWeight)).toFixed(2)),n(0,l=T),n(10,f=c),n(1,s=T[f])}if(t.$$.dirty&1024&&n(5,r=!!f),t.$$.dirty&1025&&n(4,o=f<l.length-1),t.$$.dirty&514&&s){Tn(document.getElementById(`for${s.reference}`));const T=s.characters;n(2,d=`${Math.min(Math.max(a-s.startCharacter,0),T)} / ${T}`)}},[l,s,d,m,o,r,g,u,i,a,f,p,P,h,w]}class ta extends Qe{constructor(e){super();Ze(this,e,ea,xi,xe,{sectionData:8,exploredCharCount:9})}}const{document:Zt}=Gn;function An(t){let e,n,r,o,i,a,l,s;function f(m){t[55](m)}let d={showFullscreenButton:Dt.fullscreenEnabled,autoScrollMultiplier:t[15]};return t[3]!==void 0&&(d.isBookmarkScreen=t[3]),n=new Zi({props:d}),ie.push(()=>he(n,"isBookmarkScreen",f)),n.$on("fullscreenClick",t[53]),n.$on("bookmarkClick",t[51]),n.$on("bookManagerClick",t[52]),n.$on("settingsClick",t[51]),{c(){e=J("div"),ke(n.$$.fragment),this.h()},l(m){e=Q(m,"DIV",{class:!0});var g=Z(e);pe(n.$$.fragment,g),g.forEach(E),this.h()},h(){j(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(m,g){H(m,e,g),be(n,e,null),a=!0,l||(s=ln(o=Jn.call(null,e,t[56])),l=!0)},p(m,g){t=m;const u={};g[0]&32768&&(u.autoScrollMultiplier=t[15]),!r&&g[0]&8&&(r=!0,u.isBookmarkScreen=t[3],de(()=>r=!1)),n.$set(u),o&&Hn(o.update)&&g[0]&4&&o.update.call(null,t[56])},i(m){a||(K(n.$$.fragment,m),m&&qn(()=>{i||(i=dn(e,en,{y:-300,easing:$t},!0)),i.run(1)}),a=!0)},o(m){$(n.$$.fragment,m),m&&(i||(i=dn(e,en,{y:-300,easing:$t},!1)),i.run(0)),a=!1},d(m){m&&E(e),Ce(n),m&&i&&i.end(),l=!1,s()}}}function na(t){var r;let e=((r=t[37])!=null?r:"")+"",n;return{c(){n=se(e)},l(o){n=ue(o,e)},m(o,i){H(o,n,i)},p(o,i){var a;i[1]&64&&e!==(e=((a=o[37])!=null?a:"")+"")&&Fe(n,e)},i:lt,o:lt,d(o){o&&E(n)}}}function oa(t){var _,k,B,L,N,ee,X,U;let e,n,r,o,i,a,l,s,f,d,m,g=((_=t[34])!=null?_:"")+"",u,p,P=((k=t[35])!=null?k:"")+"",h,w,T=((B=t[36])!=null?B:"")+"",c,S;e=new Fi({props:{styleSheet:t[16].styleSheet}});function F(v){t[57](v)}function O(v){t[58](v)}function I(v){t[59](v)}function R(v){t[60](v)}function G(v){t[61](v)}function re(v){t[62](v)}function A(v){t[63](v)}let z={htmlContent:t[16].htmlContent,width:(L=t[17])!=null?L:0,height:(N=t[18])!=null?N:0,verticalMode:t[12],fontColor:(ee=t[19])==null?void 0:ee.fontColor,backgroundColor:t[20],hintFuriganaFontColor:(X=t[19])==null?void 0:X.hintFuriganaFontColor,hintFuriganaShadowColor:(U=t[19])==null?void 0:U.hintFuriganaShadowColor,fontSize:t[21],fontFamilyGroupOne:t[22],fontFamilyGroupTwo:t[23],hideSpoilerImage:t[24],hideFurigana:t[25],furiganaStyle:t[26],viewMode:t[27],secondDimensionMaxValue:t[28],firstDimensionMargin:t[29],autoPositionOnResize:t[30],avoidPageBreak:t[31],pageColumns:t[32],autoBookmark:t[33],multiplier:t[15]};return t[5]!==void 0&&(z.exploredCharCount=t[5]),t[6]!==void 0&&(z.bookCharCount=t[6]),t[3]!==void 0&&(z.isBookmarkScreen=t[3]),t[9]!==void 0&&(z.bookmarkData=t[9]),t[0]!==void 0&&(z.autoScroller=t[0]),t[7]!==void 0&&(z.bookmarkManager=t[7]),t[8]!==void 0&&(z.pageManager=t[8]),r=new yi({props:z}),ie.push(()=>he(r,"exploredCharCount",F)),ie.push(()=>he(r,"bookCharCount",O)),ie.push(()=>he(r,"isBookmarkScreen",I)),ie.push(()=>he(r,"bookmarkData",R)),ie.push(()=>he(r,"autoScroller",G)),ie.push(()=>he(r,"bookmarkManager",re)),ie.push(()=>he(r,"pageManager",A)),r.$on("bookmark",t[51]),{c(){ke(e.$$.fragment),n=ne(),ke(r.$$.fragment),m=ne(),u=se(g),p=ne(),h=se(P),w=ne(),c=se(T)},l(v){pe(e.$$.fragment,v),n=oe(v),pe(r.$$.fragment,v),m=oe(v),u=ue(v,g),p=oe(v),h=ue(v,P),w=oe(v),c=ue(v,T)},m(v,V){be(e,v,V),H(v,n,V),be(r,v,V),H(v,m,V),H(v,u,V),H(v,p,V),H(v,h,V),H(v,w,V),H(v,c,V),S=!0},p(v,V){var me,we,le,fe,Se,ye,Me,ge;const ae={};V[0]&65536&&(ae.styleSheet=v[16].styleSheet),e.$set(ae);const q={};V[0]&65536&&(q.htmlContent=v[16].htmlContent),V[0]&131072&&(q.width=(me=v[17])!=null?me:0),V[0]&262144&&(q.height=(we=v[18])!=null?we:0),V[0]&4096&&(q.verticalMode=v[12]),V[0]&524288&&(q.fontColor=(le=v[19])==null?void 0:le.fontColor),V[0]&1048576&&(q.backgroundColor=v[20]),V[0]&524288&&(q.hintFuriganaFontColor=(fe=v[19])==null?void 0:fe.hintFuriganaFontColor),V[0]&524288&&(q.hintFuriganaShadowColor=(Se=v[19])==null?void 0:Se.hintFuriganaShadowColor),V[0]&2097152&&(q.fontSize=v[21]),V[0]&4194304&&(q.fontFamilyGroupOne=v[22]),V[0]&8388608&&(q.fontFamilyGroupTwo=v[23]),V[0]&16777216&&(q.hideSpoilerImage=v[24]),V[0]&33554432&&(q.hideFurigana=v[25]),V[0]&67108864&&(q.furiganaStyle=v[26]),V[0]&134217728&&(q.viewMode=v[27]),V[0]&268435456&&(q.secondDimensionMaxValue=v[28]),V[0]&536870912&&(q.firstDimensionMargin=v[29]),V[0]&1073741824&&(q.autoPositionOnResize=v[30]),V[1]&1&&(q.avoidPageBreak=v[31]),V[1]&2&&(q.pageColumns=v[32]),V[1]&4&&(q.autoBookmark=v[33]),V[0]&32768&&(q.multiplier=v[15]),!o&&V[0]&32&&(o=!0,q.exploredCharCount=v[5],de(()=>o=!1)),!i&&V[0]&64&&(i=!0,q.bookCharCount=v[6],de(()=>i=!1)),!a&&V[0]&8&&(a=!0,q.isBookmarkScreen=v[3],de(()=>a=!1)),!l&&V[0]&512&&(l=!0,q.bookmarkData=v[9],de(()=>l=!1)),!s&&V[0]&1&&(s=!0,q.autoScroller=v[0],de(()=>s=!1)),!f&&V[0]&128&&(f=!0,q.bookmarkManager=v[7],de(()=>f=!1)),!d&&V[0]&256&&(d=!0,q.pageManager=v[8],de(()=>d=!1)),r.$set(q),(!S||V[1]&8)&&g!==(g=((ye=v[34])!=null?ye:"")+"")&&Fe(u,g),(!S||V[1]&16)&&P!==(P=((Me=v[35])!=null?Me:"")+"")&&Fe(h,P),(!S||V[1]&32)&&T!==(T=((ge=v[36])!=null?ge:"")+"")&&Fe(c,T)},i(v){S||(K(e.$$.fragment,v),K(r.$$.fragment,v),S=!0)},o(v){$(e.$$.fragment,v),$(r.$$.fragment,v),S=!1},d(v){Ce(e,v),v&&E(n),Ce(r,v),v&&E(m),v&&E(u),v&&E(p),v&&E(h),v&&E(w),v&&E(c)}}}function Vn(t){let e,n,r,o,i,a,l;return n=new ta({props:{sectionData:t[11],exploredCharCount:t[5]}}),{c(){e=J("div"),ke(n.$$.fragment),this.h()},l(s){e=Q(s,"DIV",{class:!0});var f=Z(e);pe(n.$$.fragment,f),f.forEach(E),this.h()},h(){var s,f;j(e,"class","writing-horizontal-tb fixed top-0 left-0 z-20 flex h-full w-full max-w-xl flex-col justify-between"),D(e,"color",(s=t[19])==null?void 0:s.fontColor,!1),D(e,"background-color",(f=t[19])==null?void 0:f.tocBackgroundColor,!1)},m(s,f){H(s,e,f),be(n,e,null),i=!0,a||(l=ln(r=Jn.call(null,e,t[64])),a=!0)},p(s,f){var m,g;t=s;const d={};f[0]&2048&&(d.sectionData=t[11]),f[0]&32&&(d.exploredCharCount=t[5]),n.$set(d),r&&Hn(r.update)&&f[0]&1024&&r.update.call(null,t[64]),f[0]&524288&&D(e,"color",(m=t[19])==null?void 0:m.fontColor,!1),f[0]&524288&&D(e,"background-color",(g=t[19])==null?void 0:g.tocBackgroundColor,!1)},i(s){i||(K(n.$$.fragment,s),s&&(o||qn(()=>{o=Fo(e,en,{x:-100,duration:100,easing:$t}),o.start()})),i=!0)},o(s){$(n.$$.fragment,s),i=!1},d(s){s&&E(e),Ce(n),a=!1,l()}}}function On(t){let e,n,r,o,i;return n=new Ge({props:{icon:zo}}),{c(){e=J("div"),ke(n.$$.fragment),this.h()},l(a){e=Q(a,"DIV",{class:!0});var l=Z(e);pe(n.$$.fragment,l),l.forEach(E),this.h()},h(){j(e,"class","flex h-full w-8 items-center justify-center text-lg")},m(a,l){H(a,e,l),be(n,e,null),r=!0,o||(i=ve(e,"click",Mo(t[65])),o=!0)},p:lt,i(a){r||(K(n.$$.fragment,a),r=!0)},o(a){$(n.$$.fragment,a),r=!1},d(a){a&&E(e),Ce(n),o=!1,i()}}}function Rn(t){let e,n,r,o,i,a=(t[5]/t[6]*100).toFixed(2)+"",l,s;return{c(){e=J("div"),n=se(t[5]),r=se(" / "),o=se(t[6]),i=se(" ("),l=se(a),s=se("%)"),this.h()},l(f){e=Q(f,"DIV",{class:!0});var d=Z(e);n=ue(d,t[5]),r=ue(d," / "),o=ue(d,t[6]),i=ue(d," ("),l=ue(d,a),s=ue(d,"%)"),d.forEach(E),this.h()},h(){j(e,"class","pr-2")},m(f,d){H(f,e,d),Y(e,n),Y(e,r),Y(e,o),Y(e,i),Y(e,l),Y(e,s)},p(f,d){d[0]&32&&Fe(n,f[5]),d[0]&64&&Fe(o,f[6]),d[0]&96&&a!==(a=(f[5]/f[6]*100).toFixed(2)+"")&&Fe(l,a)},d(f){f&&E(e)}}}function ra(t){var re,A,z,_;let e,n,r=((re=t[14])!=null?re:"")+"",o,i,a,l,s,f,d,m,g,u,p,P,h,w,T;Zt.title=e=mn((z=(A=t[13])==null?void 0:A.title)!=null?z:"");let c=t[2]&&An(t);const S=[oa,na],F=[];function O(k,B){return k[16]?0:1}f=O(t),d=F[f]=S[f](t);let I=t[1]&&Vn(t),R=((_=t[11])==null?void 0:_.length)&&On(t),G=t[4]&&t[6]&&Rn(t);return{c(){n=ne(),o=se(r),i=ne(),a=J("button"),l=ne(),c&&c.c(),s=ne(),d.c(),m=ne(),I&&I.c(),g=ne(),u=J("div"),p=J("div"),R&&R.c(),P=ne(),G&&G.c(),this.h()},l(k){Po('[data-svelte="svelte-rnuhm6"]',Zt.head).forEach(E),n=oe(k),o=ue(k,r),i=oe(k),a=Q(k,"BUTTON",{class:!0}),Z(a).forEach(E),l=oe(k),c&&c.l(k),s=oe(k),d.l(k),m=oe(k),I&&I.l(k),g=oe(k),u=Q(k,"DIV",{class:!0});var L=Z(u);p=Q(L,"DIV",{class:!0});var N=Z(p);R&&R.l(N),N.forEach(E),P=oe(L),G&&G.l(L),L.forEach(E),this.h()},h(){var k;j(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),j(p,"class","h-full"),j(u,"class","writing-horizontal-tb fixed bottom-0 left-0 z-10 flex h-8 w-full cursor-pointer items-center justify-between text-xs leading-none"),D(u,"color",(k=t[19])==null?void 0:k.tooltipTextFontColor,!1)},m(k,B){H(k,n,B),H(k,o,B),H(k,i,B),H(k,a,B),H(k,l,B),c&&c.m(k,B),H(k,s,B),F[f].m(k,B),H(k,m,B),I&&I.m(k,B),H(k,g,B),H(k,u,B),Y(u,p),R&&R.m(p,null),Y(u,P),G&&G.m(u,null),t[66](u),h=!0,w||(T=[ve(window,"keydown",t[50]),ve(a,"click",t[54]),ve(u,"click",t[67])],w=!0)},p(k,B){var N,ee,X,U,v;(!h||B[0]&8192)&&e!==(e=mn((ee=(N=k[13])==null?void 0:N.title)!=null?ee:""))&&(Zt.title=e),(!h||B[0]&16384)&&r!==(r=((X=k[14])!=null?X:"")+"")&&Fe(o,r),k[2]?c?(c.p(k,B),B[0]&4&&K(c,1)):(c=An(k),c.c(),K(c,1),c.m(s.parentNode,s)):c&&(Ye(),$(c,1,1,()=>{c=null}),Ke());let L=f;f=O(k),f===L?F[f].p(k,B):(Ye(),$(F[L],1,1,()=>{F[L]=null}),Ke(),d=F[f],d?d.p(k,B):(d=F[f]=S[f](k),d.c()),K(d,1),d.m(m.parentNode,m)),k[1]?I?(I.p(k,B),B[0]&2&&K(I,1)):(I=Vn(k),I.c(),K(I,1),I.m(g.parentNode,g)):I&&(Ye(),$(I,1,1,()=>{I=null}),Ke()),(U=k[11])!=null&&U.length?R?(R.p(k,B),B[0]&2048&&K(R,1)):(R=On(k),R.c(),K(R,1),R.m(p,null)):R&&(Ye(),$(R,1,1,()=>{R=null}),Ke()),k[4]&&k[6]?G?G.p(k,B):(G=Rn(k),G.c(),G.m(u,null)):G&&(G.d(1),G=null),B[0]&524288&&D(u,"color",(v=k[19])==null?void 0:v.tooltipTextFontColor,!1)},i(k){h||(K(c),K(d),K(I),K(R),h=!0)},o(k){$(c),$(d),$(I),$(R),h=!1},d(k){k&&E(n),k&&E(o),k&&E(i),k&&E(a),k&&E(l),c&&c.d(k),k&&E(s),F[f].d(k),k&&E(m),I&&I.d(k),k&&E(g),k&&E(u),R&&R.d(),G&&G.d(),t[66](null),w=!1,pt(T)}}}const zn="background-color",Ln="writing-mode";function ia(t,e,n){let r,o,i,a,l,s,f,d,m,g,u,p,P,h,w,T,c,S,F,O,I,R,G,re,A,z,_,k;x(t,Zo,C=>n(12,o=C)),x(t,Je,C=>n(1,i=C)),x(t,Jt,C=>n(15,s=C)),x(t,xo,C=>n(21,p=C)),x(t,$o,C=>n(22,P=C)),x(t,er,C=>n(23,h=C)),x(t,tr,C=>n(24,w=C)),x(t,nr,C=>n(25,T=C)),x(t,or,C=>n(26,c=C)),x(t,rr,C=>n(27,S=C)),x(t,ir,C=>n(28,F=C)),x(t,ar,C=>n(29,O=C)),x(t,lr,C=>n(30,I=C)),x(t,sr,C=>n(31,R=C)),x(t,ur,C=>n(32,G=C)),x(t,fr,C=>n(33,re=C));let B=!0,L=!1,N=!0,ee=0,X=0,U,v,V,ae=Promise.resolve(void 0),q;const me=qt(2500).pipe(Ue(()=>n(2,B=!1)),ot());x(t,me,C=>n(14,l=C));const we=ht(()=>Ki(Lo)).pipe(_e(C=>Number(C.url.searchParams.get("id"))),on({refCount:!0,bufferSize:1})),le=we.pipe(mt(C=>wt.getData(C)),rn());x(t,le,C=>n(13,a=C));const fe=le.pipe(Ue(C=>{C||Jo("/manage")}),ot());x(t,fe,C=>n(37,k=C));const Se=le.pipe(Ue(C=>{!C||n(9,ae=wt.getBookmark(C.id))}),ot());x(t,Se,C=>n(34,A=C));const ye=le.pipe(mt(C=>C?(un.next(C.sections||[]),Yi(C,".book-content",document)):dt),on({refCount:!0,bufferSize:1}));x(t,ye,C=>n(16,f=C));const Me=ht(()=>We(visualViewport,"resize")).pipe(rn()),ge=Me.pipe(nn(0),_e(()=>visualViewport.width),Mt());x(t,ge,C=>n(17,d=C));const Ve=Me.pipe(nn(0),_e(()=>visualViewport.height),Mt());x(t,Ve,C=>n(18,m=C));const ce=Ko.pipe(_e(C=>pr.get(C)),Gt(C=>!!C));x(t,ce,C=>n(19,g=C));const De=ce.pipe(_e(C=>C.backgroundColor));x(t,De,C=>n(20,u=C));const Oe=De.pipe(En(()=>document.body,(C,Te)=>Te.style.setProperty(zn,C),C=>C.style.removeProperty(zn)),ot(),Mt());x(t,Oe,C=>n(35,z=C));const Re=Uo.pipe(En(()=>document.documentElement,(C,Te)=>Te.style.setProperty(Ln,C),C=>C.style.removeProperty(Ln)),ot(),Mt());x(t,Re,C=>n(36,_=C));const Ne=ht(()=>Ot).pipe(_e(C=>[...C.values()]));x(t,Ne,C=>n(11,r=C));function $e(C){!Ui(C,Qo.getValue(),He,y,ut=>Jt.next(Jt.getValue()+ut),U,V,o,Ie)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),C.preventDefault())}function et(){let C;return we.subscribe(Te=>C=Te).unsubscribe(),C}async function He(){const C=et();if(!C||!v)return;const Te=v.formatBookmarkData(C);await wt.putBookmark(Te),n(9,ae=Promise.resolve(Te))}async function y(){const C=await ae;!C||!v||v.scrollToBookmark(C)}function M(){wt.deleteLastItem(),He()}function te(){if(!Dt.fullscreenElement){Dt.requestFullscreen(document.documentElement);return}Dt.exitFullscreen()}function Ie(C){if(!(r!=null&&r.length))return;const[Te,ut]=no(r);!ut&&C===-1||C===1&&ut===Te.length-1||_t.next(Te[ut+C].reference)}const Ee=()=>n(2,B=!0);function ze(C){L=C,n(3,L)}const vt=()=>n(2,B=!1);function Le(C){ee=C,n(5,ee)}function Wt(C){X=C,n(6,X)}function b(C){L=C,n(3,L)}function jt(C){ae=C,n(9,ae)}function Yt(C){U=C,n(0,U)}function so(C){v=C,n(7,v)}function uo(C){V=C,n(8,V)}const fo=({target:C})=>{C!==q&&Je.next(!1)},co=()=>Je.next(!0);function ho(C){ie[C?"unshift":"push"](()=>{q=C,n(10,q)})}const mo=()=>{i||n(4,N=!N)};return t.$$.update=()=>{t.$$.dirty[0]&3&&i&&(U==null||U.off())},[U,i,B,L,N,ee,X,v,V,ae,q,r,o,a,l,s,f,d,m,g,u,p,P,h,w,T,c,S,F,O,I,R,G,re,A,z,_,k,me,le,fe,Se,ye,ge,Ve,ce,De,Oe,Re,Ne,$e,He,M,te,Ee,ze,vt,Le,Wt,b,jt,Yt,so,uo,fo,co,ho,mo]}class ka extends Qe{constructor(e){super();Ze(this,e,ia,ra,xe,{},null,[-1,-1,-1])}}export{ka as default};
