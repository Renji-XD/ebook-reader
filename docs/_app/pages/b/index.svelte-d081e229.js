import{S as Xe,i as We,n as je,Q as Xn,k as Ze,R as Wn,f as G,E as ot,d as D,T as yt,u as jn,e as x,j as re,c as $,a as ee,l as ie,b as Y,s as P,w as we,x as Se,U as j,y as ve,L as Ee,q as U,o as Q,B as ye,V as Mt,W as jt,X as Sn,Y as te,J as oe,Z as vn,m as xe,p as $e,t as ke,g as pe,h as De,_ as W,$ as xt,a0 as se,a1 as ue,v as Yn,a2 as Kn,a3 as Un,a4 as $t,I as Jn}from"../../chunks/index-200ea95d.js";import{F as Qe,f as Qn,a as Nt,p as ht,o as mt,b as Zn,c as xn,n as $n,t as eo,d as to,q as en,e as tn}from"../../chunks/css-classes-44c08f55.js";import{p as no}from"../../chunks/stores-2840616d.js";import{d as oo,i as ro,m as dt,a as et,b as io,E as Yt,c as ao,f as lo,p as so,e as uo,g as He,o as at,s as pt,h as ge,j as Ft,F as _e,k as Gt,l as yn,t as Kt,n as Ht,q as qt,R as fo,r as Xt,V as gt,B as Ge,u as nn,v as st,w as co,x as ho,y as mo,z as go,A as zt,C as ko,D as po,G as bo,H as Co,I as _o,J as wo,K as So,L as vo,M as yo,N as Mo,O as Fo,P as Po,Q as Bo,S as Eo}from"../../chunks/format-page-title-db029841.js";import{S as Mn,_ as bt,a as rt,b as lt,c as Do,i as qe,O as Oe,n as Fn,d as To,B as Wt,e as Be,w as Io}from"../../chunks/store-9e108e48.js";import{m as Ao,c as it,o as Pn,b as Oo,f as Vo,a as on}from"../../chunks/index.es-efcd32b8.js";import{r as Ke,c as zo,a as Ro}from"../../chunks/use-click-outside-c6870518.js";import{t as Re}from"../../chunks/tap-67010267.js";import"../../chunks/singletons-d1fb5791.js";const Bn=!0;var nt={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,r=nt.delegate;r&&(e=r.requestAnimationFrame,n=r.cancelAnimationFrame);var o=e(function(i){n=void 0,t(i)});return new Mn(function(){return n==null?void 0:n(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=nt.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,bt([],rt(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=nt.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,bt([],rt(t)))},delegate:void 0},Lo=function(t){lt(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Mn),Ct={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Ct.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,bt([t,e],rt(n))):setInterval.apply(void 0,bt([t,e],rt(n)))},clearInterval:function(t){var e=Ct.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},En=function(t){lt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(i,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),Ct.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;Ct.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Do(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Lo),rn=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=oo.now,t}(),Dn=function(t){lt(e,t);function e(n,r){r===void 0&&(r=rn.now);var o=t.call(this,n,r)||this;return o.actions=[],o._active=!1,o._scheduled=void 0,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(rn),Pt=new Dn(En),No=Pt,Go=function(t){lt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o}return e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),o!==null&&o>0?t.prototype.requestAsyncId.call(this,n,r,o):(n.actions.push(this),n._scheduled||(n._scheduled=nt.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&o>0||o==null&&this.delay>0)return t.prototype.recycleAsyncId.call(this,n,r,o);n.actions.some(function(i){return i.id===r})||(nt.cancelAnimationFrame(r),n._scheduled=void 0)},e}(En),Ho=function(t){lt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var o=this.actions,i;n=n||o.shift();do if(i=n.execute(n.state,n.delay))break;while((n=o[0])&&n.id===r&&o.shift());if(this._active=!1,i){for(;(n=o[0])&&n.id===r&&o.shift();)n.unsubscribe();throw i}},e}(Dn),Bt=new Ho(Go);function qo(t){return t instanceof Date&&!isNaN(t)}var Xo=["addListener","removeListener"],Wo=["addEventListener","removeEventListener"],jo=["on","off"];function Le(t,e,n,r){if(qe(n)&&(r=n,n=void 0),r)return Le(t,e,n).pipe(Ao(r));var o=rt(Uo(t)?Wo.map(function(l){return function(s){return t[l](e,s,n)}}):Yo(t)?Xo.map(an(t,e)):Ko(t)?jo.map(an(t,e)):[],2),i=o[0],a=o[1];if(!i&&ro(t))return dt(function(l){return Le(l,e,n)})(et(t));if(!i)throw new TypeError("Invalid event target");return new Oe(function(l){var s=function(){for(var c=[],h=0;h<arguments.length;h++)c[h]=arguments[h];return l.next(1<c.length?c:c[0])};return i(s),function(){return a(s)}})}function an(t,e){return function(n){return function(r){return t[n](e,r)}}}function Yo(t){return qe(t.addListener)&&qe(t.removeListener)}function Ko(t){return qe(t.on)&&qe(t.off)}function Uo(t){return qe(t.addEventListener)&&qe(t.removeEventListener)}function Ut(t,e,n){t===void 0&&(t=0),n===void 0&&(n=No);var r=-1;return e!=null&&(io(e)?n=e:r=e),new Oe(function(o){var i=qo(t)?+t-n.now():t;i<0&&(i=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function Jo(t,e){return t===void 0&&(t=0),e===void 0&&(e=Pt),t<0&&(t=0),Ut(t,t,e)}function Et(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=so(t),r=uo(t,1/0),o=t;return o.length?o.length===1?et(o[0]):ao(r)(lo(o,n)):Yt}var Tn=new Oe(Fn),Qo=Array.isArray;function Zo(t){return t.length===1&&Qo(t[0])?t[0]:t}function xo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=Zo(t),t.length===1?et(t[0]):new Oe($o(t))}function $o(t){return function(e){for(var n=[],r=function(i){n.push(et(t[i]).subscribe(He(e,function(a){if(n){for(var l=0;l<n.length;l++)l!==i&&n[l].unsubscribe();n=null}e.next(a)})))},o=0;n&&!e.closed&&o<t.length;o++)r(o)}}function _t(t,e){return e===void 0&&(e=Pt),at(function(n,r){var o=null,i=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var c=i;i=null,r.next(c)}};function s(){var c=a+t,h=e.now();if(h<c){o=this.schedule(void 0,c-h),r.add(o);return}l()}n.subscribe(He(r,function(c){i=c,a=e.now(),o||(o=e.schedule(s,t),r.add(o))},function(){l(),r.complete()},void 0,function(){i=o=null}))})}function In(t,e){return e===void 0&&(e=To),t=t!=null?t:er,at(function(n,r){var o,i=!0;n.subscribe(He(r,function(a){var l=e(a);(i||!t(o,l))&&(i=!1,o=l,r.next(a))}))})}function er(t,e){return t===e}function tr(){return at(function(t,e){var n,r=!1;t.subscribe(He(e,function(o){var i=n;n=o,r&&e.next([i,o]),r=!0}))})}function Ae(t){return at(function(e,n){et(t).subscribe(He(n,function(){return n.complete()},Fn)),!n.closed&&e.subscribe(n)})}var An={leading:!0,trailing:!1};function nr(t,e){return e===void 0&&(e=An),at(function(n,r){var o=e.leading,i=e.trailing,a=!1,l=null,s=null,c=!1,h=function(){s==null||s.unsubscribe(),s=null,i&&(f(),c&&r.complete())},g=function(){s=null,c&&r.complete()},k=function(d){return s=et(t(d)).subscribe(He(r,h,g))},f=function(){if(a){a=!1;var d=l;l=null,r.next(d),!c&&k(d)}};n.subscribe(He(r,function(d){a=!0,l=d,!(s&&!s.closed)&&(o?f():k(d))},function(){c=!0,!(i&&a&&s&&!s.closed)&&r.complete()}))})}function or(t,e,n){e===void 0&&(e=Pt),n===void 0&&(n=An);var r=Ut(t,e);return nr(function(){return r},n)}function rr(t){let e,n;return{c(){e=new Xn,n=Ze(),this.h()},l(r){e=Wn(r),n=Ze(),this.h()},h(){e.a=n},m(r,o){e.m(t[0],r,o),G(r,n,o)},p(r,[o]){o&1&&e.p(r[0])},i:ot,o:ot,d(r){r&&D(n),r&&e.d()}}}function ir(t,e,n){let{html:r}=e;const o=yt();return jn(()=>{o("load")}),t.$$set=i=>{"html"in i&&n(0,r=i.html)},[r]}class On extends Xe{constructor(e){super();We(this,e,ir,rr,je,{html:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Ue(t,e){return e==="rtl"?-t:t}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class ar{constructor(e,n,r){this.calculator=e,this.window=n,this.firstDimensionMargin=r}scrollToBookmark(e){const n=this.getBookmarkPosition(e);if(!n)return;const{scrollToData:r}=ln(n,this.firstDimensionMargin);this.window.scrollTo(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount,{verticalMode:o}=this.calculator,i=o?"scrollX":"scrollY";return{dataId:e,exploredCharCount:n,progress:n/r,[i]:this.window[i]}}getBookmarkBarPosition(e){const n=this.getBookmarkPosition(e);if(!!n)return ln(n,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:n}=this.calculator,r=this.getBookmarkTargetPosByScrollValue(e);if(r)return r;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return n?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:n}=e,r=o=>{const i=e[o];if(!i)return;const a=Ue(i,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===n)return{[o]:i}};return this.calculator.verticalMode?r("scrollX"):r("scrollY")}}function ln(t,e){return"scrollX"in t?{scrollToData:{left:t.scrollX},bookmarkPosData:{right:`${-t.scrollX+e}px`}}:{scrollToData:{top:t.scrollY},bookmarkPosData:{top:`${t.scrollY+e}px`}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function lr(t){const e=(n,r,o,i)=>{if(o<r)return t!=null?t:o;const a=Math.floor((r+o)/2);return n[a]===i?a:n[a]>i?e(n,r,a-1,i):e(n,a+1,o,i)};return(n,r)=>e(n,0,n.length-1,r)}const wt=lr(void 0);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Jt(t){return Array.from(t.classList).some(e=>e.includes("gaiji"))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Qt(t){return t instanceof HTMLImageElement?Jt(t):!1}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Vn(t){return Qt(t)?1:ur(t)}const sr=/[^0-9A-Z○◯々-〇〻ぁ-ゖゝ-ゞァ-ヺー０-９Ａ-Ｚｦ-ﾝ\p{Radical}\p{Unified_Ideograph}]+/gimu;function ur(t){return t.textContent?fr(t.textContent.replace(sr,"")):0}function fr(t){return Array.from(t).length}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function zn(t){return Rn(t,e=>!(e.nodeName==="RT"||e instanceof HTMLElement&&(e.attributes.getNamedItem("aria-hidden")||e.attributes.getNamedItem("hidden")))).filter(e=>{var n;return!!(Qt(e)||(n=e.textContent)!=null&&n.replace(/\s/g,"").length)})}function Rn(t,e){return!t.hasChildNodes()||!e(t)?[]:Array.from(t.childNodes).flatMap(n=>n.nodeType===Node.TEXT_NODE?[n]:Qt(n)?[n]:Rn(n,e)).filter(e)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Ln{constructor(e,n,r,o,i){this.containerEl=e,this.axis=n,this.direction=r,this.scrollEl=o,this.document=i,this.paragraphPosToAccCharCount=new Map,this.paragraphs=zn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=Vn(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const n=this.scrollEl.getBoundingClientRect(),r=Ue(this.verticalMode?n.right:n.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),i=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=this.getNodeBoundingRect(l),h=Ue(this.verticalMode?s.left:s.bottom,this.direction)-r-o+e;this.paragraphPos[a]=h;const g=i.get(h)||[];i.set(h,g),g.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(i.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(){return this.getCharCountByScrollPos(this.scrollPos)}getCharCountByScrollPos(e){const n=wt(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[n])||0}getScrollPosByCharCount(e){const n=wt(this.accumulatedCharCount,e);return Ue(this.paragraphPos[n],this.direction)}getNodeBoundingRect(e){const n=this.document.createRange();return n.selectNode(e),n.getBoundingClientRect()}get scrollPos(){return Ue(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function cr(t,e,n){const r=dr(e,n)(t,"scrollLeft");return(o,i,a)=>{if(!hr(o))return;const l=mr(o,i,a);r(-l),o.preventDefault()}}function hr(t){return!(!t.deltaY||t.deltaX||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)}function mr(t,e,n){switch(t.deltaMode){case 0:return t.deltaY;case 1:return t.deltaY*e*1.75;default:return t.deltaY*n}}function dr(t,e){return(n,r)=>{let o=!1,i=t[r],a=t[r];const l=()=>{o=!0;const s=Math.trunc((i-t[r])/n);if(t[r]!==a){o=!1;return}if(a+=s,t.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(i=t[r],a=t[r]),i+=s,o||e(l)}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class gr{constructor(e,n,r){this.verticalMode=e,this.firstDimensionMargin=n,this.window=r}nextPage(){this.scrollByPercent(.9)}prevPage(){this.scrollByPercent(-.9)}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let n=this.window.innerHeight,r="top",o=1;this.verticalMode&&(n=this.window.innerWidth,r="left",o=-1);const i=n-this.firstDimensionMargin*2;this.window.scrollBy({[r]:i*e*o,behavior:"smooth"})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class kr{constructor(e,n,r,o,i=Bt){this.multiplier=e,this.verticalMode=n,this.enabled$=new Wt(!1),this.enabled$.pipe(pt(a=>{if(!a)return Yt;let l=0;return Jo(0,i).pipe(ge(()=>Date.now()),tr(),ge(s=>this.calcNewPos(s)),ge(s=>{l+=s;const c=Math.trunc(l);return l-=c,c}),Ft(s=>s!==0))}),Ae(r)).subscribe(a=>{let l="top";n&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}calcNewPos([e,n]){let r=.00365956;return this.verticalMode&&(r=-91489e-8),r*this.multiplier*(n-e)}}const{document:pr,window:br}=Sn;function sn(t){let e,n,r,o,i;return{c(){e=x("div"),r=re(),o=x("div"),this.h()},l(a){e=$(a,"DIV",{class:!0,style:!0}),ee(e).forEach(D),r=ie(a),o=$(a,"DIV",{class:!0,style:!0}),ee(o).forEach(D),this.h()},h(){Y(e,"class","fixed z-[5]"),Y(e,"style",n=t[21]+": 100%; "+t[20]+": "+t[15]+"px; "+t[19][0]+": 0"),P(e,"background-color",t[5],!1),Y(o,"class","fixed z-[5]"),Y(o,"style",i=t[21]+": 100%; "+t[20]+": "+t[15]+"px; "+t[19][1]+": 0"),P(o,"background-color",t[5],!1)},m(a,l){G(a,e,l),G(a,r,l),G(a,o,l)},p(a,l){l[0]&3702784&&n!==(n=a[21]+": 100%; "+a[20]+": "+a[15]+"px; "+a[19][0]+": 0")&&Y(e,"style",n),l[0]&32&&P(e,"background-color",a[5],!1),l[0]&3702784&&i!==(i=a[21]+": 100%; "+a[20]+": "+a[15]+"px; "+a[19][1]+": 0")&&Y(o,"style",i),l[0]&32&&P(o,"background-color",a[5],!1)},d(a){a&&D(e),a&&D(r),a&&D(o)}}}function un(t){let e;function n(i,a){return i[3]?_r:Cr}let r=n(t),o=r(t);return{c(){o.c(),e=Ze()},l(i){o.l(i),e=Ze()},m(i,a){o.m(i,a),G(i,e,a)},p(i,a){r===(r=n(i))&&o?o.p(i,a):(o.d(1),o=r(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){o.d(i),i&&D(e)}}}function Cr(t){let e;return{c(){e=x("div"),this.h()},l(n){e=$(n,"DIV",{class:!0}),ee(e).forEach(D),this.h()},h(){Y(e,"class","absolute inset-x-0 h-12 bg-yellow-600 bg-opacity-10 pointer-events-none m-auto"),P(e,"width",`${t[14]||t[1]}px`,!1),P(e,"top",t[17].top,!1)},m(n,r){G(n,e,r)},p(n,r){r[0]&16386&&P(e,"width",`${n[14]||n[1]}px`,!1),r[0]&131072&&P(e,"top",n[17].top,!1)},d(n){n&&D(e)}}}function _r(t){let e;return{c(){e=x("div"),this.h()},l(n){e=$(n,"DIV",{class:!0}),ee(e).forEach(D),this.h()},h(){Y(e,"class","pointer-events-none absolute inset-y-0 m-auto w-12 bg-yellow-600 bg-opacity-10"),P(e,"height",`${t[18]||t[2]}px`,!1),P(e,"right",t[17].right,!1)},m(n,r){G(n,e,r)},p(n,r){r[0]&262148&&P(e,"height",`${n[18]||n[2]}px`,!1),r[0]&131072&&P(e,"right",n[17].right,!1)},d(n){n&&D(e)}}}function wr(t){let e,n,r=`${t[8]}px`,o=`${t[18]||t[2]}px`,i,a,l,s,c,h;n=new On({props:{html:t[0]}}),n.$on("load",t[24]);let g=t[15]&&sn(t),k=t[17]&&un(t);return{c(){e=x("div"),we(n.$$.fragment),i=re(),g&&g.c(),a=re(),k&&k.c(),l=re(),this.h()},l(f){e=$(f,"DIV",{class:!0});var d=ee(e);Se(n.$$.fragment,d),d.forEach(D),i=ie(f),g&&g.l(f),a=ie(f),k&&k.l(f),l=ie(f),this.h()},h(){Y(e,"class","book-content m-auto svelte-1tqbqao"),j(e,"book-content--writing-vertical-rl",t[3]),j(e,"book-content--writing-horizontal-rl",!t[3]),j(e,"book-content--hide-furigana",t[12]),j(e,"book-content--hide-spoiler-image",t[11]),j(e,"book-content--furigana-style-partial",t[13]===_e.Partial),j(e,"book-content--furigana-style-full",t[13]===_e.Full),j(e,"book-content--furigana-style-toggle",t[13]===_e.Toggle),P(e,"color",t[4],!1),P(e,"font-size",r,!1),P(e,"max-width",!t[3]&&t[14]?`${t[14]}px`:void 0,!1),P(e,"max-height",t[18]?`${t[18]}px`:void 0,!1),P(e,"padding-left",t[3]&&t[15]?`${t[15]}px`:void 0,!1),P(e,"padding-right",t[3]&&t[15]?`${t[15]}px`:void 0,!1),P(e,"padding-top",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),P(e,"padding-bottom",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),P(e,"--font-family-serif",t[9],!1),P(e,"--font-family-sans-serif",t[10],!1),P(e,"--book-content-hint-furigana-font-color",t[6],!1),P(e,"--book-content-hint-furigana-shadow-color",t[7],!1),P(e,"--book-content-child-height",o,!1)},m(f,d){G(f,e,d),ve(n,e,null),t[40](e),G(f,i,d),g&&g.m(f,d),G(f,a,d),k&&k.m(f,d),G(f,l,d),s=!0,c||(h=[Ee(br,"scroll",t[23]),Ee(pr.body,"wheel",t[22],{passive:!1})],c=!0)},p(f,d){const M={};d[0]&1&&(M.html=f[0]),n.$set(M),d[0]&8&&j(e,"book-content--writing-vertical-rl",f[3]),d[0]&8&&j(e,"book-content--writing-horizontal-rl",!f[3]),d[0]&4096&&j(e,"book-content--hide-furigana",f[12]),d[0]&2048&&j(e,"book-content--hide-spoiler-image",f[11]),d[0]&8192&&j(e,"book-content--furigana-style-partial",f[13]===_e.Partial),d[0]&8192&&j(e,"book-content--furigana-style-full",f[13]===_e.Full),d[0]&8192&&j(e,"book-content--furigana-style-toggle",f[13]===_e.Toggle),d[0]&16&&P(e,"color",f[4],!1),d[0]&256&&r!==(r=`${f[8]}px`)&&P(e,"font-size",r,!1),d[0]&16392&&P(e,"max-width",!f[3]&&f[14]?`${f[14]}px`:void 0,!1),d[0]&262144&&P(e,"max-height",f[18]?`${f[18]}px`:void 0,!1),d[0]&32776&&P(e,"padding-left",f[3]&&f[15]?`${f[15]}px`:void 0,!1),d[0]&32776&&P(e,"padding-right",f[3]&&f[15]?`${f[15]}px`:void 0,!1),d[0]&32776&&P(e,"padding-top",!f[3]&&f[15]?`${f[15]}px`:void 0,!1),d[0]&32776&&P(e,"padding-bottom",!f[3]&&f[15]?`${f[15]}px`:void 0,!1),d[0]&512&&P(e,"--font-family-serif",f[9],!1),d[0]&1024&&P(e,"--font-family-sans-serif",f[10],!1),d[0]&64&&P(e,"--book-content-hint-furigana-font-color",f[6],!1),d[0]&128&&P(e,"--book-content-hint-furigana-shadow-color",f[7],!1),d[0]&262148&&o!==(o=`${f[18]||f[2]}px`)&&P(e,"--book-content-child-height",o,!1),f[15]?g?g.p(f,d):(g=sn(f),g.c(),g.m(a.parentNode,a)):g&&(g.d(1),g=null),f[17]?k?k.p(f,d):(k=un(f),k.c(),k.m(l.parentNode,l)):k&&(k.d(1),k=null)},i(f){s||(U(n.$$.fragment,f),s=!0)},o(f){Q(n.$$.fragment,f),s=!1},d(f){f&&D(e),ye(n),t[40](null),f&&D(i),g&&g.d(f),f&&D(a),k&&k.d(f),f&&D(l),c=!1,Mt(h)}}}function Sr(t,e,n){let r,o,i,a,{htmlContent:l}=e,{width:s}=e,{height:c}=e,{verticalMode:h}=e,{fontColor:g}=e,{backgroundColor:k}=e,{hintFuriganaFontColor:f}=e,{hintFuriganaShadowColor:d}=e,{fontSize:M}=e,{fontFamilyGroupOne:p}=e,{fontFamilyGroupTwo:b}=e,{hideSpoilerImage:V}=e,{hideFurigana:u}=e,{furiganaStyle:y}=e,{secondDimensionMaxValue:v}=e,{firstDimensionMargin:I}=e,{autoPositionOnResize:A}=e,{autoBookmark:H}=e,{loadingState:F}=e,{multiplier:L}=e,{bookmarkData:J}=e,{exploredCharCount:N}=e,{bookCharCount:w}=e,{autoScroller:B}=e,{bookmarkManager:O}=e,{pageManager:R}=e;const q=yt();let X,K,ae={},_,T,fe,z,de,le=0,Z=!1;const me=cr(4,document.documentElement,requestAnimationFrame),be=new Be,Ce=new Be,ce=new Be;jt(()=>{ce.next(),ce.complete()}),_=new kr(L,h,ce,document),B=_,it([be,Ce]).pipe(Ft(()=>A),Gt(1),ge(([E,Me])=>h?Me:E),In(),_t(10),yn(Bt),Ae(ce)).subscribe(()=>{if(!K||!fe)return;const E=K.getScrollPosByCharCount(le);Z=!0,fe.scrollTo(E)});function Fe(E){E.updateParagraphPos(),n(25,N=E.calcExploredCharCount()),de&&(de=!1,J.then(Me=>{!Me||!O||O.scrollToBookmark(Me)}).finally(()=>{H&&Le(window,"scroll").pipe(Gt(1),_t(3e3),Ae(ce)).subscribe(()=>{q("bookmark")})})),n(36,ae={})}function he(E){h&&me(E,M,window.innerWidth)}function Pe(){requestAnimationFrame(()=>{!K||(n(25,N=K.calcExploredCharCount()),Z||(le=N),Z=!1)})}function Ve(){!X||(n(35,K=new Ln(X,h?"vertical":"horizontal",h?"rtl":"ltr",document.documentElement,document)),n(25,N=0),le=N,n(26,w=K.charCount),q("contentChange",X))}function Te(E){te[E?"unshift":"push"](()=>{X=E,n(16,X)})}return t.$$set=E=>{"htmlContent"in E&&n(0,l=E.htmlContent),"width"in E&&n(1,s=E.width),"height"in E&&n(2,c=E.height),"verticalMode"in E&&n(3,h=E.verticalMode),"fontColor"in E&&n(4,g=E.fontColor),"backgroundColor"in E&&n(5,k=E.backgroundColor),"hintFuriganaFontColor"in E&&n(6,f=E.hintFuriganaFontColor),"hintFuriganaShadowColor"in E&&n(7,d=E.hintFuriganaShadowColor),"fontSize"in E&&n(8,M=E.fontSize),"fontFamilyGroupOne"in E&&n(9,p=E.fontFamilyGroupOne),"fontFamilyGroupTwo"in E&&n(10,b=E.fontFamilyGroupTwo),"hideSpoilerImage"in E&&n(11,V=E.hideSpoilerImage),"hideFurigana"in E&&n(12,u=E.hideFurigana),"furiganaStyle"in E&&n(13,y=E.furiganaStyle),"secondDimensionMaxValue"in E&&n(14,v=E.secondDimensionMaxValue),"firstDimensionMargin"in E&&n(15,I=E.firstDimensionMargin),"autoPositionOnResize"in E&&n(30,A=E.autoPositionOnResize),"autoBookmark"in E&&n(31,H=E.autoBookmark),"loadingState"in E&&n(32,F=E.loadingState),"multiplier"in E&&n(33,L=E.multiplier),"bookmarkData"in E&&n(34,J=E.bookmarkData),"exploredCharCount"in E&&n(25,N=E.exploredCharCount),"bookCharCount"in E&&n(26,w=E.bookCharCount),"autoScroller"in E&&n(27,B=E.autoScroller),"bookmarkManager"in E&&n(28,O=E.bookmarkManager),"pageManager"in E&&n(29,R=E.pageManager)},t.$$.update=()=>{if(t.$$.dirty[0]&8&&n(21,r=h?"height":"width"),t.$$.dirty[0]&8&&n(20,o=h?"width":"height"),t.$$.dirty[0]&8&&n(19,i=h?["left","right"]:["top","bottom"]),t.$$.dirty[0]&2&&be.next(s),t.$$.dirty[0]&4&&Ce.next(c),t.$$.dirty[0]&16392&&n(18,a=h&&v?v:void 0),t.$$.dirty[0]&1&&l&&(de=!0),t.$$.dirty[0]&6|t.$$.dirty[1]&18&&K&&s&&c&&!F){const E=K;requestAnimationFrame(()=>{Fe(E)})}t.$$.dirty[0]&8|t.$$.dirty[1]&68&&_&&(n(37,_.multiplier=L,_),n(37,_.verticalMode=h,_)),t.$$.dirty[0]&32768|t.$$.dirty[1]&144&&K&&(n(38,T=K&&new ar(K,window,I||0)),n(28,O=T)),t.$$.dirty[1]&168&&ae&&(n(17,z=void 0),J.then(E=>{!E||n(17,z=T==null?void 0:T.getBookmarkBarPosition(E))})),t.$$.dirty[0]&32776|t.$$.dirty[1]&256&&(n(39,fe=new gr(h,I,window)),n(29,R=fe))},[l,s,c,h,g,k,f,d,M,p,b,V,u,y,v,I,X,z,a,i,o,r,he,Pe,Ve,N,w,B,O,R,A,H,F,L,J,K,ae,_,T,fe,Te]}class vr extends Xe{constructor(e){super();We(this,e,Sr,wr,je,{htmlContent:0,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,secondDimensionMaxValue:14,firstDimensionMargin:15,autoPositionOnResize:30,autoBookmark:31,loadingState:32,multiplier:33,bookmarkData:34,exploredCharCount:25,bookCharCount:26,autoScroller:27,bookmarkManager:28,pageManager:29},null,[-1,-1])}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const yr="px-4 md:px-8";/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function St(t,e=Bn){return e?t():Tn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Mr(t){const e=Array.from(t.getElementsByTagName("img"));return new Oe(n=>{const r=e.filter(i=>i.src).map(Fr);if(r.length<=0){n.next(!1),n.complete();return}const o=it(r).subscribe(()=>{n.next(!1),n.complete()});return n.next(!0),o})}function Fr(t){return t.complete?Pn(1):xo(Le(t,"load"),Le(t,"error"))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Pr(t,e){const n=Br(t),r=Dr(t);return o=>Et(n(o),Er(o,e),r(o))}function Br(t){return e=>{const n=Array.from(e.getElementsByTagName("a"));n.forEach(o=>{o.href=t.location.pathname+o.hash});const r=n.map(o=>vt(o).pipe(Re(()=>{const i=t.getElementById(o.hash.substring(1));i&&i.scrollIntoView()})));return Et(...r)}}function Er(t,e){const n=e===_e.Toggle,o=Array.from(t.getElementsByTagName("ruby")).map(i=>n?vt(i).pipe(Re(()=>{i.classList.toggle("reveal-rt")})):vt(i).pipe(Kt(1),Re(()=>{i.classList.add("reveal-rt")})));return Et(...o)}function Dr(t){return e=>{const r=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const i=t.createElement("span");return i.classList.add("spoiler-label"),i.setAttribute("aria-hidden","true"),i.innerText="\u30CD\u30BF\u30D0\u30EC",o.appendChild(i),vt(o).pipe(Kt(1),Re(()=>{o.removeChild(i),o.removeAttribute("data-ttu-spoiler-img")}))});return Et(...r)}}function vt(t){return Le(t,"click").pipe(Re(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const Tr=300,Ir=60,Nn="none";function tt(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function Ar(t,e){return e.filter(n=>t.pointerId!==n.pointerId)}function ut(t,e,n,r,o){t.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:n,pointersCount:r.length}}))}function Or(t,e,n,r,o,i=Nn){e.style.touchAction=i;let a=[];function l(c){a.push(c),ut(e,t,c,a,"down"),r==null||r(a,c);const h=c.pointerId;function g(b){h===b.pointerId&&(a=Ar(b,a),a.length||k(),ut(e,t,b,a,"up"),o==null||o(a,b))}function k(){f(),d(),M(),p()}const f=tt(e,"pointermove",b=>{a=a.map(V=>b.pointerId===V.pointerId?b:V),ut(e,t,b,a,"move"),n==null||n(a,b)}),d=tt(e,"lostpointercapture",b=>{g(b)}),M=tt(e,"pointerup",b=>{g(b)}),p=tt(e,"pointerleave",b=>{a=[],k(),ut(e,t,b,a,"up"),o==null||o(a,b)})}const s=tt(e,"pointerdown",l);return{destroy:()=>{s()}}}function Vr(t,e={timeframe:Tr,minSwipeDistance:Ir,touchAction:Nn}){const n="swipe";let r,o,i,a;function l(c,h){o=h.clientX,i=h.clientY,r=Date.now(),c.length===1&&(a=h.target)}function s(c,h){if(h.type==="pointerup"&&c.length===0&&Date.now()-r<e.timeframe){const g=h.clientX-o,k=h.clientY-i,f=Math.abs(g),d=Math.abs(k);let M=null;f>=2*d&&f>e.minSwipeDistance?M=g>0?"right":"left":d>=2*f&&d>e.minSwipeDistance&&(M=k>0?"bottom":"top"),M&&t.dispatchEvent(new CustomEvent(n,{detail:{direction:M,target:a}}))}}return Or(n,t,null,l,s,e.touchAction)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class zr{constructor(e,n,r,o,i,a,l,s,c,h,g){this.contentEl=e,this.scrollEl=n,this.sections=r,this.sectionIndex$=o,this.virtualScrollPos$=i,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=c,this.pageChange$=h,this.sectionRenderComplete$=g,this.translateX=0}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}flipPage(e){const n=this.verticalMode?"scrollHeight":"scrollWidth",r=this.verticalMode?this.height:this.width,o=r+this.pageGap,i=!0;if(this.translateX){const g=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const k=this.translateX;g(),this.scrollToPos(-k-o,i);return}if(this.nextSection(i)){g();return}return}const a=0,l=this.scrollEl[n],s=this.virtualScrollPos$.getValue(),c=s+o*e,h=Math.ceil(c);if(h<a){if(s!==a){this.scrollToPos(a,i);return}this.prevSection(o,n,r,i);return}if(h>=l){this.nextSection(i);return}this.scrollOrTranslateToPos(c,l,r,i)}scrollTo(e,n){const r=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[r],o,n)}prevSection(e,n,r,o){const i=this.sectionIndex$.getValue()-1;return i<0?!1:(this.updateSectionIndex(i).subscribe(()=>{const a=this.scrollEl[n];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,r,o)}),!0)}nextSection(e){const n=this.sectionIndex$.getValue()+1;return n>=this.sections.length?!1:(this.updateSectionIndex(n).subscribe(()=>{this.scrollToPos(0,e)}),!0)}scrollOrTranslateToPos(e,n,r,o){if(this.verticalMode){this.scrollToPos(e,o);return}if(e+r<=n){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,n){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(n)}translateXToPos(e,n){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(n)}updateSectionIndex(e){return new Oe(n=>{if(this.sectionIndex$.getValue()===e){n.next(),n.complete();return}const r=this.sectionRenderComplete$.subscribe(o=>{o===e&&n.next(),n.complete(),r.unsubscribe()});return this.sectionIndex$.next(e),r})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Rr{constructor(e,n,r,o,i,a,l,s,c){this.containerEl=e,this.sections=n,this.virtualScrollPos$=r,this.getWidth=o,this.getHeight=i,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=c,this.sectionIndex=-1;const h=k=>zn(k).reduce((d,M)=>d+Vn(M),0);let g=0;this.sectionAccCharCounts=n.map(k=>(g+=h(k),g)),this.charCount=g}updateCurrentSection(e){this.calculator=new Ln(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(){const e=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+e)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const n=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+n}getSectionIndexByCharCount(e){return wt(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const n=this.getSectionStartCount(),r=this.sectionAccCharCounts[this.sectionIndex],o=e-n,i=e===r&&r-n>0;if(o<0||e>r||i)return-1;if(o===0)return 0;const a=wt(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,c=l[a];if(Number.isNaN(Number(s[a])))return-1;const h=(M,p)=>M>=p?p:l[M]>c?M:h(M+1,p),g=s[h(a+1,l.length-1)],{screenSize:k}=this,f=this.verticalMode?-1:0,d=k*(Math.ceil(g/k)+f);return Ue(d,this.calculator.direction)}isCharOnScreen(e){const n=this.getScrollPosByCharCount(e),r=this.virtualScrollPos$.getValue();return n===r}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Lr{constructor(e,n,r,o,i){this.calculator=e,this.pageManager=n,this.sectionReady$=r,this.sectionIndex$=o,this.setIntendedCharCount=i}scrollToBookmark(e){const n=e.exploredCharCount;if(!n)return;const r=this.calculator.getSectionIndexByCharCount(n),o=l=>{const s=l.getScrollPosByCharCount(n);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(n)};if(this.sectionIndex$.getValue()===r){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount;return{dataId:e,exploredCharCount:n,progress:n/r}}}function fn(t){let e,n,r;return n=new Qe({props:{icon:Qn,spin:!0}}),{c(){e=x("div"),we(n.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var i=ee(e);Se(n.$$.fragment,i),i.forEach(D),this.h()},h(){Y(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),P(e,"color",t[4],!1),P(e,"background-color",t[5],!1)},m(o,i){G(o,e,i),ve(n,e,null),r=!0},p(o,i){i[0]&16&&P(e,"color",o[4],!1),i[0]&32&&P(e,"background-color",o[5],!1)},i(o){r||(U(n.$$.fragment,o),r=!0)},o(o){Q(n.$$.fragment,o),r=!1},d(o){o&&D(e),ye(n)}}}function cn(t){let e,n,r;return n=new Qe({props:{icon:Nt}}),{c(){e=x("div"),we(n.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var i=ee(e);Se(n.$$.fragment,i),i.forEach(D),this.h()},h(){Y(e,"class","fixed top-3 right-3 text-xl opacity-25"),P(e,"color",t[4],!1)},m(o,i){G(o,e,i),ve(n,e,null),r=!0},p(o,i){i[0]&16&&P(e,"color",o[4],!1)},i(o){r||(U(n.$$.fragment,o),r=!0)},o(o){Q(n.$$.fragment,o),r=!1},d(o){o&&D(e),ye(n)}}}function Nr(t){let e,n,r,o=`${t[8]}px`,i=`${t[1]}px`,a=`${t[2]}px`,l=`${t[3]?t[1]:(t[1]+Je)/t[20]-Je}px`,s,c,h,g,k,f;r=new On({props:{html:t[19]}}),r.$on("load",t[21]);let d=!t[18]&&fn(t),M=t[0]&&cn(t);return{c(){e=x("div"),n=x("div"),we(r.$$.fragment),s=re(),d&&d.c(),c=re(),M&&M.c(),h=Ze(),this.h()},l(p){e=$(p,"DIV",{class:!0});var b=ee(e);n=$(b,"DIV",{class:!0});var V=ee(n);Se(r.$$.fragment,V),V.forEach(D),b.forEach(D),s=ie(p),d&&d.l(p),c=ie(p),M&&M.l(p),h=Ze(),this.h()},h(){Y(n,"class","book-content-container svelte-np4m3j"),Y(e,"class","book-content m-auto svelte-np4m3j"),j(e,"book-content--avoid-page-break",t[14]),j(e,"book-content--writing-vertical-rl",t[3]),j(e,"book-content--writing-horizontal-rl",!t[3]),j(e,"book-content--hide-furigana",t[12]),j(e,"book-content--hide-spoiler-image",t[11]),j(e,"book-content--furigana-style-partial",t[13]===_e.Partial),j(e,"book-content--furigana-style-full",t[13]===_e.Full),j(e,"book-content--furigana-style-toggle",t[13]===_e.Toggle),P(e,"color",t[4],!1),P(e,"font-size",o,!1),P(e,"padding-top",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),P(e,"padding-bottom",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),P(e,"padding-left",t[3]&&t[15]?`${t[15]}px`:void 0,!1),P(e,"padding-right",t[3]&&t[15]?`${t[15]}px`:void 0,!1),P(e,"max-width",t[1]?`${t[1]}px`:void 0,!1),P(e,"max-height",t[3]&&t[2]?`${t[2]}px`:void 0,!1),P(e,"--font-family-serif",t[9],!1),P(e,"--font-family-sans-serif",t[10],!1),P(e,"--book-content-hint-furigana-font-color",t[6],!1),P(e,"--book-content-hint-furigana-shadow-color",t[7],!1),P(e,"--book-content-child-width",i,!1),P(e,"--book-content-child-height",a,!1),P(e,"--book-content-column-count",t[20],!1),P(e,"--book-content-image-max-width",l,!1)},m(p,b){G(p,e,b),oe(e,n),ve(r,n,null),t[36](n),t[37](e),G(p,s,b),d&&d.m(p,b),G(p,c,b),M&&M.m(p,b),G(p,h,b),g=!0,k||(f=[vn(Vr.call(null,e,{timeframe:500,minSwipeDistance:10,touchAction:"pan-y"})),Ee(e,"swipe",t[22])],k=!0)},p(p,b){const V={};b[0]&524288&&(V.html=p[19]),r.$set(V),b[0]&16384&&j(e,"book-content--avoid-page-break",p[14]),b[0]&8&&j(e,"book-content--writing-vertical-rl",p[3]),b[0]&8&&j(e,"book-content--writing-horizontal-rl",!p[3]),b[0]&4096&&j(e,"book-content--hide-furigana",p[12]),b[0]&2048&&j(e,"book-content--hide-spoiler-image",p[11]),b[0]&8192&&j(e,"book-content--furigana-style-partial",p[13]===_e.Partial),b[0]&8192&&j(e,"book-content--furigana-style-full",p[13]===_e.Full),b[0]&8192&&j(e,"book-content--furigana-style-toggle",p[13]===_e.Toggle),b[0]&16&&P(e,"color",p[4],!1),b[0]&256&&o!==(o=`${p[8]}px`)&&P(e,"font-size",o,!1),b[0]&32776&&P(e,"padding-top",!p[3]&&p[15]?`${p[15]}px`:void 0,!1),b[0]&32776&&P(e,"padding-bottom",!p[3]&&p[15]?`${p[15]}px`:void 0,!1),b[0]&32776&&P(e,"padding-left",p[3]&&p[15]?`${p[15]}px`:void 0,!1),b[0]&32776&&P(e,"padding-right",p[3]&&p[15]?`${p[15]}px`:void 0,!1),b[0]&2&&P(e,"max-width",p[1]?`${p[1]}px`:void 0,!1),b[0]&12&&P(e,"max-height",p[3]&&p[2]?`${p[2]}px`:void 0,!1),b[0]&512&&P(e,"--font-family-serif",p[9],!1),b[0]&1024&&P(e,"--font-family-sans-serif",p[10],!1),b[0]&64&&P(e,"--book-content-hint-furigana-font-color",p[6],!1),b[0]&128&&P(e,"--book-content-hint-furigana-shadow-color",p[7],!1),b[0]&2&&i!==(i=`${p[1]}px`)&&P(e,"--book-content-child-width",i,!1),b[0]&4&&a!==(a=`${p[2]}px`)&&P(e,"--book-content-child-height",a,!1),b[0]&1048576&&P(e,"--book-content-column-count",p[20],!1),b[0]&1048586&&l!==(l=`${p[3]?p[1]:(p[1]+Je)/p[20]-Je}px`)&&P(e,"--book-content-image-max-width",l,!1),p[18]?d&&(xe(),Q(d,1,1,()=>{d=null}),$e()):d?(d.p(p,b),b[0]&262144&&U(d,1)):(d=fn(p),d.c(),U(d,1),d.m(c.parentNode,c)),p[0]?M?(M.p(p,b),b[0]&1&&U(M,1)):(M=cn(p),M.c(),U(M,1),M.m(h.parentNode,h)):M&&(xe(),Q(M,1,1,()=>{M=null}),$e())},i(p){g||(U(r.$$.fragment,p),U(d),U(M),g=!0)},o(p){Q(r.$$.fragment,p),Q(d),Q(M),g=!1},d(p){p&&D(e),ye(r),t[36](null),t[37](null),p&&D(s),d&&d.d(p),p&&D(c),M&&M.d(p),p&&D(h),k=!1,Mt(f)}}}const hn="overflow-hidden",Je=20;function Gr(t,e,n){let r,{htmlContent:o}=e,{width:i}=e,{height:a}=e,{verticalMode:l}=e,{fontColor:s}=e,{backgroundColor:c}=e,{hintFuriganaFontColor:h}=e,{hintFuriganaShadowColor:g}=e,{fontSize:k}=e,{fontFamilyGroupOne:f}=e,{fontFamilyGroupTwo:d}=e,{hideSpoilerImage:M}=e,{hideFurigana:p}=e,{furiganaStyle:b}=e,{loadingState:V}=e,{bookmarkData:u}=e,{pageManager:y}=e,{bookmarkManager:v}=e,{exploredCharCount:I}=e,{bookCharCount:A}=e,{isBookmarkScreen:H=!1}=e,{avoidPageBreak:F=!0}=e,{pageColumns:L}=e,{firstDimensionMargin:J}=e,{autoBookmark:N=!1}=e;const w=yt();let B,O,R,q=[],X,K,ae,_=!1,T="",fe=!0,z=0;const de=new Be,le=new Be,Z=new Wt(-1),me=new Be,be=new Wt(0),Ce=new Be,ce=new Be,Fe=Z.pipe(ge(S=>{var ne;return((ne=q[S])==null?void 0:ne.innerHTML)||""})),he=new Be;jt(()=>{document.body.classList.remove(hn),he.next(),he.complete()}),it([de,le]).pipe(Gt(1),pt(()=>ce.pipe(Kt(1))),Ae(he)).subscribe(()=>{if(!R||!X)return;const S=R.getScrollPosByCharCount(z);S<0||X.scrollTo(S,!1)}),me.pipe(Ae(he)).subscribe(S=>{!R||(n(25,I=R.calcExploredCharCount()),S&&(z=I),u.then(Te))}),N&&me.pipe(_t(3e3),Ae(he)).subscribe(S=>{S&&w("bookmark")}),Fe.pipe(In(),Ae(he)).subscribe(()=>{n(18,_=!1)}),Fe.pipe(Ae(he)).subscribe(S=>{const ne=(ze,Ye)=>{if(Ye===0){ze();return}requestAnimationFrame(()=>ne(ze,Ye-1))};ne(()=>{n(19,T=S)},2)}),St(()=>Le(document.body,"wheel",{passive:!0})).pipe(or(50),Ae(he)).subscribe(S=>{let ne=(S.deltaX<0?-1:1)*(l?-1:1);S.deltaX||(ne=S.deltaY<0?-1:1),X==null||X.flipPage(ne)});function Pe(){if(fe){fe=!1;return}!B||(n(32,R=new Rr(B,q,be,()=>i,()=>a,()=>Je,l,B,document)),n(25,I=0),z=0,n(26,A=R.charCount),R.updateCurrentSection(Z.getValue()),w("contentChange",B))}function Ve(S){S.updateParagraphPos(),n(25,I=S.calcExploredCharCount()),ce.next(S),u.then(Te),ae&&(ae=!1,u.then(ne=>{!ne||!v||v.scrollToBookmark(ne)})),n(18,_=!0)}function Te(S){const ne=S==null?void 0:S.exploredCharCount;!R||!ne||n(0,H=R.isCharOnScreen(ne))}function E(S){if(!X||S.detail.direction!=="left"&&S.detail.direction!=="right")return;const ne=S.detail.direction==="left",ze=l?!ne:ne;X.flipPage(ze?1:-1)}function Me(S){te[S?"unshift":"push"](()=>{O=S,n(17,O)})}function Ne(S){te[S?"unshift":"push"](()=>{B=S,n(16,B)})}return t.$$set=S=>{"htmlContent"in S&&n(27,o=S.htmlContent),"width"in S&&n(1,i=S.width),"height"in S&&n(2,a=S.height),"verticalMode"in S&&n(3,l=S.verticalMode),"fontColor"in S&&n(4,s=S.fontColor),"backgroundColor"in S&&n(5,c=S.backgroundColor),"hintFuriganaFontColor"in S&&n(6,h=S.hintFuriganaFontColor),"hintFuriganaShadowColor"in S&&n(7,g=S.hintFuriganaShadowColor),"fontSize"in S&&n(8,k=S.fontSize),"fontFamilyGroupOne"in S&&n(9,f=S.fontFamilyGroupOne),"fontFamilyGroupTwo"in S&&n(10,d=S.fontFamilyGroupTwo),"hideSpoilerImage"in S&&n(11,M=S.hideSpoilerImage),"hideFurigana"in S&&n(12,p=S.hideFurigana),"furiganaStyle"in S&&n(13,b=S.furiganaStyle),"loadingState"in S&&n(28,V=S.loadingState),"bookmarkData"in S&&n(29,u=S.bookmarkData),"pageManager"in S&&n(23,y=S.pageManager),"bookmarkManager"in S&&n(24,v=S.bookmarkManager),"exploredCharCount"in S&&n(25,I=S.exploredCharCount),"bookCharCount"in S&&n(26,A=S.bookCharCount),"isBookmarkScreen"in S&&n(0,H=S.isBookmarkScreen),"avoidPageBreak"in S&&n(14,F=S.avoidPageBreak),"pageColumns"in S&&n(30,L=S.pageColumns),"firstDimensionMargin"in S&&n(15,J=S.firstDimensionMargin),"autoBookmark"in S&&n(31,N=S.autoBookmark)},t.$$.update=()=>{if(t.$$.dirty[0]&536870912&&u.then(Te),t.$$.dirty[0]&2&&i&&de.next(i),t.$$.dirty[0]&4&&a&&le.next(a),t.$$.dirty[0]&1073741834&&n(20,r=l?1:L||Math.ceil(i/1e3)),t.$$.dirty[0]&134217728&&o&&(ae=!0),t.$$.dirty[0]&134217728){const S=document.createElement("div");S.innerHTML=o,n(33,q=Array.from(S.children)),Z.next(0)}if(t.$$.dirty[0]&196622|t.$$.dirty[1]&12&&O&&B&&q&&(n(34,X=new zr(O,B,q,Z,be,i,a,Je,l,me,Ce)),n(23,y=X)),t.$$.dirty[0]&268435462|t.$$.dirty[1]&2&&R&&i&&a&&!V){const S=R;requestAnimationFrame(()=>{Ve(S)})}t.$$.dirty[0]&268435456|t.$$.dirty[1]&2&&R&&!V&&Ce.next(Z.getValue()),t.$$.dirty[1]&26&&R&&X&&(n(35,K=new Lr(R,X,ce,Z,S=>z=S)),n(24,v=K))},document.body.classList.add(hn),[H,i,a,l,s,c,h,g,k,f,d,M,p,b,F,J,B,O,_,T,r,Pe,E,y,v,I,A,o,V,u,L,N,R,q,X,K,Me,Ne]}class Hr extends Xe{constructor(e){super();We(this,e,Gr,Nr,je,{htmlContent:27,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,loadingState:28,bookmarkData:29,pageManager:23,bookmarkManager:24,exploredCharCount:25,bookCharCount:26,isBookmarkScreen:0,avoidPageBreak:14,pageColumns:30,firstDimensionMargin:15,autoBookmark:31},null,[-1,-1])}}function qr(t){var p,b,V;let e,n,r,o,i,a,l,s;function c(u){t[48](u)}function h(u){t[49](u)}function g(u){t[50](u)}function k(u){t[51](u)}function f(u){t[52](u)}function d(u){t[53](u)}let M={htmlContent:t[7],width:(p=t[28])!=null?p:0,height:(b=t[29])!=null?b:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],loadingState:(V=t[30])!=null?V:!0,avoidPageBreak:t[22],pageColumns:t[23],autoBookmark:t[24],firstDimensionMargin:t[20]};return t[0]!==void 0&&(M.exploredCharCount=t[0]),t[1]!==void 0&&(M.bookCharCount=t[1]),t[6]!==void 0&&(M.isBookmarkScreen=t[6]),t[2]!==void 0&&(M.bookmarkData=t[2]),t[4]!==void 0&&(M.bookmarkManager=t[4]),t[5]!==void 0&&(M.pageManager=t[5]),e=new Hr({props:M}),te.push(()=>se(e,"exploredCharCount",c)),te.push(()=>se(e,"bookCharCount",h)),te.push(()=>se(e,"isBookmarkScreen",g)),te.push(()=>se(e,"bookmarkData",k)),te.push(()=>se(e,"bookmarkManager",f)),te.push(()=>se(e,"pageManager",d)),e.$on("contentChange",t[54]),e.$on("bookmark",t[55]),{c(){we(e.$$.fragment)},l(u){Se(e.$$.fragment,u)},m(u,y){ve(e,u,y),s=!0},p(u,y){var I,A,H;const v={};y[0]&128&&(v.htmlContent=u[7]),y[0]&268435456&&(v.width=(I=u[28])!=null?I:0),y[0]&536870912&&(v.height=(A=u[29])!=null?A:0),y[0]&256&&(v.verticalMode=u[8]),y[0]&512&&(v.fontColor=u[9]),y[0]&1024&&(v.backgroundColor=u[10]),y[0]&2048&&(v.hintFuriganaFontColor=u[11]),y[0]&4096&&(v.hintFuriganaShadowColor=u[12]),y[0]&8192&&(v.fontSize=u[13]),y[0]&16384&&(v.fontFamilyGroupOne=u[14]),y[0]&32768&&(v.fontFamilyGroupTwo=u[15]),y[0]&65536&&(v.hideSpoilerImage=u[16]),y[0]&131072&&(v.hideFurigana=u[17]),y[0]&262144&&(v.furiganaStyle=u[18]),y[0]&1073741824&&(v.loadingState=(H=u[30])!=null?H:!0),y[0]&4194304&&(v.avoidPageBreak=u[22]),y[0]&8388608&&(v.pageColumns=u[23]),y[0]&16777216&&(v.autoBookmark=u[24]),y[0]&1048576&&(v.firstDimensionMargin=u[20]),!n&&y[0]&1&&(n=!0,v.exploredCharCount=u[0],ue(()=>n=!1)),!r&&y[0]&2&&(r=!0,v.bookCharCount=u[1],ue(()=>r=!1)),!o&&y[0]&64&&(o=!0,v.isBookmarkScreen=u[6],ue(()=>o=!1)),!i&&y[0]&4&&(i=!0,v.bookmarkData=u[2],ue(()=>i=!1)),!a&&y[0]&16&&(a=!0,v.bookmarkManager=u[4],ue(()=>a=!1)),!l&&y[0]&32&&(l=!0,v.pageManager=u[5],ue(()=>l=!1)),e.$set(v)},i(u){s||(U(e.$$.fragment,u),s=!0)},o(u){Q(e.$$.fragment,u),s=!1},d(u){ye(e,u)}}}function Xr(t){var p,b,V;let e,n,r,o,i,a,l,s;function c(u){t[40](u)}function h(u){t[41](u)}function g(u){t[42](u)}function k(u){t[43](u)}function f(u){t[44](u)}function d(u){t[45](u)}let M={htmlContent:t[7],width:(p=t[28])!=null?p:0,height:(b=t[29])!=null?b:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],secondDimensionMaxValue:t[19],firstDimensionMargin:t[20],autoPositionOnResize:t[21],autoBookmark:t[24],multiplier:t[26],loadingState:(V=t[30])!=null?V:!0};return t[0]!==void 0&&(M.exploredCharCount=t[0]),t[1]!==void 0&&(M.bookCharCount=t[1]),t[2]!==void 0&&(M.bookmarkData=t[2]),t[3]!==void 0&&(M.autoScroller=t[3]),t[4]!==void 0&&(M.bookmarkManager=t[4]),t[5]!==void 0&&(M.pageManager=t[5]),e=new vr({props:M}),te.push(()=>se(e,"exploredCharCount",c)),te.push(()=>se(e,"bookCharCount",h)),te.push(()=>se(e,"bookmarkData",g)),te.push(()=>se(e,"autoScroller",k)),te.push(()=>se(e,"bookmarkManager",f)),te.push(()=>se(e,"pageManager",d)),e.$on("contentChange",t[46]),e.$on("bookmark",t[47]),{c(){we(e.$$.fragment)},l(u){Se(e.$$.fragment,u)},m(u,y){ve(e,u,y),s=!0},p(u,y){var I,A,H;const v={};y[0]&128&&(v.htmlContent=u[7]),y[0]&268435456&&(v.width=(I=u[28])!=null?I:0),y[0]&536870912&&(v.height=(A=u[29])!=null?A:0),y[0]&256&&(v.verticalMode=u[8]),y[0]&512&&(v.fontColor=u[9]),y[0]&1024&&(v.backgroundColor=u[10]),y[0]&2048&&(v.hintFuriganaFontColor=u[11]),y[0]&4096&&(v.hintFuriganaShadowColor=u[12]),y[0]&8192&&(v.fontSize=u[13]),y[0]&16384&&(v.fontFamilyGroupOne=u[14]),y[0]&32768&&(v.fontFamilyGroupTwo=u[15]),y[0]&65536&&(v.hideSpoilerImage=u[16]),y[0]&131072&&(v.hideFurigana=u[17]),y[0]&262144&&(v.furiganaStyle=u[18]),y[0]&524288&&(v.secondDimensionMaxValue=u[19]),y[0]&1048576&&(v.firstDimensionMargin=u[20]),y[0]&2097152&&(v.autoPositionOnResize=u[21]),y[0]&16777216&&(v.autoBookmark=u[24]),y[0]&67108864&&(v.multiplier=u[26]),y[0]&1073741824&&(v.loadingState=(H=u[30])!=null?H:!0),!n&&y[0]&1&&(n=!0,v.exploredCharCount=u[0],ue(()=>n=!1)),!r&&y[0]&2&&(r=!0,v.bookCharCount=u[1],ue(()=>r=!1)),!o&&y[0]&4&&(o=!0,v.bookmarkData=u[2],ue(()=>o=!1)),!i&&y[0]&8&&(i=!0,v.autoScroller=u[3],ue(()=>i=!1)),!a&&y[0]&16&&(a=!0,v.bookmarkManager=u[4],ue(()=>a=!1)),!l&&y[0]&32&&(l=!0,v.pageManager=u[5],ue(()=>l=!1)),e.$set(v)},i(u){s||(U(e.$$.fragment,u),s=!0)},o(u){Q(e.$$.fragment,u),s=!1},d(u){ye(e,u)}}}function Wr(t){var g;let e,n,r,o,i=((g=t[31])!=null?g:"")+"",a,l;const s=[Xr,qr],c=[];function h(k,f){return k[25]===gt.Continuous?0:1}return n=h(t),r=c[n]=s[n](t),{c(){e=x("div"),r.c(),o=re(),a=ke(i),this.h()},l(k){e=$(k,"DIV",{class:!0});var f=ee(e);r.l(f),f.forEach(D),o=ie(k),a=pe(k,i),this.h()},h(){Y(e,"class",yr+" py-8")},m(k,f){G(k,e,f),c[n].m(e,null),t[56](e),G(k,o,f),G(k,a,f),l=!0},p(k,f){var M;let d=n;n=h(k),n===d?c[n].p(k,f):(xe(),Q(c[d],1,1,()=>{c[d]=null}),$e(),r=c[n],r?r.p(k,f):(r=c[n]=s[n](k),r.c()),U(r,1),r.m(e,null)),(!l||f[1]&1)&&i!==(i=((M=k[31])!=null?M:"")+"")&&De(a,i)},i(k){l||(U(r),l=!0)},o(k){Q(r),l=!1},d(k){k&&D(e),c[n].d(),t[56](null),k&&D(o),k&&D(a)}}}function ft(t){return Number(t.replace(/px$/,""))}function jr(t,e,n){let r,o,i,a,l,s,{htmlContent:c}=e,{width:h}=e,{height:g}=e,{verticalMode:k}=e,{fontColor:f}=e,{backgroundColor:d}=e,{hintFuriganaFontColor:M}=e,{hintFuriganaShadowColor:p}=e,{fontSize:b}=e,{fontFamilyGroupOne:V}=e,{fontFamilyGroupTwo:u}=e,{hideSpoilerImage:y}=e,{hideFurigana:v}=e,{furiganaStyle:I}=e,{secondDimensionMaxValue:A}=e,{firstDimensionMargin:H}=e,{autoPositionOnResize:F}=e,{avoidPageBreak:L}=e,{pageColumns:J}=e,{autoBookmark:N}=e,{viewMode:w}=e,{exploredCharCount:B}=e,{bookCharCount:O}=e,{multiplier:R}=e,{bookmarkData:q}=e,{autoScroller:X}=e,{bookmarkManager:K}=e,{pageManager:ae}=e,{isBookmarkScreen:_}=e;const T=new Be,fe=new Be,z=Io(null);W(t,z,m=>n(27,o=m));const de=it([z.pipe(Ft(m=>!!m)),it([T,fe]).pipe(Ht(0))]).pipe(_t(0,Bt),ge(([m])=>getComputedStyle(m)),qt({refCount:!0,bufferSize:1})),le=new fo(1),Z=de.pipe(ge(m=>ce(h-ft(m.paddingLeft)-ft(m.paddingRight))));W(t,Z,m=>n(28,i=m));const me=de.pipe(ge(m=>Fe(g-ft(m.paddingTop)-ft(m.paddingBottom)-r)));W(t,me,m=>n(29,a=m));const be=St(()=>Pn(document)).pipe(dt(m=>{const Zt=Pr(m,I);return le.pipe(dt(C=>Zt(C)))}),Ke());W(t,be,m=>n(31,s=m));const Ce=le.pipe(dt(m=>Mr(m)),Xt());W(t,Ce,m=>n(30,l=m));function ce(m){return gt.Paginated===w&&!k&&A?Math.min(A,m):m}function Fe(m){return gt.Paginated===w&&k&&A?Math.min(A,m):m}function he(m){B=m,n(0,B)}function Pe(m){O=m,n(1,O)}function Ve(m){q=m,n(2,q)}function Te(m){X=m,n(3,X)}function E(m){K=m,n(4,K)}function Me(m){ae=m,n(5,ae)}const Ne=m=>le.next(m.detail);function S(m){xt.call(this,t,m)}function ne(m){B=m,n(0,B)}function ze(m){O=m,n(1,O)}function Ye(m){_=m,n(6,_)}function Dt(m){q=m,n(2,q)}function Tt(m){K=m,n(4,K)}function It(m){ae=m,n(5,ae)}const At=m=>le.next(m.detail);function Ot(m){xt.call(this,t,m)}function Vt(m){te[m?"unshift":"push"](()=>{o=m,z.set(o)})}return t.$$set=m=>{"htmlContent"in m&&n(7,c=m.htmlContent),"width"in m&&n(38,h=m.width),"height"in m&&n(39,g=m.height),"verticalMode"in m&&n(8,k=m.verticalMode),"fontColor"in m&&n(9,f=m.fontColor),"backgroundColor"in m&&n(10,d=m.backgroundColor),"hintFuriganaFontColor"in m&&n(11,M=m.hintFuriganaFontColor),"hintFuriganaShadowColor"in m&&n(12,p=m.hintFuriganaShadowColor),"fontSize"in m&&n(13,b=m.fontSize),"fontFamilyGroupOne"in m&&n(14,V=m.fontFamilyGroupOne),"fontFamilyGroupTwo"in m&&n(15,u=m.fontFamilyGroupTwo),"hideSpoilerImage"in m&&n(16,y=m.hideSpoilerImage),"hideFurigana"in m&&n(17,v=m.hideFurigana),"furiganaStyle"in m&&n(18,I=m.furiganaStyle),"secondDimensionMaxValue"in m&&n(19,A=m.secondDimensionMaxValue),"firstDimensionMargin"in m&&n(20,H=m.firstDimensionMargin),"autoPositionOnResize"in m&&n(21,F=m.autoPositionOnResize),"avoidPageBreak"in m&&n(22,L=m.avoidPageBreak),"pageColumns"in m&&n(23,J=m.pageColumns),"autoBookmark"in m&&n(24,N=m.autoBookmark),"viewMode"in m&&n(25,w=m.viewMode),"exploredCharCount"in m&&n(0,B=m.exploredCharCount),"bookCharCount"in m&&n(1,O=m.bookCharCount),"multiplier"in m&&n(26,R=m.multiplier),"bookmarkData"in m&&n(2,q=m.bookmarkData),"autoScroller"in m&&n(3,X=m.autoScroller),"bookmarkManager"in m&&n(4,K=m.bookmarkManager),"pageManager"in m&&n(5,ae=m.pageManager),"isBookmarkScreen"in m&&n(6,_=m.isBookmarkScreen)},t.$$.update=()=>{t.$$.dirty[0]&34603264&&(r=H&&gt.Paginated===w&&!k?H*2:0),t.$$.dirty[1]&128&&T.next(h),t.$$.dirty[1]&256&&fe.next(g)},[B,O,q,X,K,ae,_,c,k,f,d,M,p,b,V,u,y,v,I,A,H,F,L,J,N,w,R,o,i,a,l,s,z,le,Z,me,be,Ce,h,g,he,Pe,Ve,Te,E,Me,Ne,S,ne,ze,Ye,Dt,Tt,It,At,Ot,Vt]}class Yr extends Xe{constructor(e){super();We(this,e,jr,Wr,je,{htmlContent:7,width:38,height:39,verticalMode:8,fontColor:9,backgroundColor:10,hintFuriganaFontColor:11,hintFuriganaShadowColor:12,fontSize:13,fontFamilyGroupOne:14,fontFamilyGroupTwo:15,hideSpoilerImage:16,hideFurigana:17,furiganaStyle:18,secondDimensionMaxValue:19,firstDimensionMargin:20,autoPositionOnResize:21,avoidPageBreak:22,pageColumns:23,autoBookmark:24,viewMode:25,exploredCharCount:0,bookCharCount:1,multiplier:26,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6},null,[-1,-1,-1])}}function Kr(t,e){const n=document.createTextNode(e);if(t.firstChild){t.replaceChild(n,t.firstChild);return}t.appendChild(n)}function Ur(t,e,n){let{styleSheet:r}=e,o;return Yn(()=>{n(1,o=document.createElement("style")),document.head.appendChild(o)}),jt(()=>{o&&document.head.removeChild(o)}),t.$$set=i=>{"styleSheet"in i&&n(0,r=i.styleSheet)},t.$$.update=()=>{t.$$.dirty&3&&o&&Kr(o,r)},[r,o]}class Jr extends Xe{constructor(e){super();We(this,e,Ur,null,je,{styleSheet:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Qr{constructor(e){this.document=e,this.fallbackSpec=mn(this.document)}get fullscreenEnabled(){var e;return(e=this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled"))!=null?e:!1}get fullscreenElement(){var e;return(e=this.fallbackSpec("fullscreenElement","webkitFullscreenElement"))!=null?e:null}async requestFullscreen(e,n){const r=mn(e)("requestFullscreen","webkitRequestFullscreen");!r||await r(n)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function mn(t){return(e,n)=>{var r;return(r=dn(t,e))!=null?r:dn(t,n)}}function dn(t,e){const n=t[e];return typeof n=="function"?n.bind(t):n}const kt=new Qr(document);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Zr(t,e){return xr(t).pipe(ge(n=>{const r=e.createElement("div");return r.innerHTML=n,$r(r),ei(r),ti(r,e),ni(r),r.innerHTML}))}function xr(t){return new Oe(e=>{const{blobs:n}=t;let{elementHtml:r}=t;const o=[];return Object.entries(n).forEach(([i,a])=>{const l=URL.createObjectURL(a);o.push(l),r=r.replaceAll(Oo(i),l).replaceAll(`ttu:${i}`,l)}),e.next(r),()=>{o.forEach(i=>URL.revokeObjectURL(i))}})}function $r(t){Array.from(t.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:Jt(e)})).forEach(({parentEl:e,isGaiji:n})=>{e==null||e.classList.add("ttu-img-container"),n||e==null||e.classList.add("ttu-illustration-container")})}function ei(t){Array.from(t.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function ti(t,e){const n=()=>{let o=[...t.children];const i=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return i>0&&i<o.length&&(o=o.slice(i)),o},r=(o,i)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||i).insertBefore(a,o),a.appendChild(o)};n().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(i=>!Jt(i)).forEach(i=>r(i,o)),Array.from(o.getElementsByTagName("svg")).filter(i=>i.getElementsByTagName("image").length).forEach(i=>r(i,o))})}function ni(t){t.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var oi=Gn;function Gn(t,e,n){t instanceof RegExp&&(t=gn(t,n)),e instanceof RegExp&&(e=gn(e,n));const r=Hn(t,e,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+t.length,r[1]),post:n.slice(r[1]+e.length)}}function gn(t,e){const n=e.match(t);return n?n[0]:null}Gn.range=Hn;function Hn(t,e,n){let r,o,i,a,l,s=n.indexOf(t),c=n.indexOf(e,s+1),h=s;if(s>=0&&c>0){if(t===e)return[s,c];for(r=[],i=n.length;h>=0&&!l;)h===s?(r.push(h),s=n.indexOf(t,h+1)):r.length===1?l=[r.pop(),c]:(o=r.pop(),o<i&&(i=o,a=c),c=n.indexOf(e,h+1)),h=s<c&&s>=0?s:c;r.length&&(l=[i,a])}return l}function ri(t,e={}){const r=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function i(w){throw new Error(`CSS parse error: ${w}`)}function a(w){const B=w.exec(t);if(B)return t=t.slice(B[0].length),B}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function c(){a(/^\s*/)}function h(){if(c(),t[0]!=="/"||t[1]!=="*")return;let w=2;for(;t[w]&&(t[w]!=="*"||t[w+1]!=="/");)w++;if(!t[w])return i("end of comment is missing");const B=t.slice(2,w);return t=t.slice(w+2),{type:"comment",comment:B}}function g(){const w=[];let B;for(;B=h();)w.push(B);return r.removeComments?[]:w}function k(){for(c();t[0]==="}";)i("extra closing bracket");const w=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(w)return w[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(B){return B.replace(/,/g,"\u200C")}).split(/\s*(?![^(]*\)),\s*/).map(function(B){return B.replace(/\u200C/g,",")})}function f(){if(t[0]==="@")return L();a(/^([;\s]*)+/);const w=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let B=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!B)return;if(B=B[0].trim(),!a(/^:\s*/))return i("property missing ':'");const O=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),R={type:"declaration",property:B.replace(w,""),value:O?O[0].replace(w,"").trim():""};return a(/^[;\s]*/),R}function d(){if(!l())return i("missing '{'");let w,B=g();for(;w=f();)B.push(w),B=B.concat(g());return s()?B:i("missing '}'")}function M(){c();const w=[];let B;for(;B=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)w.push(B[1]),a(/^,\s*/);if(w.length)return{type:"keyframe",values:w,declarations:d()}}function p(){let w=a(/^@([-\w]+)?keyframes\s*/);if(!w)return;const B=w[1];if(w=a(/^([-\w]+)\s*/),!w)return i("@keyframes missing name");const O=w[1];if(!l())return i("@keyframes missing '{'");let R,q=g();for(;R=M();)q.push(R),q=q.concat(g());return s()?{type:"keyframes",name:O,vendor:B,keyframes:q}:i("@keyframes missing '}'")}function b(){if(a(/^@page */)){const B=k()||[];return{type:"page",selectors:B,declarations:d()}}}function V(){const w=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(w){const B=`${w[1]}-${w[2]}`+(w[3]?`-${w[3]}`:"");return{type:"page-margin-box",name:B,declarations:d()}}}function u(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:d()}}function y(){const w=a(/^@supports *([^{]+)/);if(w)return{type:"supports",supports:w[1].trim(),rules:N()}}function v(){if(a(/^@host\s*/))return{type:"host",rules:N()}}function I(){const w=a(/^@media([^{]+)*/);if(w)return{type:"media",media:(w[1]||"").trim(),rules:N()}}function A(){const w=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(w)return{type:"custom-media",name:w[1].trim(),media:w[2].trim()}}function H(){const w=a(/^@([-\w]+)?document *([^{]+)/);if(w)return{type:"document",document:w[2].trim(),vendor:w[1]?w[1].trim():null,rules:N()}}function F(){const w=a(/^@(import|charset|namespace)\s*([^;]+);/);if(w)return{type:w[1],name:w[2].trim()}}function L(){if(c(),t[0]==="@"){const w=F()||u()||I()||p()||y()||H()||A()||v()||b()||V();if(w&&!r.preserveStatic){let B=!1;return w.declarations?B=w.declarations.some(O=>/var\(/.test(O.value)):B=(w.keyframes||w.rules||[]).some(R=>(R.declarations||[]).some(q=>/var\(/.test(q.value))),B?w:{}}return w}}function J(){if(!r.preserveStatic){const O=oi("{","}",t);if(O){const R=/:(?:root|host)(?![.:#(])/.test(O.pre)&&/--\S*\s*:/.test(O.body),q=/var\(/.test(O.body);if(!R&&!q)return t=t.slice(O.end+1),{}}}const w=k()||[],B=r.preserveStatic?d():d().filter(O=>{const R=w.some(X=>/:(?:root|host)(?![.:#(])/.test(X))&&/^--\S/.test(O.property),q=/var\(/.test(O.value);return R||q});return w.length||i("selector missing"),{type:"rule",selectors:w,declarations:B}}function N(w){if(!w&&!l())return i("missing '{'");let B,O=g();for(;t.length&&(w||t[0]!=="}")&&(B=L()||J());)B.type&&O.push(B),O=O.concat(g());return!w&&!s()?i("missing '}'"):O}return{type:"stylesheet",stylesheet:{rules:N(!0),errors:o}}}function ii(t,e="",n){const r={charset(i){return"@charset "+i.name+";"},comment(i){return i.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+i.comment+"*/":""},"custom-media"(i){return"@custom-media "+i.name+" "+i.media+";"},declaration(i){return i.property+":"+i.value+";"},document(i){return"@"+(i.vendor||"")+"document "+i.document+"{"+o(i.rules)+"}"},"font-face"(i){return"@font-face{"+o(i.declarations)+"}"},host(i){return"@host{"+o(i.rules)+"}"},import(i){return"@import "+i.name+";"},keyframe(i){return i.values.join(",")+"{"+o(i.declarations)+"}"},keyframes(i){return"@"+(i.vendor||"")+"keyframes "+i.name+"{"+o(i.keyframes)+"}"},media(i){return"@media "+i.media+"{"+o(i.rules)+"}"},namespace(i){return"@namespace "+i.name+";"},page(i){return"@page "+(i.selectors.length?i.selectors.join(", "):"")+"{"+o(i.declarations)+"}"},"page-margin-box"(i){return"@"+i.name+"{"+o(i.declarations)+"}"},rule(i){const a=i.declarations;if(a.length)return i.selectors.join(",")+"{"+o(a)+"}"},supports(i){return"@supports "+i.supports+"{"+o(i.rules)+"}"}};function o(i){let a="";for(let l=0;l<i.length;l++){const s=i[l];n&&n(s);const c=r[s.type](s);c&&(a+=c,c.length&&s.selectors&&(a+=e))}return a}return o(t.stylesheet.rules)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const ai=/\s?html\s?/gi,li=/\s?body\s?/gi;function si(t,e){const r=ri(t.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(i=>ai.test(i)||li.test(i)));return r.forEach(o=>{const i={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new hi(o.declarations,i);o.declarations.forEach(l=>{Rt(i,fi(l)),Rt(i,ci(l)),Rt(i,a.convert(l))}),Object.entries(i).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),r.push(mi()),r.forEach(o=>{o.selectors=ui(o.selectors,e)}),ii({stylesheet:{rules:r},type:"stylesheet"})}function ui(t,e){return t.map(n=>`${e} ${n}`)}function Rt(t,e){return e&&(t[e.key]=e.value),t}function fi(t){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(t.property);if(e)return{key:e[1],value:t.value}}function ci(t){if(t.property==="font-family"){let e=t.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:t.property,value:e}}}class hi{constructor(e,n){this.ruleDeclarations=e,this.newDeclarations=n}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(n=>n.type==="declaration"&&n.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function mi(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function di(t,e,n){return Zr(t,n).pipe(ge(r=>({htmlContent:r,styleSheet:si(t,e)})))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function gi(t){return new Oe(e=>t.subscribe(n=>{e.next(n)}))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ct(t=Bn){return e=>t?e:Tn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function kn(t,e,n){return r=>new Oe(o=>{const i=t();return r.pipe(yn(Bt),Vo(()=>n(i))).subscribe({next:a=>{e(a,i),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ki(t,e,n,r,o,i,a){switch(e[t.code]){case Ge.BOOKMARK:return n(),!0;case Ge.JUMP_TO_BOOKMARK:return r(),!0;case Ge.AUTO_SCROLL_TOGGLE:return i==null||i.toggle(),!0;case Ge.AUTO_SCROLL_INCREASE:return o(1),!0;case Ge.AUTO_SCROLL_DECREASE:return o(-1),!0;case Ge.NEXT_PAGE:return a==null||a.nextPage(),!0;case Ge.PREV_PAGE:return a==null||a.prevPage(),!0;default:return!1}}function pn(t){let e,n,r,o,i,a;return n=new Qe({props:{icon:to}}),{c(){e=x("div"),we(n.$$.fragment),this.h()},l(l){e=$(l,"DIV",{role:!0,class:!0});var s=ee(e);Se(n.$$.fragment,s),s.forEach(D),this.h()},h(){Y(e,"role","button"),Y(e,"class",r="flex h-full items-center text-xl xl:text-lg "+ht+" "+mt+" cursor-pointer")},m(l,s){G(l,e,s),ve(n,e,null),o=!0,i||(a=Ee(e,"click",t[5]),i=!0)},p:ot,i(l){o||(U(n.$$.fragment,l),o=!0)},o(l){Q(n.$$.fragment,l),o=!1},d(l){l&&D(e),ye(n),i=!1,a()}}}function pi(t){let e,n,r,o,i,a,l,s,c,h,g,k,f,d,M,p,b,V,u,y,v;o=new Qe({props:{icon:t[2]?Nt:on}});let I=t[1]&&pn(t);return d=new Qe({props:{icon:Zn}}),V=new Qe({props:{icon:xn}}),{c(){e=x("div"),n=x("div"),r=x("div"),we(o.$$.fragment),i=re(),a=x("div"),l=ke(t[0]),s=ke("x"),c=re(),h=x("div"),I&&I.c(),g=re(),k=x("a"),f=x("span"),we(d.$$.fragment),M=re(),p=x("a"),b=x("span"),we(V.$$.fragment),this.h()},l(A){e=$(A,"DIV",{class:!0});var H=ee(e);n=$(H,"DIV",{class:!0});var F=ee(n);r=$(F,"DIV",{class:!0,role:!0});var L=ee(r);Se(o.$$.fragment,L),L.forEach(D),i=ie(F),a=$(F,"DIV",{class:!0});var J=ee(a);l=pe(J,t[0]),s=pe(J,"x"),J.forEach(D),F.forEach(D),c=ie(H),h=$(H,"DIV",{class:!0});var N=ee(h);I&&I.l(N),g=ie(N),k=$(N,"A",{href:!0});var w=ee(k);f=$(w,"SPAN",{class:!0});var B=ee(f);Se(d.$$.fragment,B),B.forEach(D),w.forEach(D),M=ie(N),p=$(N,"A",{href:!0});var O=ee(p);b=$(O,"SPAN",{class:!0});var R=ee(b);Se(V.$$.fragment,R),R.forEach(D),O.forEach(D),N.forEach(D),H.forEach(D),this.h()},h(){Y(r,"class","flex h-full items-center text-xl xl:text-lg "+ht+" "+mt+" cursor-pointer"),Y(r,"role","button"),Y(a,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg"),Y(n,"class","flex transform-gpu "+$n),Y(f,"class","flex h-full items-center text-xl xl:text-lg "+ht+" "+mt+" cursor-pointer"),Y(k,"href","/ebook-reader/settings"),Y(b,"class","flex h-full items-center text-xl xl:text-lg "+ht+" "+mt+" cursor-pointer"),Y(p,"href","/ebook-reader/manage"),Y(h,"class","flex transform-gpu "+eo),Y(e,"class","flex h-12 justify-between bg-gray-700 px-4 text-white md:px-8 xl:h-10")},m(A,H){G(A,e,H),oe(e,n),oe(n,r),ve(o,r,null),oe(n,i),oe(n,a),oe(a,l),oe(a,s),oe(e,c),oe(e,h),I&&I.m(h,null),oe(h,g),oe(h,k),oe(k,f),ve(d,f,null),oe(h,M),oe(h,p),oe(p,b),ve(V,b,null),u=!0,y||(v=[Ee(r,"click",t[4]),Ee(k,"click",t[6]),Ee(p,"click",t[7])],y=!0)},p(A,[H]){const F={};H&4&&(F.icon=A[2]?Nt:on),o.$set(F),(!u||H&1)&&De(l,A[0]),A[1]?I?(I.p(A,H),H&2&&U(I,1)):(I=pn(A),I.c(),U(I,1),I.m(h,g)):I&&(xe(),Q(I,1,1,()=>{I=null}),$e())},i(A){u||(U(o.$$.fragment,A),U(I),U(d.$$.fragment,A),U(V.$$.fragment,A),u=!0)},o(A){Q(o.$$.fragment,A),Q(I),Q(d.$$.fragment,A),Q(V.$$.fragment,A),u=!1},d(A){A&&D(e),ye(o),I&&I.d(),ye(d),ye(V),y=!1,Mt(v)}}}function bi(t,e,n){let{autoScrollMultiplier:r}=e,{showFullscreenButton:o}=e,{isBookmarkScreen:i}=e;const a=yt(),l=()=>a("bookmarkClick"),s=()=>a("fullscreenClick"),c=()=>a("settingsClick"),h=()=>a("bookManagerClick");return t.$$set=g=>{"autoScrollMultiplier"in g&&n(0,r=g.autoScrollMultiplier),"showFullscreenButton"in g&&n(1,o=g.showFullscreenButton),"isBookmarkScreen"in g&&n(2,i=g.isBookmarkScreen)},[r,o,i,a,l,s,c,h]}class Ci extends Xe{constructor(e){super();We(this,e,bi,pi,je,{autoScrollMultiplier:0,showFullscreenButton:1,isBookmarkScreen:2})}}const{document:Lt}=Sn;function bn(t){let e,n,r,o,i,a,l,s;function c(g){t[51](g)}let h={showFullscreenButton:kt.fullscreenEnabled,autoScrollMultiplier:t[11]};return t[5]!==void 0&&(h.isBookmarkScreen=t[5]),n=new Ci({props:h}),te.push(()=>se(n,"isBookmarkScreen",c)),n.$on("fullscreenClick",t[49]),n.$on("bookmarkClick",t[46]),n.$on("bookManagerClick",t[48]),n.$on("settingsClick",t[46]),{c(){e=x("div"),we(n.$$.fragment),this.h()},l(g){e=$(g,"DIV",{class:!0});var k=ee(e);Se(n.$$.fragment,k),k.forEach(D),this.h()},h(){Y(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(g,k){G(g,e,k),ve(n,e,null),a=!0,l||(s=vn(o=zo.call(null,e,t[52])),l=!0)},p(g,k){t=g;const f={};k[0]&2048&&(f.autoScrollMultiplier=t[11]),!r&&k[0]&32&&(r=!0,f.isBookmarkScreen=t[5],ue(()=>r=!1)),n.$set(f),o&&Kn(o.update)&&k[0]&16&&o.update.call(null,t[52])},i(g){a||(U(n.$$.fragment,g),g&&Un(()=>{i||(i=$t(e,tn,{y:-300,easing:en},!0)),i.run(1)}),a=!0)},o(g){Q(n.$$.fragment,g),g&&(i||(i=$t(e,tn,{y:-300,easing:en},!1)),i.run(0)),a=!1},d(g){g&&D(e),ye(n),g&&i&&i.end(),l=!1,s()}}}function _i(t){var r;let e=((r=t[34])!=null?r:"")+"",n;return{c(){n=ke(e)},l(o){n=pe(o,e)},m(o,i){G(o,n,i)},p(o,i){var a;i[1]&8&&e!==(e=((a=o[34])!=null?a:"")+"")&&De(n,e)},i:ot,o:ot,d(o){o&&D(n)}}}function wi(t){var w,B,O,R,q,X,K,ae;let e,n,r,o,i,a,l,s,c,h,g,k=((w=t[31])!=null?w:"")+"",f,d,M=((B=t[32])!=null?B:"")+"",p,b,V=((O=t[33])!=null?O:"")+"",u,y;e=new Jr({props:{styleSheet:t[12].styleSheet}});function v(_){t[53](_)}function I(_){t[54](_)}function A(_){t[55](_)}function H(_){t[56](_)}function F(_){t[57](_)}function L(_){t[58](_)}function J(_){t[59](_)}let N={htmlContent:t[12].htmlContent,width:(R=t[13])!=null?R:0,height:(q=t[14])!=null?q:0,verticalMode:t[15],fontColor:(X=t[16])==null?void 0:X.fontColor,backgroundColor:t[17],hintFuriganaFontColor:(K=t[16])==null?void 0:K.hintFuriganaFontColor,hintFuriganaShadowColor:(ae=t[16])==null?void 0:ae.hintFuriganaShadowColor,fontSize:t[18],fontFamilyGroupOne:t[19],fontFamilyGroupTwo:t[20],hideSpoilerImage:t[21],hideFurigana:t[22],furiganaStyle:t[23],viewMode:t[24],secondDimensionMaxValue:t[25],firstDimensionMargin:t[26],autoPositionOnResize:t[27],avoidPageBreak:t[28],pageColumns:t[29],autoBookmark:t[30],multiplier:t[11]};return t[7]!==void 0&&(N.exploredCharCount=t[7]),t[8]!==void 0&&(N.bookCharCount=t[8]),t[5]!==void 0&&(N.isBookmarkScreen=t[5]),t[0]!==void 0&&(N.bookmarkData=t[0]),t[1]!==void 0&&(N.autoScroller=t[1]),t[2]!==void 0&&(N.bookmarkManager=t[2]),t[3]!==void 0&&(N.pageManager=t[3]),r=new Yr({props:N}),te.push(()=>se(r,"exploredCharCount",v)),te.push(()=>se(r,"bookCharCount",I)),te.push(()=>se(r,"isBookmarkScreen",A)),te.push(()=>se(r,"bookmarkData",H)),te.push(()=>se(r,"autoScroller",F)),te.push(()=>se(r,"bookmarkManager",L)),te.push(()=>se(r,"pageManager",J)),r.$on("bookmark",t[46]),{c(){we(e.$$.fragment),n=re(),we(r.$$.fragment),g=re(),f=ke(k),d=re(),p=ke(M),b=re(),u=ke(V)},l(_){Se(e.$$.fragment,_),n=ie(_),Se(r.$$.fragment,_),g=ie(_),f=pe(_,k),d=ie(_),p=pe(_,M),b=ie(_),u=pe(_,V)},m(_,T){ve(e,_,T),G(_,n,T),ve(r,_,T),G(_,g,T),G(_,f,T),G(_,d,T),G(_,p,T),G(_,b,T),G(_,u,T),y=!0},p(_,T){var de,le,Z,me,be,Ce,ce,Fe;const fe={};T[0]&4096&&(fe.styleSheet=_[12].styleSheet),e.$set(fe);const z={};T[0]&4096&&(z.htmlContent=_[12].htmlContent),T[0]&8192&&(z.width=(de=_[13])!=null?de:0),T[0]&16384&&(z.height=(le=_[14])!=null?le:0),T[0]&32768&&(z.verticalMode=_[15]),T[0]&65536&&(z.fontColor=(Z=_[16])==null?void 0:Z.fontColor),T[0]&131072&&(z.backgroundColor=_[17]),T[0]&65536&&(z.hintFuriganaFontColor=(me=_[16])==null?void 0:me.hintFuriganaFontColor),T[0]&65536&&(z.hintFuriganaShadowColor=(be=_[16])==null?void 0:be.hintFuriganaShadowColor),T[0]&262144&&(z.fontSize=_[18]),T[0]&524288&&(z.fontFamilyGroupOne=_[19]),T[0]&1048576&&(z.fontFamilyGroupTwo=_[20]),T[0]&2097152&&(z.hideSpoilerImage=_[21]),T[0]&4194304&&(z.hideFurigana=_[22]),T[0]&8388608&&(z.furiganaStyle=_[23]),T[0]&16777216&&(z.viewMode=_[24]),T[0]&33554432&&(z.secondDimensionMaxValue=_[25]),T[0]&67108864&&(z.firstDimensionMargin=_[26]),T[0]&134217728&&(z.autoPositionOnResize=_[27]),T[0]&268435456&&(z.avoidPageBreak=_[28]),T[0]&536870912&&(z.pageColumns=_[29]),T[0]&1073741824&&(z.autoBookmark=_[30]),T[0]&2048&&(z.multiplier=_[11]),!o&&T[0]&128&&(o=!0,z.exploredCharCount=_[7],ue(()=>o=!1)),!i&&T[0]&256&&(i=!0,z.bookCharCount=_[8],ue(()=>i=!1)),!a&&T[0]&32&&(a=!0,z.isBookmarkScreen=_[5],ue(()=>a=!1)),!l&&T[0]&1&&(l=!0,z.bookmarkData=_[0],ue(()=>l=!1)),!s&&T[0]&2&&(s=!0,z.autoScroller=_[1],ue(()=>s=!1)),!c&&T[0]&4&&(c=!0,z.bookmarkManager=_[2],ue(()=>c=!1)),!h&&T[0]&8&&(h=!0,z.pageManager=_[3],ue(()=>h=!1)),r.$set(z),(!y||T[1]&1)&&k!==(k=((Ce=_[31])!=null?Ce:"")+"")&&De(f,k),(!y||T[1]&2)&&M!==(M=((ce=_[32])!=null?ce:"")+"")&&De(p,M),(!y||T[1]&4)&&V!==(V=((Fe=_[33])!=null?Fe:"")+"")&&De(u,V)},i(_){y||(U(e.$$.fragment,_),U(r.$$.fragment,_),y=!0)},o(_){Q(e.$$.fragment,_),Q(r.$$.fragment,_),y=!1},d(_){ye(e,_),_&&D(n),ye(r,_),_&&D(g),_&&D(f),_&&D(d),_&&D(p),_&&D(b),_&&D(u)}}}function Cn(t){let e,n,r,o,i,a=(t[7]/t[8]*100).toFixed(2)+"",l,s;return{c(){e=x("div"),n=ke(t[7]),r=ke(" / "),o=ke(t[8]),i=ke(" ("),l=ke(a),s=ke("%)"),this.h()},l(c){e=$(c,"DIV",{class:!0});var h=ee(e);n=pe(h,t[7]),r=pe(h," / "),o=pe(h,t[8]),i=pe(h," ("),l=pe(h,a),s=pe(h,"%)"),h.forEach(D),this.h()},h(){var c;Y(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),P(e,"color",(c=t[16])==null?void 0:c.tooltipTextFontColor,!1)},m(c,h){G(c,e,h),oe(e,n),oe(e,r),oe(e,o),oe(e,i),oe(e,l),oe(e,s)},p(c,h){var g;h[0]&128&&De(n,c[7]),h[0]&256&&De(o,c[8]),h[0]&384&&a!==(a=(c[7]/c[8]*100).toFixed(2)+"")&&De(l,a),h[0]&65536&&P(e,"color",(g=c[16])==null?void 0:g.tooltipTextFontColor,!1)},d(c){c&&D(e)}}}function Si(t){var I,A,H;let e,n,r=((I=t[10])!=null?I:"")+"",o,i,a,l,s,c,h,g,k,f,d,M,p;Lt.title=e=nn((H=(A=t[9])==null?void 0:A.title)!=null?H:"");let b=t[4]&&bn(t);const V=[wi,_i],u=[];function y(F,L){return F[12]?0:1}c=y(t),h=u[c]=V[c](t);let v=t[6]&&t[8]&&Cn(t);return{c(){n=re(),o=ke(r),i=re(),a=x("button"),l=re(),b&&b.c(),s=re(),h.c(),g=re(),v&&v.c(),k=re(),f=x("button"),this.h()},l(F){Jn('[data-svelte="svelte-rnuhm6"]',Lt.head).forEach(D),n=ie(F),o=pe(F,r),i=ie(F),a=$(F,"BUTTON",{class:!0}),ee(a).forEach(D),l=ie(F),b&&b.l(F),s=ie(F),h.l(F),g=ie(F),v&&v.l(F),k=ie(F),f=$(F,"BUTTON",{class:!0}),ee(f).forEach(D),this.h()},h(){Y(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),Y(f,"class","fixed inset-x-0 bottom-0 z-10 h-8 w-full cursor-pointer")},m(F,L){G(F,n,L),G(F,o,L),G(F,i,L),G(F,a,L),G(F,l,L),b&&b.m(F,L),G(F,s,L),u[c].m(F,L),G(F,g,L),v&&v.m(F,L),G(F,k,L),G(F,f,L),d=!0,M||(p=[Ee(window,"keydown",t[45]),Ee(a,"click",t[50]),Ee(f,"click",t[60])],M=!0)},p(F,L){var N,w,B;(!d||L[0]&512)&&e!==(e=nn((w=(N=F[9])==null?void 0:N.title)!=null?w:""))&&(Lt.title=e),(!d||L[0]&1024)&&r!==(r=((B=F[10])!=null?B:"")+"")&&De(o,r),F[4]?b?(b.p(F,L),L[0]&16&&U(b,1)):(b=bn(F),b.c(),U(b,1),b.m(s.parentNode,s)):b&&(xe(),Q(b,1,1,()=>{b=null}),$e());let J=c;c=y(F),c===J?u[c].p(F,L):(xe(),Q(u[J],1,1,()=>{u[J]=null}),$e(),h=u[c],h?h.p(F,L):(h=u[c]=V[c](F),h.c()),U(h,1),h.m(g.parentNode,g)),F[6]&&F[8]?v?v.p(F,L):(v=Cn(F),v.c(),v.m(k.parentNode,k)):v&&(v.d(1),v=null)},i(F){d||(U(b),U(h),d=!0)},o(F){Q(b),Q(h),d=!1},d(F){F&&D(n),F&&D(o),F&&D(i),F&&D(a),F&&D(l),b&&b.d(F),F&&D(s),u[c].d(F),F&&D(g),v&&v.d(F),F&&D(k),F&&D(f),M=!1,Mt(p)}}}const _n="background-color",wn="writing-mode";function vi(t,e,n){let r,o,i,a,l,s,c,h,g,k,f,d,M,p,b,V,u,y,v,I,A,H,F,L,J,N;W(t,zt,C=>n(11,i=C)),W(t,ko,C=>n(15,c=C)),W(t,po,C=>n(18,k=C)),W(t,bo,C=>n(19,f=C)),W(t,Co,C=>n(20,d=C)),W(t,_o,C=>n(21,M=C)),W(t,wo,C=>n(22,p=C)),W(t,So,C=>n(23,b=C)),W(t,vo,C=>n(24,V=C)),W(t,yo,C=>n(25,u=C)),W(t,Mo,C=>n(26,y=C)),W(t,Fo,C=>n(27,v=C)),W(t,Po,C=>n(28,I=C)),W(t,Bo,C=>n(29,A=C)),W(t,Eo,C=>n(30,H=C));const w=St(()=>gi(no)).pipe(ge(C=>Number(C.url.searchParams.get("id"))),qt({refCount:!0,bufferSize:1})),B=w.pipe(pt(C=>st.getData(C)),Xt());W(t,B,C=>n(9,r=C));const O=B.pipe(Re(C=>{C||mo("/manage")}),Ke());W(t,O,C=>n(34,N=C));let R=Promise.resolve(void 0);const q=B.pipe(Re(C=>{!C||n(0,R=st.getBookmark(C.id))}),Ke());W(t,q,C=>n(31,F=C));const X=B.pipe(pt(C=>C?di(C,".book-content",document):Yt),qt({refCount:!0,bufferSize:1}));W(t,X,C=>n(12,a=C));const K=St(()=>Le(visualViewport,"resize")).pipe(Xt()),ae=K.pipe(Ht(0),ge(()=>visualViewport.width),ct());W(t,ae,C=>n(13,l=C));const _=K.pipe(Ht(0),ge(()=>visualViewport.height),ct());W(t,_,C=>n(14,s=C));const T=co.pipe(ge(C=>Ro.get(C)),Ft(C=>!!C));W(t,T,C=>n(16,h=C));const fe=T.pipe(ge(C=>C.backgroundColor));W(t,fe,C=>n(17,g=C));const z=fe.pipe(kn(()=>document.body,(C,Ie)=>Ie.style.setProperty(_n,C),C=>C.style.removeProperty(_n)),Ke(),ct());W(t,z,C=>n(32,L=C));const de=ho.pipe(kn(()=>document.documentElement,(C,Ie)=>Ie.style.setProperty(wn,C),C=>C.style.removeProperty(wn)),Ke(),ct());W(t,de,C=>n(33,J=C));let le,Z,me;function be(C){!ki(C,go.getValue(),ce,Fe,qn=>zt.next(zt.getValue()+qn),le,me)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),C.preventDefault())}function Ce(){let C;return w.subscribe(Ie=>C=Ie).unsubscribe(),C}async function ce(){const C=Ce();if(!C||!Z)return;const Ie=Z.formatBookmarkData(C);await st.putBookmark(Ie),n(0,R=Promise.resolve(Ie))}async function Fe(){const C=await R;!C||!Z||Z.scrollToBookmark(C)}let he=!0,Pe=!1;const Ve=Ut(2500).pipe(Re(()=>n(4,he=!1)),Ke());W(t,Ve,C=>n(10,o=C));function Te(){st.deleteLastItem(),ce()}function E(){if(!kt.fullscreenElement){kt.requestFullscreen(document.documentElement);return}kt.exitFullscreen()}let Me=!0,Ne=0,S=0;const ne=()=>n(4,he=!0);function ze(C){Pe=C,n(5,Pe)}const Ye=()=>n(4,he=!1);function Dt(C){Ne=C,n(7,Ne)}function Tt(C){S=C,n(8,S)}function It(C){Pe=C,n(5,Pe)}function At(C){R=C,n(0,R)}function Ot(C){le=C,n(1,le)}function Vt(C){Z=C,n(2,Z)}function m(C){me=C,n(3,me)}return[R,le,Z,me,he,Pe,Me,Ne,S,r,o,i,a,l,s,c,h,g,k,f,d,M,p,b,V,u,y,v,I,A,H,F,L,J,N,B,O,q,X,ae,_,T,fe,z,de,be,ce,Ve,Te,E,ne,ze,Ye,Dt,Tt,It,At,Ot,Vt,m,()=>n(6,Me=!Me)]}class Ai extends Xe{constructor(e){super();We(this,e,vi,Si,je,{},null,[-1,-1,-1])}}export{Ai as default};
