var ho=Object.defineProperty,mo=Object.defineProperties;var go=Object.getOwnPropertyDescriptors;var un=Object.getOwnPropertySymbols;var ko=Object.prototype.hasOwnProperty,po=Object.prototype.propertyIsEnumerable;var fn=(t,e,n)=>e in t?ho(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Yt=(t,e)=>{for(var n in e||(e={}))ko.call(e,n)&&fn(t,n,e[n]);if(un)for(var n of un(e))po.call(e,n)&&fn(t,n,e[n]);return t},Kt=(t,e)=>mo(t,go(e));import{S as Je,i as Qe,n as Ze,P as bo,k as at,Q as Co,f as G,E as lt,d as E,T as Lt,u as _o,e as J,j as oe,c as Q,a as Z,l as re,b as W,s as I,w as ge,x as ke,U as j,y as pe,L as ve,q as Y,o as ee,B as be,V as Ct,W as x,X as rn,Y as Gn,Z as ie,J as K,_ as an,m as Ye,p as Ke,t as se,g as ue,h as Pe,$ as cn,a0 as he,a1 as de,v as Nn,a2 as vo,a3 as wo,a4 as So,a5 as Hn,a6 as hn,I as yo,a7 as Mo}from"../../chunks/index-32c3e254.js";import{F as Ge,f as Po,a as Zt,p as ct,o as ht,b as Fo,c as Do,n as Eo,t as Bo,d as Io,e as To,g as Ao,h as Vo,i as Oo,q as xt,j as $t}from"../../chunks/css-classes-6ce95777.js";import{p as Ro}from"../../chunks/stores-ca4ab7da.js";import{d as zo,i as Lo,m as Dt,a as nt,b as Go,E as gt,c as No,f as Ho,p as qo,e as Xo,g as qe,o as st,s as kt,h as _e,j as Gt,F as Ee,k as en,l as qn,t as _t,n as tn,q as nn,R as Wo,r as on,V as Et,B as He,u as dn,v as yt,w as jo,x as Yo,y as Ko,z as Uo,A as Jo,C as Ut,D as Qo,G as Zo,H as xo,I as $o,J as er,K as tr,L as nr,M as or,N as rr,O as ir,P as ar,Q as lr,S as sr}from"../../chunks/format-page-title-88a0fb5c.js";import{S as Xn,_ as It,a as pt,b as vt,c as ur,i as tt,O as We,n as ln,d as fr,B as Tt,e as Me,w as cr}from"../../chunks/store-9e108e48.js";import{m as hr,g as Wn,a as jn,c as bt,p as mn,o as Yn,f as gn,b as dr,i as Kn,d as mr}from"../../chunks/index.es-ac3c0587.js";import{r as ot,c as Un,a as gr}from"../../chunks/use-click-outside-edf556ee.js";import{t as Ue}from"../../chunks/tap-05f0a3d8.js";import{d as kn}from"../../chunks/dialog-manager-f50f3d91.js";import"../../chunks/singletons-d1fb5791.js";const Jn=!0;var dt={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,r=dt.delegate;r&&(e=r.requestAnimationFrame,n=r.cancelAnimationFrame);var o=e(function(i){n=void 0,t(i)});return new Xn(function(){return n==null?void 0:n(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=dt.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,It([],pt(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=dt.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,It([],pt(t)))},delegate:void 0},kr=function(t){vt(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Xn),At={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=At.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,It([t,e],pt(n))):setInterval.apply(void 0,It([t,e],pt(n)))},clearInterval:function(t){var e=At.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Qn=function(t){vt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(i,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),At.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;At.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ur(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(kr),pn=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=zo.now,t}(),Zn=function(t){vt(e,t);function e(n,r){r===void 0&&(r=pn.now);var o=t.call(this,n,r)||this;return o.actions=[],o._active=!1,o._scheduled=void 0,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(pn),Nt=new Zn(Qn),pr=Nt,br=function(t){vt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o}return e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),o!==null&&o>0?t.prototype.requestAsyncId.call(this,n,r,o):(n.actions.push(this),n._scheduled||(n._scheduled=dt.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&o>0||o==null&&this.delay>0)return t.prototype.recycleAsyncId.call(this,n,r,o);n.actions.some(function(i){return i.id===r})||(dt.cancelAnimationFrame(r),n._scheduled=void 0)},e}(Qn),Cr=function(t){vt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var o=this.actions,i;n=n||o.shift();do if(i=n.execute(n.state,n.delay))break;while((n=o[0])&&n.id===r&&o.shift());if(this._active=!1,i){for(;(n=o[0])&&n.id===r&&o.shift();)n.unsubscribe();throw i}},e}(Zn),Ht=new Cr(br);function _r(t){return t instanceof Date&&!isNaN(t)}var vr=["addListener","removeListener"],wr=["addEventListener","removeEventListener"],Sr=["on","off"];function Xe(t,e,n,r){if(tt(n)&&(r=n,n=void 0),r)return Xe(t,e,n).pipe(hr(r));var o=pt(Pr(t)?wr.map(function(l){return function(s){return t[l](e,s,n)}}):yr(t)?vr.map(bn(t,e)):Mr(t)?Sr.map(bn(t,e)):[],2),i=o[0],a=o[1];if(!i&&Lo(t))return Dt(function(l){return Xe(l,e,n)})(nt(t));if(!i)throw new TypeError("Invalid event target");return new We(function(l){var s=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];return l.next(1<f.length?f:f[0])};return i(s),function(){return a(s)}})}function bn(t,e){return function(n){return function(r){return t[n](e,r)}}}function yr(t){return tt(t.addListener)&&tt(t.removeListener)}function Mr(t){return tt(t.on)&&tt(t.off)}function Pr(t){return tt(t.addEventListener)&&tt(t.removeEventListener)}function qt(t,e,n){t===void 0&&(t=0),n===void 0&&(n=pr);var r=-1;return e!=null&&(Go(e)?n=e:r=e),new We(function(o){var i=_r(t)?+t-n.now():t;i<0&&(i=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function Fr(t,e){return t===void 0&&(t=0),e===void 0&&(e=Nt),t<0&&(t=0),qt(t,t,e)}function Xt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=qo(t),r=Xo(t,1/0),o=t;return o.length?o.length===1?nt(o[0]):No(r)(Ho(o,n)):gt}var xn=new We(ln),Dr=Array.isArray;function Er(t){return t.length===1&&Dr(t[0])?t[0]:t}function Br(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=Er(t),t.length===1?nt(t[0]):new We(Ir(t))}function Ir(t){return function(e){for(var n=[],r=function(i){n.push(nt(t[i]).subscribe(qe(e,function(a){if(n){for(var l=0;l<n.length;l++)l!==i&&n[l].unsubscribe();n=null}e.next(a)})))},o=0;n&&!e.closed&&o<t.length;o++)r(o)}}function Tr(t){return st(function(e,n){var r=!1,o=null,i=null,a=function(){if(i==null||i.unsubscribe(),i=null,r){r=!1;var l=o;o=null,n.next(l)}};e.subscribe(qe(n,function(l){i==null||i.unsubscribe(),r=!0,o=l,i=qe(n,a,ln),nt(t(l)).subscribe(i)},function(){a(),n.complete()},void 0,function(){o=i=null}))})}function Vt(t,e){return e===void 0&&(e=Nt),st(function(n,r){var o=null,i=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var f=i;i=null,r.next(f)}};function s(){var f=a+t,g=e.now();if(g<f){o=this.schedule(void 0,f-g),r.add(o);return}l()}n.subscribe(qe(r,function(f){i=f,a=e.now(),o||(o=e.schedule(s,t),r.add(o))},function(){l(),r.complete()},void 0,function(){i=o=null}))})}function $n(t,e){return e===void 0&&(e=fr),t=t!=null?t:Ar,st(function(n,r){var o,i=!0;n.subscribe(qe(r,function(a){var l=e(a);(i||!t(o,l))&&(i=!1,o=l,r.next(a))}))})}function Ar(t,e){return t===e}function Vr(){return st(function(t,e){var n,r=!1;t.subscribe(qe(e,function(o){var i=n;n=o,r&&e.next([i,o]),r=!0}))})}function Ae(t){return st(function(e,n){nt(t).subscribe(qe(n,function(){return n.complete()},ln)),!n.closed&&e.subscribe(n)})}var eo={leading:!0,trailing:!1};function Or(t,e){return e===void 0&&(e=eo),st(function(n,r){var o=e.leading,i=e.trailing,a=!1,l=null,s=null,f=!1,g=function(){s==null||s.unsubscribe(),s=null,i&&(u(),f&&r.complete())},k=function(){s=null,f&&r.complete()},c=function(p){return s=nt(t(p)).subscribe(qe(r,g,k))},u=function(){if(a){a=!1;var p=l;l=null,r.next(p),!f&&c(p)}};n.subscribe(qe(r,function(p){a=!0,l=p,!(s&&!s.closed)&&(o?u():c(p))},function(){f=!0,!(i&&a&&s&&!s.closed)&&r.complete()}))})}function Rr(t,e,n){e===void 0&&(e=Nt),n===void 0&&(n=eo);var r=qt(t,e);return Or(function(){return r},n)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const sn=new Tt([]),Ot=new Me,wt=new Me,et=new Me;function to(t){const e=t.filter(i=>!i.parentChapter);let n=t.find(i=>i.progress<100);n||(n=t[t.length-1]);const r=n.parentChapter||n.reference,o=e.findIndex(i=>i.reference===r);return[e,o,r]}function zr(t){let e,n;return{c(){e=new bo,n=at(),this.h()},l(r){e=Co(r),n=at(),this.h()},h(){e.a=n},m(r,o){e.m(t[0],r,o),G(r,n,o)},p(r,[o]){o&1&&e.p(r[0])},i:lt,o:lt,d(r){r&&E(n),r&&e.d()}}}function Lr(t,e,n){let{html:r}=e;const o=Lt();return _o(()=>{o("load")}),t.$$set=i=>{"html"in i&&n(0,r=i.html)},[r]}class no extends Je{constructor(e){super();Qe(this,e,Lr,zr,Ze,{html:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function rt(t,e){return e==="rtl"?-t:t}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Gr{constructor(e,n,r){this.calculator=e,this.window=n,this.firstDimensionMargin=r}scrollToBookmark(e){const n=this.getBookmarkPosition(e);if(!n)return;const{scrollToData:r}=Cn(n,this.firstDimensionMargin);this.window.scrollTo(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount,{verticalMode:o}=this.calculator,i=o?"scrollX":"scrollY";return{dataId:e,exploredCharCount:n,progress:n/r,[i]:this.window[i]}}getBookmarkBarPosition(e){const n=this.getBookmarkPosition(e);if(!!n)return Cn(n,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:n}=this.calculator,r=this.getBookmarkTargetPosByScrollValue(e);if(r)return r;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return n?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:n}=e,r=o=>{const i=e[o];if(!i)return;const a=rt(i,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===n)return{[o]:i}};return this.calculator.verticalMode?r("scrollX"):r("scrollY")}}function Cn(t,e){return"scrollX"in t?{scrollToData:{left:t.scrollX},bookmarkPosData:{right:`${-t.scrollX+e}px`}}:{scrollToData:{top:t.scrollY},bookmarkPosData:{top:`${t.scrollY+e}px`}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Nr(t){const e=(n,r,o,i)=>{if(o<r)return t!=null?t:o;const a=Math.floor((r+o)/2);return n[a]===i?a:n[a]>i?e(n,r,a-1,i):e(n,a+1,o,i)};return(n,r)=>e(n,0,n.length-1,r)}const Rt=Nr(void 0);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class oo{constructor(e,n,r,o,i){this.containerEl=e,this.axis=n,this.direction=r,this.scrollEl=o,this.document=i,this.paragraphPosToAccCharCount=new Map,this.paragraphs=Wn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=jn(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const n=this.scrollEl.getBoundingClientRect(),r=rt(this.verticalMode?n.right:n.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),i=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=this.getNodeBoundingRect(l),g=rt(this.verticalMode?s.left:s.bottom,this.direction)-r-o+e;this.paragraphPos[a]=g;const k=i.get(g)||[];i.set(g,k),k.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(i.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(){return this.getCharCountByScrollPos(this.scrollPos)}getCharCountByScrollPos(e){const n=Rt(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[n])||0}getScrollPosByCharCount(e){const n=Rt(this.accumulatedCharCount,e);return rt(this.paragraphPos[n],this.direction)}getNodeBoundingRect(e){const n=this.document.createRange();return n.selectNode(e),n.getBoundingClientRect()}get scrollPos(){return rt(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Hr(t,e,n){const r=Wr(e,n)(t,"scrollLeft");return(o,i,a)=>{if(!qr(o))return;const l=Xr(o,i,a);r(-l),o.preventDefault()}}function qr(t){return!(!t.deltaY||t.deltaX||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)}function Xr(t,e,n){switch(t.deltaMode){case 0:return t.deltaY;case 1:return t.deltaY*e*1.75;default:return t.deltaY*n}}function Wr(t,e){return(n,r)=>{let o=!1,i=t[r],a=t[r];const l=()=>{o=!0;const s=Math.trunc((i-t[r])/n);if(t[r]!==a){o=!1;return}if(a+=s,t.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(i=t[r],a=t[r]),i+=s,o||e(l)}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class jr{constructor(e,n,r){this.verticalMode=e,this.firstDimensionMargin=n,this.window=r}nextPage(){this.scrollByPercent(.9)}prevPage(){this.scrollByPercent(-.9)}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let n=this.window.innerHeight,r="top",o=1;this.verticalMode&&(n=this.window.innerWidth,r="left",o=-1);const i=n-this.firstDimensionMargin*2;this.window.scrollBy({[r]:i*e*o,behavior:"smooth"})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Yr{constructor(e,n,r,o,i=Ht){this.multiplier=e,this.verticalMode=n,this.enabled$=new Tt(!1),this.enabled$.pipe(kt(a=>{if(!a)return gt;let l=0;return Fr(0,i).pipe(_e(()=>Date.now()),Vr(),_e(s=>this.calcNewPos(s)),_e(s=>{l+=s;const f=Math.trunc(l);return l-=f,f}),Gt(s=>s!==0))}),Ae(r)).subscribe(a=>{let l="top";n&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,n]){let r=.00365956;return this.verticalMode&&(r=-91489e-8),r*this.multiplier*(n-e)}}const{document:Kr,window:Ur}=Gn;function _n(t){let e,n,r,o,i;return{c(){e=J("div"),r=oe(),o=J("div"),this.h()},l(a){e=Q(a,"DIV",{class:!0,style:!0}),Z(e).forEach(E),r=re(a),o=Q(a,"DIV",{class:!0,style:!0}),Z(o).forEach(E),this.h()},h(){W(e,"class","fixed z-[5]"),W(e,"style",n=t[21]+": 100%; "+t[20]+": "+t[15]+"px; "+t[19][0]+": 0"),I(e,"background-color",t[5],!1),W(o,"class","fixed z-[5]"),W(o,"style",i=t[21]+": 100%; "+t[20]+": "+t[15]+"px; "+t[19][1]+": 0"),I(o,"background-color",t[5],!1)},m(a,l){G(a,e,l),G(a,r,l),G(a,o,l)},p(a,l){l[0]&3702784&&n!==(n=a[21]+": 100%; "+a[20]+": "+a[15]+"px; "+a[19][0]+": 0")&&W(e,"style",n),l[0]&32&&I(e,"background-color",a[5],!1),l[0]&3702784&&i!==(i=a[21]+": 100%; "+a[20]+": "+a[15]+"px; "+a[19][1]+": 0")&&W(o,"style",i),l[0]&32&&I(o,"background-color",a[5],!1)},d(a){a&&E(e),a&&E(r),a&&E(o)}}}function vn(t){let e;function n(i,a){return i[3]?Qr:Jr}let r=n(t),o=r(t);return{c(){o.c(),e=at()},l(i){o.l(i),e=at()},m(i,a){o.m(i,a),G(i,e,a)},p(i,a){r===(r=n(i))&&o?o.p(i,a):(o.d(1),o=r(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){o.d(i),i&&E(e)}}}function Jr(t){let e;return{c(){e=J("div"),this.h()},l(n){e=Q(n,"DIV",{class:!0}),Z(e).forEach(E),this.h()},h(){W(e,"class","absolute inset-x-0 h-12 bg-yellow-600 bg-opacity-10 pointer-events-none m-auto"),I(e,"width",`${t[14]||t[1]}px`,!1),I(e,"top",t[17].top,!1)},m(n,r){G(n,e,r)},p(n,r){r[0]&16386&&I(e,"width",`${n[14]||n[1]}px`,!1),r[0]&131072&&I(e,"top",n[17].top,!1)},d(n){n&&E(e)}}}function Qr(t){let e;return{c(){e=J("div"),this.h()},l(n){e=Q(n,"DIV",{class:!0}),Z(e).forEach(E),this.h()},h(){W(e,"class","pointer-events-none absolute inset-y-0 m-auto w-12 bg-yellow-600 bg-opacity-10"),I(e,"height",`${t[18]||t[2]}px`,!1),I(e,"right",t[17].right,!1)},m(n,r){G(n,e,r)},p(n,r){r[0]&262148&&I(e,"height",`${n[18]||n[2]}px`,!1),r[0]&131072&&I(e,"right",n[17].right,!1)},d(n){n&&E(e)}}}function Zr(t){let e,n,r=`${t[8]}px`,o=`${t[18]||t[2]}px`,i,a,l,s,f,g;n=new no({props:{html:t[0]}}),n.$on("load",t[24]);let k=t[15]&&_n(t),c=t[17]&&vn(t);return{c(){e=J("div"),ge(n.$$.fragment),i=oe(),k&&k.c(),a=oe(),c&&c.c(),l=oe(),this.h()},l(u){e=Q(u,"DIV",{class:!0});var p=Z(e);ke(n.$$.fragment,p),p.forEach(E),i=re(u),k&&k.l(u),a=re(u),c&&c.l(u),l=re(u),this.h()},h(){W(e,"class","book-content m-auto svelte-1tqbqao"),j(e,"book-content--writing-vertical-rl",t[3]),j(e,"book-content--writing-horizontal-rl",!t[3]),j(e,"book-content--hide-furigana",t[12]),j(e,"book-content--hide-spoiler-image",t[11]),j(e,"book-content--furigana-style-partial",t[13]===Ee.Partial),j(e,"book-content--furigana-style-full",t[13]===Ee.Full),j(e,"book-content--furigana-style-toggle",t[13]===Ee.Toggle),I(e,"color",t[4],!1),I(e,"font-size",r,!1),I(e,"max-width",!t[3]&&t[14]?`${t[14]}px`:void 0,!1),I(e,"max-height",t[18]?`${t[18]}px`:void 0,!1),I(e,"padding-left",t[3]&&t[15]?`${t[15]}px`:void 0,!1),I(e,"padding-right",t[3]&&t[15]?`${t[15]}px`:void 0,!1),I(e,"padding-top",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),I(e,"padding-bottom",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),I(e,"--font-family-serif",t[9],!1),I(e,"--font-family-sans-serif",t[10],!1),I(e,"--book-content-hint-furigana-font-color",t[6],!1),I(e,"--book-content-hint-furigana-shadow-color",t[7],!1),I(e,"--book-content-child-height",o,!1)},m(u,p){G(u,e,p),pe(n,e,null),t[40](e),G(u,i,p),k&&k.m(u,p),G(u,a,p),c&&c.m(u,p),G(u,l,p),s=!0,f||(g=[ve(Ur,"scroll",t[23]),ve(Kr.body,"wheel",t[22],{passive:!1})],f=!0)},p(u,p){const w={};p[0]&1&&(w.html=u[0]),n.$set(w),p[0]&8&&j(e,"book-content--writing-vertical-rl",u[3]),p[0]&8&&j(e,"book-content--writing-horizontal-rl",!u[3]),p[0]&4096&&j(e,"book-content--hide-furigana",u[12]),p[0]&2048&&j(e,"book-content--hide-spoiler-image",u[11]),p[0]&8192&&j(e,"book-content--furigana-style-partial",u[13]===Ee.Partial),p[0]&8192&&j(e,"book-content--furigana-style-full",u[13]===Ee.Full),p[0]&8192&&j(e,"book-content--furigana-style-toggle",u[13]===Ee.Toggle),p[0]&16&&I(e,"color",u[4],!1),p[0]&256&&r!==(r=`${u[8]}px`)&&I(e,"font-size",r,!1),p[0]&16392&&I(e,"max-width",!u[3]&&u[14]?`${u[14]}px`:void 0,!1),p[0]&262144&&I(e,"max-height",u[18]?`${u[18]}px`:void 0,!1),p[0]&32776&&I(e,"padding-left",u[3]&&u[15]?`${u[15]}px`:void 0,!1),p[0]&32776&&I(e,"padding-right",u[3]&&u[15]?`${u[15]}px`:void 0,!1),p[0]&32776&&I(e,"padding-top",!u[3]&&u[15]?`${u[15]}px`:void 0,!1),p[0]&32776&&I(e,"padding-bottom",!u[3]&&u[15]?`${u[15]}px`:void 0,!1),p[0]&512&&I(e,"--font-family-serif",u[9],!1),p[0]&1024&&I(e,"--font-family-sans-serif",u[10],!1),p[0]&64&&I(e,"--book-content-hint-furigana-font-color",u[6],!1),p[0]&128&&I(e,"--book-content-hint-furigana-shadow-color",u[7],!1),p[0]&262148&&o!==(o=`${u[18]||u[2]}px`)&&I(e,"--book-content-child-height",o,!1),u[15]?k?k.p(u,p):(k=_n(u),k.c(),k.m(a.parentNode,a)):k&&(k.d(1),k=null),u[17]?c?c.p(u,p):(c=vn(u),c.c(),c.m(l.parentNode,l)):c&&(c.d(1),c=null)},i(u){s||(Y(n.$$.fragment,u),s=!0)},o(u){ee(n.$$.fragment,u),s=!1},d(u){u&&E(e),be(n),t[40](null),u&&E(i),k&&k.d(u),u&&E(a),c&&c.d(u),u&&E(l),f=!1,Ct(g)}}}function xr(t,e,n){let r,o,i,a,l;x(t,et,P=>n(46,l=P));let{htmlContent:s}=e,{width:f}=e,{height:g}=e,{verticalMode:k}=e,{fontColor:c}=e,{backgroundColor:u}=e,{hintFuriganaFontColor:p}=e,{hintFuriganaShadowColor:w}=e,{fontSize:d}=e,{fontFamilyGroupOne:S}=e,{fontFamilyGroupTwo:F}=e,{hideSpoilerImage:h}=e,{hideFurigana:v}=e,{furiganaStyle:D}=e,{secondDimensionMaxValue:V}=e,{firstDimensionMargin:T}=e,{autoPositionOnResize:z}=e,{autoBookmark:N}=e,{loadingState:U}=e,{multiplier:m}=e,{bookmarkData:B}=e,{exploredCharCount:C}=e,{bookCharCount:A}=e,{autoScroller:R}=e,{bookmarkManager:q}=e,{pageManager:L}=e;const te=Lt();let X,$,y={},O,ae,H,Ce,le,we=0,fe=!1;const Se=Hr(4,document.documentElement,requestAnimationFrame),ye=new Me,Fe=new Me,me=new Me,Be=new Map,ce=new Map;let Ve=0,Oe=!1;rn(()=>{me.next(),me.complete()}),O=new Yr(m,k,me,document),R=O,bt([ye,Fe]).pipe(Gt(()=>z),en(1),_e(([P,ne])=>k?ne:P),$n(),Vt(10),qn(Ht),Ae(me)).subscribe(()=>{if(!$||!H)return;const P=$.getScrollPosByCharCount(we);fe=!0,H.scrollTo(P)});function Re(P){P.updateParagraphPos(),n(25,C=P.calcExploredCharCount()),le&&(le=!1,B.then(ne=>{!ne||!q||q.scrollToBookmark(ne)}).finally(()=>{N&&Xe(window,"scroll").pipe(en(1),Vt(3e3),Ae(me)).subscribe(()=>{te("bookmark")}),sn.pipe(_t(1),kt(ne=>ne.length?(ne.forEach(Ie=>{const De=Ie.reference,ze=document.getElementById(De);ze&&(Ve||(Ve=Number(getComputedStyle(ze)[k?"marginLeft":"marginBottom"].replace(/px$/,""))/2),ce.set(De,Kt(Yt({},Ie),{progress:0})),Be.set(De,ze))}),Be.size?(je(),Xe(window,"scroll")):gt):gt),Tr(()=>qt(Oe?100:500)),Ae(me)).subscribe(je)})),n(36,y={})}function je(){const P=[...ce.entries()];for(let ne=0,{length:Ie}=P;ne<Ie;ne+=1){const[De,ze]=P[ne],Le=Be.get(De).getBoundingClientRect();ze.progress=k?Math.min(Math.max(Le.right+(T||0)-window.innerWidth,0),Le.width)/(Le.width||1)*100:Math.abs(Math.min(Math.max(Le.top-(T||0),-Le.height),0))/(Le.height||1)*100,ce.set(De,ze)}Oe=!1,Ot.next(ce)}function xe(P){k&&!l&&Se(P,d,window.innerWidth)}function Ne(){requestAnimationFrame(()=>{!$||(n(25,C=$.calcExploredCharCount()),fe||(we=C),fe=!1)})}function $e(){!X||(n(35,$=new oo(X,k?"vertical":"horizontal",k?"rtl":"ltr",document.documentElement,document)),n(25,C=0),we=C,n(26,A=$.charCount),te("contentChange",X))}wt.pipe(Ae(me)).subscribe(P=>{let ne=document.getElementById(P);if(!ne)return;ne=!P.startsWith(mn)&&ne.closest(`div[id^="${mn}"]`)||ne,Oe=!0;const De=ne.getBoundingClientRect();k?window.scrollBy(-(window.innerWidth-De.right-(T||0)-Ve),0):window.scrollBy(0,De.top-(T||0)-Ve)});function M(P){ie[P?"unshift":"push"](()=>{X=P,n(16,X)})}return t.$$set=P=>{"htmlContent"in P&&n(0,s=P.htmlContent),"width"in P&&n(1,f=P.width),"height"in P&&n(2,g=P.height),"verticalMode"in P&&n(3,k=P.verticalMode),"fontColor"in P&&n(4,c=P.fontColor),"backgroundColor"in P&&n(5,u=P.backgroundColor),"hintFuriganaFontColor"in P&&n(6,p=P.hintFuriganaFontColor),"hintFuriganaShadowColor"in P&&n(7,w=P.hintFuriganaShadowColor),"fontSize"in P&&n(8,d=P.fontSize),"fontFamilyGroupOne"in P&&n(9,S=P.fontFamilyGroupOne),"fontFamilyGroupTwo"in P&&n(10,F=P.fontFamilyGroupTwo),"hideSpoilerImage"in P&&n(11,h=P.hideSpoilerImage),"hideFurigana"in P&&n(12,v=P.hideFurigana),"furiganaStyle"in P&&n(13,D=P.furiganaStyle),"secondDimensionMaxValue"in P&&n(14,V=P.secondDimensionMaxValue),"firstDimensionMargin"in P&&n(15,T=P.firstDimensionMargin),"autoPositionOnResize"in P&&n(30,z=P.autoPositionOnResize),"autoBookmark"in P&&n(31,N=P.autoBookmark),"loadingState"in P&&n(32,U=P.loadingState),"multiplier"in P&&n(33,m=P.multiplier),"bookmarkData"in P&&n(34,B=P.bookmarkData),"exploredCharCount"in P&&n(25,C=P.exploredCharCount),"bookCharCount"in P&&n(26,A=P.bookCharCount),"autoScroller"in P&&n(27,R=P.autoScroller),"bookmarkManager"in P&&n(28,q=P.bookmarkManager),"pageManager"in P&&n(29,L=P.pageManager)},t.$$.update=()=>{if(t.$$.dirty[0]&8&&n(21,r=k?"height":"width"),t.$$.dirty[0]&8&&n(20,o=k?"width":"height"),t.$$.dirty[0]&8&&n(19,i=k?["left","right"]:["top","bottom"]),t.$$.dirty[0]&2&&ye.next(f),t.$$.dirty[0]&4&&Fe.next(g),t.$$.dirty[0]&16392&&n(18,a=k&&V?V:void 0),t.$$.dirty[0]&1&&s&&(le=!0),t.$$.dirty[0]&6|t.$$.dirty[1]&18&&$&&f&&g&&!U){const P=$;requestAnimationFrame(()=>{Re(P)})}t.$$.dirty[0]&8|t.$$.dirty[1]&68&&O&&(n(37,O.multiplier=m,O),n(37,O.verticalMode=k,O)),t.$$.dirty[0]&32768|t.$$.dirty[1]&144&&$&&(n(38,ae=$&&new Gr($,window,T||0)),n(28,q=ae)),t.$$.dirty[1]&168&&y&&(n(17,Ce=void 0),B.then(P=>{!P||n(17,Ce=ae==null?void 0:ae.getBookmarkBarPosition(P))})),t.$$.dirty[0]&32776|t.$$.dirty[1]&256&&(n(39,H=new jr(k,T,window)),n(29,L=H))},[s,f,g,k,c,u,p,w,d,S,F,h,v,D,V,T,X,Ce,a,i,o,r,xe,Ne,$e,C,A,R,q,L,z,N,U,m,B,$,y,O,ae,H,M]}class $r extends Je{constructor(e){super();Qe(this,e,xr,Zr,Ze,{htmlContent:0,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,secondDimensionMaxValue:14,firstDimensionMargin:15,autoPositionOnResize:30,autoBookmark:31,loadingState:32,multiplier:33,bookmarkData:34,exploredCharCount:25,bookCharCount:26,autoScroller:27,bookmarkManager:28,pageManager:29},null,[-1,-1])}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const ei="px-4 md:px-8";/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function mt(t,e=Jn){return e?t():xn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ti(t){const e=Array.from(t.getElementsByTagName("img"));return new We(n=>{const r=e.filter(i=>i.src).map(ni);if(r.length<=0){n.next(!1),n.complete();return}const o=bt(r).subscribe(()=>{n.next(!1),n.complete()});return n.next(!0),o})}function ni(t){return t.complete?Yn(1):Br(Xe(t,"load"),Xe(t,"error"))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function oi(t,e){const n=ri(t),r=ai(t);return o=>Xt(n(o),ii(o,e),r(o))}function ri(t){return e=>{const n=Array.from(e.getElementsByTagName("a"));n.forEach(o=>{o.href=t.location.pathname+o.hash});const r=n.map(o=>zt(o).pipe(Ue(()=>wt.next(o.hash.substring(1)))));return Xt(...r)}}function ii(t,e){const n=e===Ee.Toggle,o=Array.from(t.getElementsByTagName("ruby")).map(i=>n?zt(i).pipe(Ue(()=>{i.classList.toggle("reveal-rt")})):zt(i).pipe(_t(1),Ue(()=>{i.classList.add("reveal-rt")})));return Xt(...o)}function ai(t){return e=>{const r=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const i=t.createElement("span");return i.classList.add("spoiler-label"),i.setAttribute("aria-hidden","true"),i.innerText="\u30CD\u30BF\u30D0\u30EC",o.appendChild(i),zt(o).pipe(_t(1),Ue(()=>{o.removeChild(i),o.removeAttribute("data-ttu-spoiler-img")}))});return Xt(...r)}}function zt(t){return Xe(t,"click").pipe(Ue(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const li=300,si=60,ro="none";function ft(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function ui(t,e){return e.filter(n=>t.pointerId!==n.pointerId)}function Mt(t,e,n,r,o){t.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:n,pointersCount:r.length}}))}function fi(t,e,n,r,o,i=ro){e.style.touchAction=i;let a=[];function l(f){a.push(f),Mt(e,t,f,a,"down"),r==null||r(a,f);const g=f.pointerId;function k(S){g===S.pointerId&&(a=ui(S,a),a.length||c(),Mt(e,t,S,a,"up"),o==null||o(a,S))}function c(){u(),p(),w(),d()}const u=ft(e,"pointermove",S=>{a=a.map(F=>S.pointerId===F.pointerId?S:F),Mt(e,t,S,a,"move"),n==null||n(a,S)}),p=ft(e,"lostpointercapture",S=>{k(S)}),w=ft(e,"pointerup",S=>{k(S)}),d=ft(e,"pointerleave",S=>{a=[],c(),Mt(e,t,S,a,"up"),o==null||o(a,S)})}const s=ft(e,"pointerdown",l);return{destroy:()=>{s()}}}function ci(t,e={timeframe:li,minSwipeDistance:si,touchAction:ro}){const n="swipe";let r,o,i,a;function l(f,g){o=g.clientX,i=g.clientY,r=Date.now(),f.length===1&&(a=g.target)}function s(f,g){if(g.type==="pointerup"&&f.length===0&&Date.now()-r<e.timeframe){const k=g.clientX-o,c=g.clientY-i,u=Math.abs(k),p=Math.abs(c);let w=null;u>=2*p&&u>e.minSwipeDistance?w=k>0?"right":"left":p>=2*u&&p>e.minSwipeDistance&&(w=c>0?"bottom":"top"),w&&t.dispatchEvent(new CustomEvent(n,{detail:{direction:w,target:a}}))}}return fi(n,t,null,l,s,e.touchAction)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class hi{constructor(e,n,r,o,i,a,l,s,f,g,k){this.contentEl=e,this.scrollEl=n,this.sections=r,this.sectionIndex$=o,this.virtualScrollPos$=i,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=f,this.pageChange$=g,this.sectionRenderComplete$=k,this.translateX=0,this.sectionData=new Map,sn.pipe(_t(1)).subscribe(c=>{!c.length||(c.forEach(u=>{this.sectionData.set(u.reference,Kt(Yt({},u),{progress:0}))}),Ot.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}flipPage(e){const n=this.verticalMode?"scrollHeight":"scrollWidth",r=this.verticalMode?this.height:this.width,o=r+this.pageGap,i=!0;if(this.translateX){const k=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const c=this.translateX;k(),this.scrollToPos(-c-o,i);return}if(this.nextSection(i)){k();return}return}const a=0,l=this.scrollEl[n],s=this.virtualScrollPos$.getValue(),f=s+o*e,g=Math.ceil(f);if(g<a){if(s!==a){this.scrollToPos(a,i);return}this.prevSection(o,n,r,i);return}if(g>=l){this.nextSection(i);return}this.scrollOrTranslateToPos(f,l,r,i)}scrollTo(e,n){const r=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[r],o,n)}prevSection(e,n,r,o){const i=this.sectionIndex$.getValue()-1;return i<0?!1:(this.updateSectionIndex(i).subscribe(()=>{const a=this.scrollEl[n];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,r,o)}),!0)}nextSection(e){const n=this.sectionIndex$.getValue()+1;return n>=this.sections.length?!1:(this.updateSectionIndex(n).subscribe(()=>{var r,o;this.scrollToPos(0,e),this.updateSectionData((r=this.sections[n-1])==null?void 0:r.id,100,!1),this.updateSectionData((o=this.sections[n])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,n,r,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/n*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+r<=n){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,n){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(n)}translateXToPos(e,n){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(n)}updateSectionIndex(e){return new We(n=>{if(this.sectionIndex$.getValue()===e){n.next(),n.complete();return}const r=this.sectionRenderComplete$.subscribe(o=>{o===e&&n.next(),n.complete(),r.unsubscribe()});return this.sectionIndex$.next(e),r})}updateSectionData(e,n,r=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let i=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=n:i?l.progress=0:l.progress=100,!i&&s&&(i=!0),this.sectionData.set(a.reference,l)}),r&&Ot.next(this.sectionData)}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class di{constructor(e,n,r,o,i,a,l,s,f){this.containerEl=e,this.sections=n,this.virtualScrollPos$=r,this.getWidth=o,this.getHeight=i,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=f,this.sectionIndex=-1;const g=c=>Wn(c).reduce((p,w)=>p+jn(w),0);let k=0;this.sectionAccCharCounts=n.map(c=>(k+=g(c),k)),this.charCount=k}updateCurrentSection(e){this.calculator=new oo(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(){const e=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+e)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const n=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+n}getSectionIndexByCharCount(e){return Rt(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const n=this.getSectionStartCount(),r=this.sectionAccCharCounts[this.sectionIndex],o=e-n,i=e===r&&r-n>0;if(o<0||e>r||i)return-1;if(o===0)return 0;const a=Rt(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,f=l[a];if(Number.isNaN(Number(s[a])))return-1;const g=(w,d)=>w>=d?d:l[w]>f?w:g(w+1,d),k=s[g(a+1,l.length-1)],{screenSize:c}=this,u=this.verticalMode?-1:0,p=c*(Math.ceil(k/c)+u);return rt(p,this.calculator.direction)}isCharOnScreen(e){const n=this.getScrollPosByCharCount(e),r=this.virtualScrollPos$.getValue();return n===r}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class mi{constructor(e,n,r,o,i){this.calculator=e,this.pageManager=n,this.sectionReady$=r,this.sectionIndex$=o,this.setIntendedCharCount=i}scrollToBookmark(e){const n=e.exploredCharCount;if(!n)return;const r=this.calculator.getSectionIndexByCharCount(n),o=l=>{const s=l.getScrollPosByCharCount(n);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(n)};if(this.sectionIndex$.getValue()===r){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount;return{dataId:e,exploredCharCount:n,progress:n/r}}}function wn(t){let e,n,r;return n=new Ge({props:{icon:Po,spin:!0}}),{c(){e=J("div"),ge(n.$$.fragment),this.h()},l(o){e=Q(o,"DIV",{class:!0});var i=Z(e);ke(n.$$.fragment,i),i.forEach(E),this.h()},h(){W(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),I(e,"color",t[4],!1),I(e,"background-color",t[5],!1)},m(o,i){G(o,e,i),pe(n,e,null),r=!0},p(o,i){i[0]&16&&I(e,"color",o[4],!1),i[0]&32&&I(e,"background-color",o[5],!1)},i(o){r||(Y(n.$$.fragment,o),r=!0)},o(o){ee(n.$$.fragment,o),r=!1},d(o){o&&E(e),be(n)}}}function Sn(t){let e,n,r;return n=new Ge({props:{icon:Zt}}),{c(){e=J("div"),ge(n.$$.fragment),this.h()},l(o){e=Q(o,"DIV",{class:!0});var i=Z(e);ke(n.$$.fragment,i),i.forEach(E),this.h()},h(){W(e,"class","fixed top-3 right-3 text-xl opacity-25"),I(e,"color",t[4],!1)},m(o,i){G(o,e,i),pe(n,e,null),r=!0},p(o,i){i[0]&16&&I(e,"color",o[4],!1)},i(o){r||(Y(n.$$.fragment,o),r=!0)},o(o){ee(n.$$.fragment,o),r=!1},d(o){o&&E(e),be(n)}}}function gi(t){let e,n,r,o=`${t[8]}px`,i=`${t[1]}px`,a=`${t[2]}px`,l=`${t[3]?t[1]:(t[1]+it)/t[20]-it}px`,s,f,g,k,c,u;r=new no({props:{html:t[19]}}),r.$on("load",t[21]);let p=!t[18]&&wn(t),w=t[0]&&Sn(t);return{c(){e=J("div"),n=J("div"),ge(r.$$.fragment),s=oe(),p&&p.c(),f=oe(),w&&w.c(),g=at(),this.h()},l(d){e=Q(d,"DIV",{class:!0});var S=Z(e);n=Q(S,"DIV",{class:!0});var F=Z(n);ke(r.$$.fragment,F),F.forEach(E),S.forEach(E),s=re(d),p&&p.l(d),f=re(d),w&&w.l(d),g=at(),this.h()},h(){W(n,"class","book-content-container svelte-np4m3j"),W(e,"class","book-content m-auto svelte-np4m3j"),j(e,"book-content--avoid-page-break",t[14]),j(e,"book-content--writing-vertical-rl",t[3]),j(e,"book-content--writing-horizontal-rl",!t[3]),j(e,"book-content--hide-furigana",t[12]),j(e,"book-content--hide-spoiler-image",t[11]),j(e,"book-content--furigana-style-partial",t[13]===Ee.Partial),j(e,"book-content--furigana-style-full",t[13]===Ee.Full),j(e,"book-content--furigana-style-toggle",t[13]===Ee.Toggle),I(e,"color",t[4],!1),I(e,"font-size",o,!1),I(e,"padding-top",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),I(e,"padding-bottom",!t[3]&&t[15]?`${t[15]}px`:void 0,!1),I(e,"padding-left",t[3]&&t[15]?`${t[15]}px`:void 0,!1),I(e,"padding-right",t[3]&&t[15]?`${t[15]}px`:void 0,!1),I(e,"max-width",t[1]?`${t[1]}px`:void 0,!1),I(e,"max-height",t[3]&&t[2]?`${t[2]}px`:void 0,!1),I(e,"--font-family-serif",t[9],!1),I(e,"--font-family-sans-serif",t[10],!1),I(e,"--book-content-hint-furigana-font-color",t[6],!1),I(e,"--book-content-hint-furigana-shadow-color",t[7],!1),I(e,"--book-content-child-width",i,!1),I(e,"--book-content-child-height",a,!1),I(e,"--book-content-column-count",t[20],!1),I(e,"--book-content-image-max-width",l,!1)},m(d,S){G(d,e,S),K(e,n),pe(r,n,null),t[37](n),t[38](e),G(d,s,S),p&&p.m(d,S),G(d,f,S),w&&w.m(d,S),G(d,g,S),k=!0,c||(u=[ve(window,"keydown",t[23]),an(ci.call(null,e,{timeframe:500,minSwipeDistance:10,touchAction:"pan-y"})),ve(e,"swipe",t[22])],c=!0)},p(d,S){const F={};S[0]&524288&&(F.html=d[19]),r.$set(F),S[0]&16384&&j(e,"book-content--avoid-page-break",d[14]),S[0]&8&&j(e,"book-content--writing-vertical-rl",d[3]),S[0]&8&&j(e,"book-content--writing-horizontal-rl",!d[3]),S[0]&4096&&j(e,"book-content--hide-furigana",d[12]),S[0]&2048&&j(e,"book-content--hide-spoiler-image",d[11]),S[0]&8192&&j(e,"book-content--furigana-style-partial",d[13]===Ee.Partial),S[0]&8192&&j(e,"book-content--furigana-style-full",d[13]===Ee.Full),S[0]&8192&&j(e,"book-content--furigana-style-toggle",d[13]===Ee.Toggle),S[0]&16&&I(e,"color",d[4],!1),S[0]&256&&o!==(o=`${d[8]}px`)&&I(e,"font-size",o,!1),S[0]&32776&&I(e,"padding-top",!d[3]&&d[15]?`${d[15]}px`:void 0,!1),S[0]&32776&&I(e,"padding-bottom",!d[3]&&d[15]?`${d[15]}px`:void 0,!1),S[0]&32776&&I(e,"padding-left",d[3]&&d[15]?`${d[15]}px`:void 0,!1),S[0]&32776&&I(e,"padding-right",d[3]&&d[15]?`${d[15]}px`:void 0,!1),S[0]&2&&I(e,"max-width",d[1]?`${d[1]}px`:void 0,!1),S[0]&12&&I(e,"max-height",d[3]&&d[2]?`${d[2]}px`:void 0,!1),S[0]&512&&I(e,"--font-family-serif",d[9],!1),S[0]&1024&&I(e,"--font-family-sans-serif",d[10],!1),S[0]&64&&I(e,"--book-content-hint-furigana-font-color",d[6],!1),S[0]&128&&I(e,"--book-content-hint-furigana-shadow-color",d[7],!1),S[0]&2&&i!==(i=`${d[1]}px`)&&I(e,"--book-content-child-width",i,!1),S[0]&4&&a!==(a=`${d[2]}px`)&&I(e,"--book-content-child-height",a,!1),S[0]&1048576&&I(e,"--book-content-column-count",d[20],!1),S[0]&1048586&&l!==(l=`${d[3]?d[1]:(d[1]+it)/d[20]-it}px`)&&I(e,"--book-content-image-max-width",l,!1),d[18]?p&&(Ye(),ee(p,1,1,()=>{p=null}),Ke()):p?(p.p(d,S),S[0]&262144&&Y(p,1)):(p=wn(d),p.c(),Y(p,1),p.m(f.parentNode,f)),d[0]?w?(w.p(d,S),S[0]&1&&Y(w,1)):(w=Sn(d),w.c(),Y(w,1),w.m(g.parentNode,g)):w&&(Ye(),ee(w,1,1,()=>{w=null}),Ke())},i(d){k||(Y(r.$$.fragment,d),Y(p),Y(w),k=!0)},o(d){ee(r.$$.fragment,d),ee(p),ee(w),k=!1},d(d){d&&E(e),be(r),t[37](null),t[38](null),d&&E(s),p&&p.d(d),d&&E(f),w&&w.d(d),d&&E(g),c=!1,Ct(u)}}}const yn="overflow-hidden",it=20;function ki(t,e,n){let r,o;x(t,et,M=>n(42,o=M));let{htmlContent:i}=e,{width:a}=e,{height:l}=e,{verticalMode:s}=e,{fontColor:f}=e,{backgroundColor:g}=e,{hintFuriganaFontColor:k}=e,{hintFuriganaShadowColor:c}=e,{fontSize:u}=e,{fontFamilyGroupOne:p}=e,{fontFamilyGroupTwo:w}=e,{hideSpoilerImage:d}=e,{hideFurigana:S}=e,{furiganaStyle:F}=e,{loadingState:h}=e,{bookmarkData:v}=e,{pageManager:D}=e,{bookmarkManager:V}=e,{exploredCharCount:T}=e,{bookCharCount:z}=e,{isBookmarkScreen:N=!1}=e,{avoidPageBreak:U=!0}=e,{pageColumns:m}=e,{firstDimensionMargin:B}=e,{autoBookmark:C=!1}=e;const A=Lt();let R,q,L,te=[],X,$,y,O=!1,ae="",H=!0,Ce=0;const le=new Me,we=new Me,fe=new Tt(-1),Se=new Me,ye=new Tt(0),Fe=new Me,me=new Me,Be=fe.pipe(_e(M=>{var P;return((P=te[M])==null?void 0:P.innerHTML)||""})),ce=new Me;rn(()=>{document.body.classList.remove(yn),ce.next(),ce.complete()}),bt([le,we]).pipe(en(1),kt(()=>me.pipe(_t(1))),Ae(ce)).subscribe(()=>{if(!L||!X)return;const M=L.getScrollPosByCharCount(Ce);M<0||X.scrollTo(M,!1)}),Se.pipe(Ae(ce)).subscribe(M=>{!L||(n(26,T=L.calcExploredCharCount()),M&&(Ce=T),v.then(Re))}),C&&Se.pipe(Vt(3e3),Ae(ce)).subscribe(M=>{M&&A("bookmark")}),Be.pipe($n(),Ae(ce)).subscribe(()=>{n(18,O=!1)}),Be.pipe(Ae(ce)).subscribe(M=>{const P=(ne,Ie)=>{if(Ie===0){ne();return}requestAnimationFrame(()=>P(ne,Ie-1))};P(()=>{n(19,ae=M)},2)}),mt(()=>Xe(document.body,"wheel",{passive:!0})).pipe(Rr(50),Ae(ce)).subscribe(M=>{if(!o){let P=(M.deltaX<0?-1:1)*(s?-1:1);M.deltaX||(P=M.deltaY<0?-1:1),X==null||X.flipPage(P)}});function Ve(){if(H){H=!1;return}!R||(n(33,L=new di(R,te,ye,()=>a,()=>l,()=>it,s,R,document)),n(26,T=0),Ce=0,n(27,z=L.charCount),L.updateCurrentSection(fe.getValue()),A("contentChange",R))}function Oe(M){M.updateParagraphPos(),n(26,T=M.calcExploredCharCount()),me.next(M),v.then(Re),y&&(y=!1,v.then(P=>{!P||!V||V.scrollToBookmark(P)})),n(18,O=!0)}function Re(M){const P=M==null?void 0:M.exploredCharCount;!L||!P||n(0,N=L.isCharOnScreen(P))}function je(M){if(!X||o||M.detail.direction!=="left"&&M.detail.direction!=="right")return;const P=M.detail.direction==="left",ne=s?!P:P;X.flipPage(ne?1:-1)}function xe(M){if(!(!X||o))switch(M.code){case"ArrowLeft":X[s?"nextPage":"prevPage"]();break;case"ArrowRight":X[s?"prevPage":"nextPage"]();break;case"ArrowUp":X.prevPage();break;case"ArrowDown":X.nextPage();break}}wt.pipe(Ae(ce)).subscribe(M=>{const P=te.findIndex(ne=>ne.id===M||ne.querySelector(`[id="${M}"]`));P>-1&&(fe.next(P),X==null||X.scrollTo(0,!0))});function Ne(M){ie[M?"unshift":"push"](()=>{q=M,n(17,q)})}function $e(M){ie[M?"unshift":"push"](()=>{R=M,n(16,R)})}return t.$$set=M=>{"htmlContent"in M&&n(28,i=M.htmlContent),"width"in M&&n(1,a=M.width),"height"in M&&n(2,l=M.height),"verticalMode"in M&&n(3,s=M.verticalMode),"fontColor"in M&&n(4,f=M.fontColor),"backgroundColor"in M&&n(5,g=M.backgroundColor),"hintFuriganaFontColor"in M&&n(6,k=M.hintFuriganaFontColor),"hintFuriganaShadowColor"in M&&n(7,c=M.hintFuriganaShadowColor),"fontSize"in M&&n(8,u=M.fontSize),"fontFamilyGroupOne"in M&&n(9,p=M.fontFamilyGroupOne),"fontFamilyGroupTwo"in M&&n(10,w=M.fontFamilyGroupTwo),"hideSpoilerImage"in M&&n(11,d=M.hideSpoilerImage),"hideFurigana"in M&&n(12,S=M.hideFurigana),"furiganaStyle"in M&&n(13,F=M.furiganaStyle),"loadingState"in M&&n(29,h=M.loadingState),"bookmarkData"in M&&n(30,v=M.bookmarkData),"pageManager"in M&&n(24,D=M.pageManager),"bookmarkManager"in M&&n(25,V=M.bookmarkManager),"exploredCharCount"in M&&n(26,T=M.exploredCharCount),"bookCharCount"in M&&n(27,z=M.bookCharCount),"isBookmarkScreen"in M&&n(0,N=M.isBookmarkScreen),"avoidPageBreak"in M&&n(14,U=M.avoidPageBreak),"pageColumns"in M&&n(31,m=M.pageColumns),"firstDimensionMargin"in M&&n(15,B=M.firstDimensionMargin),"autoBookmark"in M&&n(32,C=M.autoBookmark)},t.$$.update=()=>{if(t.$$.dirty[0]&1073741824&&v.then(Re),t.$$.dirty[0]&2&&a&&le.next(a),t.$$.dirty[0]&4&&l&&we.next(l),t.$$.dirty[0]&10|t.$$.dirty[1]&1&&n(20,r=s?1:m||Math.ceil(a/1e3)),t.$$.dirty[0]&268435456&&i&&(y=!0),t.$$.dirty[0]&268435456){const M=document.createElement("div");M.innerHTML=i,n(34,te=Array.from(M.children)),fe.next(0)}if(t.$$.dirty[0]&196622|t.$$.dirty[1]&24&&q&&R&&te&&(n(35,X=new hi(q,R,te,fe,ye,a,l,it,s,Se,Fe)),n(24,D=X)),t.$$.dirty[0]&536870918|t.$$.dirty[1]&4&&L&&a&&l&&!h){const M=L;requestAnimationFrame(()=>{Oe(M)})}t.$$.dirty[0]&536870912|t.$$.dirty[1]&4&&L&&!h&&Fe.next(fe.getValue()),t.$$.dirty[1]&52&&L&&X&&(n(36,$=new mi(L,X,me,fe,M=>Ce=M)),n(25,V=$))},document.body.classList.add(yn),[N,a,l,s,f,g,k,c,u,p,w,d,S,F,U,B,R,q,O,ae,r,Ve,je,xe,D,V,T,z,i,h,v,m,C,L,te,X,$,Ne,$e]}class pi extends Je{constructor(e){super();Qe(this,e,ki,gi,Ze,{htmlContent:28,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,loadingState:29,bookmarkData:30,pageManager:24,bookmarkManager:25,exploredCharCount:26,bookCharCount:27,isBookmarkScreen:0,avoidPageBreak:14,pageColumns:31,firstDimensionMargin:15,autoBookmark:32},null,[-1,-1])}}function bi(t){var d,S,F;let e,n,r,o,i,a,l,s;function f(h){t[48](h)}function g(h){t[49](h)}function k(h){t[50](h)}function c(h){t[51](h)}function u(h){t[52](h)}function p(h){t[53](h)}let w={htmlContent:t[7],width:(d=t[28])!=null?d:0,height:(S=t[29])!=null?S:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],loadingState:(F=t[30])!=null?F:!0,avoidPageBreak:t[22],pageColumns:t[23],autoBookmark:t[24],firstDimensionMargin:t[20]};return t[0]!==void 0&&(w.exploredCharCount=t[0]),t[1]!==void 0&&(w.bookCharCount=t[1]),t[6]!==void 0&&(w.isBookmarkScreen=t[6]),t[2]!==void 0&&(w.bookmarkData=t[2]),t[4]!==void 0&&(w.bookmarkManager=t[4]),t[5]!==void 0&&(w.pageManager=t[5]),e=new pi({props:w}),ie.push(()=>he(e,"exploredCharCount",f)),ie.push(()=>he(e,"bookCharCount",g)),ie.push(()=>he(e,"isBookmarkScreen",k)),ie.push(()=>he(e,"bookmarkData",c)),ie.push(()=>he(e,"bookmarkManager",u)),ie.push(()=>he(e,"pageManager",p)),e.$on("contentChange",t[54]),e.$on("bookmark",t[55]),{c(){ge(e.$$.fragment)},l(h){ke(e.$$.fragment,h)},m(h,v){pe(e,h,v),s=!0},p(h,v){var V,T,z;const D={};v[0]&128&&(D.htmlContent=h[7]),v[0]&268435456&&(D.width=(V=h[28])!=null?V:0),v[0]&536870912&&(D.height=(T=h[29])!=null?T:0),v[0]&256&&(D.verticalMode=h[8]),v[0]&512&&(D.fontColor=h[9]),v[0]&1024&&(D.backgroundColor=h[10]),v[0]&2048&&(D.hintFuriganaFontColor=h[11]),v[0]&4096&&(D.hintFuriganaShadowColor=h[12]),v[0]&8192&&(D.fontSize=h[13]),v[0]&16384&&(D.fontFamilyGroupOne=h[14]),v[0]&32768&&(D.fontFamilyGroupTwo=h[15]),v[0]&65536&&(D.hideSpoilerImage=h[16]),v[0]&131072&&(D.hideFurigana=h[17]),v[0]&262144&&(D.furiganaStyle=h[18]),v[0]&1073741824&&(D.loadingState=(z=h[30])!=null?z:!0),v[0]&4194304&&(D.avoidPageBreak=h[22]),v[0]&8388608&&(D.pageColumns=h[23]),v[0]&16777216&&(D.autoBookmark=h[24]),v[0]&1048576&&(D.firstDimensionMargin=h[20]),!n&&v[0]&1&&(n=!0,D.exploredCharCount=h[0],de(()=>n=!1)),!r&&v[0]&2&&(r=!0,D.bookCharCount=h[1],de(()=>r=!1)),!o&&v[0]&64&&(o=!0,D.isBookmarkScreen=h[6],de(()=>o=!1)),!i&&v[0]&4&&(i=!0,D.bookmarkData=h[2],de(()=>i=!1)),!a&&v[0]&16&&(a=!0,D.bookmarkManager=h[4],de(()=>a=!1)),!l&&v[0]&32&&(l=!0,D.pageManager=h[5],de(()=>l=!1)),e.$set(D)},i(h){s||(Y(e.$$.fragment,h),s=!0)},o(h){ee(e.$$.fragment,h),s=!1},d(h){be(e,h)}}}function Ci(t){var d,S,F;let e,n,r,o,i,a,l,s;function f(h){t[40](h)}function g(h){t[41](h)}function k(h){t[42](h)}function c(h){t[43](h)}function u(h){t[44](h)}function p(h){t[45](h)}let w={htmlContent:t[7],width:(d=t[28])!=null?d:0,height:(S=t[29])!=null?S:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],secondDimensionMaxValue:t[19],firstDimensionMargin:t[20],autoPositionOnResize:t[21],autoBookmark:t[24],multiplier:t[26],loadingState:(F=t[30])!=null?F:!0};return t[0]!==void 0&&(w.exploredCharCount=t[0]),t[1]!==void 0&&(w.bookCharCount=t[1]),t[2]!==void 0&&(w.bookmarkData=t[2]),t[3]!==void 0&&(w.autoScroller=t[3]),t[4]!==void 0&&(w.bookmarkManager=t[4]),t[5]!==void 0&&(w.pageManager=t[5]),e=new $r({props:w}),ie.push(()=>he(e,"exploredCharCount",f)),ie.push(()=>he(e,"bookCharCount",g)),ie.push(()=>he(e,"bookmarkData",k)),ie.push(()=>he(e,"autoScroller",c)),ie.push(()=>he(e,"bookmarkManager",u)),ie.push(()=>he(e,"pageManager",p)),e.$on("contentChange",t[46]),e.$on("bookmark",t[47]),{c(){ge(e.$$.fragment)},l(h){ke(e.$$.fragment,h)},m(h,v){pe(e,h,v),s=!0},p(h,v){var V,T,z;const D={};v[0]&128&&(D.htmlContent=h[7]),v[0]&268435456&&(D.width=(V=h[28])!=null?V:0),v[0]&536870912&&(D.height=(T=h[29])!=null?T:0),v[0]&256&&(D.verticalMode=h[8]),v[0]&512&&(D.fontColor=h[9]),v[0]&1024&&(D.backgroundColor=h[10]),v[0]&2048&&(D.hintFuriganaFontColor=h[11]),v[0]&4096&&(D.hintFuriganaShadowColor=h[12]),v[0]&8192&&(D.fontSize=h[13]),v[0]&16384&&(D.fontFamilyGroupOne=h[14]),v[0]&32768&&(D.fontFamilyGroupTwo=h[15]),v[0]&65536&&(D.hideSpoilerImage=h[16]),v[0]&131072&&(D.hideFurigana=h[17]),v[0]&262144&&(D.furiganaStyle=h[18]),v[0]&524288&&(D.secondDimensionMaxValue=h[19]),v[0]&1048576&&(D.firstDimensionMargin=h[20]),v[0]&2097152&&(D.autoPositionOnResize=h[21]),v[0]&16777216&&(D.autoBookmark=h[24]),v[0]&67108864&&(D.multiplier=h[26]),v[0]&1073741824&&(D.loadingState=(z=h[30])!=null?z:!0),!n&&v[0]&1&&(n=!0,D.exploredCharCount=h[0],de(()=>n=!1)),!r&&v[0]&2&&(r=!0,D.bookCharCount=h[1],de(()=>r=!1)),!o&&v[0]&4&&(o=!0,D.bookmarkData=h[2],de(()=>o=!1)),!i&&v[0]&8&&(i=!0,D.autoScroller=h[3],de(()=>i=!1)),!a&&v[0]&16&&(a=!0,D.bookmarkManager=h[4],de(()=>a=!1)),!l&&v[0]&32&&(l=!0,D.pageManager=h[5],de(()=>l=!1)),e.$set(D)},i(h){s||(Y(e.$$.fragment,h),s=!0)},o(h){ee(e.$$.fragment,h),s=!1},d(h){be(e,h)}}}function _i(t){var k;let e,n,r,o,i=((k=t[31])!=null?k:"")+"",a,l;const s=[Ci,bi],f=[];function g(c,u){return c[25]===Et.Continuous?0:1}return n=g(t),r=f[n]=s[n](t),{c(){e=J("div"),r.c(),o=oe(),a=se(i),this.h()},l(c){e=Q(c,"DIV",{class:!0});var u=Z(e);r.l(u),u.forEach(E),o=re(c),a=ue(c,i),this.h()},h(){W(e,"class",ei+" py-8")},m(c,u){G(c,e,u),f[n].m(e,null),t[56](e),G(c,o,u),G(c,a,u),l=!0},p(c,u){var w;let p=n;n=g(c),n===p?f[n].p(c,u):(Ye(),ee(f[p],1,1,()=>{f[p]=null}),Ke(),r=f[n],r?r.p(c,u):(r=f[n]=s[n](c),r.c()),Y(r,1),r.m(e,null)),(!l||u[1]&1)&&i!==(i=((w=c[31])!=null?w:"")+"")&&Pe(a,i)},i(c){l||(Y(r),l=!0)},o(c){ee(r),l=!1},d(c){c&&E(e),f[n].d(),t[56](null),c&&E(o),c&&E(a)}}}function Pt(t){return Number(t.replace(/px$/,""))}function vi(t,e,n){let r,o,i,a,l,s,{htmlContent:f}=e,{width:g}=e,{height:k}=e,{verticalMode:c}=e,{fontColor:u}=e,{backgroundColor:p}=e,{hintFuriganaFontColor:w}=e,{hintFuriganaShadowColor:d}=e,{fontSize:S}=e,{fontFamilyGroupOne:F}=e,{fontFamilyGroupTwo:h}=e,{hideSpoilerImage:v}=e,{hideFurigana:D}=e,{furiganaStyle:V}=e,{secondDimensionMaxValue:T}=e,{firstDimensionMargin:z}=e,{autoPositionOnResize:N}=e,{avoidPageBreak:U}=e,{pageColumns:m}=e,{autoBookmark:B}=e,{viewMode:C}=e,{exploredCharCount:A}=e,{bookCharCount:R}=e,{multiplier:q}=e,{bookmarkData:L}=e,{autoScroller:te}=e,{bookmarkManager:X}=e,{pageManager:$}=e,{isBookmarkScreen:y}=e;const O=new Me,ae=new Me,H=cr(null);x(t,H,b=>n(27,o=b));const Ce=bt([H.pipe(Gt(b=>!!b)),bt([O,ae]).pipe(tn(0))]).pipe(Vt(0,Ht),_e(([b])=>getComputedStyle(b)),nn({refCount:!0,bufferSize:1})),le=new Wo(1),we=Ce.pipe(_e(b=>Fe(g-Pt(b.paddingLeft)-Pt(b.paddingRight))));x(t,we,b=>n(28,i=b));const fe=Ce.pipe(_e(b=>me(k-Pt(b.paddingTop)-Pt(b.paddingBottom)-r)));x(t,fe,b=>n(29,a=b));const Se=mt(()=>Yn(document)).pipe(Dt(b=>{const Wt=oi(b,V);return le.pipe(Dt(jt=>Wt(jt)))}),ot());x(t,Se,b=>n(31,s=b));const ye=le.pipe(Dt(b=>ti(b)),on());x(t,ye,b=>n(30,l=b));function Fe(b){return Et.Paginated===C&&!c&&T?Math.min(T,b):b}function me(b){return Et.Paginated===C&&c&&T?Math.min(T,b):b}function Be(b){A=b,n(0,A)}function ce(b){R=b,n(1,R)}function Ve(b){L=b,n(2,L)}function Oe(b){te=b,n(3,te)}function Re(b){X=b,n(4,X)}function je(b){$=b,n(5,$)}const xe=b=>le.next(b.detail);function Ne(b){cn.call(this,t,b)}function $e(b){A=b,n(0,A)}function M(b){R=b,n(1,R)}function P(b){y=b,n(6,y)}function ne(b){L=b,n(2,L)}function Ie(b){X=b,n(4,X)}function De(b){$=b,n(5,$)}const ze=b=>le.next(b.detail);function St(b){cn.call(this,t,b)}function Le(b){ie[b?"unshift":"push"](()=>{o=b,H.set(o)})}return t.$$set=b=>{"htmlContent"in b&&n(7,f=b.htmlContent),"width"in b&&n(38,g=b.width),"height"in b&&n(39,k=b.height),"verticalMode"in b&&n(8,c=b.verticalMode),"fontColor"in b&&n(9,u=b.fontColor),"backgroundColor"in b&&n(10,p=b.backgroundColor),"hintFuriganaFontColor"in b&&n(11,w=b.hintFuriganaFontColor),"hintFuriganaShadowColor"in b&&n(12,d=b.hintFuriganaShadowColor),"fontSize"in b&&n(13,S=b.fontSize),"fontFamilyGroupOne"in b&&n(14,F=b.fontFamilyGroupOne),"fontFamilyGroupTwo"in b&&n(15,h=b.fontFamilyGroupTwo),"hideSpoilerImage"in b&&n(16,v=b.hideSpoilerImage),"hideFurigana"in b&&n(17,D=b.hideFurigana),"furiganaStyle"in b&&n(18,V=b.furiganaStyle),"secondDimensionMaxValue"in b&&n(19,T=b.secondDimensionMaxValue),"firstDimensionMargin"in b&&n(20,z=b.firstDimensionMargin),"autoPositionOnResize"in b&&n(21,N=b.autoPositionOnResize),"avoidPageBreak"in b&&n(22,U=b.avoidPageBreak),"pageColumns"in b&&n(23,m=b.pageColumns),"autoBookmark"in b&&n(24,B=b.autoBookmark),"viewMode"in b&&n(25,C=b.viewMode),"exploredCharCount"in b&&n(0,A=b.exploredCharCount),"bookCharCount"in b&&n(1,R=b.bookCharCount),"multiplier"in b&&n(26,q=b.multiplier),"bookmarkData"in b&&n(2,L=b.bookmarkData),"autoScroller"in b&&n(3,te=b.autoScroller),"bookmarkManager"in b&&n(4,X=b.bookmarkManager),"pageManager"in b&&n(5,$=b.pageManager),"isBookmarkScreen"in b&&n(6,y=b.isBookmarkScreen)},t.$$.update=()=>{t.$$.dirty[0]&34603264&&(r=z&&Et.Paginated===C&&!c?z*2:0),t.$$.dirty[1]&128&&O.next(g),t.$$.dirty[1]&256&&ae.next(k)},[A,R,L,te,X,$,y,f,c,u,p,w,d,S,F,h,v,D,V,T,z,N,U,m,B,C,q,o,i,a,l,s,H,le,we,fe,Se,ye,g,k,Be,ce,Ve,Oe,Re,je,xe,Ne,$e,M,P,ne,Ie,De,ze,St,Le]}class wi extends Je{constructor(e){super();Qe(this,e,vi,_i,Ze,{htmlContent:7,width:38,height:39,verticalMode:8,fontColor:9,backgroundColor:10,hintFuriganaFontColor:11,hintFuriganaShadowColor:12,fontSize:13,fontFamilyGroupOne:14,fontFamilyGroupTwo:15,hideSpoilerImage:16,hideFurigana:17,furiganaStyle:18,secondDimensionMaxValue:19,firstDimensionMargin:20,autoPositionOnResize:21,avoidPageBreak:22,pageColumns:23,autoBookmark:24,viewMode:25,exploredCharCount:0,bookCharCount:1,multiplier:26,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6},null,[-1,-1,-1])}}function Si(t,e){const n=document.createTextNode(e);if(t.firstChild){t.replaceChild(n,t.firstChild);return}t.appendChild(n)}function yi(t,e,n){let{styleSheet:r}=e,o;return Nn(()=>{n(1,o=document.createElement("style")),document.head.appendChild(o)}),rn(()=>{o&&document.head.removeChild(o)}),t.$$set=i=>{"styleSheet"in i&&n(0,r=i.styleSheet)},t.$$.update=()=>{t.$$.dirty&3&&o&&Si(o,r)},[r,o]}class Mi extends Je{constructor(e){super();Qe(this,e,yi,null,Ze,{styleSheet:0})}}function Mn(t){let e,n,r,o,i,a;return n=new Ge({props:{icon:Io}}),{c(){e=J("div"),ge(n.$$.fragment),this.h()},l(l){e=Q(l,"DIV",{class:!0,role:!0});var s=Z(e);ke(n.$$.fragment,s),s.forEach(E),this.h()},h(){W(e,"class",r="flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer"),W(e,"role","button")},m(l,s){G(l,e,s),pe(n,e,null),o=!0,i||(a=ve(e,"click",t[5]),i=!0)},p:lt,i(l){o||(Y(n.$$.fragment,l),o=!0)},o(l){ee(n.$$.fragment,l),o=!1},d(l){l&&E(e),be(n),i=!1,a()}}}function Pn(t){let e,n,r,o,i,a;return n=new Ge({props:{icon:To}}),{c(){e=J("div"),ge(n.$$.fragment),this.h()},l(l){e=Q(l,"DIV",{role:!0,class:!0});var s=Z(e);ke(n.$$.fragment,s),s.forEach(E),this.h()},h(){W(e,"role","button"),W(e,"class",r="flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer")},m(l,s){G(l,e,s),pe(n,e,null),o=!0,i||(a=ve(e,"click",t[7]),i=!0)},p:lt,i(l){o||(Y(n.$$.fragment,l),o=!0)},o(l){ee(n.$$.fragment,l),o=!1},d(l){l&&E(e),be(n),i=!1,a()}}}function Pi(t){let e,n,r,o,i,a,l,s,f,g,k,c,u,p,w,d,S,F,h,v,D,V,T=t[0]&&Mn(t);i=new Ge({props:{icon:t[3]?Zt:gn}});let z=t[2]&&Pn(t);return w=new Ge({props:{icon:Fo}}),h=new Ge({props:{icon:Do}}),{c(){e=J("div"),n=J("div"),T&&T.c(),r=oe(),o=J("div"),ge(i.$$.fragment),a=oe(),l=J("div"),s=se(t[1]),f=se("x"),g=oe(),k=J("div"),z&&z.c(),c=oe(),u=J("a"),p=J("span"),ge(w.$$.fragment),d=oe(),S=J("a"),F=J("span"),ge(h.$$.fragment),this.h()},l(N){e=Q(N,"DIV",{class:!0});var U=Z(e);n=Q(U,"DIV",{class:!0});var m=Z(n);T&&T.l(m),r=re(m),o=Q(m,"DIV",{class:!0,role:!0});var B=Z(o);ke(i.$$.fragment,B),B.forEach(E),a=re(m),l=Q(m,"DIV",{class:!0});var C=Z(l);s=ue(C,t[1]),f=ue(C,"x"),C.forEach(E),m.forEach(E),g=re(U),k=Q(U,"DIV",{class:!0});var A=Z(k);z&&z.l(A),c=re(A),u=Q(A,"A",{href:!0});var R=Z(u);p=Q(R,"SPAN",{class:!0});var q=Z(p);ke(w.$$.fragment,q),q.forEach(E),R.forEach(E),d=re(A),S=Q(A,"A",{href:!0});var L=Z(S);F=Q(L,"SPAN",{class:!0});var te=Z(F);ke(h.$$.fragment,te),te.forEach(E),L.forEach(E),A.forEach(E),U.forEach(E),this.h()},h(){W(o,"class","flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer"),W(o,"role","button"),W(l,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg"),W(n,"class","flex transform-gpu "+Eo),W(p,"class","flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer"),W(u,"href","/ebook-reader/settings"),W(F,"class","flex h-full items-center text-xl xl:text-lg "+ct+" "+ht+" cursor-pointer"),W(S,"href","/ebook-reader/manage"),W(k,"class","flex transform-gpu "+Bo),W(e,"class","flex h-12 justify-between bg-gray-700 px-4 text-white md:px-8 xl:h-10")},m(N,U){G(N,e,U),K(e,n),T&&T.m(n,null),K(n,r),K(n,o),pe(i,o,null),K(n,a),K(n,l),K(l,s),K(l,f),K(e,g),K(e,k),z&&z.m(k,null),K(k,c),K(k,u),K(u,p),pe(w,p,null),K(k,d),K(k,S),K(S,F),pe(h,F,null),v=!0,D||(V=[ve(o,"click",t[6]),ve(u,"click",t[8]),ve(S,"click",t[9])],D=!0)},p(N,[U]){N[0]?T?(T.p(N,U),U&1&&Y(T,1)):(T=Mn(N),T.c(),Y(T,1),T.m(n,r)):T&&(Ye(),ee(T,1,1,()=>{T=null}),Ke());const m={};U&8&&(m.icon=N[3]?Zt:gn),i.$set(m),(!v||U&2)&&Pe(s,N[1]),N[2]?z?(z.p(N,U),U&4&&Y(z,1)):(z=Pn(N),z.c(),Y(z,1),z.m(k,c)):z&&(Ye(),ee(z,1,1,()=>{z=null}),Ke())},i(N){v||(Y(T),Y(i.$$.fragment,N),Y(z),Y(w.$$.fragment,N),Y(h.$$.fragment,N),v=!0)},o(N){ee(T),ee(i.$$.fragment,N),ee(z),ee(w.$$.fragment,N),ee(h.$$.fragment,N),v=!1},d(N){N&&E(e),T&&T.d(),be(i),z&&z.d(),be(w),be(h),D=!1,Ct(V)}}}function Fi(t,e,n){let{hasChapterData:r}=e,{autoScrollMultiplier:o}=e,{showFullscreenButton:i}=e,{isBookmarkScreen:a}=e;const l=Lt(),s=()=>l("tocClick"),f=()=>l("bookmarkClick"),g=()=>l("fullscreenClick"),k=()=>l("settingsClick"),c=()=>l("bookManagerClick");return t.$$set=u=>{"hasChapterData"in u&&n(0,r=u.hasChapterData),"autoScrollMultiplier"in u&&n(1,o=u.autoScrollMultiplier),"showFullscreenButton"in u&&n(2,i=u.showFullscreenButton),"isBookmarkScreen"in u&&n(3,a=u.isBookmarkScreen)},[r,o,i,a,l,s,f,g,k,c]}class Di extends Je{constructor(e){super();Qe(this,e,Fi,Pi,Ze,{hasChapterData:0,autoScrollMultiplier:1,showFullscreenButton:2,isBookmarkScreen:3})}}function Fn(t,e,n){const r=t.slice();return r[15]=e[n],r}function Dn(t,e){let n,r,o=e[15].label+"",i,a,l,s,f=e[15].startCharacter+"",g,k,c,u;function p(){return e[12](e[15])}return{key:t,first:null,c(){n=J("div"),r=J("div"),i=se(o),l=oe(),s=J("div"),g=se(f),k=oe(),this.h()},l(w){n=Q(w,"DIV",{class:!0});var d=Z(n);r=Q(d,"DIV",{id:!0,class:!0});var S=Z(r);i=ue(S,o),S.forEach(E),l=re(d),s=Q(d,"DIV",{});var F=Z(s);g=ue(F,f),F.forEach(E),k=re(d),d.forEach(E),this.h()},h(){W(r,"id",a=`for${e[15].reference}`),W(r,"class","mr-4 cursor-pointer"),j(r,"opacity-30",e[15].progress===100&&e[15]!==e[1]),j(r,"hover:opacity-100",e[15].progress===100&&e[15]!==e[1]),j(r,"hover:opacity-60",e[15].progress<100||e[15]===e[1]),j(s,"opacity-30",e[15].progress===100&&e[15]!==e[1]),W(n,"class","my-6 flex justify-between"),this.first=n},m(w,d){G(w,n,d),K(n,r),K(r,i),K(n,l),K(n,s),K(s,g),K(n,k),c||(u=ve(r,"click",p),c=!0)},p(w,d){e=w,d&1&&o!==(o=e[15].label+"")&&Pe(i,o),d&1&&a!==(a=`for${e[15].reference}`)&&W(r,"id",a),d&3&&j(r,"opacity-30",e[15].progress===100&&e[15]!==e[1]),d&3&&j(r,"hover:opacity-100",e[15].progress===100&&e[15]!==e[1]),d&3&&j(r,"hover:opacity-60",e[15].progress<100||e[15]===e[1]),d&1&&f!==(f=e[15].startCharacter+"")&&Pe(g,f),d&3&&j(s,"opacity-30",e[15].progress===100&&e[15]!==e[1])},d(w){w&&E(n),c=!1,u()}}}function Ei(t){let e,n,r,o,i,a,l,s,f,g,k,c,u=[],p=new Map,w,d,S,F,h,v,D,V,T,z;g=new Ge({props:{icon:Ao}});let N=t[0];const U=m=>m[15].reference;for(let m=0;m<N.length;m+=1){let B=Fn(t,N,m),C=U(B);p.set(C,u[m]=Dn(C,B))}return F=new Ge({props:{icon:Vo}}),D=new Ge({props:{icon:Oo}}),{c(){e=J("div"),n=J("div"),r=se("Chapter Progress: "),o=se(t[2]),i=se(" ("),a=se(t[3]),l=se("%)"),s=oe(),f=J("div"),ge(g.$$.fragment),k=oe(),c=J("div");for(let m=0;m<u.length;m+=1)u[m].c();w=oe(),d=J("div"),S=J("div"),ge(F.$$.fragment),h=oe(),v=J("div"),ge(D.$$.fragment),this.h()},l(m){e=Q(m,"DIV",{class:!0});var B=Z(e);n=Q(B,"DIV",{});var C=Z(n);r=ue(C,"Chapter Progress: "),o=ue(C,t[2]),i=ue(C," ("),a=ue(C,t[3]),l=ue(C,"%)"),C.forEach(E),s=re(B),f=Q(B,"DIV",{class:!0});var A=Z(f);ke(g.$$.fragment,A),A.forEach(E),B.forEach(E),k=re(m),c=Q(m,"DIV",{class:!0});var R=Z(c);for(let X=0;X<u.length;X+=1)u[X].l(R);R.forEach(E),w=re(m),d=Q(m,"DIV",{class:!0});var q=Z(d);S=Q(q,"DIV",{class:!0});var L=Z(S);ke(F.$$.fragment,L),L.forEach(E),h=re(q),v=Q(q,"DIV",{class:!0});var te=Z(v);ke(D.$$.fragment,te),te.forEach(E),q.forEach(E),this.h()},h(){W(f,"class","cursor-pointer"),W(e,"class","flex justify-between p-4"),W(c,"class","flex-1 overflow-auto p-4"),W(S,"class","cursor-pointer"),j(S,"opacity-30",!t[5]),W(v,"class","cursor-pointer"),j(v,"opacity-30",!t[4]),W(d,"class","flex justify-between px-4 py-6")},m(m,B){G(m,e,B),K(e,n),K(n,r),K(n,o),K(n,i),K(n,a),K(n,l),K(e,s),K(e,f),pe(g,f,null),G(m,k,B),G(m,c,B);for(let C=0;C<u.length;C+=1)u[C].m(c,null);G(m,w,B),G(m,d,B),K(d,S),pe(F,S,null),K(d,h),K(d,v),pe(D,v,null),V=!0,T||(z=[ve(f,"click",t[11]),ve(S,"click",t[13]),ve(v,"click",t[14])],T=!0)},p(m,[B]){(!V||B&4)&&Pe(o,m[2]),(!V||B&8)&&Pe(a,m[3]),B&131&&(N=m[0],u=vo(u,B,U,1,m,N,p,c,wo,Dn,null,Fn)),B&32&&j(S,"opacity-30",!m[5]),B&16&&j(v,"opacity-30",!m[4])},i(m){V||(Y(g.$$.fragment,m),Y(F.$$.fragment,m),Y(D.$$.fragment,m),V=!0)},o(m){ee(g.$$.fragment,m),ee(F.$$.fragment,m),ee(D.$$.fragment,m),V=!1},d(m){m&&E(e),be(g),m&&E(k),m&&E(c);for(let B=0;B<u.length;B+=1)u[B].d();m&&E(w),m&&E(d),be(F),be(D),T=!1,Ct(z)}}}function Bi(t,e){const[n,r]=e.reduce((o,i,a)=>(o[0]+=t[a]*i,o[1]+=i,o),[0,0]);return n/r}function En(t){!t||(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView())}function Ii(t,e,n){let r,o,{sectionData:i=[]}=e,{exploredCharCount:a=0}=e,l=[],s,f=-1,g="0/0",k="0.00";Nn(()=>{kn.dialogs$.next([{component:"<div/>"}]),s&&En(document.getElementById(`for${s.reference}`))});function c(F,h){if(F){const v=l[f+h];u(v.reference,!1)}}function u(F,h=!1){wt.next(F),h&&(et.next(!1),kn.dialogs$.next([]))}const p=()=>et.next(!1),w=F=>u(F.reference,!0),d=()=>c(r,-1),S=()=>c(o,1);return t.$$set=F=>{"sectionData"in F&&n(8,i=F.sectionData),"exploredCharCount"in F&&n(9,a=F.exploredCharCount)},t.$$.update=()=>{if(t.$$.dirty&1280&&i){const[F,h,v]=to(i),D=i.filter(V=>V.reference===v||V.parentChapter===v);n(3,k=Bi(D.map(V=>V.progress),D.map(V=>V.charactersWeight)).toFixed(2)),n(0,l=F),n(10,f=h),n(1,s=F[f])}if(t.$$.dirty&1024&&n(5,r=!!f),t.$$.dirty&1025&&n(4,o=f<l.length-1),t.$$.dirty&514&&s){En(document.getElementById(`for${s.reference}`));const F=s.characters;n(2,g=`${Math.min(Math.max(a-s.startCharacter,0),F)} / ${F}`)}},[l,s,g,k,o,r,c,u,i,a,f,p,w,d,S]}class Ti extends Je{constructor(e){super();Qe(this,e,Ii,Ei,Ze,{sectionData:8,exploredCharCount:9})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Ai{constructor(e){this.document=e,this.fallbackSpec=Bn(this.document)}get fullscreenEnabled(){var e;return(e=this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled"))!=null?e:!1}get fullscreenElement(){var e;return(e=this.fallbackSpec("fullscreenElement","webkitFullscreenElement"))!=null?e:null}async requestFullscreen(e,n){const r=Bn(e)("requestFullscreen","webkitRequestFullscreen");!r||await r(n)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function Bn(t){return(e,n)=>{var r;return(r=In(t,e))!=null?r:In(t,n)}}function In(t,e){const n=t[e];return typeof n=="function"?n.bind(t):n}const Bt=new Ai(document);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Vi(t,e){return Oi(t).pipe(_e(n=>{const r=e.createElement("div");return r.innerHTML=n,Ri(r),zi(r),Li(r,e),Gi(r),r.innerHTML}))}function Oi(t){return new We(e=>{const{blobs:n}=t;let{elementHtml:r}=t;const o=[];return Object.entries(n).forEach(([i,a])=>{const l=URL.createObjectURL(a);o.push(l),r=r.replaceAll(dr(i),l).replaceAll(`ttu:${i}`,l)}),e.next(r),()=>{o.forEach(i=>URL.revokeObjectURL(i))}})}function Ri(t){Array.from(t.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:Kn(e)})).forEach(({parentEl:e,isGaiji:n})=>{e==null||e.classList.add("ttu-img-container"),n||e==null||e.classList.add("ttu-illustration-container")})}function zi(t){Array.from(t.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function Li(t,e){const n=()=>{let o=[...t.children];const i=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return i>0&&i<o.length&&(o=o.slice(i)),o},r=(o,i)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||i).insertBefore(a,o),a.appendChild(o)};n().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(i=>!Kn(i)).forEach(i=>r(i,o)),Array.from(o.getElementsByTagName("svg")).filter(i=>i.getElementsByTagName("image").length).forEach(i=>r(i,o))})}function Gi(t){t.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Ni=io;function io(t,e,n){t instanceof RegExp&&(t=Tn(t,n)),e instanceof RegExp&&(e=Tn(e,n));const r=ao(t,e,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+t.length,r[1]),post:n.slice(r[1]+e.length)}}function Tn(t,e){const n=e.match(t);return n?n[0]:null}io.range=ao;function ao(t,e,n){let r,o,i,a,l,s=n.indexOf(t),f=n.indexOf(e,s+1),g=s;if(s>=0&&f>0){if(t===e)return[s,f];for(r=[],i=n.length;g>=0&&!l;)g===s?(r.push(g),s=n.indexOf(t,g+1)):r.length===1?l=[r.pop(),f]:(o=r.pop(),o<i&&(i=o,a=f),f=n.indexOf(e,g+1)),g=s<f&&s>=0?s:f;r.length&&(l=[i,a])}return l}function Hi(t,e={}){const r=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function i(C){throw new Error(`CSS parse error: ${C}`)}function a(C){const A=C.exec(t);if(A)return t=t.slice(A[0].length),A}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function f(){a(/^\s*/)}function g(){if(f(),t[0]!=="/"||t[1]!=="*")return;let C=2;for(;t[C]&&(t[C]!=="*"||t[C+1]!=="/");)C++;if(!t[C])return i("end of comment is missing");const A=t.slice(2,C);return t=t.slice(C+2),{type:"comment",comment:A}}function k(){const C=[];let A;for(;A=g();)C.push(A);return r.removeComments?[]:C}function c(){for(f();t[0]==="}";)i("extra closing bracket");const C=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(C)return C[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(A){return A.replace(/,/g,"\u200C")}).split(/\s*(?![^(]*\)),\s*/).map(function(A){return A.replace(/\u200C/g,",")})}function u(){if(t[0]==="@")return U();a(/^([;\s]*)+/);const C=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let A=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!A)return;if(A=A[0].trim(),!a(/^:\s*/))return i("property missing ':'");const R=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),q={type:"declaration",property:A.replace(C,""),value:R?R[0].replace(C,"").trim():""};return a(/^[;\s]*/),q}function p(){if(!l())return i("missing '{'");let C,A=k();for(;C=u();)A.push(C),A=A.concat(k());return s()?A:i("missing '}'")}function w(){f();const C=[];let A;for(;A=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)C.push(A[1]),a(/^,\s*/);if(C.length)return{type:"keyframe",values:C,declarations:p()}}function d(){let C=a(/^@([-\w]+)?keyframes\s*/);if(!C)return;const A=C[1];if(C=a(/^([-\w]+)\s*/),!C)return i("@keyframes missing name");const R=C[1];if(!l())return i("@keyframes missing '{'");let q,L=k();for(;q=w();)L.push(q),L=L.concat(k());return s()?{type:"keyframes",name:R,vendor:A,keyframes:L}:i("@keyframes missing '}'")}function S(){if(a(/^@page */)){const A=c()||[];return{type:"page",selectors:A,declarations:p()}}}function F(){const C=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(C){const A=`${C[1]}-${C[2]}`+(C[3]?`-${C[3]}`:"");return{type:"page-margin-box",name:A,declarations:p()}}}function h(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:p()}}function v(){const C=a(/^@supports *([^{]+)/);if(C)return{type:"supports",supports:C[1].trim(),rules:B()}}function D(){if(a(/^@host\s*/))return{type:"host",rules:B()}}function V(){const C=a(/^@media([^{]+)*/);if(C)return{type:"media",media:(C[1]||"").trim(),rules:B()}}function T(){const C=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(C)return{type:"custom-media",name:C[1].trim(),media:C[2].trim()}}function z(){const C=a(/^@([-\w]+)?document *([^{]+)/);if(C)return{type:"document",document:C[2].trim(),vendor:C[1]?C[1].trim():null,rules:B()}}function N(){const C=a(/^@(import|charset|namespace)\s*([^;]+);/);if(C)return{type:C[1],name:C[2].trim()}}function U(){if(f(),t[0]==="@"){const C=N()||h()||V()||d()||v()||z()||T()||D()||S()||F();if(C&&!r.preserveStatic){let A=!1;return C.declarations?A=C.declarations.some(R=>/var\(/.test(R.value)):A=(C.keyframes||C.rules||[]).some(q=>(q.declarations||[]).some(L=>/var\(/.test(L.value))),A?C:{}}return C}}function m(){if(!r.preserveStatic){const R=Ni("{","}",t);if(R){const q=/:(?:root|host)(?![.:#(])/.test(R.pre)&&/--\S*\s*:/.test(R.body),L=/var\(/.test(R.body);if(!q&&!L)return t=t.slice(R.end+1),{}}}const C=c()||[],A=r.preserveStatic?p():p().filter(R=>{const q=C.some(te=>/:(?:root|host)(?![.:#(])/.test(te))&&/^--\S/.test(R.property),L=/var\(/.test(R.value);return q||L});return C.length||i("selector missing"),{type:"rule",selectors:C,declarations:A}}function B(C){if(!C&&!l())return i("missing '{'");let A,R=k();for(;t.length&&(C||t[0]!=="}")&&(A=U()||m());)A.type&&R.push(A),R=R.concat(k());return!C&&!s()?i("missing '}'"):R}return{type:"stylesheet",stylesheet:{rules:B(!0),errors:o}}}function qi(t,e="",n){const r={charset(i){return"@charset "+i.name+";"},comment(i){return i.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+i.comment+"*/":""},"custom-media"(i){return"@custom-media "+i.name+" "+i.media+";"},declaration(i){return i.property+":"+i.value+";"},document(i){return"@"+(i.vendor||"")+"document "+i.document+"{"+o(i.rules)+"}"},"font-face"(i){return"@font-face{"+o(i.declarations)+"}"},host(i){return"@host{"+o(i.rules)+"}"},import(i){return"@import "+i.name+";"},keyframe(i){return i.values.join(",")+"{"+o(i.declarations)+"}"},keyframes(i){return"@"+(i.vendor||"")+"keyframes "+i.name+"{"+o(i.keyframes)+"}"},media(i){return"@media "+i.media+"{"+o(i.rules)+"}"},namespace(i){return"@namespace "+i.name+";"},page(i){return"@page "+(i.selectors.length?i.selectors.join(", "):"")+"{"+o(i.declarations)+"}"},"page-margin-box"(i){return"@"+i.name+"{"+o(i.declarations)+"}"},rule(i){const a=i.declarations;if(a.length)return i.selectors.join(",")+"{"+o(a)+"}"},supports(i){return"@supports "+i.supports+"{"+o(i.rules)+"}"}};function o(i){let a="";for(let l=0;l<i.length;l++){const s=i[l];n&&n(s);const f=r[s.type](s);f&&(a+=f,f.length&&s.selectors&&(a+=e))}return a}return o(t.stylesheet.rules)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const Xi=/\s?html\s?/gi,Wi=/\s?body\s?/gi;function ji(t,e){const r=Hi(t.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(i=>Xi.test(i)||Wi.test(i)));return r.forEach(o=>{const i={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new Ji(o.declarations,i);o.declarations.forEach(l=>{Jt(i,Ki(l)),Jt(i,Ui(l)),Jt(i,a.convert(l))}),Object.entries(i).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),r.push(Qi()),r.forEach(o=>{o.selectors=Yi(o.selectors,e)}),qi({stylesheet:{rules:r},type:"stylesheet"})}function Yi(t,e){return t.map(n=>`${e} ${n}`)}function Jt(t,e){return e&&(t[e.key]=e.value),t}function Ki(t){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(t.property);if(e)return{key:e[1],value:t.value}}function Ui(t){if(t.property==="font-family"){let e=t.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:t.property,value:e}}}class Ji{constructor(e,n){this.ruleDeclarations=e,this.newDeclarations=n}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(n=>n.type==="declaration"&&n.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function Qi(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Zi(t,e,n){return Vi(t,n).pipe(_e(r=>({htmlContent:r,styleSheet:ji(t,e)})))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function xi(t){return new We(e=>t.subscribe(n=>{e.next(n)}))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Ft(t=Jn){return e=>t?e:xn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function An(t,e,n){return r=>new We(o=>{const i=t();return r.pipe(qn(Ht),mr(()=>n(i))).subscribe({next:a=>{e(a,i),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function $i(t,e,n,r,o,i,a,l,s){switch(e[t.code]){case He.BOOKMARK:return n(),!0;case He.JUMP_TO_BOOKMARK:return r(),!0;case He.AUTO_SCROLL_TOGGLE:return i==null||i.toggle(),!0;case He.AUTO_SCROLL_INCREASE:return o(1),!0;case He.AUTO_SCROLL_DECREASE:return o(-1),!0;case He.NEXT_PAGE:return a==null||a.nextPage(),!0;case He.PREV_PAGE:return a==null||a.prevPage(),!0;case He.PREV_CHAPTER:return s(l?1:-1),!0;case He.NEXT_CHAPTER:return s(l?-1:1),!0;default:return!1}}const{document:Qt}=Gn;function Vn(t){var k;let e,n,r,o,i,a,l,s;function f(c){t[54](c)}let g={hasChapterData:!!((k=t[10])!=null&&k.length),showFullscreenButton:Bt.fullscreenEnabled,autoScrollMultiplier:t[14]};return t[3]!==void 0&&(g.isBookmarkScreen=t[3]),n=new Di({props:g}),ie.push(()=>he(n,"isBookmarkScreen",f)),n.$on("tocClick",t[55]),n.$on("fullscreenClick",t[52]),n.$on("bookmarkClick",t[50]),n.$on("bookManagerClick",t[51]),n.$on("settingsClick",t[50]),{c(){e=J("div"),ge(n.$$.fragment),this.h()},l(c){e=Q(c,"DIV",{class:!0});var u=Z(e);ke(n.$$.fragment,u),u.forEach(E),this.h()},h(){W(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(c,u){G(c,e,u),pe(n,e,null),a=!0,l||(s=an(o=Un.call(null,e,t[56])),l=!0)},p(c,u){var w;t=c;const p={};u[0]&1024&&(p.hasChapterData=!!((w=t[10])!=null&&w.length)),u[0]&16384&&(p.autoScrollMultiplier=t[14]),!r&&u[0]&8&&(r=!0,p.isBookmarkScreen=t[3],de(()=>r=!1)),n.$set(p),o&&So(o.update)&&u[0]&4&&o.update.call(null,t[56])},i(c){a||(Y(n.$$.fragment,c),c&&Hn(()=>{i||(i=hn(e,$t,{y:-300,easing:xt},!0)),i.run(1)}),a=!0)},o(c){ee(n.$$.fragment,c),c&&(i||(i=hn(e,$t,{y:-300,easing:xt},!1)),i.run(0)),a=!1},d(c){c&&E(e),be(n),c&&i&&i.end(),l=!1,s()}}}function ea(t){var r;let e=((r=t[36])!=null?r:"")+"",n;return{c(){n=se(e)},l(o){n=ue(o,e)},m(o,i){G(o,n,i)},p(o,i){var a;i[1]&32&&e!==(e=((a=o[36])!=null?a:"")+"")&&Pe(n,e)},i:lt,o:lt,d(o){o&&E(n)}}}function ta(t){var C,A,R,q,L,te,X,$;let e,n,r,o,i,a,l,s,f,g,k,c=((C=t[33])!=null?C:"")+"",u,p,w=((A=t[34])!=null?A:"")+"",d,S,F=((R=t[35])!=null?R:"")+"",h,v;e=new Mi({props:{styleSheet:t[15].styleSheet}});function D(y){t[57](y)}function V(y){t[58](y)}function T(y){t[59](y)}function z(y){t[60](y)}function N(y){t[61](y)}function U(y){t[62](y)}function m(y){t[63](y)}let B={htmlContent:t[15].htmlContent,width:(q=t[16])!=null?q:0,height:(L=t[17])!=null?L:0,verticalMode:t[11],fontColor:(te=t[18])==null?void 0:te.fontColor,backgroundColor:t[19],hintFuriganaFontColor:(X=t[18])==null?void 0:X.hintFuriganaFontColor,hintFuriganaShadowColor:($=t[18])==null?void 0:$.hintFuriganaShadowColor,fontSize:t[20],fontFamilyGroupOne:t[21],fontFamilyGroupTwo:t[22],hideSpoilerImage:t[23],hideFurigana:t[24],furiganaStyle:t[25],viewMode:t[26],secondDimensionMaxValue:t[27],firstDimensionMargin:t[28],autoPositionOnResize:t[29],avoidPageBreak:t[30],pageColumns:t[31],autoBookmark:t[32],multiplier:t[14]};return t[5]!==void 0&&(B.exploredCharCount=t[5]),t[6]!==void 0&&(B.bookCharCount=t[6]),t[3]!==void 0&&(B.isBookmarkScreen=t[3]),t[9]!==void 0&&(B.bookmarkData=t[9]),t[0]!==void 0&&(B.autoScroller=t[0]),t[7]!==void 0&&(B.bookmarkManager=t[7]),t[8]!==void 0&&(B.pageManager=t[8]),r=new wi({props:B}),ie.push(()=>he(r,"exploredCharCount",D)),ie.push(()=>he(r,"bookCharCount",V)),ie.push(()=>he(r,"isBookmarkScreen",T)),ie.push(()=>he(r,"bookmarkData",z)),ie.push(()=>he(r,"autoScroller",N)),ie.push(()=>he(r,"bookmarkManager",U)),ie.push(()=>he(r,"pageManager",m)),r.$on("bookmark",t[50]),{c(){ge(e.$$.fragment),n=oe(),ge(r.$$.fragment),k=oe(),u=se(c),p=oe(),d=se(w),S=oe(),h=se(F)},l(y){ke(e.$$.fragment,y),n=re(y),ke(r.$$.fragment,y),k=re(y),u=ue(y,c),p=re(y),d=ue(y,w),S=re(y),h=ue(y,F)},m(y,O){pe(e,y,O),G(y,n,O),pe(r,y,O),G(y,k,O),G(y,u,O),G(y,p,O),G(y,d,O),G(y,S,O),G(y,h,O),v=!0},p(y,O){var Ce,le,we,fe,Se,ye,Fe,me;const ae={};O[0]&32768&&(ae.styleSheet=y[15].styleSheet),e.$set(ae);const H={};O[0]&32768&&(H.htmlContent=y[15].htmlContent),O[0]&65536&&(H.width=(Ce=y[16])!=null?Ce:0),O[0]&131072&&(H.height=(le=y[17])!=null?le:0),O[0]&2048&&(H.verticalMode=y[11]),O[0]&262144&&(H.fontColor=(we=y[18])==null?void 0:we.fontColor),O[0]&524288&&(H.backgroundColor=y[19]),O[0]&262144&&(H.hintFuriganaFontColor=(fe=y[18])==null?void 0:fe.hintFuriganaFontColor),O[0]&262144&&(H.hintFuriganaShadowColor=(Se=y[18])==null?void 0:Se.hintFuriganaShadowColor),O[0]&1048576&&(H.fontSize=y[20]),O[0]&2097152&&(H.fontFamilyGroupOne=y[21]),O[0]&4194304&&(H.fontFamilyGroupTwo=y[22]),O[0]&8388608&&(H.hideSpoilerImage=y[23]),O[0]&16777216&&(H.hideFurigana=y[24]),O[0]&33554432&&(H.furiganaStyle=y[25]),O[0]&67108864&&(H.viewMode=y[26]),O[0]&134217728&&(H.secondDimensionMaxValue=y[27]),O[0]&268435456&&(H.firstDimensionMargin=y[28]),O[0]&536870912&&(H.autoPositionOnResize=y[29]),O[0]&1073741824&&(H.avoidPageBreak=y[30]),O[1]&1&&(H.pageColumns=y[31]),O[1]&2&&(H.autoBookmark=y[32]),O[0]&16384&&(H.multiplier=y[14]),!o&&O[0]&32&&(o=!0,H.exploredCharCount=y[5],de(()=>o=!1)),!i&&O[0]&64&&(i=!0,H.bookCharCount=y[6],de(()=>i=!1)),!a&&O[0]&8&&(a=!0,H.isBookmarkScreen=y[3],de(()=>a=!1)),!l&&O[0]&512&&(l=!0,H.bookmarkData=y[9],de(()=>l=!1)),!s&&O[0]&1&&(s=!0,H.autoScroller=y[0],de(()=>s=!1)),!f&&O[0]&128&&(f=!0,H.bookmarkManager=y[7],de(()=>f=!1)),!g&&O[0]&256&&(g=!0,H.pageManager=y[8],de(()=>g=!1)),r.$set(H),(!v||O[1]&4)&&c!==(c=((ye=y[33])!=null?ye:"")+"")&&Pe(u,c),(!v||O[1]&8)&&w!==(w=((Fe=y[34])!=null?Fe:"")+"")&&Pe(d,w),(!v||O[1]&16)&&F!==(F=((me=y[35])!=null?me:"")+"")&&Pe(h,F)},i(y){v||(Y(e.$$.fragment,y),Y(r.$$.fragment,y),v=!0)},o(y){ee(e.$$.fragment,y),ee(r.$$.fragment,y),v=!1},d(y){be(e,y),y&&E(n),be(r,y),y&&E(k),y&&E(u),y&&E(p),y&&E(d),y&&E(S),y&&E(h)}}}function On(t){let e,n,r,o,i,a,l;return n=new Ti({props:{sectionData:t[10],exploredCharCount:t[5]}}),{c(){e=J("div"),ge(n.$$.fragment),this.h()},l(s){e=Q(s,"DIV",{class:!0});var f=Z(e);ke(n.$$.fragment,f),f.forEach(E),this.h()},h(){var s;W(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),I(e,"color",(s=t[18])==null?void 0:s.fontColor,!1),I(e,"background-color",t[19],!1)},m(s,f){G(s,e,f),pe(n,e,null),i=!0,a||(l=an(r=Un.call(null,e,t[64])),a=!0)},p(s,f){var k;t=s;const g={};f[0]&1024&&(g.sectionData=t[10]),f[0]&32&&(g.exploredCharCount=t[5]),n.$set(g),f[0]&262144&&I(e,"color",(k=t[18])==null?void 0:k.fontColor,!1),f[0]&524288&&I(e,"background-color",t[19],!1)},i(s){i||(Y(n.$$.fragment,s),s&&(o||Hn(()=>{o=Mo(e,$t,{x:-100,duration:100,easing:xt}),o.start()})),i=!0)},o(s){ee(n.$$.fragment,s),i=!1},d(s){s&&E(e),be(n),a=!1,l()}}}function Rn(t){let e,n,r,o,i,a=(t[5]/t[6]*100).toFixed(2)+"",l,s;return{c(){e=J("div"),n=se(t[5]),r=se(" / "),o=se(t[6]),i=se(" ("),l=se(a),s=se("%)"),this.h()},l(f){e=Q(f,"DIV",{class:!0});var g=Z(e);n=ue(g,t[5]),r=ue(g," / "),o=ue(g,t[6]),i=ue(g," ("),l=ue(g,a),s=ue(g,"%)"),g.forEach(E),this.h()},h(){var f;W(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),I(e,"color",(f=t[18])==null?void 0:f.tooltipTextFontColor,!1)},m(f,g){G(f,e,g),K(e,n),K(e,r),K(e,o),K(e,i),K(e,l),K(e,s)},p(f,g){var k;g[0]&32&&Pe(n,f[5]),g[0]&64&&Pe(o,f[6]),g[0]&96&&a!==(a=(f[5]/f[6]*100).toFixed(2)+"")&&Pe(l,a),g[0]&262144&&I(e,"color",(k=f[18])==null?void 0:k.tooltipTextFontColor,!1)},d(f){f&&E(e)}}}function na(t){var z,N,U;let e,n,r=((z=t[13])!=null?z:"")+"",o,i,a,l,s,f,g,k,c,u,p,w,d,S;Qt.title=e=dn((U=(N=t[12])==null?void 0:N.title)!=null?U:"");let F=t[2]&&Vn(t);const h=[ta,ea],v=[];function D(m,B){return m[15]?0:1}f=D(t),g=v[f]=h[f](t);let V=t[1]&&On(t),T=t[4]&&t[6]&&Rn(t);return{c(){n=oe(),o=se(r),i=oe(),a=J("button"),l=oe(),F&&F.c(),s=oe(),g.c(),k=oe(),V&&V.c(),c=oe(),T&&T.c(),u=oe(),p=J("button"),this.h()},l(m){yo('[data-svelte="svelte-rnuhm6"]',Qt.head).forEach(E),n=re(m),o=ue(m,r),i=re(m),a=Q(m,"BUTTON",{class:!0}),Z(a).forEach(E),l=re(m),F&&F.l(m),s=re(m),g.l(m),k=re(m),V&&V.l(m),c=re(m),T&&T.l(m),u=re(m),p=Q(m,"BUTTON",{class:!0}),Z(p).forEach(E),this.h()},h(){W(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),W(p,"class","fixed inset-x-0 bottom-0 z-10 h-8 w-full cursor-pointer")},m(m,B){G(m,n,B),G(m,o,B),G(m,i,B),G(m,a,B),G(m,l,B),F&&F.m(m,B),G(m,s,B),v[f].m(m,B),G(m,k,B),V&&V.m(m,B),G(m,c,B),T&&T.m(m,B),G(m,u,B),G(m,p,B),w=!0,d||(S=[ve(window,"keydown",t[49]),ve(a,"click",t[53]),ve(p,"click",t[65])],d=!0)},p(m,B){var A,R,q;(!w||B[0]&4096)&&e!==(e=dn((R=(A=m[12])==null?void 0:A.title)!=null?R:""))&&(Qt.title=e),(!w||B[0]&8192)&&r!==(r=((q=m[13])!=null?q:"")+"")&&Pe(o,r),m[2]?F?(F.p(m,B),B[0]&4&&Y(F,1)):(F=Vn(m),F.c(),Y(F,1),F.m(s.parentNode,s)):F&&(Ye(),ee(F,1,1,()=>{F=null}),Ke());let C=f;f=D(m),f===C?v[f].p(m,B):(Ye(),ee(v[C],1,1,()=>{v[C]=null}),Ke(),g=v[f],g?g.p(m,B):(g=v[f]=h[f](m),g.c()),Y(g,1),g.m(k.parentNode,k)),m[1]?V?(V.p(m,B),B[0]&2&&Y(V,1)):(V=On(m),V.c(),Y(V,1),V.m(c.parentNode,c)):V&&(Ye(),ee(V,1,1,()=>{V=null}),Ke()),m[4]&&m[6]?T?T.p(m,B):(T=Rn(m),T.c(),T.m(u.parentNode,u)):T&&(T.d(1),T=null)},i(m){w||(Y(F),Y(g),Y(V),w=!0)},o(m){ee(F),ee(g),ee(V),w=!1},d(m){m&&E(n),m&&E(o),m&&E(i),m&&E(a),m&&E(l),F&&F.d(m),m&&E(s),v[f].d(m),m&&E(k),V&&V.d(m),m&&E(c),T&&T.d(m),m&&E(u),m&&E(p),d=!1,Ct(S)}}}const zn="background-color",Ln="writing-mode";function oa(t,e,n){let r,o,i,a,l,s,f,g,k,c,u,p,w,d,S,F,h,v,D,V,T,z,N,U,m,B,C,A;x(t,Jo,_=>n(11,o=_)),x(t,et,_=>n(1,i=_)),x(t,Ut,_=>n(14,s=_)),x(t,Qo,_=>n(20,p=_)),x(t,Zo,_=>n(21,w=_)),x(t,xo,_=>n(22,d=_)),x(t,$o,_=>n(23,S=_)),x(t,er,_=>n(24,F=_)),x(t,tr,_=>n(25,h=_)),x(t,nr,_=>n(26,v=_)),x(t,or,_=>n(27,D=_)),x(t,rr,_=>n(28,V=_)),x(t,ir,_=>n(29,T=_)),x(t,ar,_=>n(30,z=_)),x(t,lr,_=>n(31,N=_)),x(t,sr,_=>n(32,U=_));let R=!0,q=!1,L=!0,te=0,X=0,$,y,O,ae=Promise.resolve(void 0);const H=qt(2500).pipe(Ue(()=>n(2,R=!1)),ot());x(t,H,_=>n(13,l=_));const Ce=mt(()=>xi(Ro)).pipe(_e(_=>Number(_.url.searchParams.get("id"))),nn({refCount:!0,bufferSize:1})),le=Ce.pipe(kt(_=>yt.getData(_)),on());x(t,le,_=>n(12,a=_));const we=le.pipe(Ue(_=>{_||Ko("/manage")}),ot());x(t,we,_=>n(36,A=_));const fe=le.pipe(Ue(_=>{!_||n(9,ae=yt.getBookmark(_.id))}),ot());x(t,fe,_=>n(33,m=_));const Se=le.pipe(kt(_=>_?(sn.next(_.sections||[]),Zi(_,".book-content",document)):gt),nn({refCount:!0,bufferSize:1}));x(t,Se,_=>n(15,f=_));const ye=mt(()=>Xe(visualViewport,"resize")).pipe(on()),Fe=ye.pipe(tn(0),_e(()=>visualViewport.width),Ft());x(t,Fe,_=>n(16,g=_));const me=ye.pipe(tn(0),_e(()=>visualViewport.height),Ft());x(t,me,_=>n(17,k=_));const Be=jo.pipe(_e(_=>gr.get(_)),Gt(_=>!!_));x(t,Be,_=>n(18,c=_));const ce=Be.pipe(_e(_=>_.backgroundColor));x(t,ce,_=>n(19,u=_));const Ve=ce.pipe(An(()=>document.body,(_,Te)=>Te.style.setProperty(zn,_),_=>_.style.removeProperty(zn)),ot(),Ft());x(t,Ve,_=>n(34,B=_));const Oe=Yo.pipe(An(()=>document.documentElement,(_,Te)=>Te.style.setProperty(Ln,_),_=>_.style.removeProperty(Ln)),ot(),Ft());x(t,Oe,_=>n(35,C=_));const Re=mt(()=>Ot).pipe(_e(_=>[..._.values()]));x(t,Re,_=>n(10,r=_));function je(_){!$i(_,Uo.getValue(),Ne,$e,ut=>Ut.next(Ut.getValue()+ut),$,O,o,ne)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),_.preventDefault())}function xe(){let _;return Ce.subscribe(Te=>_=Te).unsubscribe(),_}async function Ne(){const _=xe();if(!_||!y)return;const Te=y.formatBookmarkData(_);await yt.putBookmark(Te),n(9,ae=Promise.resolve(Te))}async function $e(){const _=await ae;!_||!y||y.scrollToBookmark(_)}function M(){yt.deleteLastItem(),Ne()}function P(){if(!Bt.fullscreenElement){Bt.requestFullscreen(document.documentElement);return}Bt.exitFullscreen()}function ne(_){if(!(r!=null&&r.length))return;const[Te,ut]=to(r);!ut&&_===-1||_===1&&ut===Te.length-1||wt.next(Te[ut+_].reference)}const Ie=()=>n(2,R=!0);function De(_){q=_,n(3,q)}const ze=()=>{n(2,R=!1),et.next(!0)},St=()=>n(2,R=!1);function Le(_){te=_,n(5,te)}function b(_){X=_,n(6,X)}function Wt(_){q=_,n(3,q)}function jt(_){ae=_,n(9,ae)}function lo(_){$=_,n(0,$)}function so(_){y=_,n(7,y)}function uo(_){O=_,n(8,O)}const fo=()=>et.next(!1),co=()=>n(4,L=!L);return t.$$.update=()=>{t.$$.dirty[0]&3&&i&&($==null||$.off())},[$,i,R,q,L,te,X,y,O,ae,r,o,a,l,s,f,g,k,c,u,p,w,d,S,F,h,v,D,V,T,z,N,U,m,B,C,A,H,le,we,fe,Se,Fe,me,Be,ce,Ve,Oe,Re,je,Ne,M,P,Ie,De,ze,St,Le,b,Wt,jt,lo,so,uo,fo,co]}class ga extends Je{constructor(e){super();Qe(this,e,oa,na,Ze,{},null,[-1,-1,-1])}}export{ga as default};
