import{S as Ne,i as Ge,a as He,Q as zn,m as Ye,R as Rn,h as L,n as xe,d as P,T as pt,w as Ln,e as Z,l as oe,c as x,b as $,o as re,f as X,g as D,y as Ce,z as _e,U as K,A as Se,L as Me,u as W,q as Q,D as we,V as bt,W as Vt,X as un,Y as ee,J as ne,Z as fn,p as Ke,r as Ue,t as ge,j as ke,k as Fe,_ as Y,$ as ie,a0 as ae,x as Nn,a1 as Gn,a2 as Hn,a3 as Gt,I as qn}from"../../chunks/index-2fb0f594.js";import{F as je,f as Xn,a as Tt,p as lt,o as st,b as Wn,c as jn,n as Yn,t as Kn,d as Un,q as Ht,e as qt}from"../../chunks/css-classes-359d4da4.js";import{p as Jn}from"../../chunks/stores-35b585f4.js";import{d as Qn,i as Zn,m as ut,a as Je,b as xn,E as zt,c as $n,f as eo,p as to,e as no,g as ze,o as tt,s as ct,h as ce,j as Ct,F as be,k as cn,l as hn,t as Rt,n as Bt,q as It,R as oo,r as At,V as ro,B as Oe,u as Xt,v as ot,w as io,x as ao,y as lo,z as so,A as Et,C as uo,D as fo,G as co,H as ho,I as mo,J as go,K as ko,L as po,M as bo,N as Co,O as _o}from"../../chunks/format-page-title-3c1ce953.js";import{S as dn,_ as ht,a as $e,b as nt,c as So,i as Re,O as De,n as mn,d as wo,B as Ot,e as ye,w as vo}from"../../chunks/store-9e108e48.js";import{m as yo,c as et,o as gn,b as Mo,f as Fo,a as Wt}from"../../chunks/index.es-43e109f6.js";import{r as Xe,a as Eo}from"../../chunks/theme-option-640ec189.js";import{t as Be}from"../../chunks/tap-7ad8a228.js";import"../../chunks/singletons-d1fb5791.js";const kn=!0;var Ze={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,r=Ze.delegate;r&&(e=r.requestAnimationFrame,n=r.cancelAnimationFrame);var o=e(function(i){n=void 0,t(i)});return new dn(function(){return n==null?void 0:n(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Ze.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,ht([],$e(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Ze.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,ht([],$e(t)))},delegate:void 0},Po=function(t){nt(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(dn),dt={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=dt.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,ht([t,e],$e(n))):setInterval.apply(void 0,ht([t,e],$e(n)))},clearInterval:function(t){var e=dt.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},pn=function(t){nt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(i,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),dt.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;dt.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,So(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Po),jt=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=Qn.now,t}(),bn=function(t){nt(e,t);function e(n,r){r===void 0&&(r=jt.now);var o=t.call(this,n,r)||this;return o.actions=[],o._active=!1,o._scheduled=void 0,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(jt),_t=new bn(pn),Do=_t,To=function(t){nt(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o}return e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),o!==null&&o>0?t.prototype.requestAsyncId.call(this,n,r,o):(n.actions.push(this),n._scheduled||(n._scheduled=Ze.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&o>0||o==null&&this.delay>0)return t.prototype.recycleAsyncId.call(this,n,r,o);n.actions.some(function(i){return i.id===r})||(Ze.cancelAnimationFrame(r),n._scheduled=void 0)},e}(pn),Bo=function(t){nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var o=this.actions,i;n=n||o.shift();do if(i=n.execute(n.state,n.delay))break;while((n=o[0])&&n.id===r&&o.shift());if(this._active=!1,i){for(;(n=o[0])&&n.id===r&&o.shift();)n.unsubscribe();throw i}},e}(bn),St=new Bo(To);function Io(t){return t instanceof Date&&!isNaN(t)}var Ao=["addListener","removeListener"],Oo=["addEventListener","removeEventListener"],Vo=["on","off"];function Le(t,e,n,r){if(Re(n)&&(r=n,n=void 0),r)return Le(t,e,n).pipe(yo(r));var o=$e(Lo(t)?Oo.map(function(l){return function(c){return t[l](e,c,n)}}):zo(t)?Ao.map(Yt(t,e)):Ro(t)?Vo.map(Yt(t,e)):[],2),i=o[0],a=o[1];if(!i&&Zn(t))return ut(function(l){return Le(l,e,n)})(Je(t));if(!i)throw new TypeError("Invalid event target");return new De(function(l){var c=function(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];return l.next(1<f.length?f:f[0])};return i(c),function(){return a(c)}})}function Yt(t,e){return function(n){return function(r){return t[n](e,r)}}}function zo(t){return Re(t.addListener)&&Re(t.removeListener)}function Ro(t){return Re(t.on)&&Re(t.off)}function Lo(t){return Re(t.addEventListener)&&Re(t.removeEventListener)}function Lt(t,e,n){t===void 0&&(t=0),n===void 0&&(n=Do);var r=-1;return e!=null&&(xn(e)?n=e:r=e),new De(function(o){var i=Io(t)?+t-n.now():t;i<0&&(i=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function No(t,e){return t===void 0&&(t=0),e===void 0&&(e=_t),t<0&&(t=0),Lt(t,t,e)}function wt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=to(t),r=no(t,1/0),o=t;return o.length?o.length===1?Je(o[0]):$n(r)(eo(o,n)):zt}var Cn=new De(mn),Go=Array.isArray;function Ho(t){return t.length===1&&Go(t[0])?t[0]:t}function qo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=Ho(t),t.length===1?Je(t[0]):new De(Xo(t))}function Xo(t){return function(e){for(var n=[],r=function(i){n.push(Je(t[i]).subscribe(ze(e,function(a){if(n){for(var l=0;l<n.length;l++)l!==i&&n[l].unsubscribe();n=null}e.next(a)})))},o=0;n&&!e.closed&&o<t.length;o++)r(o)}}function _n(t,e){return e===void 0&&(e=_t),tt(function(n,r){var o=null,i=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var f=i;i=null,r.next(f)}};function c(){var f=a+t,h=e.now();if(h<f){o=this.schedule(void 0,f-h),r.add(o);return}l()}n.subscribe(ze(r,function(f){i=f,a=e.now(),o||(o=e.schedule(c,t),r.add(o))},function(){l(),r.complete()},void 0,function(){i=o=null}))})}function Sn(t,e){return e===void 0&&(e=wo),t=t!=null?t:Wo,tt(function(n,r){var o,i=!0;n.subscribe(ze(r,function(a){var l=e(a);(i||!t(o,l))&&(i=!1,o=l,r.next(a))}))})}function Wo(t,e){return t===e}function jo(){return tt(function(t,e){var n,r=!1;t.subscribe(ze(e,function(o){var i=n;n=o,r&&e.next([i,o]),r=!0}))})}function Ve(t){return tt(function(e,n){Je(t).subscribe(ze(n,function(){return n.complete()},mn)),!n.closed&&e.subscribe(n)})}var wn={leading:!0,trailing:!1};function Yo(t,e){return e===void 0&&(e=wn),tt(function(n,r){var o=e.leading,i=e.trailing,a=!1,l=null,c=null,f=!1,h=function(){c==null||c.unsubscribe(),c=null,i&&(u(),f&&r.complete())},p=function(){c=null,f&&r.complete()},C=function(m){return c=Je(t(m)).subscribe(ze(r,h,p))},u=function(){if(a){a=!1;var m=l;l=null,r.next(m),!f&&C(m)}};n.subscribe(ze(r,function(m){a=!0,l=m,!(c&&!c.closed)&&(o?u():C(m))},function(){f=!0,!(i&&a&&c&&!c.closed)&&r.complete()}))})}function Ko(t,e,n){e===void 0&&(e=_t),n===void 0&&(n=wn);var r=Lt(t,e);return Yo(function(){return r},n)}function Uo(t){let e,n;return{c(){e=new zn,n=Ye(),this.h()},l(r){e=Rn(r),n=Ye(),this.h()},h(){e.a=n},m(r,o){e.m(t[0],r,o),L(r,n,o)},p(r,[o]){o&1&&e.p(r[0])},i:xe,o:xe,d(r){r&&P(n),r&&e.d()}}}function Jo(t,e,n){let{html:r}=e;const o=pt();return Ln(()=>{o("load")}),t.$$set=i=>{"html"in i&&n(0,r=i.html)},[r]}class vn extends Ne{constructor(e){super();Ge(this,e,Jo,Uo,He,{html:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function We(t,e){return e==="rtl"?-t:t}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Qo{constructor(e,n){this.calculator=e,this.window=n}scrollToBookmark(e){const n=this.getBookmarkPosition(e);if(!n)return;const{scrollToData:r}=Kt(n);this.window.scrollTo(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount,{verticalMode:o}=this.calculator,i=o?"scrollX":"scrollY";return{dataId:e,exploredCharCount:n,progress:n/r,[i]:this.window[i]}}getBookmarkBarPosition(e){const n=this.getBookmarkPosition(e);if(!!n)return Kt(n).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:n}=this.calculator,r=this.getBookmarkTargetPosByScrollValue(e);if(r)return r;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return n?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:n}=e,r=o=>{const i=e[o];if(!i)return;const a=We(i,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===n)return{[o]:i}};return this.calculator.verticalMode?r("scrollX"):r("scrollY")}}function Kt(t){return"scrollX"in t?{scrollToData:{left:t.scrollX},bookmarkPosData:{right:`${-t.scrollX}px`}}:{scrollToData:{top:t.scrollY},bookmarkPosData:{top:`${t.scrollY}px`}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Zo(t){const e=(n,r,o,i)=>{if(o<r)return t!=null?t:o;const a=Math.floor((r+o)/2);return n[a]===i?a:n[a]>i?e(n,r,a-1,i):e(n,a+1,o,i)};return(n,r)=>e(n,0,n.length-1,r)}const mt=Zo(void 0);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function yn(t){return Array.from(t.classList).some(e=>e.includes("gaiji"))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Nt(t){return t instanceof HTMLImageElement?yn(t):!1}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Mn(t){return Nt(t)?1:$o(t)}const xo=/[^0-9A-Z○◯々-〇〻ぁ-ゖゝ-ゞァ-ヺー０-９Ａ-Ｚｦ-ﾝ\p{Radical}\p{Unified_Ideograph}]+/gimu;function $o(t){return t.textContent?er(t.textContent.replace(xo,"")):0}function er(t){return Array.from(t).length}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Fn(t){return En(t,e=>!(e.nodeName==="RT"||e instanceof HTMLElement&&(e.attributes.getNamedItem("aria-hidden")||e.attributes.getNamedItem("hidden")))).filter(e=>{var n;return!!(Nt(e)||(n=e.textContent)!=null&&n.replace(/\s/g,"").length)})}function En(t,e){return!t.hasChildNodes()||!e(t)?[]:Array.from(t.childNodes).flatMap(n=>n.nodeType===Node.TEXT_NODE?[n]:Nt(n)?[n]:En(n,e)).filter(e)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Pn{constructor(e,n,r,o,i){this.containerEl=e,this.axis=n,this.direction=r,this.scrollEl=o,this.document=i,this.paragraphPosToAccCharCount=new Map,this.paragraphs=Fn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=Mn(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const n=this.scrollEl.getBoundingClientRect(),r=We(this.verticalMode?n.right:n.top,this.direction),o=new Map;for(let i=0;i<this.paragraphs.length;i+=1){const a=this.paragraphs[i],l=this.getNodeBoundingRect(a),f=We(this.verticalMode?l.left:l.bottom,this.direction)-r+e;this.paragraphPos[i]=f;const h=o.get(f)||[];o.set(f,h),h.push(i)}this.paragraphPosToAccCharCount=new Map(Array.from(o.entries()).map(([i,a])=>[i,Math.max(...a.map(l=>this.accumulatedCharCount[l]))]))}calcExploredCharCount(){return this.getCharCountByScrollPos(this.scrollPos)}getCharCountByScrollPos(e){const n=mt(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[n])||0}getScrollPosByCharCount(e){const n=mt(this.accumulatedCharCount,e);return We(this.paragraphPos[n],this.direction)}getNodeBoundingRect(e){const n=this.document.createRange();return n.selectNode(e),n.getBoundingClientRect()}get scrollPos(){return We(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function tr(t,e,n){const r=rr(e,n)(t,"scrollLeft");return(o,i,a)=>{if(!nr(o))return;const l=or(o,i,a);r(-l),o.preventDefault()}}function nr(t){return!(!t.deltaY||t.deltaX||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)}function or(t,e,n){switch(t.deltaMode){case 0:return t.deltaY;case 1:return t.deltaY*e*1.75;default:return t.deltaY*n}}function rr(t,e){return(n,r)=>{let o=!1,i=t[r],a=t[r];const l=()=>{o=!0;const c=Math.trunc((i-t[r])/n);if(t[r]!==a){o=!1;return}if(a+=c,t.scrollBy(c,0),Math.abs(c)>0){e(l);return}o=!1};return c=>{o||(i=t[r],a=t[r]),i+=c,o||e(l)}}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class ir{constructor(e,n,r){this.verticalMode=e,this.firstDimensionMargin=n,this.window=r}nextPage(){this.scrollByPercent(.9)}prevPage(){this.scrollByPercent(-.9)}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let n=this.window.innerHeight,r="top",o=1;this.verticalMode&&(n=this.window.innerWidth,r="left",o=-1);const i=n-this.firstDimensionMargin*2;this.window.scrollBy({[r]:i*e*o,behavior:"smooth"})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class ar{constructor(e,n,r,o,i=St){this.multiplier=e,this.verticalMode=n,this.enabled$=new Ot(!1),this.enabled$.pipe(ct(a=>{if(!a)return zt;let l=0;return No(0,i).pipe(ce(()=>Date.now()),jo(),ce(c=>this.calcNewPos(c)),ce(c=>{l+=c;const f=Math.trunc(l);return l-=f,f}),Ct(c=>c!==0))}),Ve(r)).subscribe(a=>{let l="top";n&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}calcNewPos([e,n]){let r=.00365956;return this.verticalMode&&(r=-91489e-8),r*this.multiplier*(n-e)}}const{document:lr,window:sr}=un;function Ut(t){let e,n,r,o,i;return{c(){e=Z("div"),r=oe(),o=Z("div"),this.h()},l(a){e=x(a,"DIV",{class:!0,style:!0}),$(e).forEach(P),r=re(a),o=x(a,"DIV",{class:!0,style:!0}),$(o).forEach(P),this.h()},h(){X(e,"class","fixed"),X(e,"style",n=t[20]+": 100%; "+t[19]+": "+t[14]+"px; "+t[18][0]+": 0"),D(e,"background-color",t[4],!1),X(o,"class","fixed"),X(o,"style",i=t[20]+": 100%; "+t[19]+": "+t[14]+"px; "+t[18][1]+": 0"),D(o,"background-color",t[4],!1)},m(a,l){L(a,e,l),L(a,r,l),L(a,o,l)},p(a,l){l[0]&1851392&&n!==(n=a[20]+": 100%; "+a[19]+": "+a[14]+"px; "+a[18][0]+": 0")&&X(e,"style",n),l[0]&16&&D(e,"background-color",a[4],!1),l[0]&1851392&&i!==(i=a[20]+": 100%; "+a[19]+": "+a[14]+"px; "+a[18][1]+": 0")&&X(o,"style",i),l[0]&16&&D(o,"background-color",a[4],!1)},d(a){a&&P(e),a&&P(r),a&&P(o)}}}function Jt(t){let e;function n(i,a){return i[2]?fr:ur}let r=n(t),o=r(t);return{c(){o.c(),e=Ye()},l(i){o.l(i),e=Ye()},m(i,a){o.m(i,a),L(i,e,a)},p(i,a){r===(r=n(i))&&o?o.p(i,a):(o.d(1),o=r(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){o.d(i),i&&P(e)}}}function ur(t){let e;return{c(){e=Z("div"),this.h()},l(n){e=x(n,"DIV",{class:!0}),$(e).forEach(P),this.h()},h(){X(e,"class","absolute inset-x-0 h-12 bg-yellow-600 bg-opacity-10 pointer-events-none"),D(e,"top",t[16].top,!1)},m(n,r){L(n,e,r)},p(n,r){r[0]&65536&&D(e,"top",n[16].top,!1)},d(n){n&&P(e)}}}function fr(t){let e;return{c(){e=Z("div"),this.h()},l(n){e=x(n,"DIV",{class:!0}),$(e).forEach(P),this.h()},h(){X(e,"class","pointer-events-none absolute inset-y-0 w-12 bg-yellow-600 bg-opacity-10"),D(e,"right",t[16].right,!1)},m(n,r){L(n,e,r)},p(n,r){r[0]&65536&&D(e,"right",n[16].right,!1)},d(n){n&&P(e)}}}function cr(t){let e,n,r=`${t[7]}px`,o=`${t[17]||t[1]}px`,i,a,l,c,f,h;n=new vn({props:{html:t[0]}}),n.$on("load",t[23]);let p=t[14]&&Ut(t),C=t[16]&&Jt(t);return{c(){e=Z("div"),Ce(n.$$.fragment),i=oe(),p&&p.c(),a=oe(),C&&C.c(),l=oe(),this.h()},l(u){e=x(u,"DIV",{class:!0});var m=$(e);_e(n.$$.fragment,m),m.forEach(P),i=re(u),p&&p.l(u),a=re(u),C&&C.l(u),l=re(u),this.h()},h(){X(e,"class","book-content m-auto svelte-nb1mte"),K(e,"book-content--writing-vertical-rl",t[2]),K(e,"book-content--writing-horizontal-rl",!t[2]),K(e,"book-content--hide-furigana",t[11]),K(e,"book-content--hide-spoiler-image",t[10]),K(e,"book-content--furigana-style-partial",t[12]===be.Partial),K(e,"book-content--furigana-style-full",t[12]===be.Full),K(e,"book-content--furigana-style-toggle",t[12]===be.Toggle),D(e,"color",t[3],!1),D(e,"font-size",r,!1),D(e,"max-width",!t[2]&&t[13]?`${t[13]}px`:void 0,!1),D(e,"max-height",t[17]?`${t[17]}px`:void 0,!1),D(e,"padding-left",t[2]&&t[14]?`${t[14]}px`:void 0,!1),D(e,"padding-right",t[2]&&t[14]?`${t[14]}px`:void 0,!1),D(e,"padding-top",!t[2]&&t[14]?`${t[14]}px`:void 0,!1),D(e,"padding-bottom",!t[2]&&t[14]?`${t[14]}px`:void 0,!1),D(e,"--font-family-serif",t[8],!1),D(e,"--font-family-sans-serif",t[9],!1),D(e,"--book-content-hint-furigana-font-color",t[5],!1),D(e,"--book-content-hint-furigana-shadow-color",t[6],!1),D(e,"--book-content-child-height",o,!1)},m(u,m){L(u,e,m),Se(n,e,null),t[39](e),L(u,i,m),p&&p.m(u,m),L(u,a,m),C&&C.m(u,m),L(u,l,m),c=!0,f||(h=[Me(sr,"scroll",t[22]),Me(lr.body,"wheel",t[21],{passive:!1})],f=!0)},p(u,m){const g={};m[0]&1&&(g.html=u[0]),n.$set(g),m[0]&4&&K(e,"book-content--writing-vertical-rl",u[2]),m[0]&4&&K(e,"book-content--writing-horizontal-rl",!u[2]),m[0]&2048&&K(e,"book-content--hide-furigana",u[11]),m[0]&1024&&K(e,"book-content--hide-spoiler-image",u[10]),m[0]&4096&&K(e,"book-content--furigana-style-partial",u[12]===be.Partial),m[0]&4096&&K(e,"book-content--furigana-style-full",u[12]===be.Full),m[0]&4096&&K(e,"book-content--furigana-style-toggle",u[12]===be.Toggle),m[0]&8&&D(e,"color",u[3],!1),m[0]&128&&r!==(r=`${u[7]}px`)&&D(e,"font-size",r,!1),m[0]&8196&&D(e,"max-width",!u[2]&&u[13]?`${u[13]}px`:void 0,!1),m[0]&131072&&D(e,"max-height",u[17]?`${u[17]}px`:void 0,!1),m[0]&16388&&D(e,"padding-left",u[2]&&u[14]?`${u[14]}px`:void 0,!1),m[0]&16388&&D(e,"padding-right",u[2]&&u[14]?`${u[14]}px`:void 0,!1),m[0]&16388&&D(e,"padding-top",!u[2]&&u[14]?`${u[14]}px`:void 0,!1),m[0]&16388&&D(e,"padding-bottom",!u[2]&&u[14]?`${u[14]}px`:void 0,!1),m[0]&256&&D(e,"--font-family-serif",u[8],!1),m[0]&512&&D(e,"--font-family-sans-serif",u[9],!1),m[0]&32&&D(e,"--book-content-hint-furigana-font-color",u[5],!1),m[0]&64&&D(e,"--book-content-hint-furigana-shadow-color",u[6],!1),m[0]&131074&&o!==(o=`${u[17]||u[1]}px`)&&D(e,"--book-content-child-height",o,!1),u[14]?p?p.p(u,m):(p=Ut(u),p.c(),p.m(a.parentNode,a)):p&&(p.d(1),p=null),u[16]?C?C.p(u,m):(C=Jt(u),C.c(),C.m(l.parentNode,l)):C&&(C.d(1),C=null)},i(u){c||(W(n.$$.fragment,u),c=!0)},o(u){Q(n.$$.fragment,u),c=!1},d(u){u&&P(e),we(n),t[39](null),u&&P(i),p&&p.d(u),u&&P(a),C&&C.d(u),u&&P(l),f=!1,bt(h)}}}function hr(t,e,n){let r,o,i,a,{htmlContent:l}=e,{width:c}=e,{height:f}=e,{verticalMode:h}=e,{fontColor:p}=e,{backgroundColor:C}=e,{hintFuriganaFontColor:u}=e,{hintFuriganaShadowColor:m}=e,{fontSize:g}=e,{fontFamilyGroupOne:E}=e,{fontFamilyGroupTwo:F}=e,{hideSpoilerImage:R}=e,{hideFurigana:d}=e,{furiganaStyle:v}=e,{secondDimensionMaxValue:w}=e,{firstDimensionMargin:I}=e,{autoPositionOnResize:O}=e,{loadingState:N}=e,{multiplier:y}=e,{bookmarkData:B}=e,{exploredCharCount:G}=e,{bookCharCount:A}=e,{autoScroller:k}=e,{bookmarkManager:M}=e,{pageManager:V}=e;const H=pt();let q,U,ue={},J,S,T,te,z,le=0,he=!1;const ve=tr(4,document.documentElement,requestAnimationFrame),de=new ye,se=new ye,fe=new ye;Vt(()=>{fe.next(),fe.complete()}),J=new ar(y,h,fe,document),k=J,et([de,se]).pipe(Ct(()=>O),cn(1),ce(([s,j])=>h?j:s),Sn(),_n(10),hn(St),Ve(fe)).subscribe(()=>{if(!U||!T)return;const s=U.getScrollPosByCharCount(le);he=!0,T.scrollTo(s)});function me(s){s.updateParagraphPos(),n(24,G=s.calcExploredCharCount()),z&&(z=!1,B.then(j=>{!j||!M||M.scrollToBookmark(j)})),n(35,ue={})}function pe(s){h&&ve(s,g,window.innerWidth)}function Ie(){requestAnimationFrame(()=>{!U||(n(24,G=U.calcExploredCharCount()),he||(le=G),he=!1)})}function Ae(){!q||(n(34,U=new Pn(q,h?"vertical":"horizontal",h?"rtl":"ltr",document.documentElement,document)),n(24,G=0),le=G,n(25,A=U.charCount),H("contentChange",q))}function Ee(s){ee[s?"unshift":"push"](()=>{q=s,n(15,q)})}return t.$$set=s=>{"htmlContent"in s&&n(0,l=s.htmlContent),"width"in s&&n(29,c=s.width),"height"in s&&n(1,f=s.height),"verticalMode"in s&&n(2,h=s.verticalMode),"fontColor"in s&&n(3,p=s.fontColor),"backgroundColor"in s&&n(4,C=s.backgroundColor),"hintFuriganaFontColor"in s&&n(5,u=s.hintFuriganaFontColor),"hintFuriganaShadowColor"in s&&n(6,m=s.hintFuriganaShadowColor),"fontSize"in s&&n(7,g=s.fontSize),"fontFamilyGroupOne"in s&&n(8,E=s.fontFamilyGroupOne),"fontFamilyGroupTwo"in s&&n(9,F=s.fontFamilyGroupTwo),"hideSpoilerImage"in s&&n(10,R=s.hideSpoilerImage),"hideFurigana"in s&&n(11,d=s.hideFurigana),"furiganaStyle"in s&&n(12,v=s.furiganaStyle),"secondDimensionMaxValue"in s&&n(13,w=s.secondDimensionMaxValue),"firstDimensionMargin"in s&&n(14,I=s.firstDimensionMargin),"autoPositionOnResize"in s&&n(30,O=s.autoPositionOnResize),"loadingState"in s&&n(31,N=s.loadingState),"multiplier"in s&&n(32,y=s.multiplier),"bookmarkData"in s&&n(33,B=s.bookmarkData),"exploredCharCount"in s&&n(24,G=s.exploredCharCount),"bookCharCount"in s&&n(25,A=s.bookCharCount),"autoScroller"in s&&n(26,k=s.autoScroller),"bookmarkManager"in s&&n(27,M=s.bookmarkManager),"pageManager"in s&&n(28,V=s.pageManager)},t.$$.update=()=>{if(t.$$.dirty[0]&4&&n(20,r=h?"height":"width"),t.$$.dirty[0]&4&&n(19,o=h?"width":"height"),t.$$.dirty[0]&4&&n(18,i=h?["left","right"]:["top","bottom"]),t.$$.dirty[0]&536870912&&de.next(c),t.$$.dirty[0]&2&&se.next(f),t.$$.dirty[0]&8196&&n(17,a=h&&w?w:void 0),t.$$.dirty[0]&1&&l&&(z=!0),t.$$.dirty[0]&536870914|t.$$.dirty[1]&9&&U&&c&&f&&!N){const s=U;requestAnimationFrame(()=>{me(s)})}t.$$.dirty[0]&4|t.$$.dirty[1]&34&&J&&(n(36,J.multiplier=y,J),n(36,J.verticalMode=h,J)),t.$$.dirty[1]&72&&U&&(n(37,S=U&&new Qo(U,window)),n(27,M=S)),t.$$.dirty[1]&84&&ue&&(n(16,te=void 0),B.then(s=>{!s||n(16,te=S==null?void 0:S.getBookmarkBarPosition(s))})),t.$$.dirty[0]&16388|t.$$.dirty[1]&128&&(n(38,T=new ir(h,I,window)),n(28,V=T))},[l,f,h,p,C,u,m,g,E,F,R,d,v,w,I,q,te,a,i,o,r,pe,Ie,Ae,G,A,k,M,V,c,O,N,y,B,U,ue,J,S,T,Ee]}class dr extends Ne{constructor(e){super();Ge(this,e,hr,cr,He,{htmlContent:0,width:29,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontSize:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,hideSpoilerImage:10,hideFurigana:11,furiganaStyle:12,secondDimensionMaxValue:13,firstDimensionMargin:14,autoPositionOnResize:30,loadingState:31,multiplier:32,bookmarkData:33,exploredCharCount:24,bookCharCount:25,autoScroller:26,bookmarkManager:27,pageManager:28},null,[-1,-1])}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const mr="px-4 md:px-8";/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function gt(t,e=kn){return e?t():Cn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function gr(t){const e=Array.from(t.getElementsByTagName("img"));return new De(n=>{const r=e.filter(i=>i.src).map(kr);if(r.length<=0){n.next(!1),n.complete();return}const o=et(r).subscribe(()=>{n.next(!1),n.complete()});return n.next(!0),o})}function kr(t){return t.complete?gn(1):qo(Le(t,"load"),Le(t,"error"))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function pr(t,e){const n=br(t),r=_r(t);return o=>wt(n(o),Cr(o,e),r(o))}function br(t){return e=>{const n=Array.from(e.getElementsByTagName("a"));n.forEach(o=>{o.href=t.location.pathname+o.hash});const r=n.map(o=>kt(o).pipe(Be(()=>{const i=t.getElementById(o.hash.substring(1));i&&i.scrollIntoView()})));return wt(...r)}}function Cr(t,e){const n=e===be.Toggle,o=Array.from(t.getElementsByTagName("ruby")).map(i=>n?kt(i).pipe(Be(()=>{i.classList.toggle("reveal-rt")})):kt(i).pipe(Rt(1),Be(()=>{i.classList.add("reveal-rt")})));return wt(...o)}function _r(t){return e=>{const r=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const i=t.createElement("span");return i.classList.add("spoiler-label"),i.setAttribute("aria-hidden","true"),i.innerText="\u30CD\u30BF\u30D0\u30EC",o.appendChild(i),kt(o).pipe(Rt(1),Be(()=>{o.removeChild(i),o.removeAttribute("data-ttu-spoiler-img")}))});return wt(...r)}}function kt(t){return Le(t,"click").pipe(Be(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const Sr=300,wr=60,Dn="none";function Qe(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function vr(t,e){return e.filter(n=>t.pointerId!==n.pointerId)}function rt(t,e,n,r,o){t.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:n,pointersCount:r.length}}))}function yr(t,e,n,r,o,i=Dn){e.style.touchAction=i;let a=[];function l(f){a.push(f),rt(e,t,f,a,"down"),r==null||r(a,f);const h=f.pointerId;function p(F){h===F.pointerId&&(a=vr(F,a),a.length||C(),rt(e,t,F,a,"up"),o==null||o(a,F))}function C(){u(),m(),g(),E()}const u=Qe(e,"pointermove",F=>{a=a.map(R=>F.pointerId===R.pointerId?F:R),rt(e,t,F,a,"move"),n==null||n(a,F)}),m=Qe(e,"lostpointercapture",F=>{p(F)}),g=Qe(e,"pointerup",F=>{p(F)}),E=Qe(e,"pointerleave",F=>{a=[],C(),rt(e,t,F,a,"up"),o==null||o(a,F)})}const c=Qe(e,"pointerdown",l);return{destroy:()=>{c()}}}function Mr(t,e={timeframe:Sr,minSwipeDistance:wr,touchAction:Dn}){const n="swipe";let r,o,i,a;function l(f,h){o=h.clientX,i=h.clientY,r=Date.now(),f.length===1&&(a=h.target)}function c(f,h){if(h.type==="pointerup"&&f.length===0&&Date.now()-r<e.timeframe){const p=h.clientX-o,C=h.clientY-i,u=Math.abs(p),m=Math.abs(C);let g=null;u>=2*m&&u>e.minSwipeDistance?g=p>0?"right":"left":m>=2*u&&m>e.minSwipeDistance&&(g=C>0?"bottom":"top"),g&&t.dispatchEvent(new CustomEvent(n,{detail:{direction:g,target:a}}))}}return yr(n,t,null,l,c,e.touchAction)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Fr{constructor(e,n,r,o,i,a,l,c,f,h,p){this.contentEl=e,this.scrollEl=n,this.sections=r,this.sectionIndex$=o,this.virtualScrollPos$=i,this.width=a,this.height=l,this.pageGap=c,this.verticalMode=f,this.pageChange$=h,this.sectionRenderComplete$=p,this.translateX=0}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}flipPage(e){const n=this.verticalMode?"scrollHeight":"scrollWidth",r=this.verticalMode?this.height:this.width,o=r+this.pageGap,i=!0;if(this.translateX){const p=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const C=this.translateX;p(),this.scrollToPos(-C-o,i);return}if(this.nextSection(i)){p();return}return}const a=0,l=this.scrollEl[n],c=this.virtualScrollPos$.getValue(),f=c+o*e,h=Math.ceil(f);if(h<a){if(c!==a){this.scrollToPos(a,i);return}this.prevSection(o,n,r,i);return}if(h>=l){this.nextSection(i);return}this.scrollOrTranslateToPos(f,l,r,i)}scrollTo(e,n){const r=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[r],o,n)}prevSection(e,n,r,o){const i=this.sectionIndex$.getValue()-1;return i<0?!1:(this.updateSectionIndex(i).subscribe(()=>{const a=this.scrollEl[n];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,r,o)}),!0)}nextSection(e){const n=this.sectionIndex$.getValue()+1;return n>=this.sections.length?!1:(this.updateSectionIndex(n).subscribe(()=>{this.scrollToPos(0,e)}),!0)}scrollOrTranslateToPos(e,n,r,o){if(this.verticalMode){this.scrollToPos(e,o);return}if(e+r<=n){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,n){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(n)}translateXToPos(e,n){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(n)}updateSectionIndex(e){return new De(n=>{if(this.sectionIndex$.getValue()===e){n.next(),n.complete();return}const r=this.sectionRenderComplete$.subscribe(o=>{o===e&&n.next(),n.complete(),r.unsubscribe()});return this.sectionIndex$.next(e),r})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Er{constructor(e,n,r,o,i,a,l,c,f){this.containerEl=e,this.sections=n,this.virtualScrollPos$=r,this.getWidth=o,this.getHeight=i,this.getPageGap=a,this.verticalMode=l,this.scrollEl=c,this.document=f,this.sectionIndex=-1;const h=C=>Fn(C).reduce((m,g)=>m+Mn(g),0);let p=0;this.sectionAccCharCounts=n.map(C=>(p+=h(C),p)),this.charCount=p}updateCurrentSection(e){this.calculator=new Pn(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(){const e=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+e)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const n=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+n}getSectionIndexByCharCount(e){return mt(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const n=this.getSectionStartCount(),r=this.sectionAccCharCounts[this.sectionIndex],o=e-n,i=e===r&&r-n>0;if(o<0||e>r||i)return-1;if(o===0)return 0;const a=mt(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:c}=this.calculator,f=l[a];if(Number.isNaN(Number(c[a])))return-1;const h=(g,E)=>g>=E?E:l[g]>f?g:h(g+1,E),p=c[h(a+1,l.length-1)],{screenSize:C}=this,u=this.verticalMode?0:1,m=C*(Math.floor(p/C)+u);return We(m,this.calculator.direction)}isCharOnScreen(e){const n=this.getScrollPosByCharCount(e),r=this.virtualScrollPos$.getValue();return n===r}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Pr{constructor(e,n,r,o,i){this.calculator=e,this.pageManager=n,this.sectionReady$=r,this.sectionIndex$=o,this.setIntendedCharCount=i}scrollToBookmark(e){const n=e.exploredCharCount;if(!n)return;const r=this.calculator.getSectionIndexByCharCount(n),o=l=>{const c=l.getScrollPosByCharCount(n);this.pageManager.scrollTo(c,!1),this.setIntendedCharCount(n)};if(this.sectionIndex$.getValue()===r){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(r)}formatBookmarkData(e){const n=this.calculator.calcExploredCharCount(),r=this.calculator.charCount;return{dataId:e,exploredCharCount:n,progress:n/r}}}function Qt(t){let e,n,r;return n=new je({props:{icon:Xn,spin:!0}}),{c(){e=Z("div"),Ce(n.$$.fragment),this.h()},l(o){e=x(o,"DIV",{class:!0});var i=$(e);_e(n.$$.fragment,i),i.forEach(P),this.h()},h(){X(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),D(e,"color",t[4],!1),D(e,"background-color",t[5],!1)},m(o,i){L(o,e,i),Se(n,e,null),r=!0},p(o,i){i[0]&16&&D(e,"color",o[4],!1),i[0]&32&&D(e,"background-color",o[5],!1)},i(o){r||(W(n.$$.fragment,o),r=!0)},o(o){Q(n.$$.fragment,o),r=!1},d(o){o&&P(e),we(n)}}}function Zt(t){let e,n,r;return n=new je({props:{icon:Tt}}),{c(){e=Z("div"),Ce(n.$$.fragment),this.h()},l(o){e=x(o,"DIV",{class:!0});var i=$(e);_e(n.$$.fragment,i),i.forEach(P),this.h()},h(){X(e,"class","fixed top-3 right-3 text-xl opacity-25"),D(e,"color",t[4],!1)},m(o,i){L(o,e,i),Se(n,e,null),r=!0},p(o,i){i[0]&16&&D(e,"color",o[4],!1)},i(o){r||(W(n.$$.fragment,o),r=!0)},o(o){Q(n.$$.fragment,o),r=!1},d(o){o&&P(e),we(n)}}}function Dr(t){let e,n,r,o=`${t[8]}px`,i=`${t[1]}px`,a=`${t[2]}px`,l,c,f,h,p,C;r=new vn({props:{html:t[17]}}),r.$on("load",t[18]);let u=!t[16]&&Qt(t),m=t[0]&&Zt(t);return{c(){e=Z("div"),n=Z("div"),Ce(r.$$.fragment),l=oe(),u&&u.c(),c=oe(),m&&m.c(),f=Ye(),this.h()},l(g){e=x(g,"DIV",{class:!0});var E=$(e);n=x(E,"DIV",{class:!0});var F=$(n);_e(r.$$.fragment,F),F.forEach(P),E.forEach(P),l=re(g),u&&u.l(g),c=re(g),m&&m.l(g),f=Ye(),this.h()},h(){X(n,"class","book-content-container svelte-10tg7f6"),X(e,"class","book-content m-auto svelte-10tg7f6"),K(e,"book-content--writing-vertical-rl",t[3]),K(e,"book-content--writing-horizontal-rl",!t[3]),K(e,"book-content--hide-furigana",t[12]),K(e,"book-content--hide-spoiler-image",t[11]),K(e,"book-content--furigana-style-partial",t[13]===be.Partial),K(e,"book-content--furigana-style-full",t[13]===be.Full),K(e,"book-content--furigana-style-toggle",t[13]===be.Toggle),D(e,"color",t[4],!1),D(e,"font-size",o,!1),D(e,"--font-family-serif",t[9],!1),D(e,"--font-family-sans-serif",t[10],!1),D(e,"--book-content-hint-furigana-font-color",t[6],!1),D(e,"--book-content-hint-furigana-shadow-color",t[7],!1),D(e,"--book-content-child-width",i,!1),D(e,"--book-content-child-height",a,!1),D(e,"--book-content-column-count",Math.ceil(t[1]/1e3),!1)},m(g,E){L(g,e,E),ne(e,n),Se(r,n,null),t[32](n),t[33](e),L(g,l,E),u&&u.m(g,E),L(g,c,E),m&&m.m(g,E),L(g,f,E),h=!0,p||(C=[fn(Mr.call(null,e,{timeframe:500,minSwipeDistance:10,touchAction:"pan-y"})),Me(e,"swipe",t[19])],p=!0)},p(g,E){const F={};E[0]&131072&&(F.html=g[17]),r.$set(F),E[0]&8&&K(e,"book-content--writing-vertical-rl",g[3]),E[0]&8&&K(e,"book-content--writing-horizontal-rl",!g[3]),E[0]&4096&&K(e,"book-content--hide-furigana",g[12]),E[0]&2048&&K(e,"book-content--hide-spoiler-image",g[11]),E[0]&8192&&K(e,"book-content--furigana-style-partial",g[13]===be.Partial),E[0]&8192&&K(e,"book-content--furigana-style-full",g[13]===be.Full),E[0]&8192&&K(e,"book-content--furigana-style-toggle",g[13]===be.Toggle),E[0]&16&&D(e,"color",g[4],!1),E[0]&256&&o!==(o=`${g[8]}px`)&&D(e,"font-size",o,!1),E[0]&512&&D(e,"--font-family-serif",g[9],!1),E[0]&1024&&D(e,"--font-family-sans-serif",g[10],!1),E[0]&64&&D(e,"--book-content-hint-furigana-font-color",g[6],!1),E[0]&128&&D(e,"--book-content-hint-furigana-shadow-color",g[7],!1),E[0]&2&&i!==(i=`${g[1]}px`)&&D(e,"--book-content-child-width",i,!1),E[0]&4&&a!==(a=`${g[2]}px`)&&D(e,"--book-content-child-height",a,!1),E[0]&2&&D(e,"--book-content-column-count",Math.ceil(g[1]/1e3),!1),g[16]?u&&(Ke(),Q(u,1,1,()=>{u=null}),Ue()):u?(u.p(g,E),E[0]&65536&&W(u,1)):(u=Qt(g),u.c(),W(u,1),u.m(c.parentNode,c)),g[0]?m?(m.p(g,E),E[0]&1&&W(m,1)):(m=Zt(g),m.c(),W(m,1),m.m(f.parentNode,f)):m&&(Ke(),Q(m,1,1,()=>{m=null}),Ue())},i(g){h||(W(r.$$.fragment,g),W(u),W(m),h=!0)},o(g){Q(r.$$.fragment,g),Q(u),Q(m),h=!1},d(g){g&&P(e),we(r),t[32](null),t[33](null),g&&P(l),u&&u.d(g),g&&P(c),m&&m.d(g),g&&P(f),p=!1,bt(C)}}}const xt="overflow-hidden";function Tr(t,e,n){let r,{htmlContent:o}=e,{width:i}=e,{height:a}=e,{verticalMode:l}=e,{fontColor:c}=e,{backgroundColor:f}=e,{hintFuriganaFontColor:h}=e,{hintFuriganaShadowColor:p}=e,{fontSize:C}=e,{fontFamilyGroupOne:u}=e,{fontFamilyGroupTwo:m}=e,{hideSpoilerImage:g}=e,{hideFurigana:E}=e,{furiganaStyle:F}=e,{loadingState:R}=e,{bookmarkData:d}=e,{pageManager:v}=e,{bookmarkManager:w}=e,{exploredCharCount:I}=e,{bookCharCount:O}=e,{isBookmarkScreen:N=!1}=e;const y=pt();let B,G,A,k=[],M,V,H,q=!1,U="",ue=!0,J=0;const S=new ye,T=new ye,te=new Ot(-1),z=new ye,le=new Ot(0),he=new ye,ve=new ye,de=te.pipe(ce(s=>{var j;return((j=k[s])==null?void 0:j.innerHTML)||""})),se=new ye;Vt(()=>{document.body.classList.remove(xt),se.next(),se.complete()}),et([S,T]).pipe(cn(1),ct(()=>ve.pipe(Rt(1))),Ve(se)).subscribe(()=>{if(!A||!M)return;const s=A.getScrollPosByCharCount(J);s<0||M.scrollTo(s,!1)}),z.pipe(Ve(se)).subscribe(s=>{!A||(n(22,I=A.calcExploredCharCount()),s&&(J=I),d.then(pe))}),de.pipe(Sn(),Ve(se)).subscribe(()=>{n(16,q=!1)}),de.pipe(Ve(se)).subscribe(s=>{const j=(Te,qe)=>{if(qe===0){Te();return}requestAnimationFrame(()=>j(Te,qe-1))};j(()=>{n(17,U=s)},2)}),gt(()=>Le(document.body,"wheel",{passive:!0})).pipe(Ko(50),Ve(se)).subscribe(s=>{let j=s.deltaX<0?-1:1;s.deltaX||(j=s.deltaY<0?-1:1),M==null||M.flipPage(j)});function fe(){if(ue){ue=!1;return}!B||(n(27,A=new Er(B,k,le,()=>i,()=>a,()=>r,l,B,document)),n(22,I=0),J=0,n(23,O=A.charCount),A.updateCurrentSection(te.getValue()),y("contentChange",B))}function me(s){s.updateParagraphPos(),n(22,I=s.calcExploredCharCount()),ve.next(s),d.then(pe),H&&(H=!1,d.then(j=>{!j||!w||w.scrollToBookmark(j)})),n(16,q=!0)}function pe(s){const j=s==null?void 0:s.exploredCharCount;!A||!j||n(0,N=A.isCharOnScreen(j))}function Ie(s){if(!M||s.detail.direction!=="left"&&s.detail.direction!=="right")return;const j=s.detail.direction==="left",Te=l?!j:j;M.flipPage(Te?1:-1)}function Ae(s){ee[s?"unshift":"push"](()=>{G=s,n(15,G)})}function Ee(s){ee[s?"unshift":"push"](()=>{B=s,n(14,B)})}return t.$$set=s=>{"htmlContent"in s&&n(24,o=s.htmlContent),"width"in s&&n(1,i=s.width),"height"in s&&n(2,a=s.height),"verticalMode"in s&&n(3,l=s.verticalMode),"fontColor"in s&&n(4,c=s.fontColor),"backgroundColor"in s&&n(5,f=s.backgroundColor),"hintFuriganaFontColor"in s&&n(6,h=s.hintFuriganaFontColor),"hintFuriganaShadowColor"in s&&n(7,p=s.hintFuriganaShadowColor),"fontSize"in s&&n(8,C=s.fontSize),"fontFamilyGroupOne"in s&&n(9,u=s.fontFamilyGroupOne),"fontFamilyGroupTwo"in s&&n(10,m=s.fontFamilyGroupTwo),"hideSpoilerImage"in s&&n(11,g=s.hideSpoilerImage),"hideFurigana"in s&&n(12,E=s.hideFurigana),"furiganaStyle"in s&&n(13,F=s.furiganaStyle),"loadingState"in s&&n(25,R=s.loadingState),"bookmarkData"in s&&n(26,d=s.bookmarkData),"pageManager"in s&&n(20,v=s.pageManager),"bookmarkManager"in s&&n(21,w=s.bookmarkManager),"exploredCharCount"in s&&n(22,I=s.exploredCharCount),"bookCharCount"in s&&n(23,O=s.bookCharCount),"isBookmarkScreen"in s&&n(0,N=s.isBookmarkScreen)},t.$$.update=()=>{if(t.$$.dirty[0]&67108864&&d.then(pe),t.$$.dirty[0]&8&&n(31,r=l?0:20),t.$$.dirty[0]&2&&i&&S.next(i),t.$$.dirty[0]&4&&a&&T.next(a),t.$$.dirty[0]&16777216&&o&&(H=!0),t.$$.dirty[0]&16777216){const s=document.createElement("div");s.innerHTML=o,n(28,k=Array.from(s.children)),te.next(0)}if(t.$$.dirty[0]&805355534|t.$$.dirty[1]&1&&G&&B&&k&&(n(29,M=new Fr(G,B,k,te,le,i,a,r,l,z,he)),n(20,v=M)),t.$$.dirty[0]&167772166&&A&&i&&a&&!R){const s=A;requestAnimationFrame(()=>{me(s)})}t.$$.dirty[0]&167772160&&A&&!R&&he.next(te.getValue()),t.$$.dirty[0]&1744830464&&A&&M&&(n(30,V=new Pr(A,M,ve,te,s=>J=s)),n(21,w=V))},document.body.classList.add(xt),[N,i,a,l,c,f,h,p,C,u,m,g,E,F,B,G,q,U,fe,Ie,v,w,I,O,o,R,d,A,k,M,V,r,Ae,Ee]}class Br extends Ne{constructor(e){super();Ge(this,e,Tr,Dr,He,{htmlContent:24,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontSize:8,fontFamilyGroupOne:9,fontFamilyGroupTwo:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,loadingState:25,bookmarkData:26,pageManager:20,bookmarkManager:21,exploredCharCount:22,bookCharCount:23,isBookmarkScreen:0},null,[-1,-1])}}function Ir(t){var E,F,R;let e,n,r,o,i,a,l,c;function f(d){t[44](d)}function h(d){t[45](d)}function p(d){t[46](d)}function C(d){t[47](d)}function u(d){t[48](d)}function m(d){t[49](d)}let g={htmlContent:t[7],width:(E=t[25])!=null?E:0,height:(F=t[26])!=null?F:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],loadingState:(R=t[27])!=null?R:!0};return t[0]!==void 0&&(g.exploredCharCount=t[0]),t[1]!==void 0&&(g.bookCharCount=t[1]),t[6]!==void 0&&(g.isBookmarkScreen=t[6]),t[2]!==void 0&&(g.bookmarkData=t[2]),t[4]!==void 0&&(g.bookmarkManager=t[4]),t[5]!==void 0&&(g.pageManager=t[5]),e=new Br({props:g}),ee.push(()=>ie(e,"exploredCharCount",f)),ee.push(()=>ie(e,"bookCharCount",h)),ee.push(()=>ie(e,"isBookmarkScreen",p)),ee.push(()=>ie(e,"bookmarkData",C)),ee.push(()=>ie(e,"bookmarkManager",u)),ee.push(()=>ie(e,"pageManager",m)),e.$on("contentChange",t[50]),{c(){Ce(e.$$.fragment)},l(d){_e(e.$$.fragment,d)},m(d,v){Se(e,d,v),c=!0},p(d,v){var I,O,N;const w={};v[0]&128&&(w.htmlContent=d[7]),v[0]&33554432&&(w.width=(I=d[25])!=null?I:0),v[0]&67108864&&(w.height=(O=d[26])!=null?O:0),v[0]&256&&(w.verticalMode=d[8]),v[0]&512&&(w.fontColor=d[9]),v[0]&1024&&(w.backgroundColor=d[10]),v[0]&2048&&(w.hintFuriganaFontColor=d[11]),v[0]&4096&&(w.hintFuriganaShadowColor=d[12]),v[0]&8192&&(w.fontSize=d[13]),v[0]&16384&&(w.fontFamilyGroupOne=d[14]),v[0]&32768&&(w.fontFamilyGroupTwo=d[15]),v[0]&65536&&(w.hideSpoilerImage=d[16]),v[0]&131072&&(w.hideFurigana=d[17]),v[0]&262144&&(w.furiganaStyle=d[18]),v[0]&134217728&&(w.loadingState=(N=d[27])!=null?N:!0),!n&&v[0]&1&&(n=!0,w.exploredCharCount=d[0],ae(()=>n=!1)),!r&&v[0]&2&&(r=!0,w.bookCharCount=d[1],ae(()=>r=!1)),!o&&v[0]&64&&(o=!0,w.isBookmarkScreen=d[6],ae(()=>o=!1)),!i&&v[0]&4&&(i=!0,w.bookmarkData=d[2],ae(()=>i=!1)),!a&&v[0]&16&&(a=!0,w.bookmarkManager=d[4],ae(()=>a=!1)),!l&&v[0]&32&&(l=!0,w.pageManager=d[5],ae(()=>l=!1)),e.$set(w)},i(d){c||(W(e.$$.fragment,d),c=!0)},o(d){Q(e.$$.fragment,d),c=!1},d(d){we(e,d)}}}function Ar(t){var E,F,R;let e,n,r,o,i,a,l,c;function f(d){t[37](d)}function h(d){t[38](d)}function p(d){t[39](d)}function C(d){t[40](d)}function u(d){t[41](d)}function m(d){t[42](d)}let g={htmlContent:t[7],width:(E=t[25])!=null?E:0,height:(F=t[26])!=null?F:0,verticalMode:t[8],fontColor:t[9],backgroundColor:t[10],hintFuriganaFontColor:t[11],hintFuriganaShadowColor:t[12],fontSize:t[13],fontFamilyGroupOne:t[14],fontFamilyGroupTwo:t[15],hideSpoilerImage:t[16],hideFurigana:t[17],furiganaStyle:t[18],secondDimensionMaxValue:t[19],firstDimensionMargin:t[20],autoPositionOnResize:t[21],multiplier:t[23],loadingState:(R=t[27])!=null?R:!0};return t[0]!==void 0&&(g.exploredCharCount=t[0]),t[1]!==void 0&&(g.bookCharCount=t[1]),t[2]!==void 0&&(g.bookmarkData=t[2]),t[3]!==void 0&&(g.autoScroller=t[3]),t[4]!==void 0&&(g.bookmarkManager=t[4]),t[5]!==void 0&&(g.pageManager=t[5]),e=new dr({props:g}),ee.push(()=>ie(e,"exploredCharCount",f)),ee.push(()=>ie(e,"bookCharCount",h)),ee.push(()=>ie(e,"bookmarkData",p)),ee.push(()=>ie(e,"autoScroller",C)),ee.push(()=>ie(e,"bookmarkManager",u)),ee.push(()=>ie(e,"pageManager",m)),e.$on("contentChange",t[43]),{c(){Ce(e.$$.fragment)},l(d){_e(e.$$.fragment,d)},m(d,v){Se(e,d,v),c=!0},p(d,v){var I,O,N;const w={};v[0]&128&&(w.htmlContent=d[7]),v[0]&33554432&&(w.width=(I=d[25])!=null?I:0),v[0]&67108864&&(w.height=(O=d[26])!=null?O:0),v[0]&256&&(w.verticalMode=d[8]),v[0]&512&&(w.fontColor=d[9]),v[0]&1024&&(w.backgroundColor=d[10]),v[0]&2048&&(w.hintFuriganaFontColor=d[11]),v[0]&4096&&(w.hintFuriganaShadowColor=d[12]),v[0]&8192&&(w.fontSize=d[13]),v[0]&16384&&(w.fontFamilyGroupOne=d[14]),v[0]&32768&&(w.fontFamilyGroupTwo=d[15]),v[0]&65536&&(w.hideSpoilerImage=d[16]),v[0]&131072&&(w.hideFurigana=d[17]),v[0]&262144&&(w.furiganaStyle=d[18]),v[0]&524288&&(w.secondDimensionMaxValue=d[19]),v[0]&1048576&&(w.firstDimensionMargin=d[20]),v[0]&2097152&&(w.autoPositionOnResize=d[21]),v[0]&8388608&&(w.multiplier=d[23]),v[0]&134217728&&(w.loadingState=(N=d[27])!=null?N:!0),!n&&v[0]&1&&(n=!0,w.exploredCharCount=d[0],ae(()=>n=!1)),!r&&v[0]&2&&(r=!0,w.bookCharCount=d[1],ae(()=>r=!1)),!o&&v[0]&4&&(o=!0,w.bookmarkData=d[2],ae(()=>o=!1)),!i&&v[0]&8&&(i=!0,w.autoScroller=d[3],ae(()=>i=!1)),!a&&v[0]&16&&(a=!0,w.bookmarkManager=d[4],ae(()=>a=!1)),!l&&v[0]&32&&(l=!0,w.pageManager=d[5],ae(()=>l=!1)),e.$set(w)},i(d){c||(W(e.$$.fragment,d),c=!0)},o(d){Q(e.$$.fragment,d),c=!1},d(d){we(e,d)}}}function Or(t){var p;let e,n,r,o,i=((p=t[28])!=null?p:"")+"",a,l;const c=[Ar,Ir],f=[];function h(C,u){return C[22]===ro.Continuous?0:1}return n=h(t),r=f[n]=c[n](t),{c(){e=Z("div"),r.c(),o=oe(),a=ge(i),this.h()},l(C){e=x(C,"DIV",{class:!0});var u=$(e);r.l(u),u.forEach(P),o=re(C),a=ke(C,i),this.h()},h(){X(e,"class",mr+" py-8")},m(C,u){L(C,e,u),f[n].m(e,null),t[51](e),L(C,o,u),L(C,a,u),l=!0},p(C,u){var g;let m=n;n=h(C),n===m?f[n].p(C,u):(Ke(),Q(f[m],1,1,()=>{f[m]=null}),Ue(),r=f[n],r?r.p(C,u):(r=f[n]=c[n](C),r.c()),W(r,1),r.m(e,null)),(!l||u[0]&268435456)&&i!==(i=((g=C[28])!=null?g:"")+"")&&Fe(a,i)},i(C){l||(W(r),l=!0)},o(C){Q(r),l=!1},d(C){C&&P(e),f[n].d(),t[51](null),C&&P(o),C&&P(a)}}}function it(t){return Number(t.replace(/px$/,""))}function Vr(t,e,n){let r,o,i,a,l,{htmlContent:c}=e,{width:f}=e,{height:h}=e,{verticalMode:p}=e,{fontColor:C}=e,{backgroundColor:u}=e,{hintFuriganaFontColor:m}=e,{hintFuriganaShadowColor:g}=e,{fontSize:E}=e,{fontFamilyGroupOne:F}=e,{fontFamilyGroupTwo:R}=e,{hideSpoilerImage:d}=e,{hideFurigana:v}=e,{furiganaStyle:w}=e,{secondDimensionMaxValue:I}=e,{firstDimensionMargin:O}=e,{autoPositionOnResize:N}=e,{viewMode:y}=e,{exploredCharCount:B}=e,{bookCharCount:G}=e,{multiplier:A}=e,{bookmarkData:k}=e,{autoScroller:M}=e,{bookmarkManager:V}=e,{pageManager:H}=e,{isBookmarkScreen:q}=e;const U=new ye,ue=new ye,J=vo(null);Y(t,J,b=>n(24,r=b));const S=et([J.pipe(Ct(b=>!!b)),et([U,ue]).pipe(Bt(0))]).pipe(_n(0,St),ce(([b])=>getComputedStyle(b)),It({refCount:!0,bufferSize:1})),T=new oo(1),te=S.pipe(ce(b=>f-it(b.paddingLeft)-it(b.paddingRight)));Y(t,te,b=>n(25,o=b));const z=S.pipe(ce(b=>h-it(b.paddingTop)-it(b.paddingBottom)));Y(t,z,b=>n(26,i=b));const le=gt(()=>gn(document)).pipe(ut(b=>{const Mt=pr(b,w);return T.pipe(ut(Ft=>Mt(Ft)))}),Xe());Y(t,le,b=>n(28,l=b));const he=T.pipe(ut(b=>gr(b)),At());Y(t,he,b=>n(27,a=b));function ve(b){B=b,n(0,B)}function de(b){G=b,n(1,G)}function se(b){k=b,n(2,k)}function fe(b){M=b,n(3,M)}function me(b){V=b,n(4,V)}function pe(b){H=b,n(5,H)}const Ie=b=>T.next(b.detail);function Ae(b){B=b,n(0,B)}function Ee(b){G=b,n(1,G)}function s(b){q=b,n(6,q)}function j(b){k=b,n(2,k)}function Te(b){V=b,n(4,V)}function qe(b){H=b,n(5,H)}const vt=b=>T.next(b.detail);function yt(b){ee[b?"unshift":"push"](()=>{r=b,J.set(r)})}return t.$$set=b=>{"htmlContent"in b&&n(7,c=b.htmlContent),"width"in b&&n(35,f=b.width),"height"in b&&n(36,h=b.height),"verticalMode"in b&&n(8,p=b.verticalMode),"fontColor"in b&&n(9,C=b.fontColor),"backgroundColor"in b&&n(10,u=b.backgroundColor),"hintFuriganaFontColor"in b&&n(11,m=b.hintFuriganaFontColor),"hintFuriganaShadowColor"in b&&n(12,g=b.hintFuriganaShadowColor),"fontSize"in b&&n(13,E=b.fontSize),"fontFamilyGroupOne"in b&&n(14,F=b.fontFamilyGroupOne),"fontFamilyGroupTwo"in b&&n(15,R=b.fontFamilyGroupTwo),"hideSpoilerImage"in b&&n(16,d=b.hideSpoilerImage),"hideFurigana"in b&&n(17,v=b.hideFurigana),"furiganaStyle"in b&&n(18,w=b.furiganaStyle),"secondDimensionMaxValue"in b&&n(19,I=b.secondDimensionMaxValue),"firstDimensionMargin"in b&&n(20,O=b.firstDimensionMargin),"autoPositionOnResize"in b&&n(21,N=b.autoPositionOnResize),"viewMode"in b&&n(22,y=b.viewMode),"exploredCharCount"in b&&n(0,B=b.exploredCharCount),"bookCharCount"in b&&n(1,G=b.bookCharCount),"multiplier"in b&&n(23,A=b.multiplier),"bookmarkData"in b&&n(2,k=b.bookmarkData),"autoScroller"in b&&n(3,M=b.autoScroller),"bookmarkManager"in b&&n(4,V=b.bookmarkManager),"pageManager"in b&&n(5,H=b.pageManager),"isBookmarkScreen"in b&&n(6,q=b.isBookmarkScreen)},t.$$.update=()=>{t.$$.dirty[1]&16&&U.next(f),t.$$.dirty[1]&32&&ue.next(h)},[B,G,k,M,V,H,q,c,p,C,u,m,g,E,F,R,d,v,w,I,O,N,y,A,r,o,i,a,l,J,T,te,z,le,he,f,h,ve,de,se,fe,me,pe,Ie,Ae,Ee,s,j,Te,qe,vt,yt]}class zr extends Ne{constructor(e){super();Ge(this,e,Vr,Or,He,{htmlContent:7,width:35,height:36,verticalMode:8,fontColor:9,backgroundColor:10,hintFuriganaFontColor:11,hintFuriganaShadowColor:12,fontSize:13,fontFamilyGroupOne:14,fontFamilyGroupTwo:15,hideSpoilerImage:16,hideFurigana:17,furiganaStyle:18,secondDimensionMaxValue:19,firstDimensionMargin:20,autoPositionOnResize:21,viewMode:22,exploredCharCount:0,bookCharCount:1,multiplier:23,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6},null,[-1,-1])}}function Rr(t,e){const n=document.createTextNode(e);if(t.firstChild){t.replaceChild(n,t.firstChild);return}t.appendChild(n)}function Lr(t,e,n){let{styleSheet:r}=e,o;return Nn(()=>{n(1,o=document.createElement("style")),document.head.appendChild(o)}),Vt(()=>{o&&document.head.removeChild(o)}),t.$$set=i=>{"styleSheet"in i&&n(0,r=i.styleSheet)},t.$$.update=()=>{t.$$.dirty&3&&o&&Rr(o,r)},[r,o]}class Nr extends Ne{constructor(e){super();Ge(this,e,Lr,null,He,{styleSheet:0})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */class Gr{constructor(e){this.document=e,this.fallbackSpec=$t(this.document)}get fullscreenEnabled(){var e;return(e=this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled"))!=null?e:!1}get fullscreenElement(){var e;return(e=this.fallbackSpec("fullscreenElement","webkitFullscreenElement"))!=null?e:null}async requestFullscreen(e,n){const r=$t(e)("requestFullscreen","webkitRequestFullscreen");!r||await r(n)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function $t(t){return(e,n)=>{var r;return(r=en(t,e))!=null?r:en(t,n)}}function en(t,e){const n=t[e];return typeof n=="function"?n.bind(t):n}const ft=new Gr(document);/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function Hr(t,e){return qr(t).pipe(ce(n=>{const r=e.createElement("div");return r.innerHTML=n,Xr(r),Wr(r,e),jr(r),r.innerHTML}))}function qr(t){return new De(e=>{const{blobs:n}=t;let{elementHtml:r}=t;const o=[];return Object.entries(n).forEach(([i,a])=>{const l=URL.createObjectURL(a);o.push(l),r=r.replaceAll(Mo(i),l).replaceAll(`ttu:${i}`,l)}),e.next(r),()=>{o.forEach(i=>URL.revokeObjectURL(i))}})}function Xr(t){Array.from(t.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function Wr(t,e){const n=()=>{let o=[...t.children];const i=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return i>0&&i<o.length&&(o=o.slice(i)),o},r=(o,i)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||i).insertBefore(a,o),a.appendChild(o)};n().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(i=>!yn(i)).forEach(i=>r(i,o)),Array.from(o.getElementsByTagName("svg")).filter(i=>i.getElementsByTagName("image").length).forEach(i=>r(i,o))})}function jr(t){t.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Yr=Tn;function Tn(t,e,n){t instanceof RegExp&&(t=tn(t,n)),e instanceof RegExp&&(e=tn(e,n));const r=Bn(t,e,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+t.length,r[1]),post:n.slice(r[1]+e.length)}}function tn(t,e){const n=e.match(t);return n?n[0]:null}Tn.range=Bn;function Bn(t,e,n){let r,o,i,a,l,c=n.indexOf(t),f=n.indexOf(e,c+1),h=c;if(c>=0&&f>0){if(t===e)return[c,f];for(r=[],i=n.length;h>=0&&!l;)h===c?(r.push(h),c=n.indexOf(t,h+1)):r.length===1?l=[r.pop(),f]:(o=r.pop(),o<i&&(i=o,a=f),f=n.indexOf(e,h+1)),h=c<f&&c>=0?c:f;r.length&&(l=[i,a])}return l}function Kr(t,e={}){const r=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function i(k){throw new Error(`CSS parse error: ${k}`)}function a(k){const M=k.exec(t);if(M)return t=t.slice(M[0].length),M}function l(){return a(/^{\s*/)}function c(){return a(/^}/)}function f(){a(/^\s*/)}function h(){if(f(),t[0]!=="/"||t[1]!=="*")return;let k=2;for(;t[k]&&(t[k]!=="*"||t[k+1]!=="/");)k++;if(!t[k])return i("end of comment is missing");const M=t.slice(2,k);return t=t.slice(k+2),{type:"comment",comment:M}}function p(){const k=[];let M;for(;M=h();)k.push(M);return r.removeComments?[]:k}function C(){for(f();t[0]==="}";)i("extra closing bracket");const k=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(k)return k[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(M){return M.replace(/,/g,"\u200C")}).split(/\s*(?![^(]*\)),\s*/).map(function(M){return M.replace(/\u200C/g,",")})}function u(){if(t[0]==="@")return B();a(/^([;\s]*)+/);const k=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let M=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!M)return;if(M=M[0].trim(),!a(/^:\s*/))return i("property missing ':'");const V=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),H={type:"declaration",property:M.replace(k,""),value:V?V[0].replace(k,"").trim():""};return a(/^[;\s]*/),H}function m(){if(!l())return i("missing '{'");let k,M=p();for(;k=u();)M.push(k),M=M.concat(p());return c()?M:i("missing '}'")}function g(){f();const k=[];let M;for(;M=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)k.push(M[1]),a(/^,\s*/);if(k.length)return{type:"keyframe",values:k,declarations:m()}}function E(){let k=a(/^@([-\w]+)?keyframes\s*/);if(!k)return;const M=k[1];if(k=a(/^([-\w]+)\s*/),!k)return i("@keyframes missing name");const V=k[1];if(!l())return i("@keyframes missing '{'");let H,q=p();for(;H=g();)q.push(H),q=q.concat(p());return c()?{type:"keyframes",name:V,vendor:M,keyframes:q}:i("@keyframes missing '}'")}function F(){if(a(/^@page */)){const M=C()||[];return{type:"page",selectors:M,declarations:m()}}}function R(){const k=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(k){const M=`${k[1]}-${k[2]}`+(k[3]?`-${k[3]}`:"");return{type:"page-margin-box",name:M,declarations:m()}}}function d(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:m()}}function v(){const k=a(/^@supports *([^{]+)/);if(k)return{type:"supports",supports:k[1].trim(),rules:A()}}function w(){if(a(/^@host\s*/))return{type:"host",rules:A()}}function I(){const k=a(/^@media([^{]+)*/);if(k)return{type:"media",media:(k[1]||"").trim(),rules:A()}}function O(){const k=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(k)return{type:"custom-media",name:k[1].trim(),media:k[2].trim()}}function N(){const k=a(/^@([-\w]+)?document *([^{]+)/);if(k)return{type:"document",document:k[2].trim(),vendor:k[1]?k[1].trim():null,rules:A()}}function y(){const k=a(/^@(import|charset|namespace)\s*([^;]+);/);if(k)return{type:k[1],name:k[2].trim()}}function B(){if(f(),t[0]==="@"){const k=y()||d()||I()||E()||v()||N()||O()||w()||F()||R();if(k&&!r.preserveStatic){let M=!1;return k.declarations?M=k.declarations.some(V=>/var\(/.test(V.value)):M=(k.keyframes||k.rules||[]).some(H=>(H.declarations||[]).some(q=>/var\(/.test(q.value))),M?k:{}}return k}}function G(){if(!r.preserveStatic){const V=Yr("{","}",t);if(V){const H=/:(?:root|host)(?![.:#(])/.test(V.pre)&&/--\S*\s*:/.test(V.body),q=/var\(/.test(V.body);if(!H&&!q)return t=t.slice(V.end+1),{}}}const k=C()||[],M=r.preserveStatic?m():m().filter(V=>{const H=k.some(U=>/:(?:root|host)(?![.:#(])/.test(U))&&/^--\S/.test(V.property),q=/var\(/.test(V.value);return H||q});return k.length||i("selector missing"),{type:"rule",selectors:k,declarations:M}}function A(k){if(!k&&!l())return i("missing '{'");let M,V=p();for(;t.length&&(k||t[0]!=="}")&&(M=B()||G());)M.type&&V.push(M),V=V.concat(p());return!k&&!c()?i("missing '}'"):V}return{type:"stylesheet",stylesheet:{rules:A(!0),errors:o}}}function Ur(t,e="",n){const r={charset(i){return"@charset "+i.name+";"},comment(i){return i.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+i.comment+"*/":""},"custom-media"(i){return"@custom-media "+i.name+" "+i.media+";"},declaration(i){return i.property+":"+i.value+";"},document(i){return"@"+(i.vendor||"")+"document "+i.document+"{"+o(i.rules)+"}"},"font-face"(i){return"@font-face{"+o(i.declarations)+"}"},host(i){return"@host{"+o(i.rules)+"}"},import(i){return"@import "+i.name+";"},keyframe(i){return i.values.join(",")+"{"+o(i.declarations)+"}"},keyframes(i){return"@"+(i.vendor||"")+"keyframes "+i.name+"{"+o(i.keyframes)+"}"},media(i){return"@media "+i.media+"{"+o(i.rules)+"}"},namespace(i){return"@namespace "+i.name+";"},page(i){return"@page "+(i.selectors.length?i.selectors.join(", "):"")+"{"+o(i.declarations)+"}"},"page-margin-box"(i){return"@"+i.name+"{"+o(i.declarations)+"}"},rule(i){const a=i.declarations;if(a.length)return i.selectors.join(",")+"{"+o(a)+"}"},supports(i){return"@supports "+i.supports+"{"+o(i.rules)+"}"}};function o(i){let a="";for(let l=0;l<i.length;l++){const c=i[l];n&&n(c);const f=r[c.type](c);f&&(a+=f,f.length&&c.selectors&&(a+=e))}return a}return o(t.stylesheet.rules)}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */const Jr=/\s?html\s?/gi,Qr=/\s?body\s?/gi;function Zr(t,e){const r=Kr(t.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(i=>Jr.test(i)||Qr.test(i)));return r.forEach(o=>{const i={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new ti(o.declarations,i);o.declarations.forEach(l=>{Pt(i,$r(l)),Pt(i,ei(l)),Pt(i,a.convert(l))}),Object.entries(i).forEach(([l,c])=>{o.declarations.push({type:"declaration",property:l,value:c})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),r.push(ni()),r.forEach(o=>{o.selectors=xr(o.selectors,e)}),Ur({stylesheet:{rules:r},type:"stylesheet"})}function xr(t,e){return t.map(n=>`${e} ${n}`)}function Pt(t,e){return e&&(t[e.key]=e.value),t}function $r(t){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(t.property);if(e)return{key:e[1],value:t.value}}function ei(t){if(t.property==="font-family"){let e=t.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:t.property,value:e}}}class ti{constructor(e,n){this.ruleDeclarations=e,this.newDeclarations=n}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(n=>n.type==="declaration"&&n.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function ni(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function oi(t,e,n){return Hr(t,n).pipe(ce(r=>({htmlContent:r,styleSheet:Zr(t,e)})))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ri(t){return new De(e=>t.subscribe(n=>{e.next(n)}))}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function at(t=kn){return e=>t?e:Cn}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function nn(t,e,n){return r=>new De(o=>{const i=t();return r.pipe(hn(St),Fo(()=>n(i))).subscribe({next:a=>{e(a,i),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ii(t,e,n,r,o,i,a){switch(e[t.code]){case Oe.BOOKMARK:return n(),!0;case Oe.JUMP_TO_BOOKMARK:return r(),!0;case Oe.AUTO_SCROLL_TOGGLE:return i==null||i.toggle(),!0;case Oe.AUTO_SCROLL_INCREASE:return o(1),!0;case Oe.AUTO_SCROLL_DECREASE:return o(-1),!0;case Oe.NEXT_PAGE:return a==null||a.nextPage(),!0;case Oe.PREV_PAGE:return a==null||a.prevPage(),!0;default:return!1}}function on(t){let e,n,r,o,i,a;return n=new je({props:{icon:Un}}),{c(){e=Z("div"),Ce(n.$$.fragment),this.h()},l(l){e=x(l,"DIV",{role:!0,class:!0});var c=$(e);_e(n.$$.fragment,c),c.forEach(P),this.h()},h(){X(e,"role","button"),X(e,"class",r="flex h-full items-center text-xl xl:text-lg "+lt+" "+st+" cursor-pointer")},m(l,c){L(l,e,c),Se(n,e,null),o=!0,i||(a=Me(e,"click",t[5]),i=!0)},p:xe,i(l){o||(W(n.$$.fragment,l),o=!0)},o(l){Q(n.$$.fragment,l),o=!1},d(l){l&&P(e),we(n),i=!1,a()}}}function ai(t){let e,n,r,o,i,a,l,c,f,h,p,C,u,m,g,E,F,R,d,v,w;o=new je({props:{icon:t[2]?Tt:Wt}});let I=t[1]&&on(t);return m=new je({props:{icon:Wn}}),R=new je({props:{icon:jn}}),{c(){e=Z("div"),n=Z("div"),r=Z("div"),Ce(o.$$.fragment),i=oe(),a=Z("div"),l=ge(t[0]),c=ge("x"),f=oe(),h=Z("div"),I&&I.c(),p=oe(),C=Z("a"),u=Z("span"),Ce(m.$$.fragment),g=oe(),E=Z("a"),F=Z("span"),Ce(R.$$.fragment),this.h()},l(O){e=x(O,"DIV",{class:!0});var N=$(e);n=x(N,"DIV",{class:!0});var y=$(n);r=x(y,"DIV",{class:!0,role:!0});var B=$(r);_e(o.$$.fragment,B),B.forEach(P),i=re(y),a=x(y,"DIV",{class:!0});var G=$(a);l=ke(G,t[0]),c=ke(G,"x"),G.forEach(P),y.forEach(P),f=re(N),h=x(N,"DIV",{class:!0});var A=$(h);I&&I.l(A),p=re(A),C=x(A,"A",{href:!0});var k=$(C);u=x(k,"SPAN",{class:!0});var M=$(u);_e(m.$$.fragment,M),M.forEach(P),k.forEach(P),g=re(A),E=x(A,"A",{href:!0});var V=$(E);F=x(V,"SPAN",{class:!0});var H=$(F);_e(R.$$.fragment,H),H.forEach(P),V.forEach(P),A.forEach(P),N.forEach(P),this.h()},h(){X(r,"class","flex h-full items-center text-xl xl:text-lg "+lt+" "+st+" cursor-pointer"),X(r,"role","button"),X(a,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg"),X(n,"class","flex transform-gpu "+Yn),X(u,"class","flex h-full items-center text-xl xl:text-lg "+lt+" "+st+" cursor-pointer"),X(C,"href","/settings"),X(F,"class","flex h-full items-center text-xl xl:text-lg "+lt+" "+st+" cursor-pointer"),X(E,"href","/manage"),X(h,"class","flex transform-gpu "+Kn),X(e,"class","flex h-12 justify-between bg-gray-700 px-4 text-white md:px-8 xl:h-10")},m(O,N){L(O,e,N),ne(e,n),ne(n,r),Se(o,r,null),ne(n,i),ne(n,a),ne(a,l),ne(a,c),ne(e,f),ne(e,h),I&&I.m(h,null),ne(h,p),ne(h,C),ne(C,u),Se(m,u,null),ne(h,g),ne(h,E),ne(E,F),Se(R,F,null),d=!0,v||(w=[Me(r,"click",t[4]),Me(C,"click",t[6]),Me(E,"click",t[7])],v=!0)},p(O,[N]){const y={};N&4&&(y.icon=O[2]?Tt:Wt),o.$set(y),(!d||N&1)&&Fe(l,O[0]),O[1]?I?(I.p(O,N),N&2&&W(I,1)):(I=on(O),I.c(),W(I,1),I.m(h,p)):I&&(Ke(),Q(I,1,1,()=>{I=null}),Ue())},i(O){d||(W(o.$$.fragment,O),W(I),W(m.$$.fragment,O),W(R.$$.fragment,O),d=!0)},o(O){Q(o.$$.fragment,O),Q(I),Q(m.$$.fragment,O),Q(R.$$.fragment,O),d=!1},d(O){O&&P(e),we(o),I&&I.d(),we(m),we(R),v=!1,bt(w)}}}function li(t,e,n){let{autoScrollMultiplier:r}=e,{showFullscreenButton:o}=e,{isBookmarkScreen:i}=e;const a=pt(),l=()=>a("bookmarkClick"),c=()=>a("fullscreenClick"),f=()=>a("settingsClick"),h=()=>a("bookManagerClick");return t.$$set=p=>{"autoScrollMultiplier"in p&&n(0,r=p.autoScrollMultiplier),"showFullscreenButton"in p&&n(1,o=p.showFullscreenButton),"isBookmarkScreen"in p&&n(2,i=p.isBookmarkScreen)},[r,o,i,a,l,c,f,h]}class si extends Ne{constructor(e){super();Ge(this,e,li,ai,He,{autoScrollMultiplier:0,showFullscreenButton:1,isBookmarkScreen:2})}}/**
 * @license BSD-3-Clause
 * Copyright (c) 2022, ッツ Reader Authors
 * All rights reserved.
 */function ui(t,e){const n=r=>{!r.defaultPrevented&&!t.contains(r.target)&&e(r)};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}const{document:Dt}=un;function rn(t){let e,n,r,o,i,a,l,c;function f(p){t[48](p)}let h={showFullscreenButton:ft.fullscreenEnabled,autoScrollMultiplier:t[11]};return t[5]!==void 0&&(h.isBookmarkScreen=t[5]),n=new si({props:h}),ee.push(()=>ie(n,"isBookmarkScreen",f)),n.$on("fullscreenClick",t[46]),n.$on("bookmarkClick",t[43]),n.$on("bookManagerClick",t[45]),n.$on("settingsClick",t[43]),{c(){e=Z("div"),Ce(n.$$.fragment),this.h()},l(p){e=x(p,"DIV",{class:!0});var C=$(e);_e(n.$$.fragment,C),C.forEach(P),this.h()},h(){X(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(p,C){L(p,e,C),Se(n,e,null),a=!0,l||(c=fn(o=ui.call(null,e,t[49])),l=!0)},p(p,C){t=p;const u={};C[0]&2048&&(u.autoScrollMultiplier=t[11]),!r&&C[0]&32&&(r=!0,u.isBookmarkScreen=t[5],ae(()=>r=!1)),n.$set(u),o&&Gn(o.update)&&C[0]&16&&o.update.call(null,t[49])},i(p){a||(W(n.$$.fragment,p),p&&Hn(()=>{i||(i=Gt(e,qt,{y:-300,easing:Ht},!0)),i.run(1)}),a=!0)},o(p){Q(n.$$.fragment,p),p&&(i||(i=Gt(e,qt,{y:-300,easing:Ht},!1)),i.run(0)),a=!1},d(p){p&&P(e),we(n),p&&i&&i.end(),l=!1,c()}}}function fi(t){var r;let e=((r=t[31])!=null?r:"")+"",n;return{c(){n=ge(e)},l(o){n=ke(o,e)},m(o,i){L(o,n,i)},p(o,i){var a;i[1]&1&&e!==(e=((a=o[31])!=null?a:"")+"")&&Fe(n,e)},i:xe,o:xe,d(o){o&&P(n)}}}function ci(t){var k,M,V,H,q,U,ue,J;let e,n,r,o,i,a,l,c,f,h,p,C=((k=t[28])!=null?k:"")+"",u,m,g=((M=t[29])!=null?M:"")+"",E,F,R=((V=t[30])!=null?V:"")+"",d,v;e=new Nr({props:{styleSheet:t[12].styleSheet}});function w(S){t[50](S)}function I(S){t[51](S)}function O(S){t[52](S)}function N(S){t[53](S)}function y(S){t[54](S)}function B(S){t[55](S)}function G(S){t[56](S)}let A={htmlContent:t[12].htmlContent,width:(H=t[13])!=null?H:0,height:(q=t[14])!=null?q:0,verticalMode:t[15],fontColor:(U=t[16])==null?void 0:U.fontColor,backgroundColor:t[17],hintFuriganaFontColor:(ue=t[16])==null?void 0:ue.hintFuriganaFontColor,hintFuriganaShadowColor:(J=t[16])==null?void 0:J.hintFuriganaShadowColor,fontSize:t[18],fontFamilyGroupOne:t[19],fontFamilyGroupTwo:t[20],hideSpoilerImage:t[21],hideFurigana:t[22],furiganaStyle:t[23],viewMode:t[24],secondDimensionMaxValue:t[25],firstDimensionMargin:t[26],autoPositionOnResize:t[27],multiplier:t[11]};return t[7]!==void 0&&(A.exploredCharCount=t[7]),t[8]!==void 0&&(A.bookCharCount=t[8]),t[5]!==void 0&&(A.isBookmarkScreen=t[5]),t[0]!==void 0&&(A.bookmarkData=t[0]),t[1]!==void 0&&(A.autoScroller=t[1]),t[2]!==void 0&&(A.bookmarkManager=t[2]),t[3]!==void 0&&(A.pageManager=t[3]),r=new zr({props:A}),ee.push(()=>ie(r,"exploredCharCount",w)),ee.push(()=>ie(r,"bookCharCount",I)),ee.push(()=>ie(r,"isBookmarkScreen",O)),ee.push(()=>ie(r,"bookmarkData",N)),ee.push(()=>ie(r,"autoScroller",y)),ee.push(()=>ie(r,"bookmarkManager",B)),ee.push(()=>ie(r,"pageManager",G)),{c(){Ce(e.$$.fragment),n=oe(),Ce(r.$$.fragment),p=oe(),u=ge(C),m=oe(),E=ge(g),F=oe(),d=ge(R)},l(S){_e(e.$$.fragment,S),n=re(S),_e(r.$$.fragment,S),p=re(S),u=ke(S,C),m=re(S),E=ke(S,g),F=re(S),d=ke(S,R)},m(S,T){Se(e,S,T),L(S,n,T),Se(r,S,T),L(S,p,T),L(S,u,T),L(S,m,T),L(S,E,T),L(S,F,T),L(S,d,T),v=!0},p(S,T){var le,he,ve,de,se,fe,me,pe;const te={};T[0]&4096&&(te.styleSheet=S[12].styleSheet),e.$set(te);const z={};T[0]&4096&&(z.htmlContent=S[12].htmlContent),T[0]&8192&&(z.width=(le=S[13])!=null?le:0),T[0]&16384&&(z.height=(he=S[14])!=null?he:0),T[0]&32768&&(z.verticalMode=S[15]),T[0]&65536&&(z.fontColor=(ve=S[16])==null?void 0:ve.fontColor),T[0]&131072&&(z.backgroundColor=S[17]),T[0]&65536&&(z.hintFuriganaFontColor=(de=S[16])==null?void 0:de.hintFuriganaFontColor),T[0]&65536&&(z.hintFuriganaShadowColor=(se=S[16])==null?void 0:se.hintFuriganaShadowColor),T[0]&262144&&(z.fontSize=S[18]),T[0]&524288&&(z.fontFamilyGroupOne=S[19]),T[0]&1048576&&(z.fontFamilyGroupTwo=S[20]),T[0]&2097152&&(z.hideSpoilerImage=S[21]),T[0]&4194304&&(z.hideFurigana=S[22]),T[0]&8388608&&(z.furiganaStyle=S[23]),T[0]&16777216&&(z.viewMode=S[24]),T[0]&33554432&&(z.secondDimensionMaxValue=S[25]),T[0]&67108864&&(z.firstDimensionMargin=S[26]),T[0]&134217728&&(z.autoPositionOnResize=S[27]),T[0]&2048&&(z.multiplier=S[11]),!o&&T[0]&128&&(o=!0,z.exploredCharCount=S[7],ae(()=>o=!1)),!i&&T[0]&256&&(i=!0,z.bookCharCount=S[8],ae(()=>i=!1)),!a&&T[0]&32&&(a=!0,z.isBookmarkScreen=S[5],ae(()=>a=!1)),!l&&T[0]&1&&(l=!0,z.bookmarkData=S[0],ae(()=>l=!1)),!c&&T[0]&2&&(c=!0,z.autoScroller=S[1],ae(()=>c=!1)),!f&&T[0]&4&&(f=!0,z.bookmarkManager=S[2],ae(()=>f=!1)),!h&&T[0]&8&&(h=!0,z.pageManager=S[3],ae(()=>h=!1)),r.$set(z),(!v||T[0]&268435456)&&C!==(C=((fe=S[28])!=null?fe:"")+"")&&Fe(u,C),(!v||T[0]&536870912)&&g!==(g=((me=S[29])!=null?me:"")+"")&&Fe(E,g),(!v||T[0]&1073741824)&&R!==(R=((pe=S[30])!=null?pe:"")+"")&&Fe(d,R)},i(S){v||(W(e.$$.fragment,S),W(r.$$.fragment,S),v=!0)},o(S){Q(e.$$.fragment,S),Q(r.$$.fragment,S),v=!1},d(S){we(e,S),S&&P(n),we(r,S),S&&P(p),S&&P(u),S&&P(m),S&&P(E),S&&P(F),S&&P(d)}}}function an(t){let e,n,r,o,i,a=(t[7]/t[8]*100).toFixed(2)+"",l,c;return{c(){e=Z("div"),n=ge(t[7]),r=ge(" / "),o=ge(t[8]),i=ge(" ("),l=ge(a),c=ge("%)"),this.h()},l(f){e=x(f,"DIV",{class:!0});var h=$(e);n=ke(h,t[7]),r=ke(h," / "),o=ke(h,t[8]),i=ke(h," ("),l=ke(h,a),c=ke(h,"%)"),h.forEach(P),this.h()},h(){var f;X(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),D(e,"color",(f=t[16])==null?void 0:f.tooltipTextFontColor,!1)},m(f,h){L(f,e,h),ne(e,n),ne(e,r),ne(e,o),ne(e,i),ne(e,l),ne(e,c)},p(f,h){var p;h[0]&128&&Fe(n,f[7]),h[0]&256&&Fe(o,f[8]),h[0]&384&&a!==(a=(f[7]/f[8]*100).toFixed(2)+"")&&Fe(l,a),h[0]&65536&&D(e,"color",(p=f[16])==null?void 0:p.tooltipTextFontColor,!1)},d(f){f&&P(e)}}}function hi(t){var I,O,N;let e,n,r=((I=t[10])!=null?I:"")+"",o,i,a,l,c,f,h,p,C,u,m,g,E;Dt.title=e=Xt((N=(O=t[9])==null?void 0:O.title)!=null?N:"");let F=t[4]&&rn(t);const R=[ci,fi],d=[];function v(y,B){return y[12]?0:1}f=v(t),h=d[f]=R[f](t);let w=t[6]&&t[8]&&an(t);return{c(){n=oe(),o=ge(r),i=oe(),a=Z("button"),l=oe(),F&&F.c(),c=oe(),h.c(),p=oe(),w&&w.c(),C=oe(),u=Z("button"),this.h()},l(y){qn('[data-svelte="svelte-rnuhm6"]',Dt.head).forEach(P),n=re(y),o=ke(y,r),i=re(y),a=x(y,"BUTTON",{class:!0}),$(a).forEach(P),l=re(y),F&&F.l(y),c=re(y),h.l(y),p=re(y),w&&w.l(y),C=re(y),u=x(y,"BUTTON",{class:!0}),$(u).forEach(P),this.h()},h(){X(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),X(u,"class","fixed inset-x-0 bottom-0 z-10 h-8 w-full cursor-pointer")},m(y,B){L(y,n,B),L(y,o,B),L(y,i,B),L(y,a,B),L(y,l,B),F&&F.m(y,B),L(y,c,B),d[f].m(y,B),L(y,p,B),w&&w.m(y,B),L(y,C,B),L(y,u,B),m=!0,g||(E=[Me(window,"keydown",t[42]),Me(a,"click",t[47]),Me(u,"click",t[57])],g=!0)},p(y,B){var A,k,M;(!m||B[0]&512)&&e!==(e=Xt((k=(A=y[9])==null?void 0:A.title)!=null?k:""))&&(Dt.title=e),(!m||B[0]&1024)&&r!==(r=((M=y[10])!=null?M:"")+"")&&Fe(o,r),y[4]?F?(F.p(y,B),B[0]&16&&W(F,1)):(F=rn(y),F.c(),W(F,1),F.m(c.parentNode,c)):F&&(Ke(),Q(F,1,1,()=>{F=null}),Ue());let G=f;f=v(y),f===G?d[f].p(y,B):(Ke(),Q(d[G],1,1,()=>{d[G]=null}),Ue(),h=d[f],h?h.p(y,B):(h=d[f]=R[f](y),h.c()),W(h,1),h.m(p.parentNode,p)),y[6]&&y[8]?w?w.p(y,B):(w=an(y),w.c(),w.m(C.parentNode,C)):w&&(w.d(1),w=null)},i(y){m||(W(F),W(h),m=!0)},o(y){Q(F),Q(h),m=!1},d(y){y&&P(n),y&&P(o),y&&P(i),y&&P(a),y&&P(l),F&&F.d(y),y&&P(c),d[f].d(y),y&&P(p),w&&w.d(y),y&&P(C),y&&P(u),g=!1,bt(E)}}}const ln="background-color",sn="writing-mode";function di(t,e,n){let r,o,i,a,l,c,f,h,p,C,u,m,g,E,F,R,d,v,w,I,O,N,y;Y(t,Et,_=>n(11,i=_)),Y(t,uo,_=>n(15,f=_)),Y(t,fo,_=>n(18,C=_)),Y(t,co,_=>n(19,u=_)),Y(t,ho,_=>n(20,m=_)),Y(t,mo,_=>n(21,g=_)),Y(t,go,_=>n(22,E=_)),Y(t,ko,_=>n(23,F=_)),Y(t,po,_=>n(24,R=_)),Y(t,bo,_=>n(25,d=_)),Y(t,Co,_=>n(26,v=_)),Y(t,_o,_=>n(27,w=_));const B=gt(()=>ri(Jn)).pipe(ce(_=>Number(_.url.searchParams.get("id"))),It({refCount:!0,bufferSize:1})),G=B.pipe(ct(_=>ot.getData(_)),At());Y(t,G,_=>n(9,r=_));const A=G.pipe(Be(_=>{_||lo("/manage")}),Xe());Y(t,A,_=>n(31,y=_));let k=Promise.resolve(void 0);const M=G.pipe(Be(_=>{!_||n(0,k=ot.getBookmark(_.id))}),Xe());Y(t,M,_=>n(28,I=_));const V=G.pipe(ct(_=>_?oi(_,".book-content",document):zt),It({refCount:!0,bufferSize:1}));Y(t,V,_=>n(12,a=_));const H=gt(()=>Le(visualViewport,"resize")).pipe(At()),q=H.pipe(Bt(0),ce(()=>visualViewport.width),at());Y(t,q,_=>n(13,l=_));const U=H.pipe(Bt(0),ce(()=>visualViewport.height),at());Y(t,U,_=>n(14,c=_));const ue=io.pipe(ce(_=>Eo.get(_)),Ct(_=>!!_));Y(t,ue,_=>n(16,h=_));const J=ue.pipe(ce(_=>_.backgroundColor));Y(t,J,_=>n(17,p=_));const S=J.pipe(nn(()=>document.body,(_,Pe)=>Pe.style.setProperty(ln,_),_=>_.style.removeProperty(ln)),Xe(),at());Y(t,S,_=>n(29,O=_));const T=ao.pipe(nn(()=>document.documentElement,(_,Pe)=>Pe.style.setProperty(sn,_),_=>_.style.removeProperty(sn)),Xe(),at());Y(t,T,_=>n(30,N=_));let te,z,le;function he(_){!ii(_,so.getValue(),de,se,Vn=>Et.next(Et.getValue()+Vn),te,le)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),_.preventDefault())}function ve(){let _;return B.subscribe(Pe=>_=Pe).unsubscribe(),_}async function de(){const _=ve();if(!_||!z)return;const Pe=z.formatBookmarkData(_);await ot.putBookmark(Pe),n(0,k=Promise.resolve(Pe))}async function se(){const _=await k;!_||!z||z.scrollToBookmark(_)}let fe=!0,me=!1;const pe=Lt(2500).pipe(Be(()=>n(4,fe=!1)),Xe());Y(t,pe,_=>n(10,o=_));function Ie(){ot.deleteLastItem(),de()}function Ae(){if(!ft.fullscreenElement){ft.requestFullscreen(document.documentElement);return}ft.exitFullscreen()}let Ee=!0,s=0,j=0;const Te=()=>n(4,fe=!0);function qe(_){me=_,n(5,me)}const vt=()=>n(4,fe=!1);function yt(_){s=_,n(7,s)}function b(_){j=_,n(8,j)}function Mt(_){me=_,n(5,me)}function Ft(_){k=_,n(0,k)}function In(_){te=_,n(1,te)}function An(_){z=_,n(2,z)}function On(_){le=_,n(3,le)}return[k,te,z,le,fe,me,Ee,s,j,r,o,i,a,l,c,f,h,p,C,u,m,g,E,F,R,d,v,w,I,O,N,y,G,A,M,V,q,U,ue,J,S,T,he,de,pe,Ie,Ae,Te,qe,vt,yt,b,Mt,Ft,In,An,On,()=>n(6,Ee=!Ee)]}class yi extends Ne{constructor(e){super();Ge(this,e,di,hi,He,{},null,[-1,-1])}}export{yi as default};
